!function(e){"use strict";function d(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function a(e,t,i,n,r,o){return d((t=d(d(t,e),d(n,o)))<<r|t>>>32-r,i)}function h(e,t,i,n,r,o,s){return a(t&i|~t&n,e,t,r,o,s)}function p(e,t,i,n,r,o,s){return a(t&n|i&~n,e,t,r,o,s)}function f(e,t,i,n,r,o,s){return a(t^i^n,e,t,r,o,s)}function g(e,t,i,n,r,o,s){return a(i^(t|~n),e,t,r,o,s)}function s(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i,n,r,o,s=1732584193,a=-271733879,l=-1732584194,u=271733878,c=0;c<e.length;c+=16)s=h(i=s,n=a,r=l,o=u,e[c],7,-680876936),u=h(u,s,a,l,e[c+1],12,-389564586),l=h(l,u,s,a,e[c+2],17,606105819),a=h(a,l,u,s,e[c+3],22,-1044525330),s=h(s,a,l,u,e[c+4],7,-176418897),u=h(u,s,a,l,e[c+5],12,1200080426),l=h(l,u,s,a,e[c+6],17,-1473231341),a=h(a,l,u,s,e[c+7],22,-45705983),s=h(s,a,l,u,e[c+8],7,1770035416),u=h(u,s,a,l,e[c+9],12,-1958414417),l=h(l,u,s,a,e[c+10],17,-42063),a=h(a,l,u,s,e[c+11],22,-1990404162),s=h(s,a,l,u,e[c+12],7,1804603682),u=h(u,s,a,l,e[c+13],12,-40341101),l=h(l,u,s,a,e[c+14],17,-1502002290),s=p(s,a=h(a,l,u,s,e[c+15],22,1236535329),l,u,e[c+1],5,-165796510),u=p(u,s,a,l,e[c+6],9,-1069501632),l=p(l,u,s,a,e[c+11],14,643717713),a=p(a,l,u,s,e[c],20,-373897302),s=p(s,a,l,u,e[c+5],5,-701558691),u=p(u,s,a,l,e[c+10],9,38016083),l=p(l,u,s,a,e[c+15],14,-660478335),a=p(a,l,u,s,e[c+4],20,-405537848),s=p(s,a,l,u,e[c+9],5,568446438),u=p(u,s,a,l,e[c+14],9,-1019803690),l=p(l,u,s,a,e[c+3],14,-187363961),a=p(a,l,u,s,e[c+8],20,1163531501),s=p(s,a,l,u,e[c+13],5,-1444681467),u=p(u,s,a,l,e[c+2],9,-51403784),l=p(l,u,s,a,e[c+7],14,1735328473),s=f(s,a=p(a,l,u,s,e[c+12],20,-1926607734),l,u,e[c+5],4,-378558),u=f(u,s,a,l,e[c+8],11,-2022574463),l=f(l,u,s,a,e[c+11],16,1839030562),a=f(a,l,u,s,e[c+14],23,-35309556),s=f(s,a,l,u,e[c+1],4,-1530992060),u=f(u,s,a,l,e[c+4],11,1272893353),l=f(l,u,s,a,e[c+7],16,-155497632),a=f(a,l,u,s,e[c+10],23,-1094730640),s=f(s,a,l,u,e[c+13],4,681279174),u=f(u,s,a,l,e[c],11,-358537222),l=f(l,u,s,a,e[c+3],16,-722521979),a=f(a,l,u,s,e[c+6],23,76029189),s=f(s,a,l,u,e[c+9],4,-640364487),u=f(u,s,a,l,e[c+12],11,-421815835),l=f(l,u,s,a,e[c+15],16,530742520),s=g(s,a=f(a,l,u,s,e[c+2],23,-995338651),l,u,e[c],6,-198630844),u=g(u,s,a,l,e[c+7],10,1126891415),l=g(l,u,s,a,e[c+14],15,-1416354905),a=g(a,l,u,s,e[c+5],21,-57434055),s=g(s,a,l,u,e[c+12],6,1700485571),u=g(u,s,a,l,e[c+3],10,-1894986606),l=g(l,u,s,a,e[c+10],15,-1051523),a=g(a,l,u,s,e[c+1],21,-2054922799),s=g(s,a,l,u,e[c+8],6,1873313359),u=g(u,s,a,l,e[c+15],10,-30611744),l=g(l,u,s,a,e[c+6],15,-1560198380),a=g(a,l,u,s,e[c+13],21,1309151649),s=g(s,a,l,u,e[c+4],6,-145523070),u=g(u,s,a,l,e[c+11],10,-1120210379),l=g(l,u,s,a,e[c+2],15,718787259),a=g(a,l,u,s,e[c+9],21,-343485551),s=d(s,i),a=d(a,n),l=d(l,r),u=d(u,o);return[s,a,l,u]}function l(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}function u(e){var t,i=[];for(i[(e.length>>2)-1]=void 0,t=0;t<i.length;t+=1)i[t]=0;for(t=0;t<8*e.length;t+=8)i[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return i}function n(e){for(var t,i="0123456789abcdef",n="",r=0;r<e.length;r+=1)t=e.charCodeAt(r),n+=i.charAt(t>>>4&15)+i.charAt(15&t);return n}function c(e){return unescape(encodeURIComponent(e))}function r(e){return l(s(u(e=c(e)),8*e.length))}function o(e,t){var i,e=c(e),t=c(t),n=u(e),r=[],o=[];for(r[15]=o[15]=void 0,16<n.length&&(n=s(n,8*e.length)),i=0;i<16;i+=1)r[i]=909522486^n[i],o[i]=1549556828^n[i];return e=s(r.concat(u(t)),512+8*t.length),l(s(o.concat(e),640))}e.md5=function(e,t,i){return t?i?o(t,e):n(o(t,e)):i?r(e):n(r(e))}}("function"==typeof jQuery?jQuery:this),!function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},L=e._,n=Array.prototype,s=Object.prototype,c="undefined"!=typeof Symbol?Symbol.prototype:null,P=n.push,l=n.slice,d=s.toString,o=s.hasOwnProperty,t=Array.isArray,r=Object.keys,i=Object.create,a=function(){},p=function(e){return e instanceof p?e:this instanceof p?void(this._wrapped=e):new p(e)};"undefined"==typeof exports||exports.nodeType?e._=p:(exports="undefined"!=typeof module&&!module.nodeType&&module.exports?module.exports=p:exports)._=p,p.VERSION="1.9.1";function u(r,o){return o=null==o?r.length-1:+o,function(){for(var e=Math.max(arguments.length-o,0),t=Array(e),i=0;i<e;i++)t[i]=arguments[i+o];switch(o){case 0:return r.call(this,t);case 1:return r.call(this,arguments[0],t);case 2:return r.call(this,arguments[0],arguments[1],t)}for(var n=Array(o+1),i=0;i<o;i++)n[i]=arguments[i];return n[o]=t,r.apply(this,n)}}function h(t){return function(e){return null==e?void 0:e[t]}}function f(e,t){for(var i=t.length,n=0;n<i;n++){if(null==e)return;e=e[t[n]]}return i?e:void 0}function g(h){return function(e,t,i,n){var r=3<=arguments.length,o=e,s=k(t,n,4),a=i,l=!D(o)&&p.keys(o),u=(l||o).length,c=0<h?0:u-1;for(r||(a=o[l?l[c]:c],c+=h);0<=c&&c<u;c+=h){var d=l?l[c]:c;a=s(a,o[d],d,o)}return a}}function m(o,t){return function(i,n,e){var r=t?[[],[]]:{};return n=C(n,e),p.each(i,function(e,t){t=n(e,t,i);o(r,e,t)}),r}}function v(o){return function(e,t,i){t=C(t,i);for(var n=T(e),r=0<o?0:n-1;0<=r&&r<n;r+=o)if(t(e[r],r,e))return r;return-1}}function y(o,s,a){return function(e,t,i){var n=0,r=T(e);if("number"==typeof i)0<o?n=0<=i?i:Math.max(i+r,n):r=0<=i?Math.min(i+1,r):i+r+1;else if(a&&i&&r)return e[i=a(e,t)]===t?i:-1;if(t!=t)return 0<=(i=s(l.call(e,n,r),p.isNaN))?i+n:-1;for(i=0<o?n:r-1;0<=i&&i<r;i+=o)if(e[i]===t)return i;return-1}}function b(e,t,i,n,r){return n instanceof t?(n=E(e.prototype),t=e.apply(n,r),p.isObject(t)?t:n):e.apply(i,r)}function w(e,t){var i=j.length,n=e.constructor,r=p.isFunction(n)&&n.prototype||s,o="constructor";for(F(e,o)&&!p.contains(t,o)&&t.push(o);i--;)(o=j[i])in e&&e[o]!==r[o]&&!p.contains(t,o)&&t.push(o)}function x(l,u){return function(e){var t=arguments.length;if(u&&(e=Object(e)),!(t<2||null==e))for(var i=1;i<t;i++)for(var n=arguments[i],r=l(n),o=r.length,s=0;s<o;s++){var a=r[s];u&&void 0!==e[a]||(e[a]=n[a])}return e}}var _,k=function(r,o,e){if(void 0===o)return r;switch(null==e?3:e){case 1:return function(e){return r.call(o,e)};case 3:return function(e,t,i){return r.call(o,e,t,i)};case 4:return function(e,t,i,n){return r.call(o,e,t,i,n)}}return function(){return r.apply(o,arguments)}},C=function(e,t,i){return p.iteratee!==_?p.iteratee(e,t):null==e?p.identity:p.isFunction(e)?k(e,t,i):p.isObject(e)&&!p.isArray(e)?p.matcher(e):p.property(e)},E=(p.iteratee=_=function(e,t){return C(e,t,1/0)},function(e){if(!p.isObject(e))return{};if(i)return i(e);a.prototype=e;e=new a;return a.prototype=null,e}),F=function(e,t){return null!=e&&o.call(e,t)},M=Math.pow(2,53)-1,T=h("length"),D=function(e){e=T(e);return"number"==typeof e&&0<=e&&e<=M},U=(p.each=p.forEach=function(e,t,i){if(t=k(t,i),D(e))for(r=0,o=e.length;r<o;r++)t(e[r],r,e);else for(var n=p.keys(e),r=0,o=n.length;r<o;r++)t(e[n[r]],n[r],e);return e},p.map=p.collect=function(e,t,i){t=C(t,i);for(var n=!D(e)&&p.keys(e),r=(n||e).length,o=Array(r),s=0;s<r;s++){var a=n?n[s]:s;o[s]=t(e[a],a,e)}return o},p.reduce=p.foldl=p.inject=g(1),p.reduceRight=p.foldr=g(-1),p.find=p.detect=function(e,t,i){t=(D(e)?p.findIndex:p.findKey)(e,t,i);if(void 0!==t&&-1!==t)return e[t]},p.filter=p.select=function(e,n,t){var r=[];return n=C(n,t),p.each(e,function(e,t,i){n(e,t,i)&&r.push(e)}),r},p.reject=function(e,t,i){return p.filter(e,p.negate(C(t)),i)},p.every=p.all=function(e,t,i){t=C(t,i);for(var n=!D(e)&&p.keys(e),r=(n||e).length,o=0;o<r;o++){var s=n?n[o]:o;if(!t(e[s],s,e))return!1}return!0},p.some=p.any=function(e,t,i){t=C(t,i);for(var n=!D(e)&&p.keys(e),r=(n||e).length,o=0;o<r;o++){var s=n?n[o]:o;if(t(e[s],s,e))return!0}return!1},p.contains=p.includes=p.include=function(e,t,i,n){return D(e)||(e=p.values(e)),0<=p.indexOf(e,t,i="number"==typeof i&&!n?i:0)},p.invoke=u(function(e,i,n){var r,o;return p.isFunction(i)?o=i:p.isArray(i)&&(r=i.slice(0,-1),i=i[i.length-1]),p.map(e,function(e){var t=o;if(!t){if(null==(e=r&&r.length?f(e,r):e))return;t=e[i]}return null==t?t:t.apply(e,n)})}),p.pluck=function(e,t){return p.map(e,p.property(t))},p.where=function(e,t){return p.filter(e,p.matcher(t))},p.findWhere=function(e,t){return p.find(e,p.matcher(t))},p.max=function(e,n,t){var i,r,o=-1/0,s=-1/0;if(null==n||"number"==typeof n&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=D(e)?e:p.values(e)).length;a<l;a++)null!=(i=e[a])&&o<i&&(o=i);else n=C(n,t),p.each(e,function(e,t,i){r=n(e,t,i),(s<r||r===-1/0&&o===-1/0)&&(o=e,s=r)});return o},p.min=function(e,n,t){var i,r,o=1/0,s=1/0;if(null==n||"number"==typeof n&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=D(e)?e:p.values(e)).length;a<l;a++)null!=(i=e[a])&&i<o&&(o=i);else n=C(n,t),p.each(e,function(e,t,i){((r=n(e,t,i))<s||r===1/0&&o===1/0)&&(o=e,s=r)});return o},p.shuffle=function(e){return p.sample(e,1/0)},p.sample=function(e,t,i){if(null==t||i)return(e=D(e)?e:p.values(e))[p.random(e.length-1)];var n=D(e)?p.clone(e):p.values(e),i=T(n);t=Math.max(Math.min(t,i),0);for(var r=i-1,o=0;o<t;o++){var s=p.random(o,r),a=n[o];n[o]=n[s],n[s]=a}return n.slice(0,t)},p.sortBy=function(e,n,t){var r=0;return n=C(n,t),p.pluck(p.map(e,function(e,t,i){return{value:e,index:r++,criteria:n(e,t,i)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index-t.index}),"value")},p.groupBy=m(function(e,t,i){F(e,i)?e[i].push(t):e[i]=[t]}),p.indexBy=m(function(e,t,i){e[i]=t}),p.countBy=m(function(e,t,i){F(e,i)?e[i]++:e[i]=1}),/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g),S=(p.toArray=function(e){return e?p.isArray(e)?l.call(e):p.isString(e)?e.match(U):D(e)?p.map(e,p.identity):p.values(e):[]},p.size=function(e){return null==e?0:(D(e)?e:p.keys(e)).length},p.partition=m(function(e,t,i){e[i?0:1].push(t)},!0),p.first=p.head=p.take=function(e,t,i){return null==e||e.length<1?null==t?void 0:[]:null==t||i?e[0]:p.initial(e,e.length-t)},p.initial=function(e,t,i){return l.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},p.last=function(e,t,i){return null==e||e.length<1?null==t?void 0:[]:null==t||i?e[e.length-1]:p.rest(e,Math.max(0,e.length-t))},p.rest=p.tail=p.drop=function(e,t,i){return l.call(e,null==t||i?1:t)},p.compact=function(e){return p.filter(e,Boolean)},function(e,t,i,n){for(var r=(n=n||[]).length,o=0,s=T(e);o<s;o++){var a=e[o];if(D(a)&&(p.isArray(a)||p.isArguments(a)))if(t)for(var l=0,u=a.length;l<u;)n[r++]=a[l++];else S(a,t,i,n),r=n.length;else i||(n[r++]=a)}return n}),R=(p.flatten=function(e,t){return S(e,t,!1)},p.without=u(function(e,t){return p.difference(e,t)}),p.uniq=p.unique=function(e,t,i,n){p.isBoolean(t)||(n=i,i=t,t=!1),null!=i&&(i=C(i,n));for(var r=[],o=[],s=0,a=T(e);s<a;s++){var l=e[s],u=i?i(l,s,e):l;t&&!i?(s&&o===u||r.push(l),o=u):i?p.contains(o,u)||(o.push(u),r.push(l)):p.contains(r,l)||r.push(l)}return r},p.union=u(function(e){return p.uniq(S(e,!0,!0))}),p.intersection=function(e){for(var t=[],i=arguments.length,n=0,r=T(e);n<r;n++){var o=e[n];if(!p.contains(t,o)){for(var s=1;s<i&&p.contains(arguments[s],o);s++);s===i&&t.push(o)}}return t},p.difference=u(function(e,t){return t=S(t,!0,!0),p.filter(e,function(e){return!p.contains(t,e)})}),p.unzip=function(e){for(var t=e&&p.max(e,T).length||0,i=Array(t),n=0;n<t;n++)i[n]=p.pluck(e,n);return i},p.zip=u(p.unzip),p.object=function(e,t){for(var i={},n=0,r=T(e);n<r;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},p.findIndex=v(1),p.findLastIndex=v(-1),p.sortedIndex=function(e,t,i,n){for(var r=(i=C(i,n,1))(t),o=0,s=T(e);o<s;){var a=Math.floor((o+s)/2);i(e[a])<r?o=a+1:s=a}return o},p.indexOf=y(1,p.findIndex,p.sortedIndex),p.lastIndexOf=y(-1,p.findLastIndex),p.range=function(e,t,i){null==t&&(t=e||0,e=0),i=i||(t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/i),0),r=Array(n),o=0;o<n;o++,e+=i)r[o]=e;return r},p.chunk=function(e,t){if(null==t||t<1)return[];for(var i=[],n=0,r=e.length;n<r;)i.push(l.call(e,n,n+=t));return i},p.bind=u(function(t,i,n){var r;if(p.isFunction(t))return r=u(function(e){return b(t,r,i,this,n.concat(e))});throw new TypeError("Bind must be called on a function")}),p.partial=u(function(r,o){function s(){for(var e=0,t=o.length,i=Array(t),n=0;n<t;n++)i[n]=o[n]===a?arguments[e++]:o[n];for(;e<arguments.length;)i.push(arguments[e++]);return b(r,s,this,this,i)}var a=p.partial.placeholder;return s}),(p.partial.placeholder=p).bindAll=u(function(e,t){var i=(t=S(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var n=t[i];e[n]=p.bind(e[n],e)}}),p.memoize=function(n,r){function o(e){var t=o.cache,i=""+(r?r.apply(this,arguments):e);return F(t,i)||(t[i]=n.apply(this,arguments)),t[i]}return o.cache={},o},p.delay=u(function(e,t,i){return setTimeout(function(){return e.apply(null,i)},t)}),p.defer=p.partial(p.delay,p,1),p.throttle=function(i,n,r){function o(){c=!1===r.leading?0:p.now(),s=null,u=i.apply(a,l),s||(a=l=null)}function e(){var e=p.now(),t=(c||!1!==r.leading||(c=e),n-(e-c));return a=this,l=arguments,t<=0||n<t?(s&&(clearTimeout(s),s=null),c=e,u=i.apply(a,l),s||(a=l=null)):s||!1===r.trailing||(s=setTimeout(o,t)),u}var s,a,l,u,c=0;r=r||{};return e.cancel=function(){clearTimeout(s),c=0,s=a=l=null},e},p.debounce=function(i,n,r){function o(e,t){s=null,t&&(a=i.apply(e,t))}var s,a,e=u(function(e){var t;return s&&clearTimeout(s),r?(t=!s,s=setTimeout(o,n),t&&(a=i.apply(this,e))):s=p.delay(o,n,this,e),a});return e.cancel=function(){clearTimeout(s),s=null},e},p.wrap=function(e,t){return p.partial(t,e)},p.negate=function(e){return function(){return!e.apply(this,arguments)}},p.compose=function(){var i=arguments,n=i.length-1;return function(){for(var e=n,t=i[n].apply(this,arguments);e--;)t=i[e].call(this,t);return t}},p.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},p.before=function(e,t){var i;return function(){return 0<--e&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}},p.once=p.partial(p.before,2),p.restArguments=u,!{toString:null}.propertyIsEnumerable("toString")),j=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];p.keys=function(e){if(!p.isObject(e))return[];if(r)return r(e);var t,i=[];for(t in e)F(e,t)&&i.push(t);return R&&w(e,i),i},p.allKeys=function(e){if(!p.isObject(e))return[];var t,i=[];for(t in e)i.push(t);return R&&w(e,i),i},p.values=function(e){for(var t=p.keys(e),i=t.length,n=Array(i),r=0;r<i;r++)n[r]=e[t[r]];return n},p.mapObject=function(e,t,i){t=C(t,i);for(var n=p.keys(e),r=n.length,o={},s=0;s<r;s++){var a=n[s];o[a]=t(e[a],a,e)}return o},p.pairs=function(e){for(var t=p.keys(e),i=t.length,n=Array(i),r=0;r<i;r++)n[r]=[t[r],e[t[r]]];return n},p.invert=function(e){for(var t={},i=p.keys(e),n=0,r=i.length;n<r;n++)t[e[i[n]]]=i[n];return t},p.functions=p.methods=function(e){var t,i=[];for(t in e)p.isFunction(e[t])&&i.push(t);return i.sort()};p.extend=x(p.allKeys),p.extendOwn=p.assign=x(p.keys),p.findKey=function(e,t,i){t=C(t,i);for(var n,r=p.keys(e),o=0,s=r.length;o<s;o++)if(t(e[n=r[o]],n,e))return n};function $(e,t,i){return t in i}function I(t){function i(e){return t[e]}var e="(?:"+p.keys(t).join("|")+")",n=RegExp(e),r=RegExp(e,"g");return function(e){return n.test(e=null==e?"":""+e)?e.replace(r,i):e}}function B(e){return"\\"+q[e]}function A(e,t){return e._chain?p(t).chain():t}p.pick=u(function(e,t){var i={},n=t[0];if(null!=e){p.isFunction(n)?(1<t.length&&(n=k(n,t[1])),t=p.allKeys(e)):(n=$,t=S(t,!1,!1),e=Object(e));for(var r=0,o=t.length;r<o;r++){var s=t[r],a=e[s];n(a,s,e)&&(i[s]=a)}}return i}),p.omit=u(function(e,i){var t,n=i[0];return p.isFunction(n)?(n=p.negate(n),1<i.length&&(t=i[1])):(i=p.map(S(i,!1,!1),String),n=function(e,t){return!p.contains(i,t)}),p.pick(e,n,t)}),p.defaults=x(p.allKeys,!0),p.create=function(e,t){e=E(e);return t&&p.extendOwn(e,t),e},p.clone=function(e){return p.isObject(e)?p.isArray(e)?e.slice():p.extend({},e):e},p.tap=function(e,t){return t(e),e},p.isMatch=function(e,t){var i=p.keys(t),n=i.length;if(null==e)return!n;for(var r=Object(e),o=0;o<n;o++){var s=i[o];if(t[s]!==r[s]||!(s in r))return!1}return!0},O=function(e,t,i,n){var r;return e===t?0!==e||1/e==1/t:null!=e&&null!=t&&(e!=e?t!=t:("function"==(r=typeof e)||"object"==r||"object"==typeof t)&&Q(e,t,i,n))},Q=function(e,t,i,n){e instanceof p&&(e=e._wrapped),t instanceof p&&(t=t._wrapped);var r=d.call(e);if(r!==d.call(t))return!1;switch(r){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return c.valueOf.call(e)===c.valueOf.call(t)}r="[object Array]"===r;if(!r){if("object"!=typeof e||"object"!=typeof t)return!1;var o=e.constructor,s=t.constructor;if(o!==s&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}n=n||[];for(var a=(i=i||[]).length;a--;)if(i[a]===e)return n[a]===t;if(i.push(e),n.push(t),r){if((a=e.length)!==t.length)return!1;for(;a--;)if(!O(e[a],t[a],i,n))return!1}else{var l,u=p.keys(e),a=u.length;if(p.keys(t).length!==a)return!1;for(;a--;)if(l=u[a],!F(t,l)||!O(e[l],t[l],i,n))return!1}return i.pop(),n.pop(),!0},p.isEqual=function(e,t){return O(e,t)},p.isEmpty=function(e){return null==e||(D(e)&&(p.isArray(e)||p.isString(e)||p.isArguments(e))?0===e.length:0===p.keys(e).length)},p.isElement=function(e){return!(!e||1!==e.nodeType)},p.isArray=t||function(e){return"[object Array]"===d.call(e)},p.isObject=function(e){var t=typeof e;return"function"==t||"object"==t&&!!e},p.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(t){p["is"+t]=function(e){return d.call(e)==="[object "+t+"]"}}),p.isArguments(arguments)||(p.isArguments=function(e){return F(e,"callee")});var O,Q,t=e.document&&e.document.childNodes,t=("function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof t&&(p.isFunction=function(e){return"function"==typeof e||!1}),p.isFinite=function(e){return!p.isSymbol(e)&&isFinite(e)&&!isNaN(parseFloat(e))},p.isNaN=function(e){return p.isNumber(e)&&isNaN(e)},p.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===d.call(e)},p.isNull=function(e){return null===e},p.isUndefined=function(e){return void 0===e},p.has=function(e,t){if(!p.isArray(t))return F(e,t);for(var i=t.length,n=0;n<i;n++){var r=t[n];if(null==e||!o.call(e,r))return!1;e=e[r]}return!!i},p.noConflict=function(){return e._=L,this},p.identity=function(e){return e},p.constant=function(e){return function(){return e}},p.noop=function(){},p.property=function(t){return p.isArray(t)?function(e){return f(e,t)}:h(t)},p.propertyOf=function(t){return null==t?function(){}:function(e){return p.isArray(e)?f(t,e):t[e]}},p.matcher=p.matches=function(t){return t=p.extendOwn({},t),function(e){return p.isMatch(e,t)}},p.times=function(e,t,i){var n=Array(Math.max(0,e));t=k(t,i,1);for(var r=0;r<e;r++)n[r]=t(r);return n},p.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},p.now=Date.now||function(){return(new Date).getTime()},{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"}),V=p.invert(t),z=(p.escape=I(t),p.unescape=I(V),p.result=function(e,t,i){var n=(t=p.isArray(t)?t:[t]).length;if(!n)return p.isFunction(i)?i.call(e):i;for(var r=0;r<n;r++){var o=null==e?void 0:e[t[r]];void 0===o&&(o=i,r=n),e=p.isFunction(o)?o.call(e):o}return e},0),N=(p.uniqueId=function(e){var t=++z+"";return e?e+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},/(.)^/),q={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\u2028|\u2029/g;p.template=function(o,e,t){e=p.defaults({},e=!e&&t?t:e,p.templateSettings);var i,t=RegExp([(e.escape||N).source,(e.interpolate||N).source,(e.evaluate||N).source].join("|")+"|$","g"),s=0,a="__p+='";o.replace(t,function(e,t,i,n,r){return a+=o.slice(s,r).replace(H,B),s=r+e.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":i?a+="'+\n((__t=("+i+"))==null?'':__t)+\n'":n&&(a+="';\n"+n+"\n__p+='"),e}),a+="';\n",a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+(a=e.variable?a:"with(obj||{}){\n"+a+"}\n")+"return __p;\n";try{i=new Function(e.variable||"obj","_",a)}catch(e){throw e.source=a,e}function n(e){return i.call(this,e,p)}t=e.variable||"obj";return n.source="function("+t+"){\n"+a+"}",n},p.chain=function(e){e=p(e);return e._chain=!0,e};p.mixin=function(i){return p.each(p.functions(i),function(e){var t=p[e]=i[e];p.prototype[e]=function(){var e=[this._wrapped];return P.apply(e,arguments),A(this,t.apply(p,e))}}),p},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var i=n[t];p.prototype[t]=function(){var e=this._wrapped;return i.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],A(this,e)}}),p.each(["concat","join","slice"],function(e){var t=n[e];p.prototype[e]=function(){return A(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},p.prototype.valueOf=p.prototype.toJSON=p.prototype.value,p.prototype.toString=function(){return String(this._wrapped)},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}(),!function(n,r){var e;"function"==typeof define&&define.amd?define(["underscore","jquery","exports"],function(e,t,i){n.Backbone=r(n,i,e,t)}):"undefined"!=typeof exports?(e=require("underscore"),r(n,exports,e)):n.Backbone=r(n,{},n._,n.jQuery||n.Zepto||n.ender||n.$)}(this,function(e,s,x,t){var i=e.Backbone,n=[],r=n.slice,o=(s.VERSION="1.1.2",s.$=t,s.noConflict=function(){return e.Backbone=i,this},s.emulateHTTP=!1,s.emulateJSON=!1,s.Events={on:function(e,t,i){return d(this,"on",e,[t,i])&&t&&(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this})),this},once:function(e,t,i){var n,r;return d(this,"once",e,[t,i])&&t?(n=this,(r=x.once(function(){n.off(e,r),t.apply(this,arguments)}))._callback=t,this.on(e,r,i)):this},off:function(e,t,i){var n,r,o,s,a,l,u,c;if(this._events&&d(this,"off",e,[t,i]))if(e||t||i){for(a=0,l=(s=e?[e]:x.keys(this._events)).length;a<l;a++)if(e=s[a],o=this._events[e]){if(this._events[e]=n=[],t||i)for(u=0,c=o.length;u<c;u++)r=o[u],(t&&t!==r.callback&&t!==r.callback._callback||i&&i!==r.context)&&n.push(r);n.length||delete this._events[e]}}else this._events=void 0;return this},trigger:function(e){var t,i,n;return this._events&&(t=r.call(arguments,1),d(this,"trigger",e,t))&&(i=this._events[e],n=this._events.all,i&&a(i,t),n)&&a(n,arguments),this},stopListening:function(e,t,i){var n=this._listeningTo;if(n){var r,o=!t&&!i;for(r in i||"object"!=typeof t||(i=this),e&&((n={})[e._listenId]=e),n)(e=n[r]).off(t,i,this),(o||x.isEmpty(e._events))&&delete this._listeningTo[r]}return this}}),l=/\s+/,d=function(e,t,i,n){if(i){if("object"==typeof i){for(var r in i)e[t].apply(e,[r,i[r]].concat(n));return!1}if(l.test(i)){for(var o=i.split(l),s=0,a=o.length;s<a;s++)e[t].apply(e,[o[s]].concat(n));return!1}}return!0},a=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t);return}},_=(x.each({listenTo:"on",listenToOnce:"once"},function(n,e){o[e]=function(e,t,i){return((this._listeningTo||(this._listeningTo={}))[e._listenId||(e._listenId=x.uniqueId("l"))]=e)[n](t,i=i||"object"!=typeof t?i:this,this),this}}),o.bind=o.on,o.unbind=o.off,x.extend(s,o),s.Model=function(e,t){var i=e||{};t=t||{},this.cid=x.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=x.defaults({},i,x.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)}),u=(x.extend(_.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return x.clone(this.attributes)},sync:function(){return s.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return x.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var n,r,o,s,a,l,u;if(null!=e){if("object"==typeof e?(r=e,i=t):(r={})[e]=t,!this._validate(r,i=i||{}))return!1;for(n in o=i.unset,e=i.silent,s=[],a=this._changing,this._changing=!0,a||(this._previousAttributes=x.clone(this.attributes),this.changed={}),u=this.attributes,l=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]),r)t=r[n],x.isEqual(u[n],t)||s.push(n),x.isEqual(l[n],t)?delete this.changed[n]:this.changed[n]=t,o?delete u[n]:u[n]=t;if(!e){s.length&&(this._pending=i);for(var c=0,d=s.length;c<d;c++)this.trigger("change:"+s[c],this,u[s[c]],i)}if(!a){if(!e)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);this._pending=!1,this._changing=!1}}return this},unset:function(e,t){return this.set(e,void 0,x.extend({},t,{unset:!0}))},clear:function(e){var t,i={};for(t in this.attributes)i[t]=void 0;return this.set(i,x.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!x.isEmpty(this.changed):x.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&x.clone(this.changed);var t,i,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(i in e)x.isEqual(r[i],t=e[i])||((n=n||{})[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return x.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?x.clone(t):{}).parse&&(t.parse=!0);var i=this,n=t.success;return t.success=function(e){if(!i.set(i.parse(e,t),t))return!1;n&&n(i,e,t),i.trigger("sync",i,e,t)},R(this,t),this.sync("read",this,t)},save:function(e,t,i){var n,r=this.attributes;if(null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,i=x.extend({validate:!0},i),n&&!i.wait){if(!this.set(n,i))return!1}else if(!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=x.extend({},r,n)),void 0===i.parse&&(i.parse=!0);var o=this,s=i.success;return i.success=function(e){o.attributes=r;var t=o.parse(e,i);if(i.wait&&(t=x.extend(n||{},t)),x.isObject(t)&&!o.set(t,i))return!1;s&&s(o,e,i),o.trigger("sync",o,e,i)},R(this,i),"patch"==(e=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=n),t=this.sync(e,this,i),n&&i.wait&&(this.attributes=r),t},destroy:function(t){t=t?x.clone(t):{};function i(){n.trigger("destroy",n,n.collection,t)}var n=this,r=t.success;if(t.success=function(e){(t.wait||n.isNew())&&i(),r&&r(n,e,t),n.isNew()||n.trigger("sync",n,e,t)},this.isNew())return t.success(),!1;R(this,t);var e=this.sync("delete",this,t);return t.wait||i(),e},url:function(){var e=x.result(this,"urlRoot")||x.result(this.collection,"url")||S();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},x.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=x.extend({},this.attributes,e);e=this.validationError=this.validate(e,t)||null;return!e||(this.trigger("invalid",this,e,x.extend(t,{validationError:e})),!1)}}),x.each(["keys","values","pairs","invert","pick","omit"],function(t){_.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.attributes),x[t].apply(x,e)}}),s.Collection=function(e,t){(t=t||{}).model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,x.extend({silent:!0},t))}),k={add:!0,remove:!0,merge:!0},c={add:!0,remove:!1},n=(x.extend(u.prototype,o,{model:_,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return s.sync.apply(this,arguments)},add:function(e,t){return this.set(e,x.extend({merge:!1},t,c))},remove:function(e,t){var i,n,r,o,s=!x.isArray(e);for(t=t||{},i=0,n=(e=s?[e]:x.clone(e)).length;i<n;i++)(o=e[i]=this.get(e[i]))&&(delete this._byId[o.id],delete this._byId[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,t.silent||(t.index=r,o.trigger("remove",o,this,t)),this._removeReference(o,t));return s?e[0]:e},set:function(e,t){(t=x.defaults({},t,k)).parse&&(e=this.parse(e,t));var i,n,r,o,s=!x.isArray(e),a=(e=s?e?[e]:[]:x.clone(e),t.at),l=this.model,u=this.comparator&&null==a&&!1!==t.sort,c=x.isString(this.comparator)?this.comparator:null,d=[],h=[],p={},f=t.add,g=t.merge,m=t.remove,v=!(u||!f||!m)&&[];for(b=0,w=e.length;b<w;b++){if(r=(n=e[b]||{})instanceof _?i=n:n[l.prototype.idAttribute||"id"],r=this.get(r))m&&(p[r.cid]=!0),g&&(n=n===i?i.attributes:n,t.parse&&(n=r.parse(n,t)),r.set(n,t),u)&&!o&&r.hasChanged(c)&&(o=!0),e[b]=r;else if(f){if(!(i=e[b]=this._prepareModel(n,t)))continue;d.push(i),this._addReference(i,t)}i=r||i,!v||!i.isNew()&&p[i.id]||v.push(i),p[i.id]=!0}if(m){for(b=0,w=this.length;b<w;++b)p[(i=this.models[b]).cid]||h.push(i);h.length&&this.remove(h,t)}if(d.length||v&&v.length)if(u&&(o=!0),this.length+=d.length,null!=a)for(b=0,w=d.length;b<w;b++)this.models.splice(a+b,0,d[b]);else{v&&(this.models.length=0);for(var y=v||d,b=0,w=y.length;b<w;b++)this.models.push(y[b])}if(o&&this.sort({silent:!0}),!t.silent){for(b=0,w=d.length;b<w;b++)(i=d[b]).trigger("add",i,this,t);(o||v&&v.length)&&this.trigger("sort",this,t)}return s?e[0]:e},reset:function(e,t){t=t||{};for(var i=0,n=this.models.length;i<n;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,x.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,x.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,x.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(i,e){return x.isEmpty(i)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var t in i)if(i[t]!==e.get(t))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(this.comparator)return e=e||{},x.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(x.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this;throw new Error("Cannot sort a set without a comparator")},pluck:function(e){return x.invoke(this.models,"get",e)},fetch:function(i){void 0===(i=i?x.clone(i):{}).parse&&(i.parse=!0);var n=i.success,r=this;return i.success=function(e){var t=i.reset?"reset":"set";r[t](e,i),n&&n(r,e,i),r.trigger("sync",r,e,i)},R(this,i),this.sync("read",this,i)},create:function(e,i){if(i=i?x.clone(i):{},!(e=this._prepareModel(e,i)))return!1;i.wait||this.add(e,i);var n=this,r=i.success;return i.success=function(e,t){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,i),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){return!(e instanceof _)&&(e=new((t=t?x.clone(t):{}).collection=this).model(e,t)).validationError?(this.trigger("invalid",this,e.validationError,t),!1):e},_addReference:function(e,t){null!=(this._byId[e.cid]=e).id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id)&&(this._byId[t.id]=t),this.trigger.apply(this,arguments))}}),x.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"],function(t){u.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.models),x[t].apply(x,e)}}),x.each(["groupBy","countBy","sortBy","indexBy"],function(n){u.prototype[n]=function(t,e){var i=x.isFunction(t)?t:function(e){return e.get(t)};return x[n](this.models,i,e)}}),s.View=function(e){this.cid=x.uniqueId("view"),x.extend(this,x.pick(e=e||{},p)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()}),h=/^(\S+)\s*(.*)$/,p=["model","collection","el","id","attributes","className","tagName","events"],f=(x.extend(n.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof s.$?e:s.$(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(e=e||x.result(this,"events"))for(var t in this.undelegateEvents(),e){var i,n=e[t];(n=x.isFunction(n)?n:this[e[t]])&&(i=(t=t.match(h))[1],t=t[2],n=x.bind(n,this),i+=".delegateEvents"+this.cid,""===t?this.$el.on(i,n):this.$el.on(i,t,n))}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){var e;this.el?this.setElement(x.result(this,"el"),!1):(e=x.extend({},x.result(this,"attributes")),this.id&&(e.id=x.result(this,"id")),this.className&&(e.class=x.result(this,"className")),e=s.$("<"+x.result(this,"tagName")+">").attr(e),this.setElement(e,!1))}}),s.sync=function(e,t,i){var n,r=g[e],o=(x.defaults(i=i||{},{emulateHTTP:s.emulateHTTP,emulateJSON:s.emulateJSON}),{type:r,dataType:"json"}),e=(i.url||(o.url=x.result(t,"url")||S()),null!=i.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(i.attrs||t.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),!i.emulateHTTP||"PUT"!==r&&"DELETE"!==r&&"PATCH"!==r||(o.type="POST",i.emulateJSON&&(o.data._method=r),n=i.beforeSend,i.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),n)return n.apply(this,arguments)}),"GET"===o.type||i.emulateJSON||(o.processData=!1),"PATCH"===o.type&&f&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}),i.xhr=s.ajax(x.extend(o,i)));return t.trigger("request",t,e,i),e},!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent)),g={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"},t=(s.ajax=function(){return s.$.ajax.apply(s.$,arguments)},s.Router=function(e){(e=e||{}).routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)}),m=/\((.*?)\)/g,v=/(\(\?)?:\w+/g,y=/\*\w+/g,b=/[\-{}\[\]+?.,\\\^$|#\s]/g,w=(x.extend(t.prototype,o,{initialize:function(){},route:function(t,i,n){x.isRegExp(t)||(t=this._routeToRegExp(t)),x.isFunction(i)&&(n=i,i=""),n=n||this[i];var r=this;return s.history.route(t,function(e){e=r._extractParameters(t,e);r.execute(n,e),r.trigger.apply(r,["route:"+i].concat(e)),r.trigger("route",i,e),s.history.trigger("route",r,i,e)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,t){return s.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes){this.routes=x.result(this,"routes");for(var e,t=x.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(b,"\\$&").replace(m,"(?:$1)?").replace(v,function(e,t){return t?e:"([^/?]+)"}).replace(y,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return x.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}}),s.History=function(){this.handlers=[],x.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)}),C=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,F=/msie [\w.]+/,T=/\/$/,D=/#.*$/,S=(w.started=!1,x.extend(w.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){e=(e||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(e,t){return null==e&&(this._hasPushState||!this._wantsHashChange||t?(e=decodeURI(this.location.pathname+this.location.search),t=this.root.replace(T,""),e.indexOf(t)||(e=e.slice(t.length))):e=this.getHash()),e.replace(C,"")},start:function(e){if(w.started)throw new Error("Backbone.history has already been started");w.started=!0,this.options=x.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment(),t=document.documentMode,t=F.exec(navigator.userAgent.toLowerCase())&&(!t||t<=7),i=(this.root=("/"+this.root+"/").replace(E,"/"),t&&this._wantsHashChange&&(i=s.$('<iframe src="javascript:0" tabindex="-1">'),this.iframe=i.hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?s.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!t?s.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=e,this.location);if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&i.hash&&(this.fragment=this.getHash().replace(C,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){s.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),w.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if((t=t===this.fragment&&this.iframe?this.getFragment(this.getHash(this.iframe)):t)===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(t){return t=this.fragment=this.getFragment(t),x.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!w.started)return!1;t&&!0!==t||(t={trigger:!!t});var i=this.root+(e=this.getFragment(e||""));if(e=e.replace(D,""),this.fragment!==e){if(""===(this.fragment=e)&&"/"!==i&&(i=i.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){i?(i=e.href.replace(/(javascript:|#).*$/,""),e.replace(i+"#"+t)):e.hash="#"+t}}),s.history=new w,_.extend=u.extend=t.extend=n.extend=w.extend=function(e,t){function i(){this.constructor=r}var n=this,r=e&&x.has(e,"constructor")?e.constructor:function(){return n.apply(this,arguments)};x.extend(r,n,t);return i.prototype=n.prototype,r.prototype=new i,e&&x.extend(r.prototype,e),r.__super__=n.prototype,r},function(){throw new Error('A "url" property or function must be specified')}),R=function(t,i){var n=i.error;i.error=function(e){n&&n(t,e,i),t.trigger("error",t,e,i)}};return s}),!function(e){var i,t,s,n,r,o,a,l,u,c,d,h,p,f,g,m,v,y,b,w,x,_,k;function C(e,t){if(!(this instanceof C))return new C(e,t);this._size=0,this._graphs=Object.create(null),this._id=0,this._ids=Object.create(null),this._ids["><"]=0,this._entities=Object.create(null),this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),t=t||{},this._prefixes=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),e&&this.addTriples(e)}function E(e){return"string"==typeof e||e instanceof String}function F(e,t){if(!(this instanceof F))return new F(e,t);var n;e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e?(this._outputStream=e,this._endStream=void 0===t.end||!!t.end):(n="",this._outputStream={write:function(e,t,i){n+=e,i&&i()},end:function(e){e&&e(null,n)}},this._endStream=!0),this._subject=null,/triple|quad/i.test(t.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes))}function T(e){var t=a[e];return t=void 0===t?1===e.length?(t=e.charCodeAt(0).toString(16),"\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),"\\U00000000".substr(0,10-t.length)+t):t}function D(e){if(!(this instanceof D))return new D(e);this._contextStack=[],this._graph=null,this._setBase((e=e||{}).documentIRI);var t="string"==typeof e.format?e.format.match(/\w*$/)[0].toLowerCase():"",i="turtle"===t,n="trig"===t,r=/triple/.test(t),o=/quad/.test(t),t=this._n3Mode=/n3/.test(t),o=r||o;(this._supportsNamedGraphs=!(i||t))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(i||n||r||t),o&&(this._base="",this._resolveIRI=function(e){return this._error("Disallowed relative IRI",e),this._callback=S,this._subject=null}),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":"_:"+e.blankNodePrefix.replace(/^_:/,""),this._lexer=e.lexer||new l({lineMode:o,n3:t}),this._explicitQuantifiers=!!e.explicitQuantifiers}function S(){}function R(e){if(!(this instanceof R))return new R(e);var n;(e=e||{}).lineMode&&(this._tripleQuotedString=this._number=this._boolean=/$0^/,(n=this)._tokenize=this.tokenize,this.tokenize=function(e,i){this._tokenize(e,function(e,t){!e&&/^(?:IRI|blank|literal|langcode|typeIRI|\.|eof)$/.test(t.type)?i&&i(e,t):i&&i(e||n._syntaxError(t.type,i=null))})}),this._n3Mode=!1!==e.n3,this._comments=!!e.comments}i="http://www.w3.org/2001/XMLSchema#double",t={isIRI:function(e){return"string"==typeof e&&(0===e.length||'"'!==(e=e[0])&&"_"!==e)},isLiteral:function(e){return"string"==typeof e&&'"'===e[0]},isBlank:function(e){return"string"==typeof e&&"_:"===e.substr(0,2)},isDefaultGraph:function(e){return!e},inDefaultGraph:function(e){return!e.graph},getLiteralValue:function(e){var t=/^"([^]*)"/.exec(e);if(t)return t[1];throw new Error(e+" is not a literal")},getLiteralType:function(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(t)return t[1]||(t[2]?"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString":"http://www.w3.org/2001/XMLSchema#string");throw new Error(e+" is not a literal")},getLiteralLanguage:function(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(t)return t[1]?t[1].toLowerCase():"";throw new Error(e+" is not a literal")},isPrefixedName:function(e){return"string"==typeof e&&/^[^:\/"']*:[^:\/"']+$/.test(e)},expandPrefixedName:function(e,t){var i,n,r,o=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(e);return o&&(n=t[i=o[1]],r=o.index),void 0===n?e:0===r?n+e.substr(i.length+1):e.substr(0,r+3)+n+e.substr(r+i.length+4)},createIRI:function(e){return e&&'"'===e[0]?t.getLiteralValue(e):e},createLiteral:function(e,t){if(!t)switch(typeof e){case"boolean":t="http://www.w3.org/2001/XMLSchema#boolean";break;case"number":isFinite(e)?t=e%1==0?"http://www.w3.org/2001/XMLSchema#integer":i:(t=i,isNaN(e)||(e=0<e?"INF":"-INF"));break;default:return'"'+e+'"'}return'"'+e+(/^[a-z]+(-[a-z0-9]+)*$/i.test(t)?'"@'+t.toLowerCase():'"^^'+t)},prefix:function(e){return t.prefixes({"":e})("")},prefixes:function(e){var t,n=Object.create(null);for(t in e)i(t,e[t]);function i(e,t){var i;return!t&&e in n||(i=Object.create(null),t=t||"",n[e]=function(e){return i[e]||(i[e]=t+e)}),n[e]}return i}},e.Util=t,b=String.fromCharCode,w="function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)},x=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,_={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},k=/[\x00-\x20<>\\"\{\}\|\^\`]/,R.prototype={_iri:/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,_unescapedString:/^"[^"\\\r\n]+"/,_singleQuotedString:/^"(?:[^"\\\r\n]|\\.)*"(?=[^"])|^'(?:[^'\\\r\n]|\\.)*'(?=[^'])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<]))/,_variable:/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<]))/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/i,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_comment:/#([^\n\r]*)/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(t,e){for(var i,n,r=this._input,o=this._comments;;){for(;i=this._newline.exec(r);)o&&(n=this._comment.exec(i[0]))&&t(null,{line:this._line,type:"comment",value:n[1],prefix:""}),r=r.substr(i[0].length,r.length),this._line++;if((i=this._whitespace.exec(r))&&(r=r.substr(i[0].length,r.length)),this._endOfFile.test(r))return e&&(o&&(n=this._comment.exec(r))&&t(null,{line:this._line,type:"comment",value:n[1],prefix:""}),t(r=null,{line:this._line,type:"eof",value:"",prefix:""})),this._input=r;var s,a=this._line,l="",u="",c="",d=r[0],h=null,p=0,f=!1;switch(d){case"^":if(r.length<3)break;if("^"!==r[1]){this._n3Mode&&(p=1,l="^");break}if(this._previousMarker="^^","<"!==(r=r.substr(2))[0]){f=!0;break}case"<":if(h=this._unescapedIri.exec(r))l="IRI",u=h[1];else if(h=this._iri.exec(r)){if(null===(s=this._unescape(h[1]))||k.test(s))return g(this);l="IRI",u=s}else this._n3Mode&&1<r.length&&"="===r[1]&&(l="inverse",p=2,u="http://www.w3.org/2000/10/swap/log#implies");break;case"_":((h=this._blank.exec(r))||e&&(h=this._blank.exec(r+" ")))&&(l="blank",c="_",u=h[1]);break;case'"':case"'":if(h=this._unescapedString.exec(r))l="literal",u=h[0];else if(h=this._singleQuotedString.exec(r)){if(null===(s=this._unescape(h[0])))return g(this);l="literal",u=s.replace(/^'|'$/g,'"')}else if(h=this._tripleQuotedString.exec(r)){if(s=h[1]||h[2],this._line+=s.split(/\r\n|\r|\n/).length-1,null===(s=this._unescape(s)))return g(this);l="literal",u=s.replace(/^'|'$/g,'"')}break;case"?":this._n3Mode&&(h=this._variable.exec(r))&&(l="var",u=h[0]);break;case"@":"literal"===this._previousMarker&&(h=this._langcode.exec(r))?(l="langcode",u=h[1]):(h=this._keyword.exec(r))&&(l=h[0]);break;case".":if(1===r.length?e:r[1]<"0"||"9"<r[1]){l=".",p=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(h=this._number.exec(r)||e&&this._number.exec(r+" "))&&(l="literal",u='"'+h[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(h[1]?"double":/^[+\-]?\d+$/.test(h[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(h=this._sparqlKeyword.exec(r))?l=h[0].toUpperCase():f=!0;break;case"f":case"t":(h=this._boolean.exec(r))?(l="literal",u='"'+h[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):f=!0;break;case"a":(h=this._shortPredicates.exec(r))?(l="abbreviation",u="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):f=!0;break;case"=":this._n3Mode&&1<r.length&&(l="abbreviation",u=">"!==r[1]?(p=1,"http://www.w3.org/2002/07/owl#sameAs"):(p=2,"http://www.w3.org/2000/10/swap/log#implies"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":p=1,l=d;break;default:f=!0}if(f&&("@prefix"!==this._previousMarker&&"PREFIX"!==this._previousMarker||!(h=this._prefix.exec(r))?((h=this._prefixed.exec(r))||e&&(h=this._prefixed.exec(r+" ")))&&(l="prefixed",c=h[1]||"",u=this._unescape(h[2])):(l="prefix",u=h[1]||"")),"^^"===this._previousMarker)switch(l){case"prefixed":l="type";break;case"IRI":l="typeIRI";break;default:l=""}if(!l)return e||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?g(this):this._input=r;a={line:a,type:l,value:u,prefix:c};t(null,a),this.previousToken=a,this._previousMarker=l,r=r.substr(p||h[0].length,r.length)}function g(e){t(e._syntaxError(/^\S*/.exec(r)[0]))}},_unescape:function(e){try{return e.replace(x,function(e,t,i,n){var r;if(t){if(r=parseInt(t,16),isNaN(r))throw new Error;return b(r)}if(i){if(r=parseInt(i,16),isNaN(r))throw new Error;return r<=65535?b(r):b(55296+(r-=65536)/1024,56320+(1023&r))}t=_[n];if(t)return t;throw new Error})}catch(e){return null}},_syntaxError:function(e){this._input=null;e=new Error('Unexpected "'+e+'" on line '+this._line+".");return e.context={token:void 0,line:this._line,previousToken:this.previousToken},e},tokenize:function(e,t){var i=this;if(this._line=1,"string"==typeof e){if(this._input=e,"function"!=typeof t){var n,r=[];if(this._tokenizeToEnd(function(e,t){e?n=e:r.push(t)},!0),n)throw n;return r}w(function(){i._tokenizeToEnd(t,!0)})}else this._input="","function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",function(e){null!==i._input&&(i._input+=e,i._tokenizeToEnd(t,!1))}),e.on("end",function(){null!==i._input&&i._tokenizeToEnd(t,!0)}),e.on("error",t)}},e.Lexer=R,l=e.Lexer,c=(u="http://www.w3.org/1999/02/22-rdf-syntax-ns#")+"nil",d=u+"first",h=u+"rest",p="urn:n3:quantifiers",f=/^[a-z][a-z0-9+.-]*:/i,g=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,m=/(?:^|\/)\.\.?(?:$|[\/#?])/,y=v=0,D._resetBlankNodeIds=function(){v=y=0},D.prototype={_setBase:function(e){var t;e?(0<=(t=e.indexOf("#"))&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(g),this._baseRoot=e[0],this._baseScheme=e[1]):this._base=null},_saveContext:function(e,t,i,n,r){var o=this._n3Mode;this._contextStack.push({subject:i,predicate:n,object:r,graph:t,type:e,inverse:!!o&&this._inversePredicate,blankPrefix:o?this._prefixes._:"",quantified:o?this._quantified:null}),o&&(this._inversePredicate=!1,this._prefixes._=this._graph+".",this._quantified=Object.create(this._quantified))},_restoreContext:function(){var e=this._contextStack.pop(),t=this._n3Mode;this._subject=e.subject,this._predicate=e.predicate,this._object=e.object,this._graph=e.graph,t&&(this._inversePredicate=e.inverse,this._prefixes._=e.blankPrefix,this._quantified=e.quantified)},_readInTopContext:function(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}},_readEntity:function(e,t){var i;switch(e.type){case"IRI":case"typeIRI":i=null===this._base||f.test(e.value)?e.value:this._resolveIRI(e);break;case"type":case"blank":case"prefixed":var n=this._prefixes[e.prefix];if(void 0===n)return this._error('Undefined prefix "'+e.prefix+':"',e);i=n+e.value;break;case"var":return e.value;default:return this._error("Expected entity but got "+e.type,e)}return i=!t&&this._n3Mode&&i in this._quantified?this._quantified[i]:i},_readSubject:function(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject="_:b"+y++,null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,c,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph="_:b"+y++,null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate="http://www.w3.org/2000/10/swap/reify#forSome",this._quantifiedPrefix="_:b",this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate="http://www.w3.org/2000/10/swap/reify#forAll",this._quantifiedPrefix="?b-",this._readQuantifierList):this._error('Unexpected "@forAll"',e);default:if(void 0===(this._subject=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph},_readPredicate:function(e){var t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=e.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+t,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return null!==this._predicate?this._readPredicate:this._error("Expected predicate but got ;",e);case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if(void 0===(this._predicate=this._readEntity(e)))return}return this._readObject},_readObject:function(e){switch(e.type){case"literal":return this._object=e.value,this._readDataTypeOrLang;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject="_:b"+y++),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,c),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph="_:b"+y++),this._readSubject):this._error("Unexpected graph",e);default:if(void 0===(this._object=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()},_readPredicateOrNamedGraph:function(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)},_readGraph:function(e){return"{"!==e.type?this._error("Expected graph but got "+e.type,e):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))},_readBlankNodeTail:function(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._triple(this._subject,this._predicate,this._object,this._graph);e=null===this._predicate;return this._restoreContext(),null===this._object?e?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank:this._getContextEndReader()},_readPredicateAfterBlank:function(e){return"."!==e.type||this._contextStack.length?this._readPredicate(e):(this._subject=null,this._readPunctuation(e))},_readListItem:function(e){var t=null,i=null,n=this._subject,r=this._contextStack,o=r[r.length-1],s=this._readListItem,a=!0;switch(e.type){case"[":this._saveContext("blank",this._graph,i="_:b"+y++,d,this._subject=t="_:b"+y++),s=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,i="_:b"+y++,d,c),this._subject=null;break;case")":if(this._restoreContext(),0!==r.length&&"list"===r[r.length-1].type&&this._triple(this._subject,this._predicate,this._object,this._graph),null===this._predicate){if(s=this._readPredicate,this._subject===c)return s}else if(s=this._getContextEndReader(),this._object===c)return s;i=c;break;case"literal":t=e.value,a=!1,s=this._readListItemDataTypeOrLang;break;default:if(void 0===(t=this._readEntity(e)))return}if(null===i&&(this._subject=i="_:b"+y++),null===n?null===o.predicate?o.subject=i:o.object=i:this._triple(n,h,i,this._graph),null!==t){if(this._n3Mode&&("IRI"===e.type||"prefixed"===e.type))return this._saveContext("item",this._graph,i,d,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);a?this._triple(i,d,t,this._graph):this._object=t}return s},_readDataTypeOrLang:function(e){return this._completeLiteral(e,!1)},_readListItemDataTypeOrLang:function(e){return this._completeLiteral(e,!0)},_completeLiteral:function(e,t){var i=!1;switch(e.type){case"type":case"typeIRI":var n=this._readEntity(e);if(void 0===n)return;i=!0,this._object+="^^"+n;break;case"langcode":i=!0,this._object+="@"+e.value.toLowerCase()}return t&&this._triple(this._subject,d,this._object,this._graph),i?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(e))},_readFormulaTail:function(e){return"}"!==e.type?this._readPunctuation(e):(null!==this._subject&&this._triple(this._subject,this._predicate,this._object,this._graph),this._restoreContext(),null===this._object?this._readPredicate:this._getContextEndReader())},_readPunctuation:function(e){var t,i,n,r=this._subject,o=this._graph,s=this._inversePredicate;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,s&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:if(this._supportsQuads&&null===this._graph&&void 0!==(o=this._readEntity(e))){t=this._readQuadPunctuation;break}return this._error('Expected punctuation to follow "'+this._object+'"',e)}return null!==r&&(i=this._predicate,n=this._object,s?this._triple(n,i,r,o):this._triple(r,i,n,o)),t},_readBlankNodePunctuation:function(e){var t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return this._triple(this._subject,this._predicate,this._object,this._graph),t},_readQuadPunctuation:function(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)},_readPrefixIRI:function(e){return"IRI"!==e.type?this._error('Expected IRI to follow prefix "'+this._prefix+':"',e):(e=this._readEntity(e),this._prefixes[this._prefix]=e,this._prefixCallback(this._prefix,e),this._readDeclarationPunctuation)},_readBaseIRI:function(e){return"IRI"!==e.type?this._error("Expected IRI to follow base declaration",e):(this._setBase(null===this._base||f.test(e.value)?e.value:this._resolveIRI(e)),this._readDeclarationPunctuation)},_readNamedGraphLabel:function(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}},_readNamedGraphBlankLabel:function(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject="_:b"+y++,this._readGraph)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_readQuantifierList:function(e){var t;switch(e.type){case"IRI":case"prefixed":if(void 0!==(t=this._readEntity(e,!0)))break;default:return this._error("Unexpected "+e.type,e)}return this._explicitQuantifiers?(null===this._subject?this._triple(this._graph||"",this._predicate,this._subject="_:b"+y++,p):this._triple(this._subject,h,this._subject="_:b"+y++,p),this._triple(this._subject,d,t,p)):this._quantified[t]=this._quantifiedPrefix+y++,this._readQuantifierPunctuation},_readQuantifierPunctuation:function(e){return","===e.type?this._readQuantifierList:(this._explicitQuantifiers&&(this._triple(this._subject,h,c,p),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))},_getPathReader:function(e){return this._afterPath=e,this._readPath},_readPath:function(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:var t=this._contextStack,t=t.length&&t[t.length-1];return t&&"item"===t.type&&(t=this._subject,this._restoreContext(),this._triple(this._subject,d,t,this._graph)),this._afterPath(e)}},_readForwardPath:function(e){var t,i="_:b"+y++;if(void 0!==(e=this._readEntity(e)))return null===this._predicate?(t=this._subject,this._subject=i):(t=this._object,this._object=i),this._triple(t,e,i,this._graph),this._readPath},_readBackwardPath:function(e){var t,i="_:b"+y++;if(void 0!==(e=this._readEntity(e)))return null===this._predicate?(t=this._subject,this._subject=i):(t=this._object,this._object=i),this._triple(i,e,t,this._graph),this._readPath},_getContextEndReader:function(){var e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail}},_triple:function(e,t,i,n){this._callback(null,{subject:e,predicate:t,object:i,graph:n||""})},_error:function(e,t){e=new Error(e+" on line "+t.line+".");e.context={token:t,line:t.line,previousToken:this._lexer.previousToken},this._callback(e),this._callback=S},_resolveIRI:function(e){var t=e.value;switch(t[0]){case void 0:return this._base;case"#":return this._base+t;case"?":return this._base.replace(/(?:\?.*)?$/,t);case"/":return("/"===t[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(t);default:return this._removeDotSegments(this._basePath+t)}},_removeDotSegments:function(e){if(!m.test(e))return e;for(var t="",i=e.length,n=-1,r=-1,o=0,s="/";n<i;){switch(s){case":":if(r<0&&"/"===e[++n]&&"/"===e[++n])for(;(r=n+1)<i&&"/"!==e[r];)n=r;break;case"?":case"#":n=i;break;case"/":if("."===e[n+1])switch(s=e[++n+1]){case"/":t+=e.substring(o,n-1),o=n+1;break;case void 0:case"?":case"#":return t+e.substring(o,n)+e.substr(n+1);case".":if(void 0===(s=e[++n+1])||"/"===s||"?"===s||"#"===s){if((o=(t+=e.substring(o,n-2)).lastIndexOf("/"))>=r&&(t=t.substr(0,o)),"/"!==s)return t+"/"+e.substr(n+1);o=n+1}}}s=e[++n]}return t+e.substring(o)},parse:function(e,t,i){var n=this;if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix||"_:b"+v+++"_",this._prefixCallback=i||S,this._inversePredicate=!1,this._quantified=Object.create(null),!t){var r,o=[];if(this._callback=function(e,t){e?r=e:t&&o.push(t)},this._lexer.tokenize(e).every(function(e){return n._readCallback=n._readCallback(e)}),r)throw r;return o}this._callback=t,this._lexer.tokenize(e,function(e,t){null!==e?(n._callback(e),n._callback=S):n._readCallback&&(n._readCallback=n._readCallback(t))})}},e.Parser=D,n=/^"([^]*)"(?:\^\^(.+)|@([a-z]+(?:-[a-z0-9]+)*))?$/i,r=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,o=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,a={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"},F.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeTriple:function(e,t,i,n,r){try{this._graph!==n&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(n?this._encodeIriOrBlankNode(n)+" {\n":"")),this._subject=null,this._graph="["!==n[0]?n:"]"),this._subject===e?this._predicate===t?this._write(", "+this._encodeObject(i),r):this._write(";\n    "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(i),r):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)+" "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(i),r)}catch(e){r&&r(e)}},_writeTripleLine:function(e,t,i,n,r){delete this._prefixMatch;try{this._write(this.tripleToString(e,t,i,n),r)}catch(e){r&&r(e)}},tripleToString:function(e,t,i,n){return this._encodeIriOrBlankNode(e)+" "+this._encodeIriOrBlankNode(t)+" "+this._encodeObject(i)+(n?" "+this._encodeIriOrBlankNode(n)+".\n":".\n")},triplesToString:function(e){return e.map(function(e){return this.tripleToString(e.subject,e.predicate,e.object,e.graph)},this).join("")},_encodeIriOrBlankNode:function(e){var t=e[0];if("["===t||"("===t||"_"===t&&":"===e[1])return e;r.test(e)&&(e=e.replace(o,T));t=this._prefixRegex.exec(e);return t?t[1]?this._prefixIRIs[t[1]]+t[2]:e:"<"+e+">"},_encodeLiteral:function(e,t,i){return r.test(e)&&(e=e.replace(o,T)),i?'"'+e+'"@'+i:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeSubject:function(e){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return"["===e[0]&&(this._subject="]"),this._encodeIriOrBlankNode(e)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e?"a":this._encodeIriOrBlankNode(e)},_encodeObject:function(e){if('"'!==e[0])return this._encodeIriOrBlankNode(e);var t=n.exec(e);if(t)return this._encodeLiteral(t[1],t[2],t[3]);throw new Error("Invalid literal: "+e)},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(e,t,i,n,r){void 0===i?this._writeTriple(e.subject,e.predicate,e.object,e.graph||"",t):"string"!=typeof n?this._writeTriple(e,t,i,"",n):this._writeTriple(e,t,i,n,r)},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,i){var n={};n[e]=t,this.addPrefixes(n,i)},addPrefixes:function(e,t){var i,n=this._prefixIRIs,r=!1;for(i in e){var o=e[i];/[#\/]$/.test(o)&&n[o]!==(i+=":")&&(r=!0,n[o]=i,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+i+" <"+o+">.\n"))}if(r){var s,a="",l="";for(s in n)a+=a?"|"+s:s,l+=(l?"|":"")+n[s];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+l+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(r?"\n":"",t)},blank:function(e,t){var i,n,r=e;switch(void 0===e?r=[]:"string"==typeof e?r=[{predicate:e,object:t}]:"length"in e||(r=[e]),n=r.length){case 0:return"[]";case 1:if("["!==(i=r[0]).object[0])return"[ "+this._encodePredicate(i.predicate)+" "+this._encodeObject(i.object)+" ]";default:for(var o="[",s=0;s<n;s++)(i=r[s]).predicate===e?o+=", "+this._encodeObject(i.object):(o+=(s?";\n  ":"\n  ")+this._encodePredicate(i.predicate)+" "+this._encodeObject(i.object),e=i.predicate);return o+"\n]"}},list:function(e){for(var t=e&&e.length||0,i=new Array(t),n=0;n<t;n++)i[n]=this._encodeObject(e[n]);return"("+i.join(" ")+")"},_prefixRegex:/$0^/,end:function(i){null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite;var n=i&&function(e,t){n=null,i(e,t)};if(this._endStream)try{return this._outputStream.end(n)}catch(e){}n&&n()}},e.Writer=F,s=e.Util.expandPrefixedName,C.prototype={get size(){if(null!==(n=this._size))return n;var e,t,i,n=0,r=this._graphs;for(i in r)for(var o in e=r[i].subjects)for(var s in t=e[o])n+=Object.keys(t[s]).length;return this._size=n},_addToIndex:function(e,t,i,n){e=e[t]||(e[t]={}),t=e[i]||(e[i]={}),e=n in t;return e||(t[n]=null),!e},_removeFromIndex:function(e,t,i,n){var r,o=e[t],s=o[i];for(r in delete s[n],s)return;for(r in delete o[i],o)return;delete e[t]},_findInIndex:function(e,t,i,n,r,o,s,a,l,u){var c,d,h,p=1<!t+!i+!n?Object.keys(this._ids):this._entities;for(h in t&&(c=e,(e={})[t]=c[t]),e){var f=p[h];if(d=e[h])for(var g in i&&(c=d,(d={})[i]=c[i]),d){var m=p[g];if(g=d[g])for(var v=(n?n in g?[n]:[]:Object.keys(g)),y=v.length-1;0<=y;y--){var b={subject:"",predicate:"",object:"",graph:a};if(b[r]=f,b[o]=m,b[s]=p[v[y]],u)u.push(b);else if(l(b))return!0}}}return u},_loop:function(e,t){for(var i in e)t(i)},_loopByKey0:function(e,t,i){if(e=e[t])for(var n in e)i(n)},_loopByKey1:function(e,t,i){for(var n in e)e[n][t]&&i(n)},_loopBy2Keys:function(e,t,i,n){if((e=e[t])&&(t=e[i]))for(var r in t)n(r)},_countInIndex:function(e,t,i,n){var r,o,s,a=0;for(s in t&&(r=e,(e={})[t]=r[t]),e)if(o=e[s])for(var l in i&&(r=o,(o={})[i]=r[i]),o)(l=o[l])&&(n?n in l&&a++:a+=Object.keys(l).length);return a},_getGraphs:function(e){var t;return E(e)?((t={})[e]=this._graphs[e],t):this._graphs},_uniqueEntities:function(t){var i=Object.create(null),n=this._entities;return function(e){e in i||(i[e]=!0,t(n[e]))}},addTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject);var r=this._graphs[n=n||""],n=(r||(r=this._graphs[n]={subjects:{},predicates:{},objects:{}},Object.freeze(r)),this._ids),o=this._entities,n=(e=n[e]||(n[o[++this._id]=e]=this._id),t=n[t]||(n[o[++this._id]=t]=this._id),i=n[i]||(n[o[++this._id]=i]=this._id),this._addToIndex(r.subjects,e,t,i));return this._addToIndex(r.predicates,t,i,e),this._addToIndex(r.objects,i,e,t),this._size=null,n},addTriples:function(e){for(var t=e.length-1;0<=t;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject),n=n||"";var r,o=this._ids,s=this._graphs;if(!((e=o[e])&&(t=o[t])&&(i=o[i])&&(r=s[n])&&(o=r.subjects[e])&&(o=o[t])&&i in o))return!1;for(e in this._removeFromIndex(r.subjects,e,t,i),this._removeFromIndex(r.predicates,t,i,e),this._removeFromIndex(r.objects,i,e,t),null!==this._size&&this._size--,r.subjects)return!0;return delete s[n],!0},removeTriples:function(e){for(var t=e.length-1;0<=t;t--)this.removeTriple(e[t])},getTriples:function(e,t,i,n){var r=this._prefixes;return this.getTriplesByIRI(s(e,r),s(t,r),s(i,r),s(n,r))},getTriplesByIRI:function(e,t,i,n){var r,o,s,a,l=[],u=this._getGraphs(n),n=this._ids;if(!(E(e)&&!(o=n[e])||E(t)&&!(s=n[t])||E(i)&&!(a=n[i])))for(var c in u)(r=u[c])&&(o?a?this._findInIndex(r.objects,a,o,s,"object","subject","predicate",c,null,l):this._findInIndex(r.subjects,o,s,null,"subject","predicate","object",c,null,l):s?this._findInIndex(r.predicates,s,a,null,"predicate","object","subject",c,null,l):a?this._findInIndex(r.objects,a,null,null,"object","subject","predicate",c,null,l):this._findInIndex(r.subjects,null,null,null,"subject","predicate","object",c,null,l));return l},countTriples:function(e,t,i,n){var r=this._prefixes;return this.countTriplesByIRI(s(e,r),s(t,r),s(i,r),s(n,r))},countTriplesByIRI:function(e,t,i,n){var r,o,s,a,l,u=0,c=this._getGraphs(n),n=this._ids;if(E(e)&&!(o=n[e])||E(t)&&!(s=n[t])||E(i)&&!(a=n[i]))return 0;for(l in c)(r=c[l])&&(u+=e?i?this._countInIndex(r.objects,a,o,s):this._countInIndex(r.subjects,o,s,a):t?this._countInIndex(r.predicates,s,a,o):this._countInIndex(r.objects,a,o,s));return u},forEach:function(e,t,i,n,r){var o=this._prefixes;this.forEachByIRI(e,s(t,o),s(i,o),s(n,o),s(r,o))},forEachByIRI:function(t,e,i,n,r){this.someByIRI(function(e){return t(e),!1},e,i,n,r)},every:function(e,t,i,n,r){var o=this._prefixes;return this.everyByIRI(e,s(t,o),s(i,o),s(n,o),s(r,o))},everyByIRI:function(t,e,i,n,r){var o=!1,e=!this.someByIRI(function(e){return o=!0,!t(e)},e,i,n,r);return o&&e},some:function(e,t,i,n,r){var o=this._prefixes;return this.someByIRI(e,s(t,o),s(i,o),s(n,o),s(r,o))},someByIRI:function(e,t,i,n,r){var o,s,a,l,u=this._getGraphs(r),r=this._ids;if(!(E(t)&&!(s=r[t])||E(i)&&!(a=r[i])||E(n)&&!(l=r[n])))for(var c in u)if(o=u[c])if(s){if(l){if(this._findInIndex(o.objects,l,s,a,"object","subject","predicate",c,e,null))return!0}else if(this._findInIndex(o.subjects,s,a,null,"subject","predicate","object",c,e,null))return!0}else if(a){if(this._findInIndex(o.predicates,a,l,null,"predicate","object","subject",c,e,null))return!0}else if(l){if(this._findInIndex(o.objects,l,null,null,"object","subject","predicate",c,e,null))return!0}else if(this._findInIndex(o.subjects,null,null,null,"subject","predicate","object",c,e,null))return!0;return!1},getSubjects:function(e,t,i){var n=this._prefixes;return this.getSubjectsByIRI(s(e,n),s(t,n),s(i,n))},getSubjectsByIRI:function(e,t,i){var n=[];return this.forSubjectsByIRI(function(e){n.push(e)},e,t,i),n},forSubjects:function(e,t,i,n){var r=this._prefixes;this.forSubjectsByIRI(e,s(t,r),s(i,r),s(n,r))},forSubjectsByIRI:function(e,t,i,n){var r,o,s,a=this._ids,l=this._getGraphs(n);if(e=this._uniqueEntities(e),!(E(t)&&!(o=a[t])||E(i)&&!(s=a[i])))for(n in l)(r=l[n])&&(o?s?this._loopBy2Keys(r.predicates,o,s,e):this._loopByKey1(r.subjects,o,e):s?this._loopByKey0(r.objects,s,e):this._loop(r.subjects,e))},getPredicates:function(e,t,i){var n=this._prefixes;return this.getPredicatesByIRI(s(e,n),s(t,n),s(i,n))},getPredicatesByIRI:function(e,t,i){var n=[];return this.forPredicatesByIRI(function(e){n.push(e)},e,t,i),n},forPredicates:function(e,t,i,n){var r=this._prefixes;this.forPredicatesByIRI(e,s(t,r),s(i,r),s(n,r))},forPredicatesByIRI:function(e,t,i,n){var r,o,s,a=this._ids,l=this._getGraphs(n);if(e=this._uniqueEntities(e),!(E(t)&&!(o=a[t])||E(i)&&!(s=a[i])))for(n in l)(r=l[n])&&(o?s?this._loopBy2Keys(r.objects,s,o,e):this._loopByKey0(r.subjects,o,e):s?this._loopByKey1(r.predicates,s,e):this._loop(r.predicates,e))},getObjects:function(e,t,i){var n=this._prefixes;return this.getObjectsByIRI(s(e,n),s(t,n),s(i,n))},getObjectsByIRI:function(e,t,i){var n=[];return this.forObjectsByIRI(function(e){n.push(e)},e,t,i),n},forObjects:function(e,t,i,n){var r=this._prefixes;this.forObjectsByIRI(e,s(t,r),s(i,r),s(n,r))},forObjectsByIRI:function(e,t,i,n){var r,o,s,a=this._ids,l=this._getGraphs(n);if(e=this._uniqueEntities(e),!(E(t)&&!(o=a[t])||E(i)&&!(s=a[i])))for(n in l)(r=l[n])&&(o?s?this._loopBy2Keys(r.subjects,o,s,e):this._loopByKey1(r.objects,o,e):s?this._loopByKey0(r.predicates,s,e):this._loop(r.objects,e))},getGraphs:function(e,t,i){var n=this._prefixes;return this.getGraphsByIRI(s(e,n),s(t,n),s(i,n))},getGraphsByIRI:function(e,t,i){var n=[];return this.forGraphsByIRI(function(e){n.push(e)},e,t,i),n},forGraphs:function(e,t,i,n){var r=this._prefixes;this.forGraphsByIRI(e,s(t,r),s(i,r),s(n,r))},forGraphsByIRI:function(t,e,i,n){for(var r in this._graphs)this.someByIRI(function(e){return t(e.graph),!0},e,i,n,r)},createBlankNode:function(e){var t,i;if(e)for(t=e="_:"+e,i=1;this._ids[t];)t=e+i++;else for(;t="_:b"+this._blankNodeIndex++,this._ids[t];);return this._ids[t]=++this._id,this._entities[this._id]=t}},e.Store=C}("undefined"!=typeof exports?exports:this.N3={}),!function(e){var t;"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):("undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.rdfstore=e())}(function(){var define,module,exports;return function n(r,o,s){function a(i,e){if(!o[i]){if(!r[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(l)return l(i,!0);throw new Error("Cannot find module '"+i+"'")}e=o[i]={exports:{}};r[i][0].call(e.exports,function(e){var t=r[i][1][e];return a(t||e)},e,e.exports,n,r,o,s)}return o[i].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,i){!function(){var e=void 0!==i?i:this,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function a(e){this.message=e}(a.prototype=new Error).name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var t,i,n=0,r=s,o="";e.charAt(0|n)||(r="=",n%1);o+=r.charAt(63&t>>8-n%1*8)){if(255<(i=e.charCodeAt(n+=.75)))throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|i}return o}),e.atob||(e.atob=function(e){if((e=e.replace(/=+$/,"")).length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,i,n=0,r=0,o="";i=e.charAt(r++);~i&&(t=n%4?64*t+i:i,n++%4)&&(o+=String.fromCharCode(255&t>>(-2*n&6))))i=s.indexOf(i);return o})}()},{}],2:[function(e,t,i){!function(e){"use strict";var l="undefined"!=typeof Uint8Array?Uint8Array:Array,t="+".charCodeAt(0),i="/".charCodeAt(0),n="0".charCodeAt(0),r="a".charCodeAt(0),o="A".charCodeAt(0);function u(e){e=e.charCodeAt(0);return e===t?62:e===i?63:e<n?-1:e<n+10?e-n+26+26:e<o+26?e-o:e<r+26?e-r+26:void 0}e.toByteArray=function(e){var t,i;if(0<e.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.length,n="="===e.charAt(n-2)?2:"="===e.charAt(n-1)?1:0,r=new l(3*e.length/4-n),o=0<n?e.length-4:e.length,s=0;function a(e){r[s++]=e}for(t=0;t<o;t+=4,0)a((16711680&(i=u(e.charAt(t))<<18|u(e.charAt(t+1))<<12|u(e.charAt(t+2))<<6|u(e.charAt(t+3))))>>16),a((65280&i)>>8),a(255&i);return 2==n?a(255&(i=u(e.charAt(t))<<2|u(e.charAt(t+1))>>4)):1==n&&(a((i=u(e.charAt(t))<<10|u(e.charAt(t+1))<<4|u(e.charAt(t+2))>>2)>>8&255),a(255&i)),r},e.fromByteArray=function(e){var t,i,n,r,o=e.length%3,s="";function a(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)}for(t=0,n=e.length-o;t<n;t+=3)i=(e[t]<<16)+(e[t+1]<<8)+e[t+2],s+=a((r=i)>>18&63)+a(r>>12&63)+a(r>>6&63)+a(63&r);switch(o){case 1:s=(s+=a((i=e[e.length-1])>>2))+a(i<<4&63)+"==";break;case 2:s=(s=(s+=a((i=(e[e.length-2]<<8)+e[e.length-1])>>10))+a(i>>4&63))+a(i<<2&63)+"="}return s}}(void 0===i?this.base64js={}:i)},{}],3:[function(H,G,e){!function(z,q){!function(){"use strict";function u(e){return"function"==typeof e}var t,i,e=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=e,n=0,a=function(e,t){g[n]=e,g[n+1]=t,2===(n+=2)&&(i?i(m):b())};var e="undefined"!=typeof window?window:void 0,r=e||{},r=r.MutationObserver||r.WebKitMutationObserver,o=void 0!==z&&"[object process]"==={}.toString.call(z),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function c(){return function(){setTimeout(m,1)}}var d,h,p,f,g=new Array(1e3);function m(){for(var e=0;e<n;e+=2)(0,g[e])(g[e+1]),g[e]=void 0,g[e+1]=void 0;n=0}function v(){try{var e=H("vertx");return t=e.runOnLoop||e.runOnContext,function(){t(m)}}catch(e){return c()}}function y(){}var b=o?(f=z.nextTick,o=z.versions.node.match(/^(?:(\d+)\.)?(?:(\d+)\.)?(\*|\d+)$/),Array.isArray(o)&&"0"===o[1]&&"10"===o[2]&&(f=setImmediate),function(){f(m)}):r?(h=0,o=new r(m),p=document.createTextNode(""),o.observe(p,{characterData:!0}),function(){p.data=h=++h%2}):l?((d=new MessageChannel).port1.onmessage=m,function(){d.port2.postMessage(0)}):(void 0===e&&"function"==typeof H?v:c)(),w=void 0,x=1,_=2,k=new S;function L(e,n,r){a(function(t){var i=!1,e=function(e,t,i,n){try{e.call(t,i,n)}catch(e){return e}}(r,n,function(e){i||(i=!0,(n!==e?C:E)(t,e))},function(e){i||(i=!0,F(t,e))},t._label);!i&&e&&(i=!0,F(t,e))},e)}function P(e,t){var i,n;t.constructor===e.constructor?(i=e,(n=t)._state===x?E(i,n._result):n._state===_?F(i,n._result):T(n,void 0,function(e){C(i,e)},function(e){F(i,e)})):(n=function(e){try{return e.then}catch(e){return k.error=e,k}}(t))===k?F(e,k.error):void 0!==n&&u(n)?L(e,t,n):E(e,t)}function C(e,t){var i;e===t?F(e,new TypeError("You cannot resolve a promise with itself")):("function"==typeof(i=t)||"object"==typeof i&&null!==i?P:E)(e,t)}function M(e){e._onerror&&e._onerror(e._result),D(e)}function E(e,t){e._state===w&&(e._result=t,e._state=x,0!==e._subscribers.length)&&a(D,e)}function F(e,t){e._state===w&&(e._state=_,e._result=t,a(M,e))}function T(e,t,i,n){var r=e._subscribers,o=r.length;e._onerror=null,r[o]=t,r[o+x]=i,r[o+_]=n,0===o&&e._state&&a(D,e)}function D(e){var t=e._subscribers,i=e._state;if(0!==t.length){for(var n,r,o=e._result,s=0;s<t.length;s+=3)n=t[s],r=t[s+i],n?j(i,n,r,o):r(o);e._subscribers.length=0}}function S(){this.error=null}var R=new S;function j(e,t,i,n){var r,o,s,a,l=u(i);if(l){if((r=function(e,t){try{return e(t)}catch(e){return R.error=e,R}}(i,n))===R?(a=!0,o=r.error,r=null):s=!0,t===r)return void F(t,new TypeError("A promises callback cannot return that same promise."))}else r=n,s=!0;t._state===w&&(l&&s?C(t,r):a?F(t,o):e===x?E(t,r):e===_&&F(t,r))}function I(e,t){var i=this;i._instanceConstructor=e,i.promise=new e(y),i._validateInput(t)?(i._input=t,i.length=t.length,i._remaining=t.length,i._init(),0!==i.length&&(i.length=i.length||0,i._enumerate(),0!==i._remaining)||E(i.promise,i._result)):F(i.promise,i._validationError())}I.prototype._validateInput=function(e){return s(e)},I.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},I.prototype._init=function(){this._result=new Array(this.length)};var U=I;I.prototype._enumerate=function(){for(var e=this.length,t=this.promise,i=this._input,n=0;t._state===w&&n<e;n++)this._eachEntry(i[n],n)},I.prototype._eachEntry=function(e,t){var i,n=this,r=n._instanceConstructor;"object"==typeof(i=e)&&null!==i?e.constructor===r&&e._state!==w?(e._onerror=null,n._settledAt(e._state,t,e._result)):n._willSettleAt(r.resolve(e),t):(n._remaining--,n._result[t]=e)},I.prototype._settledAt=function(e,t,i){var n=this,r=n.promise;r._state===w&&(n._remaining--,e===_?F(r,i):n._result[t]=i),0===n._remaining&&E(r,n._result)},I.prototype._willSettleAt=function(e,t){var i=this;T(e,void 0,function(e){i._settledAt(x,t,e)},function(e){i._settledAt(_,t,e)})};function $(e){var t=new this(y);if(s(e))for(var i=e.length,n=0;t._state===w&&n<i;n++)T(this.resolve(e[n]),void 0,r,o);else F(t,new TypeError("You must pass an array to race."));return t;function r(e){C(t,e)}function o(e){F(t,e)}}function B(e){var t;return e&&"object"==typeof e&&e.constructor===this?e:(C(t=new this(y),e),t)}function Q(e){var t=new this(y);return F(t,e),t}var V=0;var A=O;function O(e){if(this._id=V++,this._state=void 0,this._result=void 0,this._subscribers=[],y!==e){if(!u(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof O))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");var t=this;try{e(function(e){C(t,e)},function(e){F(t,e)})}catch(e){F(t,e)}}}O.all=function(e){return new U(this,e).promise},O.race=$,O.resolve=B,O.reject=Q,O._setScheduler=function(e){i=e},O._setAsap=function(e){a=e},O._asap=a,O.prototype={constructor:O,then:function(e,t){var i,n,r,o=this._state;return o===x&&!e||o===_&&!t?this:(i=new this.constructor(y),n=this._result,o?(r=arguments[o-1],a(function(){j(o,i,r,n)})):T(this,i,e,t),i)},catch:function(e){return this.then(null,e)}};var r=function(){var e;if(void 0!==q)e=q;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;t&&"[object Promise]"===Object.prototype.toString.call(t.resolve())&&!t.cast||(e.Promise=A)},N={Promise:A,polyfill:r};"function"==typeof define&&define.amd?define(function(){return N}):void 0!==G&&G.exports?G.exports=N:void 0!==this&&(this.ES6Promise=N),r()}.call(this)}.call(this,H("2ionoC"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"2ionoC":10}],4:[function(e,t,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function l(e){return"object"==typeof e&&null!==e}function u(e){return void 0===e}((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,i,n,r,o,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(u(i=this._events[e]))return!1;if(a(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];i.apply(this,r)}else if(l(i)){for(n=arguments.length,r=new Array(n-1),o=1;o<n;o++)r[o-1]=arguments[o];for(n=(s=i.slice()).length,o=0;o<n;o++)s[o].apply(this,r)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){if(a(t))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,l(this._events[e])&&!this._events[e].warned&&(t=u(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<t&&this._events[e].length>t&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace)&&console.trace(),this;throw TypeError("listener must be a function")},n.prototype.once=function(e,t){var i;if(a(t))return i=!1,n.listener=t,this.on(e,n),this;throw TypeError("listener must be a function");function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}},n.prototype.removeListener=function(e,t){var i,n,r,o;if(!a(t))throw TypeError("listener must be a function");if(this._events&&this._events[e])if(r=(i=this._events[e]).length,n=-1,i===t||a(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(i)){for(o=r;0<o--;)if(i[o]===t||i[o].listener&&i[o].listener===t){n=o;break}if(n<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,i;if(this._events)if(this._events.removeListener)if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);this.removeAllListeners("removeListener"),this._events={}}else{if(a(i=this._events[e]))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);delete this._events[e]}else 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e];return this},n.prototype.listeners=function(e){e=this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[];return e},n.listenerCount=function(e,t){e=e._events&&e._events[t]?a(e._events[t])?1:e._events[t].length:0;return e}},{}],5:[function(e,t,i){},{}],6:[function(e,t,n){var l=e("base64-js"),o=e("ieee754");function u(e,t,i){if(!(this instanceof u))return new u(e,t,i);var n,r,o,s,a=typeof e;if("base64"===t&&"string"==a)for(e=(s=e).trim?s.trim():s.replace(/^\s+|\s+$/g,"");e.length%4!=0;)e+="=";if("number"==a)n=k(e);else if("string"==a)n=u.byteLength(e,t);else{if("object"!=a)throw new Error("First argument needs to be a number, array or string.");n=k(e.length)}if(u._useTypedArrays?r=u._augment(new Uint8Array(n)):((r=this).length=n,r._isBuffer=!0),u._useTypedArrays&&"number"==typeof e.byteLength)r._set(e);else if(C(s=e)||u.isBuffer(s)||s&&"object"==typeof s&&"number"==typeof s.length)for(o=0;o<n;o++)u.isBuffer(e)?r[o]=e.readUInt8(o):r[o]=e[o];else if("string"==a)r.write(e,0,t);else if("number"==a&&!u._useTypedArrays&&!i)for(o=0;o<n;o++)r[o]=0;return r}function c(e,t,i,n){return u._charsWritten=D(function(e){for(var t=[],i=0;i<e.length;i++)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function d(e,t,i,n){return u._charsWritten=D(function(e){for(var t,i,n=[],r=0;r<e.length;r++)t=e.charCodeAt(r),i=t>>8,n.push(t%256),n.push(i);return n}(t),e,i,n)}function h(e,t,i){var n="";i=Math.min(e.length,i);for(var r=t;r<i;r++)n+=String.fromCharCode(e[r]);return n}function r(e,t,i,n){n||(A("boolean"==typeof i,"missing or invalid endian"),A(null!=t,"missing offset"),A(t+1<e.length,"Trying to read beyond buffer length"));var r,n=e.length;if(!(n<=t))return i?(r=e[t],t+1<n&&(r|=e[t+1]<<8)):(r=e[t]<<8,t+1<n&&(r|=e[t+1])),r}function s(e,t,i,n){n||(A("boolean"==typeof i,"missing or invalid endian"),A(null!=t,"missing offset"),A(t+3<e.length,"Trying to read beyond buffer length"));var r,n=e.length;if(!(n<=t))return i?(t+2<n&&(r=e[t+2]<<16),t+1<n&&(r|=e[t+1]<<8),r|=e[t],t+3<n&&(r+=e[t+3]<<24>>>0)):(t+1<n&&(r=e[t+1]<<16),t+2<n&&(r|=e[t+2]<<8),t+3<n&&(r|=e[t+3]),r+=e[t]<<24>>>0),r}function i(e,t,i,n){n||(A("boolean"==typeof i,"missing or invalid endian"),A(null!=t,"missing offset"),A(t+1<e.length,"Trying to read beyond buffer length"));var n=e.length;if(!(n<=t))return 32768&(n=r(e,t,i,!0))?-1*(65535-n+1):n}function a(e,t,i,n){n||(A("boolean"==typeof i,"missing or invalid endian"),A(null!=t,"missing offset"),A(t+3<e.length,"Trying to read beyond buffer length"));var n=e.length;if(!(n<=t))return 2147483648&(n=s(e,t,i,!0))?-1*(4294967295-n+1):n}function p(e,t,i,n){return n||(A("boolean"==typeof i,"missing or invalid endian"),A(t+3<e.length,"Trying to read beyond buffer length")),o.read(e,t,i,23,4)}function f(e,t,i,n){return n||(A("boolean"==typeof i,"missing or invalid endian"),A(t+7<e.length,"Trying to read beyond buffer length")),o.read(e,t,i,52,8)}function g(e,t,i,n,r){r||(A(null!=t,"missing value"),A("boolean"==typeof n,"missing or invalid endian"),A(null!=i,"missing offset"),A(i+1<e.length,"trying to write beyond buffer length"),R(t,65535));r=e.length;if(!(r<=i))for(var o=0,s=Math.min(r-i,2);o<s;o++)e[i+o]=(t&255<<8*(n?o:1-o))>>>8*(n?o:1-o)}function m(e,t,i,n,r){r||(A(null!=t,"missing value"),A("boolean"==typeof n,"missing or invalid endian"),A(null!=i,"missing offset"),A(i+3<e.length,"trying to write beyond buffer length"),R(t,4294967295));r=e.length;if(!(r<=i))for(var o=0,s=Math.min(r-i,4);o<s;o++)e[i+o]=t>>>8*(n?o:3-o)&255}function v(e,t,i,n,r){r||(A(null!=t,"missing value"),A("boolean"==typeof n,"missing or invalid endian"),A(null!=i,"missing offset"),A(i+1<e.length,"Trying to write beyond buffer length"),j(t,32767,-32768)),e.length<=i||g(e,0<=t?t:65535+t+1,i,n,r)}function y(e,t,i,n,r){r||(A(null!=t,"missing value"),A("boolean"==typeof n,"missing or invalid endian"),A(null!=i,"missing offset"),A(i+3<e.length,"Trying to write beyond buffer length"),j(t,2147483647,-2147483648)),e.length<=i||m(e,0<=t?t:4294967295+t+1,i,n,r)}function b(e,t,i,n,r){r||(A(null!=t,"missing value"),A("boolean"==typeof n,"missing or invalid endian"),A(null!=i,"missing offset"),A(i+3<e.length,"Trying to write beyond buffer length"),I(t,34028234663852886e22,-34028234663852886e22)),e.length<=i||o.write(e,t,i,n,23,4)}function w(e,t,i,n,r){r||(A(null!=t,"missing value"),A("boolean"==typeof n,"missing or invalid endian"),A(null!=i,"missing offset"),A(i+7<e.length,"Trying to write beyond buffer length"),I(t,17976931348623157e292,-17976931348623157e292)),e.length<=i||o.write(e,t,i,n,52,8)}n.Buffer=u,n.SlowBuffer=u,n.INSPECT_MAX_BYTES=50,u.poolSize=8192,u._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(e){return!1}}(),u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.byteLength=function(e,t){var i;switch(e+="",t||"utf8"){case"hex":i=e.length/2;break;case"utf8":case"utf-8":i=F(e).length;break;case"ascii":case"binary":case"raw":i=e.length;break;case"base64":i=T(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=2*e.length;break;default:throw new Error("Unknown encoding")}return i},u.concat=function(e,t){if(A(C(e),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===e.length)return new u(0);if(1===e.length)return e[0];if("number"!=typeof t)for(r=t=0;r<e.length;r++)t+=e[r].length;for(var i=new u(t),n=0,r=0;r<e.length;r++){var o=e[r];o.copy(i,n),n+=o.length}return i},u.prototype.write=function(e,t,i,n){isFinite(t)?isFinite(i)||(n=i,i=void 0):(l=n,n=t,t=i,i=l),t=Number(t)||0;var r,o,s,a,l=this.length-t;switch((!i||l<(i=Number(i)))&&(i=l),n=String(n||"utf8").toLowerCase()){case"hex":r=function(e,t,i,n){i=Number(i)||0;var r=e.length-i;(!n||r<(n=Number(n)))&&(n=r),A((r=t.length)%2==0,"Invalid hex string"),r/2<n&&(n=r/2);for(var o=0;o<n;o++){var s=parseInt(t.substr(2*o,2),16);A(!isNaN(s),"Invalid hex string"),e[i+o]=s}return u._charsWritten=2*o,o}(this,e,t,i);break;case"utf8":case"utf-8":o=this,s=t,a=i,r=u._charsWritten=D(F(e),o,s,a);break;case"ascii":case"binary":r=c(this,e,t,i);break;case"base64":o=this,s=t,a=i,r=u._charsWritten=D(T(e),o,s,a);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=d(this,e,t,i);break;default:throw new Error("Unknown encoding")}return r},u.prototype.toString=function(e,t,i){var n,r,o,s,a=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,(i=void 0!==i?Number(i):a.length)===t)return"";switch(e){case"hex":n=function(e,t,i){var n=e.length;(!t||t<0)&&(t=0);(!i||i<0||n<i)&&(i=n);for(var r="",o=t;o<i;o++)r+=E(e[o]);return r}(a,t,i);break;case"utf8":case"utf-8":n=function(e,t,i){var n="",r="";i=Math.min(e.length,i);for(var o=t;o<i;o++)e[o]<=127?(n+=S(r)+String.fromCharCode(e[o]),r=""):r+="%"+e[o].toString(16);return n+S(r)}(a,t,i);break;case"ascii":case"binary":n=h(a,t,i);break;case"base64":r=a,s=i,n=0===(o=t)&&s===r.length?l.fromByteArray(r):l.fromByteArray(r.slice(o,s));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":n=function(e,t,i){for(var n=e.slice(t,i),r="",o=0;o<n.length;o+=2)r+=String.fromCharCode(n[o]+256*n[o+1]);return r}(a,t,i);break;default:throw new Error("Unknown encoding")}return n},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.copy=function(e,t,i,n){if(t=t||0,(n=n||0===n?n:this.length)!==(i=i||0)&&0!==e.length&&0!==this.length){A(i<=n,"sourceEnd < sourceStart"),A(0<=t&&t<e.length,"targetStart out of bounds"),A(0<=i&&i<this.length,"sourceStart out of bounds"),A(0<=n&&n<=this.length,"sourceEnd out of bounds"),n>this.length&&(n=this.length);var r=(n=e.length-t<n-i?e.length-t+i:n)-i;if(r<100||!u._useTypedArrays)for(var o=0;o<r;o++)e[o+t]=this[o+i];else e._set(this.subarray(i,i+r),t)}},u.prototype.slice=function(e,t){var i=this.length;if(e=_(e,i,0),t=_(t,i,i),u._useTypedArrays)return u._augment(this.subarray(e,t));for(var n=t-e,r=new u(n,void 0,!0),o=0;o<n;o++)r[o]=this[o+e];return r},u.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},u.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},u.prototype.readUInt8=function(e,t){if(t||(A(null!=e,"missing offset"),A(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return this[e]},u.prototype.readUInt16LE=function(e,t){return r(this,e,!0,t)},u.prototype.readUInt16BE=function(e,t){return r(this,e,!1,t)},u.prototype.readUInt32LE=function(e,t){return s(this,e,!0,t)},u.prototype.readUInt32BE=function(e,t){return s(this,e,!1,t)},u.prototype.readInt8=function(e,t){if(t||(A(null!=e,"missing offset"),A(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){return i(this,e,!0,t)},u.prototype.readInt16BE=function(e,t){return i(this,e,!1,t)},u.prototype.readInt32LE=function(e,t){return a(this,e,!0,t)},u.prototype.readInt32BE=function(e,t){return a(this,e,!1,t)},u.prototype.readFloatLE=function(e,t){return p(this,e,!0,t)},u.prototype.readFloatBE=function(e,t){return p(this,e,!1,t)},u.prototype.readDoubleLE=function(e,t){return f(this,e,!0,t)},u.prototype.readDoubleBE=function(e,t){return f(this,e,!1,t)},u.prototype.writeUInt8=function(e,t,i){i||(A(null!=e,"missing value"),A(null!=t,"missing offset"),A(t<this.length,"trying to write beyond buffer length"),R(e,255)),t>=this.length||(this[t]=e)},u.prototype.writeUInt16LE=function(e,t,i){g(this,e,t,!0,i)},u.prototype.writeUInt16BE=function(e,t,i){g(this,e,t,!1,i)},u.prototype.writeUInt32LE=function(e,t,i){m(this,e,t,!0,i)},u.prototype.writeUInt32BE=function(e,t,i){m(this,e,t,!1,i)},u.prototype.writeInt8=function(e,t,i){i||(A(null!=e,"missing value"),A(null!=t,"missing offset"),A(t<this.length,"Trying to write beyond buffer length"),j(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,i):this.writeUInt8(255+e+1,t,i))},u.prototype.writeInt16LE=function(e,t,i){v(this,e,t,!0,i)},u.prototype.writeInt16BE=function(e,t,i){v(this,e,t,!1,i)},u.prototype.writeInt32LE=function(e,t,i){y(this,e,t,!0,i)},u.prototype.writeInt32BE=function(e,t,i){y(this,e,t,!1,i)},u.prototype.writeFloatLE=function(e,t,i){b(this,e,t,!0,i)},u.prototype.writeFloatBE=function(e,t,i){b(this,e,t,!1,i)},u.prototype.writeDoubleLE=function(e,t,i){w(this,e,t,!0,i)},u.prototype.writeDoubleBE=function(e,t,i){w(this,e,t,!1,i)},u.prototype.fill=function(e,t,i){if(t=t||0,i=i||this.length,A("number"==typeof(e="string"==typeof(e=e||0)?e.charCodeAt(0):e)&&!isNaN(e),"value is not a number"),A(t<=i,"end < start"),i!==t&&0!==this.length){A(0<=t&&t<this.length,"start out of bounds"),A(0<=i&&i<=this.length,"end out of bounds");for(var n=t;n<i;n++)this[n]=e}},u.prototype.inspect=function(){for(var e=[],t=this.length,i=0;i<t;i++)if(e[i]=E(this[i]),i===n.INSPECT_MAX_BYTES){e[i+1]="...";break}return"<Buffer "+e.join(" ")+">"},u.prototype.toArrayBuffer=function(){if("undefined"==typeof Uint8Array)throw new Error("Buffer.toArrayBuffer not supported in this browser");if(u._useTypedArrays)return new u(this).buffer;for(var e=new Uint8Array(this.length),t=0,i=e.length;t<i;t+=1)e[t]=this[t];return e.buffer};var x=u.prototype;function _(e,t,i){return"number"!=typeof e?i:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function k(e){return(e=~~Math.ceil(+e))<0?0:e}function C(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function E(e){return e<16?"0"+e.toString(16):e.toString(16)}function F(e){for(var t=[],i=0;i<e.length;i++){var n=e.charCodeAt(i);if(n<=127)t.push(e.charCodeAt(i));else for(var r=i,o=(55296<=n&&n<=57343&&i++,encodeURIComponent(e.slice(r,i+1)).substr(1).split("%")),s=0;s<o.length;s++)t.push(parseInt(o[s],16))}return t}function T(e){return l.toByteArray(e)}function D(e,t,i,n){for(var r=0;r<n&&!(r+i>=t.length||r>=e.length);r++)t[r+i]=e[r];return r}function S(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function R(e,t){A("number"==typeof e,"cannot write a non-number as a number"),A(0<=e,"specified a negative value for writing an unsigned value"),A(e<=t,"value is larger than maximum value for type"),A(Math.floor(e)===e,"value has a fractional component")}function j(e,t,i){A("number"==typeof e,"cannot write a non-number as a number"),A(e<=t,"value larger than maximum allowed value"),A(i<=e,"value smaller than minimum allowed value"),A(Math.floor(e)===e,"value has a fractional component")}function I(e,t,i){A("number"==typeof e,"cannot write a non-number as a number"),A(e<=t,"value larger than maximum allowed value"),A(i<=e,"value smaller than minimum allowed value")}function A(e,t){if(!e)throw new Error(t||"Failed assertion")}u._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=x.get,e.set=x.set,e.write=x.write,e.toString=x.toString,e.toLocaleString=x.toString,e.toJSON=x.toJSON,e.copy=x.copy,e.slice=x.slice,e.readUInt8=x.readUInt8,e.readUInt16LE=x.readUInt16LE,e.readUInt16BE=x.readUInt16BE,e.readUInt32LE=x.readUInt32LE,e.readUInt32BE=x.readUInt32BE,e.readInt8=x.readInt8,e.readInt16LE=x.readInt16LE,e.readInt16BE=x.readInt16BE,e.readInt32LE=x.readInt32LE,e.readInt32BE=x.readInt32BE,e.readFloatLE=x.readFloatLE,e.readFloatBE=x.readFloatBE,e.readDoubleLE=x.readDoubleLE,e.readDoubleBE=x.readDoubleBE,e.writeUInt8=x.writeUInt8,e.writeUInt16LE=x.writeUInt16LE,e.writeUInt16BE=x.writeUInt16BE,e.writeUInt32LE=x.writeUInt32LE,e.writeUInt32BE=x.writeUInt32BE,e.writeInt8=x.writeInt8,e.writeInt16LE=x.writeInt16LE,e.writeInt16BE=x.writeInt16BE,e.writeInt32LE=x.writeInt32LE,e.writeInt32BE=x.writeInt32BE,e.writeFloatLE=x.writeFloatLE,e.writeFloatBE=x.writeFloatBE,e.writeDoubleLE=x.writeDoubleLE,e.writeDoubleBE=x.writeDoubleBE,e.fill=x.fill,e.inspect=x.inspect,e.toArrayBuffer=x.toArrayBuffer,e}},{"base64-js":2,ieee754:24}],7:[function(e,t,i){var n=t.exports,r=(e("events").EventEmitter,e("./lib/request")),o=e("url"),s=(n.request=function(e,t){(e=(e="string"==typeof e?o.parse(e):e)||{}).host||e.port||(e.port=parseInt(window.location.port,10)),!e.host&&e.hostname&&(e.host=e.hostname),e.scheme||(e.scheme=window.location.protocol.split(":")[0]),e.host||(e.host=window.location.hostname||window.location.host),/:/.test(e.host)&&(e.port||(e.port=e.host.split(":")[1]),e.host=e.host.split(":")[0]),e.port||(e.port="https"==e.scheme?443:80);e=new r(new s,e);return t&&e.on("response",t),e},n.get=function(e,t){e.method="GET";e=n.request(e,t);return e.end(),e},n.Agent=function(){},n.Agent.defaultMaxSockets=4,function(){if("undefined"==typeof window)throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject)for(var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],i=0;i<t.length;i++)try{var n=new window.ActiveXObject(t[i]);return function(){var e;return n?(e=n,n=null,e):new window.ActiveXObject(t[i])}}catch(e){}throw new Error("ajax not supported in this browser")}());n.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{"./lib/request":8,events:4,url:36}],8:[function(e,t,i){var n=e("stream"),l=e("./response"),u=e("Base64"),e=e("inherits"),r=t.exports=function(e,t){var i=this;i.writable=!0,i.xhr=e,i.body=[],i.uri=(t.scheme||"http")+"://"+t.host+(t.port?":"+t.port:"")+(t.path||"/"),void 0===t.withCredentials&&(t.withCredentials=!0);try{e.withCredentials=t.withCredentials}catch(e){}if(e.open(t.method||"GET",i.uri,!0),i._headers={},t.headers)for(var n=c(t.headers),r=0;r<n.length;r++){var o,s=n[r];i.isSafeRequestHeader(s)&&(o=t.headers[s],i.setHeader(s,o))}t.auth&&this.setHeader("Authorization","Basic "+u.btoa(t.auth));var a=new l;a.on("close",function(){i.emit("close")}),a.on("ready",function(){i.emit("response",a)}),e.onreadystatechange=function(){e.__aborted||a.handle(e)}},c=(e(r,n),r.prototype.setHeader=function(e,t){this._headers[e.toLowerCase()]=t},r.prototype.getHeader=function(e){return this._headers[e.toLowerCase()]},r.prototype.removeHeader=function(e){delete this._headers[e.toLowerCase()]},r.prototype.write=function(e){this.body.push(e)},r.prototype.destroy=function(e){this.xhr.__aborted=!0,this.xhr.abort(),this.emit("close")},r.prototype.end=function(e){void 0!==e&&this.body.push(e);for(var t=c(this._headers),i=0;i<t.length;i++){var n=t[i],r=this._headers[n];if(d(r))for(var o=0;o<r.length;o++)this.xhr.setRequestHeader(n,r[o]);else this.xhr.setRequestHeader(n,r)}if(0===this.body.length)this.xhr.send("");else if("string"==typeof this.body[0])this.xhr.send(this.body.join(""));else{if(d(this.body[0]))for(var s=[],i=0;i<this.body.length;i++)s.push.apply(s,this.body[i]);else if(/Array/.test(Object.prototype.toString.call(this.body[0]))){for(var a=0,i=0;i<this.body.length;i++)a+=this.body[i].length;for(var s=new this.body[0].constructor(a),l=0,i=0;i<this.body.length;i++)for(var u=this.body[i],o=0;o<u.length;o++)s[l++]=u[o]}else for(s="",i=0;i<this.body.length;i++)s+=this.body[i].toString();this.xhr.send(s)}},r.unsafeHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"],r.prototype.isSafeRequestHeader=function(e){return!!e&&-1===o(r.unsafeHeaders,e.toLowerCase())},Object.keys||function(e){var t,i=[];for(t in e)i.push(t);return i}),d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1}},{"./response":9,Base64:1,inherits:25,stream:16}],9:[function(e,t,i){var n=e("stream"),e=e("util"),t=t.exports=function(e){this.offset=0,this.readable=!0},r=(e.inherits(t,n),{streaming:!0,status2:!0});function o(e){for(var t=e.getAllResponseHeaders().split(/\r?\n/),i={},n=0;n<t.length;n++){var r,o,s=t[n];""!==s&&((o=s.match(/^([^:]+):\s*(.*)/))?(r=o[1].toLowerCase(),o=o[2],void 0!==i[r]?a(i[r])?i[r].push(o):i[r]=[i[r],o]:i[r]=o):i[s]=!0)}return i}t.prototype.getResponse=function(e){var t=String(e.responseType).toLowerCase();return"blob"===t?e.responseBlob||e.response:"arraybuffer"===t?e.response:e.responseText},t.prototype.getHeader=function(e){return this.headers[e.toLowerCase()]},t.prototype.handle=function(e){if(2===e.readyState&&r.status2){try{this.statusCode=e.status,this.headers=o(e)}catch(e){r.status2=!1}r.status2&&this.emit("ready")}else if(r.streaming&&3===e.readyState){try{this.statusCode||(this.statusCode=e.status,this.headers=o(e),this.emit("ready"))}catch(e){}try{this._emitData(e)}catch(e){r.streaming=!1}}else 4===e.readyState&&(this.statusCode||(this.statusCode=e.status,this.emit("ready")),this._emitData(e),e.error?this.emit("error",this.getResponse(e)):this.emit("end"),this.emit("close"))},t.prototype._emitData=function(e){e=this.getResponse(e);e.toString().match(/ArrayBuffer/)?(this.emit("data",new Uint8Array(e,this.offset)),this.offset=e.byteLength):e.length>this.offset&&(this.emit("data",e.slice(this.offset)),this.offset=e.length)};var a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{stream:16,util:38}],10:[function(e,t,i){var n,r,o,t=t.exports={};function s(){}t.nextTick=(r="undefined"!=typeof window&&window.setImmediate,o="undefined"!=typeof window&&window.postMessage&&window.addEventListener,r?function(e){return window.setImmediate(e)}:o?(n=[],window.addEventListener("message",function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<n.length&&n.shift()())},!0),function(e){n.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.on=s,t.addListener=s,t.once=s,t.off=s,t.removeListener=s,t.removeAllListeners=s,t.emit=s,t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],11:[function(e,T,D){!function(e){var t=this,i="object"==typeof D&&D,n="object"==typeof T&&T&&T.exports==i&&T,e="object"==typeof e&&e;e.global!==e&&e.window!==e||(t=e);var r,o,m=2147483647,v=36,y=26,s=38,a=700,l=/^xn--/,u=/[^ -~]/,c=/\x2E|\u3002|\uFF0E|\uFF61/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},h=v-1,b=Math.floor,w=String.fromCharCode;function x(e){throw RangeError(d[e])}function p(e,t){for(var i=e.length;i--;)e[i]=t(e[i]);return e}function f(e,t){return p(e.split(c),t).join(".")}function _(e){for(var t,i,n=[],r=0,o=e.length;r<o;)55296<=(t=e.charCodeAt(r++))&&t<=56319&&r<o?56320==(64512&(i=e.charCodeAt(r++)))?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),r--):n.push(t);return n}function g(e){return p(e,function(e){var t="";return 65535<e&&(t+=w((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=w(e)}).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function C(e,t,i){var n=0;for(e=i?b(e/a):e>>1,e+=b(e/t);h*y>>1<e;n+=v)e=b(e/h);return b(n+(h+1)*e/(e+s))}function E(e){var t,i,n,r,o,s,a,l=[],u=e.length,c=0,d=128,h=72,p=e.lastIndexOf("-");for(p<0&&(p=0),i=0;i<p;++i)128<=e.charCodeAt(i)&&x("not-basic"),l.push(e.charCodeAt(i));for(n=0<p?p+1:0;n<u;){for(r=c,o=1,s=v;u<=n&&x("invalid-input"),a=e.charCodeAt(n++),(v<=(a=a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:v)||a>b((m-c)/o))&&x("overflow"),c+=a*o,!(a<(a=s<=h?1:h+y<=s?y:s-h));s+=v)o>b(m/(a=v-a))&&x("overflow"),o*=a;h=C(c-r,t=l.length+1,0==r),b(c/t)>m-d&&x("overflow"),d+=b(c/t),c%=t,l.splice(c++,0,d)}return g(l)}function F(e){for(var t,i,n,r,o,s,a,l,u,c,d=[],h=(e=_(e)).length,p=128,f=72,g=t=0;g<h;++g)(a=e[g])<128&&d.push(w(a));for(i=n=d.length,n&&d.push("-");i<h;){for(r=m,g=0;g<h;++g)p<=(a=e[g])&&a<r&&(r=a);for(r-p>b((m-t)/(l=i+1))&&x("overflow"),t+=(r-p)*l,p=r,g=0;g<h;++g)if((a=e[g])<p&&++t>m&&x("overflow"),a==p){for(o=t,s=v;!(o<(u=s<=f?1:f+y<=s?y:s-f));s+=v)d.push(w(k(u+(c=o-u)%(u=v-u),0))),o=b(c/u);d.push(w(k(o,0))),f=C(t,l,i==n),t=0,++i}++t,++p}return d.join("")}if(r={version:"1.2.4",ucs2:{decode:_,encode:g},decode:E,encode:F,toASCII:function(e){return f(e,function(e){return u.test(e)?"xn--"+F(e):e})},toUnicode:function(e){return f(e,function(e){return l.test(e)?E(e.slice(4).toLowerCase()):e})}},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return r});else if(i&&!i.nodeType)if(n)n.exports=r;else for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);else t.punycode=r}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(e,t,i){"use strict";t.exports=function(e,t,i,n){t=t||"&",i=i||"=";var r={};if("string"==typeof e&&0!==e.length){var o=/\+/g,t=(e=e.split(t),1e3),s=(n&&"number"==typeof n.maxKeys&&(t=n.maxKeys),e.length);0<t&&t<s&&(s=t);for(var a=0;a<s;++a){var l,u=e[a].replace(o,"%20"),c=u.indexOf(i),c=0<=c?(l=u.substr(0,c),u.substr(c+1)):(l=u,""),u=decodeURIComponent(l),c=decodeURIComponent(c);Object.prototype.hasOwnProperty.call(r,u)?d(r[u])?r[u].push(c):r[u]=[r[u],c]:r[u]=c}}return r};var d=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],13:[function(e,t,i){"use strict";function o(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}t.exports=function(i,n,r,e){return n=n||"&",r=r||"=","object"==typeof(i=null===i?void 0:i)?function(e,t){if(e.map)return e.map(t);for(var i=[],n=0;n<e.length;n++)i.push(t(e[n],n));return i}(a(i),function(e){var t=encodeURIComponent(o(e))+r;return s(i[e])?i[e].map(function(e){return t+encodeURIComponent(o(e))}).join(n):t+encodeURIComponent(o(i[e]))}).join(n):e?encodeURIComponent(o(e))+r+encodeURIComponent(o(i)):""};var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};var a=Object.keys||function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}},{}],14:[function(e,t,i){"use strict";i.decode=i.parse=e("./decode"),i.encode=i.stringify=e("./encode")},{"./decode":12,"./encode":13}],15:[function(e,t,i){t.exports=s;var t=e("inherits"),n=e("process/browser.js").nextTick,r=e("./readable.js"),o=e("./writable.js");function s(e){if(!(this instanceof s))return new s(e);r.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",a)}function a(){var e;this.allowHalfOpen||this._writableState.ended||(e=this,n(function(){e.end()}))}t(s,r),s.prototype.write=o.prototype.write,s.prototype.end=o.prototype.end,s.prototype._write=o.prototype._write},{"./readable.js":19,"./writable.js":21,inherits:25,"process/browser.js":17}],16:[function(e,t,i){t.exports=n;var c=e("events").EventEmitter;function n(){c.call(this)}e("inherits")(n,c),n.Readable=e("./readable.js"),n.Writable=e("./writable.js"),n.Duplex=e("./duplex.js"),n.Transform=e("./transform.js"),n.PassThrough=e("./passthrough.js"),(n.Stream=n).prototype.pipe=function(t,e){var i=this;function n(e){t.writable&&!1===t.write(e)&&i.pause&&i.pause()}function r(){i.readable&&i.resume&&i.resume()}i.on("data",n),t.on("drain",r),t._isStdio||e&&!1===e.end||(i.on("end",s),i.on("close",a));var o=!1;function s(){o||(o=!0,t.end())}function a(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function l(e){if(u(),0===c.listenerCount(this,"error"))throw e}function u(){i.removeListener("data",n),t.removeListener("drain",r),i.removeListener("end",s),i.removeListener("close",a),i.removeListener("error",l),t.removeListener("error",l),i.removeListener("end",u),i.removeListener("close",u),t.removeListener("close",u)}return i.on("error",l),t.on("error",l),i.on("end",u),i.on("close",u),t.on("close",u),t.emit("pipe",i),t}},{"./duplex.js":15,"./passthrough.js":18,"./readable.js":19,"./transform.js":20,"./writable.js":21,events:4,inherits:25}],17:[function(e,t,i){var n,r,o,t=t.exports={};t.nextTick=(r="undefined"!=typeof window&&window.setImmediate,o="undefined"!=typeof window&&window.postMessage&&window.addEventListener,r?function(e){return window.setImmediate(e)}:o?(n=[],window.addEventListener("message",function(e){var t=e.source;t!==window&&null!==t||"process-tick"!==e.data||(e.stopPropagation(),0<n.length&&n.shift()())},!0),function(e){n.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}),t.title="browser",t.browser=!0,t.env={},t.argv=[],t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],18:[function(e,t,i){t.exports=r;var n=e("./transform.js");function r(e){if(!(this instanceof r))return new r(e);n.call(this,e)}e("inherits")(r,n),r.prototype._transform=function(e,t,i){i(null,e)}},{"./transform.js":20,inherits:25}],19:[function(w,e,t){!function(f){(e.exports=i).ReadableState=t;var n,g=w("events").EventEmitter,r=w("./index.js"),d=w("buffer").Buffer,m=w("process/browser.js").nextTick;function t(e,t){var i=(e=e||{}).highWaterMark;this.highWaterMark=i||0===i?i:16384,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=!1,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(n=n||w("string_decoder").StringDecoder,this.decoder=new n(e.encoding),this.encoding=e.encoding)}function i(e){if(!(this instanceof i))return new i(e);this._readableState=new t(e),this.readable=!0,r.call(this)}function o(e,t,i,n,r){var o,s,a,l=function(e,t){var i=null;d.isBuffer(t)||"string"==typeof t||null==t||e.objectMode||(i=i||new TypeError("Invalid non-string/buffer chunk"));return i}(t,i);if(l)e.emit("error",l);else if(null==i){if(t.reading=!1,!t.ended){var u,l=e,c=t;c.decoder&&!c.ended&&(u=c.decoder.end())&&u.length&&(c.buffer.push(u),c.length+=c.objectMode?1:u.length),c.ended=!0,(0<c.length?h:p)(l)}}else t.objectMode||i&&0<i.length?t.ended&&!r?(o=new Error("stream.push() after EOF"),e.emit("error",o)):t.endEmitted&&r?(o=new Error("stream.unshift() after end event"),e.emit("error",o)):(!t.decoder||r||n||(i=t.decoder.write(i)),t.length+=t.objectMode?1:i.length,r?t.buffer.unshift(i):(t.reading=!1,t.buffer.push(i)),t.needReadable&&h(e),s=e,(a=t).readingMore||(a.readingMore=!0,m(function(){for(var e=s,t=a,i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}))):r||(t.reading=!1);return!(u=t).ended&&(u.needReadable||u.length<u.highWaterMark||0===u.length)}w("inherits")(i,r),i.prototype.push=function(e,t){var i=this._readableState;return"string"!=typeof e||i.objectMode||(t=t||i.defaultEncoding)!==i.encoding&&(e=new d(e,t),t=""),o(this,i,e,t,!1)},i.prototype.unshift=function(e){return o(this,this._readableState,e,"",!0)},i.prototype.setEncoding=function(e){n=n||w("string_decoder").StringDecoder,this._readableState.decoder=new n(e),this._readableState.encoding=e};var s=8388608;function a(e,t){return 0===t.length&&t.ended?0:t.objectMode?0===e?0:1:isNaN(e)||null===e?(t.flowing&&t.buffer.length?t.buffer[0]:t).length:e<=0?0:(e>t.highWaterMark&&(t.highWaterMark=function(e){if(s<=e)e=s;else{e--;for(var t=1;t<32;t<<=1)e|=e>>t;e++}return e}(e)),e>t.length?t.ended?t.length:(t.needReadable=!0,0):e)}function h(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,t.sync?m(function(){l(e)}):l(e))}function l(e){e.emit("readable")}function v(e){var n,r=e._readableState;function t(e,t,i){!1===e.write(n)&&r.awaitDrain++}for(r.awaitDrain=0;r.pipesCount&&null!==(n=e.read());)if(1===r.pipesCount?t(r.pipes):b(r.pipes,t),e.emit("data",n),0<r.awaitDrain)return;0===r.pipesCount?(r.flowing=!1,0<g.listenerCount(e,"data")&&u(e)):r.ranOut=!0}function y(){this._readableState.ranOut&&(this._readableState.ranOut=!1,v(this))}function u(t,e){if(t._readableState.flowing)throw new Error("Cannot switch to old mode now.");var i=e||!1,n=!1;t.readable=!0,t.pipe=r.prototype.pipe,t.on=t.addListener=r.prototype.on,t.on("readable",function(){var e;for(n=!0;!i&&null!==(e=t.read());)t.emit("data",e);null===e&&(n=!1,t._readableState.needReadable=!0)}),t.pause=function(){i=!0,this.emit("pause")},t.resume=function(){i=!1,n?m(function(){t.emit("readable")}):this.read(0),this.emit("resume")},t.emit("readable")}function c(e,t){var i=t.buffer,n=t.length,r=!!t.decoder,t=!!t.objectMode;if(0===i.length)return null;if(0===n)o=null;else if(t)o=i.shift();else if(!e||n<=e)o=r?i.join(""):d.concat(i,n),i.length=0;else if(e<i[0].length){var o=(u=i[0]).slice(0,e);i[0]=u.slice(e)}else if(e===i[0].length)o=i.shift();else{o=r?"":new d(e);for(var s=0,a=0,l=i.length;a<l&&s<e;a++){var u=i[0],c=Math.min(e-s,u.length);r?o+=u.slice(0,c):u.copy(o,s,0,c),c<u.length?i[0]=u.slice(c):i.shift(),s+=c}}return o}function p(e){var t=e._readableState;if(0<t.length)throw new Error("endReadable called on non-empty stream");!t.endEmitted&&t.calledRead&&(t.ended=!0,m(function(){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}))}function b(e,t){for(var i=0,n=e.length;i<n;i++)t(e[i],i)}i.prototype.read=function(e){var t,i=this._readableState,n=(i.calledRead=!0,e);return("number"!=typeof e||0<e)&&(i.emittedReadable=!1),0===e&&i.needReadable&&(i.length>=i.highWaterMark||i.ended)?(h(this),null):0===(e=a(e,i))&&i.ended?(0===i.length&&p(this),null):(t=i.needReadable,i.length-e<=i.highWaterMark&&(t=!0),(t=i.ended||i.reading?!1:t)&&(i.reading=!0,i.sync=!0,0===i.length&&(i.needReadable=!0),this._read(i.highWaterMark),i.sync=!1),null===(t=0<(e=t&&!i.reading?a(n,i):e)?c(e,i):null)&&(i.needReadable=!0,e=0),i.length-=e,0!==i.length||i.ended||(i.needReadable=!0),i.ended&&!i.endEmitted&&0===i.length&&p(this),t)},i.prototype._read=function(e){this.emit("error",new Error("not implemented"))},i.prototype.pipe=function(t,e){var i=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=t;break;case 1:n.pipes=[n.pipes,t];break;default:n.pipes.push(t)}n.pipesCount+=1;e=(!e||!1!==e.end)&&t!==f.stdout&&t!==f.stderr?o:l;function r(e){e===i&&l()}function o(){t.end()}n.endEmitted?m(e):i.once("end",e),t.on("unpipe",r);s=i;var s,a=function(){var e=s._readableState;e.awaitDrain--,0===e.awaitDrain&&v(s)};function l(){t.removeListener("close",d),t.removeListener("finish",h),t.removeListener("drain",a),t.removeListener("error",c),t.removeListener("unpipe",r),i.removeListener("end",o),i.removeListener("end",l),t._writableState&&!t._writableState.needDrain||a()}t.on("drain",a);var u=g.listenerCount(t,"error");function c(e){p(),0===u&&0===g.listenerCount(t,"error")&&t.emit("error",e)}function d(){t.removeListener("finish",h),p()}function h(){t.removeListener("close",d),p()}function p(){i.unpipe(t)}return t.once("error",c),t.once("close",d),t.once("finish",h),t.emit("pipe",i),n.flowing||(this.on("readable",y),n.flowing=!0,m(function(){v(i)})),t},i.prototype.unpipe=function(e){var t=this._readableState;if(0!==t.pipesCount)if(1===t.pipesCount)e&&e!==t.pipes||(e=e||t.pipes,t.pipes=null,t.pipesCount=0,this.removeListener("readable",y),t.flowing=!1,e&&e.emit("unpipe",this));else if(e)-1!==(r=function(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}(t.pipes,e))&&(t.pipes.splice(r,1),--t.pipesCount,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this));else{var i=t.pipes,n=t.pipesCount;t.pipes=null,t.pipesCount=0,this.removeListener("readable",y),t.flowing=!1;for(var r=0;r<n;r++)i[r].emit("unpipe",this)}return this},i.prototype.addListener=i.prototype.on=function(e,t){t=r.prototype.on.call(this,e,t);return"data"!==e||this._readableState.flowing||u(this),"readable"===e&&this.readable&&!(e=this._readableState).readableListening&&(e.readableListening=!0,e.emittedReadable=!1,e.needReadable=!0,e.reading?e.length&&h(this):this.read(0)),t},i.prototype.resume=function(){u(this),this.read(0),this.emit("resume")},i.prototype.pause=function(){u(this,!0),this.emit("pause")},i.prototype.wrap=function(i){var e,t=this._readableState,n=!1,r=this;for(e in i.on("end",function(){var e;t.decoder&&!t.ended&&(e=t.decoder.end())&&e.length&&r.push(e),r.push(null)}),i.on("data",function(e){(e=t.decoder?t.decoder.write(e):e)&&(t.objectMode||e.length)&&!r.push(e)&&(n=!0,i.pause())}),i)"function"==typeof i[e]&&void 0===this[e]&&(this[e]=function(e){return function(){return i[e].apply(i,arguments)}}(e));return b(["error","close","destroy","pause","resume"],function(t){i.on(t,function(e){return r.emit.apply(r,t,e)})}),r._read=function(e){n&&(n=!1,i.resume())},r},i._fromList=c}.call(this,w("2ionoC"))},{"./index.js":16,"2ionoC":10,buffer:6,events:4,inherits:25,"process/browser.js":17,string_decoder:22}],20:[function(e,t,i){t.exports=o;var n=e("./duplex.js");function r(e,o){this.afterTransform=function(e,t){var i=o,n=i._transformState,r=(n.transforming=!1,n.writecb);if(!r)return i.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,(n.writecb=null)!=t&&i.push(t),r&&r(e),(n=i._readableState).reading=!1,(n.needReadable||n.length<n.highWaterMark)&&i._read(n.highWaterMark)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function o(e){if(!(this instanceof o))return new o(e);n.call(this,e);this._transformState=new r(0,this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof this._flush?this._flush(function(e){s(t,e)}):s(t)})}function s(e,t){if(t)return e.emit("error",t);var t=e._writableState,i=(e._readableState,e._transformState);if(t.length)throw new Error("calling transform done when ws.length != 0");if(i.transforming)throw new Error("calling transform done when still transforming");e.push(null)}e("inherits")(o,n),o.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},o.prototype._transform=function(e,t,i){throw new Error("not implemented")},o.prototype._write=function(e,t,i){var n=this._transformState;n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming&&(i=this._readableState,n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)},o.prototype._read=function(e){var t=this._transformState;t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0}},{"./duplex.js":15,inherits:25}],21:[function(e,t,i){(t.exports=o).WritableState=r;var p="undefined"!=typeof Uint8Array?function(e){return e instanceof Uint8Array}:function(e){return e&&e.constructor&&"Uint8Array"===e.constructor.name},f="undefined"!=typeof ArrayBuffer?function(e){return e instanceof ArrayBuffer}:function(e){return e&&e.constructor&&"ArrayBuffer"===e.constructor.name},t=e("inherits"),n=e("./index.js"),v=e("process/browser.js").nextTick,g=e("buffer").Buffer;function m(e,t,i){this.chunk=e,this.encoding=t,this.callback=i}function r(e,m){var t=(e=e||{}).highWaterMark,t=(this.highWaterMark=t||0===t?t:16384,this.objectMode=!!e.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,(this.finished=!1)===e.decodeStrings);this.decodeStrings=!t,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){var t,i=m,n=i._writableState,r=n.sync,o=n.writecb,s=n;if(s.writing=!1,s.writecb=null,s.length-=s.writelen,s.writelen=0,e){var s=i,a=e,l=o;r?v(function(){l(a)}):l(a),s.emit("error",a)}else{if(!(t=w(0,n))&&!n.bufferProcessing&&n.buffer.length){var u=i,c=n;c.bufferProcessing=!0;for(var d=0;d<c.buffer.length;d++){var h=c.buffer[d],p=h.chunk,f=h.encoding,h=h.callback,g=c.objectMode?1:p.length;if(y(u,c,g,p,f,h),c.writing){d++;break}}c.bufferProcessing=!1,d<c.buffer.length?c.buffer=c.buffer.slice(d):c.buffer.length=0}r?v(function(){b(i,n,t,o)}):b(i,n,t,o)}},this.writecb=null,this.writelen=0,this.buffer=[]}function o(e){if(!(this instanceof o||this instanceof n.Duplex))return new o(e);this._writableState=new r(e,this),this.writable=!0,n.call(this)}function y(e,t,i,n,r,o){t.writelen=i,t.writecb=o,t.writing=!0,t.sync=!0,e._write(n,r,t.onwrite),t.sync=!1}function b(e,t,i,n){var r,o;i||(r=e,0===(o=t).length&&o.needDrain&&(o.needDrain=!1,r.emit("drain"))),n(),i&&s(e,t)}function w(e,t){return t.ending&&0===t.length&&!t.finished&&!t.writing}function s(e,t){var i=w(0,t);i&&(t.finished=!0,e.emit("finish"))}t(o,n),o.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},o.prototype.write=function(e,t,i){var n,r,o,s,a,l,u,c,d=this._writableState,h=!1;return"function"==typeof t&&(i=t,t=null),!g.isBuffer(e)&&p(e)&&(e=new g(e)),f(e)&&"undefined"!=typeof Uint8Array&&(e=new g(new Uint8Array(e))),t=g.isBuffer(e)?"buffer":t||d.defaultEncoding,"function"!=typeof i&&(i=function(){}),d.ended?(l=this,u=i,c=new Error("write after end"),l.emit("error",c),v(function(){u(c)})):(l=this,n=d,r=e,o=i,a=!0,g.isBuffer(r)||"string"==typeof r||null==r||n.objectMode||(s=new TypeError("Invalid non-string/buffer chunk"),l.emit("error",s),v(function(){o(s)}),a=!1),a&&(h=function(e,t,i,n,r){i=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=new g(t,i));return t}(t,i,n);var o=t.objectMode?1:i.length,s=(t.length+=o,t.length<t.highWaterMark);t.needDrain=!s,t.writing?t.buffer.push(new m(i,n,r)):y(e,t,o,i,n,r);return s}(this,d,e,t,i))),h},o.prototype._write=function(e,t,i){i(new Error("not implemented"))},o.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.ending||n.finished||(e=this,t=i,(i=n).ending=!0,s(e,i),t&&(i.finished?v(t):e.once("finish",t)),i.ended=!0)}},{"./index.js":16,buffer:6,inherits:25,"process/browser.js":17}],22:[function(e,t,i){var n=e("buffer").Buffer;e=i.StringDecoder=function(e){this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,"");if(e&&!n.isEncoding(e))throw new Error("Unknown encoding: "+e);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=o;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=s;break;default:return void(this.write=r)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function r(e){return e.toString(this.encoding)}function o(e){e=this.charReceived=e.length%2;return this.charLength=e?2:0,e}function s(e){e=this.charReceived=e.length%3;return this.charLength=e?3:0,e}e.prototype.write=function(e){for(var t="",i=0;this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,i,n),this.charReceived+=n-i,i=n,this.charReceived<this.charLength)return"";if(!(55296<=(r=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))&&r<=56319)){if(this.charReceived=this.charLength=0,n==e.length)return t;e=e.slice(n,e.length);break}this.charLength+=this.surrogateSize,t=""}var r,o=this.detectIncompleteChar(e),s=e.length,s=(this.charLength&&(e.copy(this.charBuffer,0,e.length-o,s),s-=this.charReceived=o),(t+=e.toString(this.encoding,0,s)).length-1);return 55296<=(r=t.charCodeAt(s))&&r<=56319?(o=this.surrogateSize,this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),this.charBuffer.write(t.charAt(t.length-1),this.encoding),t.substring(0,s)):t},e.prototype.detectIncompleteChar=function(e){for(var t=3<=e.length?3:e.length;0<t;t--){var i=e[e.length-t];if(1==t&&i>>5==6){this.charLength=2;break}if(t<=2&&i>>4==14){this.charLength=3;break}if(t<=3&&i>>3==30){this.charLength=4;break}}return t},e.prototype.end=function(e){var t,i,n="";return e&&e.length&&(n=this.write(e)),this.charReceived&&(e=this.charReceived,t=this.charBuffer,i=this.encoding,n+=t.slice(0,e).toString(i)),n}},{buffer:6}],23:[function(e,t,i){var n,r=e("http"),o=t.exports;for(n in r)r.hasOwnProperty(n)&&(o[n]=r[n]);o.request=function(e,t){return(e=e||{}).scheme="https",e.protocol="https:",r.request.call(this,e,t)}},{http:7}],24:[function(e,t,i){i.read=function(e,t,i,n,r){var o,s,a=8*r-n-1,l=(1<<a)-1,u=l>>1,c=-7,d=i?r-1:0,h=i?-1:1,r=e[t+d];for(d+=h,o=r&(1<<-c)-1,r>>=-c,c+=a;0<c;o=256*o+e[t+d],d+=h,c-=8);for(s=o&(1<<-c)-1,o>>=-c,c+=n;0<c;s=256*s+e[t+d],d+=h,c-=8);if(0===o)o=1-u;else{if(o===l)return s?NaN:1/0*(r?-1:1);s+=Math.pow(2,n),o-=u}return(r?-1:1)*s*Math.pow(2,o-n)},i.write=function(e,t,i,n,r,o){var s,a,l=8*o-r-1,u=(1<<l)-1,c=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,o=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-s))<1&&(s--,n*=2),2<=(t+=1<=s+c?d/n:d*Math.pow(2,1-c))*n&&(s++,n/=2),u<=s+c?(a=0,s=u):1<=s+c?(a=(t*n-1)*Math.pow(2,r),s+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,r),s=0));8<=r;e[i+h]=255&a,h+=p,a/=256,r-=8);for(s=s<<r|a,l+=r;0<l;e[i+h]=255&s,h+=p,s/=256,l-=8);e[i+h-p]|=128*o}},{}],25:[function(e,t,i){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;function i(){}i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},{}],26:[function(e,t,i){},{}],27:[function(ve,i,e){!function(he,pe,fe){function e(I){function e(){}if(I.compact=function(e,u,c,d){if(arguments.length<2)return I.nextTick(function(){d(new TypeError("Could not compact, too few arguments."))});if("function"==typeof c&&(d=c,c={}),c=c||{},null===u)return I.nextTick(function(){d(new P("The compaction context must not be null.","jsonld.CompactError",{code:"invalid local context"}))});if(null===e)return I.nextTick(function(){d(null,null)});"base"in c||(c.base="string"==typeof e?e:""),"compactArrays"in c||(c.compactArrays=!0),"graph"in c||(c.graph=!1),"skipExpansion"in c||(c.skipExpansion=!1),"documentLoader"in c||(c.documentLoader=I.loadDocument),"link"in c||(c.link=!1),c.link&&(c.skipExpansion=!0);var t=e,i=c,n=function(e,l){if(e)return d(new P("Could not expand input before compaction.","jsonld.CompactError",{cause:e}));e=x(c);I.processContext(e,u,c,function(e,t){if(e)return d(new P("Could not process context before compaction.","jsonld.CompactError",{cause:e}));try{n=(new h).compact(t,null,l,c)}catch(e){return d(e)}var e=null,i=n,n=t,t=c;if(e)d(e);else{t.compactArrays&&!t.graph&&B(i)?1===i.length?i=i[0]:0===i.length&&(i={}):t.graph&&$(i)&&(i=[i]);var r=u=B(u=D(u=$(u)&&"@context"in u?u["@context"]:u))?u:[u];u=[];for(var o=0;o<r.length;++o)(!$(r[o])||0<Object.keys(r[o]).length)&&u.push(r[o]);if(e=0<u.length,1===u.length&&(u=u[0]),B(i)){var t=R(n,"@graph"),s=i;i={},e&&(i["@context"]=u),i[t]=s}else if($(i)&&e){var a,s=i;for(a in i={"@context":u},s)i[a]=s[a]}d(null,i,n)}})};i.skipExpansion?I.nextTick(function(){n(null,t)}):I.expand(t,i,n)},I.expand=function(i,a,l){if(arguments.length<1)return I.nextTick(function(){l(new TypeError("Could not expand, too few arguments."))});function n(e){"base"in a||(a.base=e.documentUrl||"");var t,e={document:D(e.document),remoteContext:{"@context":e.contextUrl}};"expandContext"in a&&("object"==typeof(t=D(a.expandContext))&&"@context"in t?e.expandContext=t:e.expandContext={"@context":t}),oe(e,a,function(e,t){if(e)return l(e);var i;try{var n=new h,r=x(a),o=t.document,s=t.remoteContext["@context"];t.expandContext&&(r=n.processContext(r,t.expandContext["@context"],a)),s&&(r=n.processContext(r,s,a)),$(i=n.expand(r,null,o,a,!1))&&"@graph"in i&&1===Object.keys(i).length?i=i["@graph"]:null===i&&(i=[]),B(i)||(i=[i])}catch(e){return l(e)}l(null,i)})}"function"==typeof a&&(l=a,a={}),"documentLoader"in(a=a||{})||(a.documentLoader=I.loadDocument),"keepFreeFloatingNodes"in a||(a.keepFreeFloatingNodes=!1),I.nextTick(function(){var e,t;"string"==typeof i?(t=a.documentLoader(i,e=function(e,t){if(e)return l(e);try{if(!t.document)throw new P("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(e){return l(new P("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:t}))}n(t)}))&&"then"in t&&t.then(e.bind(null,null),e):n({contextUrl:null,documentUrl:null,document:i})})},I.flatten=function(e,n,r,o){if(arguments.length<1)return I.nextTick(function(){o(new TypeError("Could not flatten, too few arguments."))});"function"==typeof r?(o=r,r={}):"function"==typeof n&&(o=n,n=null,r={}),"base"in(r=r||{})||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=I.loadDocument),I.expand(e,r,function(e,t){if(e)return o(new P("Could not expand input before flattening.","jsonld.FlattenError",{cause:e}));var i;try{i=(new h).flatten(t)}catch(e){return o(e)}if(null===n)return o(null,i);r.graph=!0,r.skipExpansion=!0,I.compact(i,n,r,function(e,t){if(e)return o(new P("Could not compact flattened output.","jsonld.FlattenError",{cause:e}));o(null,t)})})},I.frame=function(i,n,s,a){if(arguments.length<2)return I.nextTick(function(){a(new TypeError("Could not frame, too few arguments."))});function r(e){var o,t=e.document;t?(o=t["@context"],e.contextUrl?(o?B(o)?o.push(e.contextUrl):o=[o,e.contextUrl]:o=e.contextUrl,t["@context"]=o):o=o||{}):o={},I.expand(i,s,function(e,n){if(e)return a(new P("Could not expand input before framing.","jsonld.FrameError",{cause:e}));var r=D(s);r.isFrame=!0,r.keepFreeFloatingNodes=!0,I.expand(t,r,function(e,t){if(e)return a(new P("Could not expand frame before framing.","jsonld.FrameError",{cause:e}));var i;try{i=(new h).frame(n,t,r)}catch(e){return a(e)}r.graph=!0,r.skipExpansion=!0,r.link={},I.compact(i,o,r,function(e,t,i){if(e)return a(new P("Could not compact framed output.","jsonld.FrameError",{cause:e}));e=R(i,"@graph");r.link={},t[e]=function e(t,i,n){if(B(i)){for(var r=[],o=0;o<i.length;++o)null!==(u=e(t,i[o],n))&&r.push(u);i=r}else if($(i)){if("@preserve"in i)return"@null"===i["@preserve"]?null:i["@preserve"];if(q(i))return i;if(H(i))return i["@list"]=e(t,i["@list"],n),i;var s,a=R(t,"@id");if(a in i){a=i[a];if(a in n.link){var l=n.link[a].indexOf(i);if(-1!==l)return n.link[a][l];n.link[a].push(i)}else n.link[a]=[i]}for(s in i){var u=e(t,i[s],n),c=I.getContextValue(t,s,"@container");n.compactArrays&&B(u)&&1===u.length&&null===c&&(u=u[0]),i[s]=u}}return i}(i,t[e],r),a(null,t)})})})}"function"==typeof s&&(a=s,s={}),"base"in(s=s||{})||(s.base="string"==typeof i?i:""),"documentLoader"in s||(s.documentLoader=I.loadDocument),"embed"in s||(s.embed="@last"),s.explicit=s.explicit||!1,"requireAll"in s||(s.requireAll=!0),s.omitDefault=s.omitDefault||!1,I.nextTick(function(){var e,t;"string"==typeof n?(t=s.documentLoader(n,e=function(e,t){if(e)return a(e);try{if(!t.document)throw new P("No remote document found at the given URL.","jsonld.NullRemoteDocument");"string"==typeof t.document&&(t.document=JSON.parse(t.document))}catch(e){return a(new P("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed",cause:e,remoteDoc:t}))}r(t)}))&&"then"in t&&t.then(e.bind(null,null),e):r({contextUrl:null,documentUrl:null,document:n})})},I.link=function(e,t,i,n){var r={};t&&(r["@context"]=t),r["@embed"]="@link",I.frame(e,r,i,n)},I.objectify=function(e,n,r,o){"function"==typeof r&&(o=r,r={}),"base"in(r=r||{})||(r.base="string"==typeof e?e:""),"documentLoader"in r||(r.documentLoader=I.loadDocument),I.expand(e,r,function(e,t){if(e)return o(new P("Could not expand input before linking.","jsonld.LinkError",{cause:e}));var i;try{i=(new h).flatten(t)}catch(e){return o(e)}r.graph=!0,r.skipExpansion=!0,I.compact(i,n,r,function(e,t,s){if(e)return o(new P("Could not compact flattened output before linking.","jsonld.LinkError",{cause:e}));var i,a=t[R(s,"@graph")][0],l=function(e){if($(e)||B(e)){if($(e)){if(l.visited[e["@id"]])return;l.visited[e["@id"]]=!0}for(var t in e){var i,n=e[t],r="@id"===I.getContextValue(s,t,"@type");if(B(n)||$(n)||r)if(Q(n)&&r)e[t]=n=a[n],l(n);else if(B(n))for(var o=0;o<n.length;++o)Q(n[o])&&r?n[o]=a[n[o]]:$(n[o])&&"@id"in n[o]&&(n[o]=a[n[o]["@id"]]),l(n[o]);else $(n)&&(i=n["@id"],e[t]=n=a[i],l(n))}}};for(i in l.visited={},l(a),t.of_type={},a)if("@type"in a[i]){var n=a[i]["@type"];B(n)||(n=[n]);for(var r=0;r<n.length;++r)n[r]in t.of_type||(t.of_type[n[r]]=[]),t.of_type[n[r]].push(a[i])}o(null,t)})})},I.normalize=function(e,i,n){if(arguments.length<1)return I.nextTick(function(){n(new TypeError("Could not normalize, too few arguments."))});if("function"==typeof i&&(n=i,i={}),"algorithm"in(i=i||{})||(i.algorithm="URGNA2012"),"base"in i||(i.base="string"==typeof e?e:""),"documentLoader"in i||(i.documentLoader=I.loadDocument),"inputFormat"in i){if("application/nquads"!==i.inputFormat)return n(new P("Unknown normalization input format.","jsonld.NormalizeError"));var t=se(e);(new h).normalize(t,i,n)}else{t=D(i);delete t.format,t.produceGeneralizedRdf=!1,I.toRDF(e,t,function(e,t){if(e)return n(new P("Could not convert input to RDF dataset before normalization.","jsonld.NormalizeError",{cause:e}));(new h).normalize(t,i,n)})}},I.fromRDF=function(t,r,o){if(arguments.length<1)return I.nextTick(function(){o(new TypeError("Could not convert from RDF, too few arguments."))});"function"==typeof r&&(o=r,r={}),"useRdfType"in(r=r||{})||(r.useRdfType=!1),"useNativeTypes"in r||(r.useNativeTypes=!1),"format"in r||!Q(t)||"format"in r||(r.format="application/nquads"),I.nextTick(function(){var e;if(r.format){if(!(e=r.rdfParser||s[r.format]))return o(new P("Unknown input format.","jsonld.UnknownFormat",{format:r.format}))}else e=function(){return t};var i=!1;try{t=e(t,function(e,t){if(i=!0,e)return o(e);n(t,r,o)})}catch(e){if(i)throw e;return o(e)}if(t){if("then"in t)return t.then(function(e){n(e,r,o)},o);n(t,r,o)}function n(e,t,i){(new h).fromRDF(e,t,i)}})},I.toRDF=function(e,n,r){if(arguments.length<1)return I.nextTick(function(){r(new TypeError("Could not convert to RDF, too few arguments."))});"function"==typeof n&&(r=n,n={}),"base"in(n=n||{})||(n.base="string"==typeof e?e:""),"documentLoader"in n||(n.documentLoader=I.loadDocument),I.expand(e,n,function(e,t){if(e)return r(new P("Could not expand input before serialization to RDF.","jsonld.RdfError",{cause:e}));var i;try{if(i=h.prototype.toRDF(t,n),n.format){if("application/nquads"===n.format)return r(null,function(e){var t,i=[];for(t in e)for(var n=e[t],r=0;r<n.length;++r){var o=n[r];i.push(ae(o,t="@default"===t?null:t))}return i.sort().join("")}(i));throw new P("Unknown output format.","jsonld.UnknownFormat",{format:n.format})}}catch(e){return r(e)}r(null,i)})},I.createNodeMap=function(e,n,r){if(arguments.length<1)return I.nextTick(function(){r(new TypeError("Could not create node map, too few arguments."))});"function"==typeof n&&(r=n,n={}),"base"in(n=n||{})||(n.base="string"==typeof e?e:""),"documentLoader"in n||(n.documentLoader=I.loadDocument),I.expand(e,n,function(e,t){if(e)return r(new P("Could not expand input before creating node map.","jsonld.CreateNodeMapError",{cause:e}));var i;try{i=(new h).createNodeMap(t,n)}catch(e){return r(e)}r(null,i)})},I.merge=function(e,y,b,w){if(arguments.length<1)return I.nextTick(function(){w(new TypeError("Could not merge, too few arguments."))});if(!B(e))return I.nextTick(function(){w(new TypeError('Could not merge, "docs" must be an array.'))});"function"==typeof b?(w=b,b={}):"function"==typeof y&&(w=y,y=null,b={}),b=b||{};for(var x=[],_=null,k=e.length,t=0;t<e.length;++t){var i,n={};for(i in b)n[i]=b[i];I.expand(e[t],n,r)}function r(e,t){if(!_){if(e)return w(new P("Could not expand input before flattening.","jsonld.FlattenError",{cause:_=e}));if(x.push(t),0==--k){var i=x,n=!0;"mergeNodes"in b&&(n=b.mergeNodes);var r,o=b.namer||b.issuer||new C("_:b"),s={"@default":{}};try{for(var a=0;a<i.length;++a){var l=i[a],u=(l=I.relabelBlankNodes(l,{issuer:new C("_:b"+a+"-")}),n||0===a?s:{"@default":{}});if(E(l,u,"@default",o),u!==s)for(var c in u){var d=u[c];if(c in s){var h,p=s[c];for(h in d)h in p||(p[h]=d[h])}else s[c]=d}}r=S(s)}catch(e){return void w(e)}for(var f=[],g=Object.keys(r).sort(),m=0;m<g.length;++m){var v=r[g[m]];z(v)||f.push(v)}null===y?w(null,f):(b.graph=!0,b.skipExpansion=!0,I.compact(f,y,b,function(e,t){if(e)return w(new P("Could not compact merged output.","jsonld.MergeError",{cause:e}));w(null,t)}))}}}},I.relabelBlankNodes=function(e,t){return function e(t,i){if(B(i))for(var n=0;n<i.length;++n)i[n]=e(t,i[n]);else if(H(i))i["@list"]=e(t,i["@list"]);else if($(i)){ne(i)&&(i["@id"]=t.getId(i["@id"]));for(var r=Object.keys(i).sort(),o=0;o<r.length;++o){var s=r[o];"@id"!==s&&(i[s]=e(t,i[s]))}}return i}((t=t||{}).namer||t.issuer||new C("_:b"),e)},I.prependBase=function(e,t){if(null===e)return t;if(-1!==t.indexOf(":"))return t;Q(e)&&(e=I.url.parse(e||""));var t=I.url.parse(t),i={protocol:e.protocol||""};return null!==t.authority?(i.authority=t.authority,i.path=t.path,i.query=t.query):(i.authority=e.authority,""===t.path?(i.path=e.path,null!==t.query?i.query=t.query:i.query=e.query):(0===t.path.indexOf("/")?i.path=t.path:(e=e.path,""!==t.path&&(0<(e=e.substr(0,e.lastIndexOf("/")+1)).length&&"/"!==e.substr(-1)&&(e+="/"),e+=t.path),i.path=e),i.query=t.query)),i.path=de(i.path,!!i.authority),e=i.protocol,null!==i.authority&&(e+="//"+i.authority),e+=i.path,null!==i.query&&(e+="?"+i.query),null!==t.fragment&&(e+="#"+t.fragment),e=""===e?"./":e},I.documentLoader=function(e,t){var i=new P("Could not retrieve a JSON-LD document from the URL. URL dereferencing not implemented.","jsonld.LoadDocumentError",{code:"loading document failed"});return ge?t(i,{contextUrl:null,documentUrl:e,document:null}):I.promisify(function(e){e(i)})},I.loadDocument=function(e,t){e=I.documentLoader(e,t);e&&"then"in e&&e.then(t.bind(null,null),t)},I.promises=function(e){e=e||{};var i=Array.prototype.slice,n=I.promisify,t=e.api||{},r=e.version||"jsonld.js";"string"==typeof e.api&&(e.version||(r=e.api),t={}),t.expand=function(e){if(arguments.length<1)throw new TypeError("Could not expand, too few arguments.");return n.apply(null,[I.expand].concat(i.call(arguments)))},t.compact=function(e,t){if(arguments.length<2)throw new TypeError("Could not compact, too few arguments.");return n.apply(null,[function(e,t,i,n){"function"==typeof i&&(n=i,i={}),I.compact(e,t,i=i||{},function(e,t){n(e,t)})}].concat(i.call(arguments)))},t.flatten=function(e){if(arguments.length<1)throw new TypeError("Could not flatten, too few arguments.");return n.apply(null,[I.flatten].concat(i.call(arguments)))},t.frame=function(e,t){if(arguments.length<2)throw new TypeError("Could not frame, too few arguments.");return n.apply(null,[I.frame].concat(i.call(arguments)))},t.fromRDF=function(e){if(arguments.length<1)throw new TypeError("Could not convert from RDF, too few arguments.");return n.apply(null,[I.fromRDF].concat(i.call(arguments)))},t.toRDF=function(e){if(arguments.length<1)throw new TypeError("Could not convert to RDF, too few arguments.");return n.apply(null,[I.toRDF].concat(i.call(arguments)))},t.normalize=function(e){if(arguments.length<1)throw new TypeError("Could not normalize, too few arguments.");return n.apply(null,[I.normalize].concat(i.call(arguments)))},"jsonld.js"===r&&(t.link=function(e,t){if(arguments.length<2)throw new TypeError("Could not link, too few arguments.");return n.apply(null,[I.link].concat(i.call(arguments)))},t.objectify=function(e){return n.apply(null,[I.objectify].concat(i.call(arguments)))},t.createNodeMap=function(e){return n.apply(null,[I.createNodeMap].concat(i.call(arguments)))},t.merge=function(e){return n.apply(null,[I.merge].concat(i.call(arguments)))});try{I.Promise=pe.Promise||ve("es6-promise").Promise}catch(e){function o(){throw new Error("Unable to find a Promise implementation.")}for(var s in t)t[s]=o}return t},I.promisify=function(e){if(!I.Promise)try{I.Promise=pe.Promise||ve("es6-promise").Promise}catch(e){throw new Error("Unable to find a Promise implementation.")}var t=Array.prototype.slice.call(arguments,1);return new I.Promise(function(i,n){e.apply(null,t.concat(function(e,t){e?n(e):i(t)}))})},I.promises({api:I.promises}),(e.prototype=I.promises({version:"json-ld-1.0"})).toString=function(){return this instanceof e?"[object JsonLdProcessor]":"[object JsonLdProcessorPrototype]"},I.JsonLdProcessor=e,t=!!Object.defineProperty)try{Object.defineProperty({},"x",{})}catch(e){t=!1}t&&(Object.defineProperty(e,"prototype",{writable:!1,enumerable:!1}),Object.defineProperty(e.prototype,"constructor",{writable:!0,enumerable:!1,configurable:!0,value:e})),me&&void 0===pe.JsonLdProcessor&&(t?Object.defineProperty(pe,"JsonLdProcessor",{writable:!0,enumerable:!1,configurable:!0,value:e}):pe.JsonLdProcessor=e);var g,m,o="function"==typeof setImmediate&&setImmediate,t=o?function(e){o(e)}:function(e){setTimeout(e,0)},s=("object"==typeof he&&"function"==typeof he.nextTick?I.nextTick=he.nextTick:I.nextTick=t,I.setImmediate=o?t:I.nextTick,I.parseLinkHeader=function(e){for(var t={},i=e.match(/(?:<[^>]*?>|"[^"]*?"|[^,])+/g),n=/\s*<([^>]*?)>\s*(?:;\s*(.*))?/,r=0;r<i.length;++r){var o=i[r].match(n);if(o){for(var s={target:o[1]},a=o[2],l=/(.*?)=(?:(?:"([^"]*?)")|([^"]*?))\s*(?:(?:;\s*)|$)/g;o=l.exec(a);)s[o[1]]=void 0===o[2]?o[3]:o[2];var u=s.rel||"";B(t[u])?t[u].push(s):u in t?t[u]=[t[u],s]:t[u]=s}}return t},I.RequestQueue=function(){this._requests={}},I.RequestQueue.prototype.wrapLoader=function(e){return this._loader=e,this._usePromise=1===e.length,this.add.bind(this)},I.RequestQueue.prototype.add=function(r,e){var o=this;if(!e&&!o._usePromise)throw new Error("callback must be specified.");if(o._usePromise)return new I.Promise(function(t,i){(o._requests[r]||(o._requests[r]=o._loader(r).then(function(e){return delete o._requests[r],e}).catch(function(e){throw delete o._requests[r],e}))).then(function(e){t(e)}).catch(function(e){i(e)})});r in o._requests?o._requests[r].push(e):(o._requests[r]=[e],o._loader(r,function(e,t){var i=o._requests[r];delete o._requests[r];for(var n=0;n<i.length;++n)i[n](e,t)}))},I.DocumentCache=function(e){this.order=[],this.cache={},this.size=e||50,this.expires=3e4},I.DocumentCache.prototype.get=function(e){if(e in this.cache){var t=this.cache[e];if(t.expires>=+new Date)return t.ctx;delete this.cache[e],this.order.splice(this.order.indexOf(e),1)}return null},I.DocumentCache.prototype.set=function(e,t){this.order.length===this.size&&delete this.cache[this.order.shift()],this.order.push(e),this.cache[e]={ctx:t,expires:+new Date+this.expires}},I.ActiveContextCache=function(e){this.order=[],this.cache={},this.size=e||100},I.ActiveContextCache.prototype.get=function(e,t){e=JSON.stringify(e),t=JSON.stringify(t),e=this.cache[e];return e&&t in e?e[t]:null},I.ActiveContextCache.prototype.set=function(e,t,i){this.order.length===this.size&&(n=this.order.shift(),delete this.cache[n.activeCtx][n.localCtx]);var n=JSON.stringify(e),e=JSON.stringify(t);this.order.push({activeCtx:n,localCtx:e}),n in this.cache||(this.cache[n]={}),this.cache[n][e]=D(i)},I.cache={activeCtx:new I.ActiveContextCache},I.documentLoaders={},I.documentLoaders.jquery=function(e,t){t=t||{};var i=new I.RequestQueue;return("usePromise"in t?t.usePromise:"undefined"!=typeof Promise)?i.wrapLoader(function(e){return I.promisify(n,e)}):i.wrapLoader(n);function n(r,o){return 0!==r.indexOf("http:")&&0!==r.indexOf("https:")?o(new P('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):t.secure&&0!==r.indexOf("https")?o(new P('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:r}),{contextUrl:null,documentUrl:r,document:null}):void e.ajax({url:r,accepts:{json:"application/ld+json, application/json"},headers:{Accept:"application/ld+json, application/json"},dataType:"json",crossDomain:!0,success:function(e,t,i){var e={contextUrl:null,documentUrl:r,document:e},n=i.getResponseHeader("Content-Type"),i=i.getResponseHeader("Link");if(i&&"application/ld+json"!==n){if(B(i=I.parseLinkHeader(i)[f]))return o(new P("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:r}),e);i&&(e.contextUrl=i.target)}o(null,e)},error:function(e,t,i){o(new P("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:r,cause:i}),{contextUrl:null,documentUrl:r,document:null})}})}},I.documentLoaders.node=function(i){var a=!("strictSSL"in(i=i||{}))||i.strictSSL,l="maxRedirects"in i?i.maxRedirects:-1,u="request"in i?i.request:ve("request"),c="application/ld+json, application/json",d=ve("http"),e=new I.RequestQueue;if(i.usePromise)return e.wrapLoader(function(e){return I.promisify(h,e,[])});var t=i.headers||{};if("Accept"in t||"accept"in t)throw new RangeError('Accept header may not be specified as an option; only "'+c+'" is supported.');return e.wrapLoader(function(e,t){h(e,[],t)});function h(n,r,o){if(0!==n.indexOf("http:")&&0!==n.indexOf("https:"))return o(new P('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null});if(i.secure&&0!==n.indexOf("https"))return o(new P('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null});var s=null;if(null!==s)return o(null,s);var e,t={Accept:c};for(e in i.headers)t[e]=i.headers[e];u({url:n,headers:t,strictSSL:a,followRedirect:!1},function(e,t,i){if(s={contextUrl:null,documentUrl:n,document:i||null},e)return o(new P("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:n,cause:e}),s);i=d.STATUS_CODES[t.statusCode];if(400<=t.statusCode)return o(new P("URL could not be dereferenced: "+i,"jsonld.InvalidUrl",{code:"loading document failed",url:n,httpStatusCode:t.statusCode}),s);if(t.headers.link&&"application/ld+json"!==t.headers["content-type"]){i=I.parseLinkHeader(t.headers.link)[f];if(B(i))return o(new P("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:n}),s);i&&(s.contextUrl=i.target)}if(300<=t.statusCode&&t.statusCode<400&&t.headers.location)return r.length===l?o(new P("URL could not be dereferenced; there were too many redirects.","jsonld.TooManyRedirects",{code:"loading document failed",url:n,httpStatusCode:t.statusCode,redirects:r}),s):-1!==r.indexOf(n)?o(new P("URL could not be dereferenced; infinite redirection was detected.","jsonld.InfiniteRedirectDetected",{code:"recursive context inclusion",url:n,httpStatusCode:t.statusCode,redirects:r}),s):(r.push(n),h(t.headers.location,r,o));r.push(n),o(e,s)})}},I.documentLoaders.xhr=function(e){e=e||{};var s=/(^|(\r\n))link:/i,t=new I.RequestQueue;return("usePromise"in e?e.usePromise:"undefined"!=typeof Promise)?t.wrapLoader(function(e){return I.promisify(i,e)}):t.wrapLoader(i);function i(n,r){var o;return 0!==n.indexOf("http:")&&0!==n.indexOf("https:")?r(new P('URL could not be dereferenced; only "http" and "https" URLs are supported.',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null}):e.secure&&0!==n.indexOf("https")?r(new P('URL could not be dereferenced; secure mode is enabled and the URL\'s scheme is not "https".',"jsonld.InvalidUrl",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null}):((o=new(e.xhr||XMLHttpRequest)).onload=function(){if(400<=o.status)return r(new P("URL could not be dereferenced: "+o.statusText,"jsonld.LoadDocumentError",{code:"loading document failed",url:n,httpStatusCode:o.status}),{contextUrl:null,documentUrl:n,document:null});var e,t={contextUrl:null,documentUrl:n,document:o.response},i=o.getResponseHeader("Content-Type");if((e=s.test(o.getAllResponseHeaders())?o.getResponseHeader("Link"):e)&&"application/ld+json"!==i){if(B(e=I.parseLinkHeader(e)[f]))return r(new P("URL could not be dereferenced, it has more than one associated HTTP Link Header.","jsonld.InvalidUrl",{code:"multiple context link headers",url:n}),t);e&&(t.contextUrl=e.target)}r(null,t)},o.onerror=function(){r(new P("URL could not be dereferenced, an error occurred.","jsonld.LoadDocumentError",{code:"loading document failed",url:n}),{contextUrl:null,documentUrl:n,document:null})},o.open("GET",n,!0),o.setRequestHeader("Accept","application/ld+json, application/json"),void o.send())}},I.useDocumentLoader=function(e){if(!(e in I.documentLoaders))throw new P('Unknown document loader type: "'+e+'"',"jsonld.UnknownDocumentLoader",{type:e});I.documentLoader=I.documentLoaders[e].apply(I,Array.prototype.slice.call(arguments,1))},I.processContext=function(i,e){var n={},t=2,r=(3<arguments.length&&(n=arguments[2]||{},t+=1),arguments[t]);if("base"in n||(n.base=""),"documentLoader"in n||(n.documentLoader=I.loadDocument),null===e)return r(null,x(n));oe(e=$(e=D(e))&&"@context"in e?e:{"@context":e},n,function(e,t){if(e)return r(e);try{t=(new h).processContext(i,t,n)}catch(e){return r(e)}r(null,t)})},I.hasProperty=function(e,t){var i=!1;return i=t in e?!B(e=e[t])||0<e.length:i},I.hasValue=function(e,t,i){var n=!1;if(I.hasProperty(e,t)){var r=e[t],e=H(r);if(B(r)||e){e&&(r=r["@list"]);for(var o=0;o<r.length;++o)if(I.compareValues(i,r[o])){n=!0;break}}else B(i)||(n=I.compareValues(i,r))}return n},I.addValue=function(e,t,i,n){if("propertyIsArray"in(n=n||{})||(n.propertyIsArray=!1),"allowDuplicate"in n||(n.allowDuplicate=!0),B(i)){0!==i.length||!n.propertyIsArray||t in e||(e[t]=[]);for(var r=0;r<i.length;++r)I.addValue(e,t,i[r],n)}else{var o;t in e?(o=!n.allowDuplicate&&I.hasValue(e,t,i),B(e[t])||o&&!n.propertyIsArray||(e[t]=[e[t]]),o||e[t].push(i)):e[t]=n.propertyIsArray?[i]:i}},I.getValues=function(e,t){e=e[t]||[];return e=B(e)?e:[e]},I.removeProperty=function(e,t){delete e[t]},I.removeValue=function(e,t,i,n){"propertyIsArray"in(n=n||{})||(n.propertyIsArray=!1);var r=I.getValues(e,t).filter(function(e){return!I.compareValues(e,i)});0===r.length?I.removeProperty(e,t):1!==r.length||n.propertyIsArray?e[t]=r:e[t]=r[0]},I.compareValues=function(e,t){return e===t||!(!q(e)||!q(t)||e["@value"]!==t["@value"]||e["@type"]!==t["@type"]||e["@language"]!==t["@language"]||e["@index"]!==t["@index"])||!!($(e)&&"@id"in e&&$(t)&&"@id"in t)&&e["@id"]===t["@id"]},I.getContextValue=function(e,t,i){var n=null;return null!==t&&("@language"===i&&i in e&&(n=e[i]),e.mappings[t])&&(e=e.mappings[t],V(i)?n=e:i in e&&(n=e[i])),n},{}),X=(I.registerRDFParser=function(e,t){s[e]=t},I.unregisterRDFParser=function(e){delete s[e]},ge&&(void 0===g&&(g=null),void 0===m)&&(m={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),"http://www.w3.org/2001/XMLSchema#boolean"),j="http://www.w3.org/2001/XMLSchema#double",W="http://www.w3.org/2001/XMLSchema#integer",A="http://www.w3.org/2001/XMLSchema#string",O=(t="http://www.w3.org/1999/02/22-rdf-syntax-ns#")+"first",N=t+"rest",L=t+"nil",K=t+"type",v=t+"langString",f="http://www.w3.org/ns/json-ld#context",b=10,P=function(e,t,i){ge?(Error.call(this),Error.captureStackTrace(this,this.constructor)):"undefined"!=typeof Error&&(this.stack=(new Error).stack),this.name=t||"jsonld.Error",this.message=e||"An unspecified JSON-LD error occurred.",this.details=i||{}},h=(ge?ve("util").inherits(P,Error):"undefined"!=typeof Error&&(P.prototype=new Error),function(){});function w(e){var t,i,n,r={};return q(e)?(r.type="literal",t=e["@value"],i=e["@type"]||null,"boolean"==typeof(n=t)||"[object Boolean]"===Object.prototype.toString.call(n)?(r.value=t.toString(),r.datatype=i||X):k(t)||i===j?(k(t)||(t=parseFloat(t)),r.value=t.toExponential(15).replace(/(\d)0*e\+?/,"$1E"),r.datatype=i||j):_(t)?(r.value=t.toFixed(0),r.datatype=i||W):"@language"in e?(r.value=t,r.datatype=i||v,r.language=e["@language"]):(r.value=t,r.datatype=i||A)):(n=$(e)?e["@id"]:e,r.type=0===n.indexOf("_:")?"blank node":"IRI",r.value=n),"IRI"!==r.type||G(r.value)?r:null}h.prototype.compact=function(e,t,i,n){if(B(i)){for(var r=[],o=0;o<i.length;++o){var s=this.compact(e,t,i[o],n);null!==s&&r.push(s)}return r=n.compactArrays&&1===r.length&&null===(k=I.getContextValue(e,t,"@container"))?r[0]:r}if($(i)){if(n.link&&"@id"in i&&i["@id"]in n.link)for(var a=n.link[i["@id"]],o=0;o<a.length;++o)if(a[o].expanded===i)return a[o].compacted;if(q(i)||z(i))r=function(e,t,i){if(q(i)){var n=I.getContextValue(e,t,"@type"),r=I.getContextValue(e,t,"@language"),o=I.getContextValue(e,t,"@container"),o="@index"in i&&"@index"!==o;if(!o&&(i["@type"]===n||i["@language"]===r))return i["@value"];var r=Object.keys(i).length,r=1===r||2===r&&"@index"in i&&!o,s="@language"in e,a=Q(i["@value"]),l=e.mappings[t]&&null===e.mappings[t]["@language"];if(r&&(!s||!a||l))return i["@value"];r={};o&&(r[R(e,"@index")]=i["@index"]),"@type"in i?r[R(e,"@type")]=R(e,i["@type"],null,{vocab:!0}):"@language"in i&&(r[R(e,"@language")]=i["@language"]),r[R(e,"@value")]=i["@value"]}else{s=M(e,t,{vocab:!0}),n=I.getContextValue(e,t,"@type"),a=R(e,i["@id"],null,{vocab:"@vocab"===n});if("@id"===n||"@vocab"===n||"@graph"===s)return a;(r={})[R(e,"@id")]=a}return r}(e,t,i),n.link&&z(i)&&(i["@id"]in n.link||(n.link[i["@id"]]=[]),n.link[i["@id"]].push({expanded:i,compacted:r}));else for(var l="@reverse"===t,r={},u=(n.link&&"@id"in i&&(i["@id"]in n.link||(n.link[i["@id"]]=[]),n.link[i["@id"]].push({expanded:i,compacted:r})),Object.keys(i).sort()),c=0;c<u.length;++c){var d,h,p,f,g=u[c],m=i[g];if("@id"===g||"@type"===g){if(Q(m))d=R(e,m,null,{vocab:"@type"===g});else{d=[];for(var v=0;v<m.length;++v)d.push(R(e,m[v],null,{vocab:!0}))}var y=R(e,g),b=B(d)&&0===m.length;I.addValue(r,y,d,{propertyIsArray:b})}else if("@reverse"===g){for(h in d=this.compact(e,"@reverse",m,n))e.mappings[h]&&e.mappings[h].reverse&&(p=d[h],f="@set"===(k=I.getContextValue(e,h,"@container"))||!n.compactArrays,I.addValue(r,h,p,{propertyIsArray:f}),delete d[h]);0<Object.keys(d).length&&(y=R(e,g),I.addValue(r,y,d))}else if("@index"===g)"@index"!==(k=I.getContextValue(e,t,"@container"))&&(y=R(e,g),I.addValue(r,y,m));else if("@graph"!==g&&"@list"!==g&&U(g)){y=R(e,g);I.addValue(r,y,m)}else{0===m.length&&(_=R(e,g,m,{vocab:!0},l),I.addValue(r,_,m,{propertyIsArray:!0}));for(v=0;v<m.length;++v){var w,x=m[v],_=R(e,g,x,{vocab:!0},l),k=I.getContextValue(e,_,"@container"),C=H(x),E=null,E=(C&&(E=x["@list"]),this.compact(e,_,C?E:x,n));if(C)if(B(E)||(E=[E]),"@list"!==k){C={};C[R(e,"@list")]=E,E=C,"@index"in x&&(E[R(e,"@index")]=x["@index"])}else if(_ in r)throw new P('JSON-LD compact error; property has a "@list" @container rule but there is more than a single @list that matches the compacted term in the document. Compaction might mix unwanted items into the list.',"jsonld.SyntaxError",{code:"compaction to list of lists"});"@language"===k||"@index"===k?(_ in r?w=r[_]:r[_]=w={},"@language"===k&&q(E)&&(E=E["@value"]),I.addValue(w,x[k],E)):(b=!n.compactArrays||"@set"===k||"@list"===k||B(E)&&0===E.length||"@list"===g||"@graph"===g,I.addValue(r,_,E,{propertyIsArray:b}))}}}return r}return i},h.prototype.expand=function(l,e,t,u,i){var n,r,o,c=this;if(null==t)return null;if(!B(t)&&!$(t))return!(i||null!==e&&"@graph"!==M(l,e,{vocab:!0}))||(R=l,j=e,null==(n=t))?null:"@id"===(r=M(R,j,{vocab:!0}))?M(R,n,{base:!0}):"@type"===r?M(R,n,{vocab:!0,base:!0}):"@id"===(o=I.getContextValue(R,j,"@type"))||"@graph"===r&&Q(n)?{"@id":M(R,n,{base:!0})}:"@vocab"===o?{"@id":M(R,n,{vocab:!0,base:!0})}:U(r)?n:(r={},null!==o?r["@type"]=o:Q(n)&&null!==(o=I.getContextValue(R,j,"@language"))&&(r["@language"]=o),-1===["boolean","number","string"].indexOf(typeof n)&&(n=n.toString()),r["@value"]=n,r);if(B(t)){var s=[],a=I.getContextValue(l,e,"@container");i=i||"@list"===a;for(var d=0;d<t.length;++d){var h=c.expand(l,e,t[d],u);if(i&&(B(h)||H(h)))throw new P("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"});null!==h&&(B(h)?s=s.concat(h):s.push(h))}}else{for(var p=(M(l="@context"in t?c.processContext(l,t["@context"],u):l,e,{vocab:!0})),s={},f=Object.keys(t).sort(),g=0;g<f.length;++g){var m=f[g],v=t[m];if("@context"!==m){var y=M(l,m,{vocab:!0});if(null!==y&&(G(y)||U(y))){if(U(y)){if("@reverse"===p)throw new P("Invalid JSON-LD syntax; a keyword cannot be used as a @reverse property.","jsonld.SyntaxError",{code:"invalid reverse property map",value:v});if(y in s)throw new P("Invalid JSON-LD syntax; colliding keywords detected.","jsonld.SyntaxError",{code:"colliding keywords",keyword:y})}if("@id"===y&&!Q(v)){if(!u.isFrame)throw new P('Invalid JSON-LD syntax; "@id" value must a string.',"jsonld.SyntaxError",{code:"invalid @id value",value:v});if(!$(v))throw new P('Invalid JSON-LD syntax; "@id" value must be a string or an object.',"jsonld.SyntaxError",{code:"invalid @id value",value:v})}if("@type"===y){x=w=b=void 0;var b=v;if(!Q(b)&&!function(e){return $(e)&&0===Object.keys(e).length}(b)){var w=!1;if(B(b)){w=!0;for(var x=0;x<b.length;++x)if(!Q(b[x])){w=!1;break}}if(!w)throw new P('Invalid JSON-LD syntax; "@type" value must a string, an array of strings, or an empty object.',"jsonld.SyntaxError",{code:"invalid type value",value:b})}}if("@graph"===y&&!$(v)&&!B(v))throw new P('Invalid JSON-LD syntax; "@graph" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid @graph value",value:v});if("@value"===y&&($(v)||B(v)))throw new P('Invalid JSON-LD syntax; "@value" value must not be an object or an array.',"jsonld.SyntaxError",{code:"invalid value object value",value:v});if("@language"===y){if(null===v)continue;if(!Q(v))throw new P('Invalid JSON-LD syntax; "@language" value must be a string.',"jsonld.SyntaxError",{code:"invalid language-tagged string",value:v});v=v.toLowerCase()}if("@index"===y&&!Q(v))throw new P('Invalid JSON-LD syntax; "@index" value must be a string.',"jsonld.SyntaxError",{code:"invalid @index value",value:v});if("@reverse"===y){if(!$(v))throw new P('Invalid JSON-LD syntax; "@reverse" value must be an object.',"jsonld.SyntaxError",{code:"invalid @reverse value",value:v});if("@reverse"in(D=c.expand(l,"@reverse",v,u)))for(var _ in D["@reverse"])I.addValue(s,_,D["@reverse"][_],{propertyIsArray:!0});var k=s["@reverse"]||null;for(_ in D)if("@reverse"!==_){null===k&&(k=s["@reverse"]={}),I.addValue(k,_,[],{propertyIsArray:!0});for(var C=D[_],E=0;E<C.length;++E){if(q(S=C[E])||H(S))throw new P('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:D});I.addValue(k,_,S,{propertyIsArray:!0})}}}else{if("@language"===(a=I.getContextValue(l,m,"@container"))&&$(v))D=function(e){for(var t=[],i=Object.keys(e).sort(),n=0;n<i.length;++n){var r=i[n],o=e[r];B(o)||(o=[o]);for(var s=0;s<o.length;++s){var a=o[s];if(null!==a){if(!Q(a))throw new P("Invalid JSON-LD syntax; language map values must be strings.","jsonld.SyntaxError",{code:"invalid language map value",languageMap:e});t.push({"@value":a,"@language":r.toLowerCase()})}}}return t}(v);else if("@index"===a&&$(v))D=function(e){for(var t=[],i=Object.keys(v).sort(),n=0;n<i.length;++n){var r=i[n];B(o=v[r])||(o=[o]);for(var o=c.expand(l,e,o,u,!1),s=0;s<o.length;++s){var a=o[s];"@index"in a||(a["@index"]=r),t.push(a)}}return t}(m);else{var F="@list"===y;if(F||"@set"===y){var T=F&&"@graph"===p?null:e,D=c.expand(l,T,v,u,F);if(F&&H(D))throw new P("Invalid JSON-LD syntax; lists of lists are not permitted.","jsonld.SyntaxError",{code:"list of lists"})}else D=c.expand(l,m,v,u,!1)}if(null!==D||"@value"===y)if("@list"===y||H(D)||"@list"!==a||(D={"@list":D=B(D)?D:[D]}),l.mappings[m]&&l.mappings[m].reverse){k=s["@reverse"]=s["@reverse"]||{};B(D)||(D=[D]);for(var S,E=0;E<D.length;++E){if(q(S=D[E])||H(S))throw new P('Invalid JSON-LD syntax; "@reverse" value must not be a @value or an @list.',"jsonld.SyntaxError",{code:"invalid reverse property value",value:D});I.addValue(k,y,S,{propertyIsArray:!0})}}else{T=-1===["@index","@id","@type","@value","@language"].indexOf(y);I.addValue(s,y,D,{propertyIsArray:T})}}}}}var R=(f=Object.keys(s)).length;if("@value"in s){if("@type"in s&&"@language"in s)throw new P('Invalid JSON-LD syntax; an element containing "@value" may not contain both "@type" and "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:s});var j=R-1;if("@type"in s&&--j,"@index"in s&&--j,"@language"in s&&--j,0!==j)throw new P('Invalid JSON-LD syntax; an element containing "@value" may only have an "@index" property and at most one other property which can be "@type" or "@language".',"jsonld.SyntaxError",{code:"invalid value object",element:s});if(null===s["@value"])s=null;else{if("@language"in s&&!Q(s["@value"]))throw new P("Invalid JSON-LD syntax; only strings may be language-tagged.","jsonld.SyntaxError",{code:"invalid language-tagged value",element:s});if("@type"in s&&(!G(s["@type"])||0===s["@type"].indexOf("_:")))throw new P('Invalid JSON-LD syntax; an element containing "@value" and "@type" must have an absolute IRI for the value of "@type".',"jsonld.SyntaxError",{code:"invalid typed value",element:s})}}else if("@type"in s&&!B(s["@type"]))s["@type"]=[s["@type"]];else if("@set"in s||"@list"in s){if(1<R&&!(2===R&&"@index"in s))throw new P('Invalid JSON-LD syntax; if an element has the property "@set" or "@list", then it can have at most one other property that is "@index".',"jsonld.SyntaxError",{code:"invalid set or list object",element:s});"@set"in s&&(s=s["@set"],R=(f=Object.keys(s)).length)}else 1===R&&"@language"in s&&(s=null);!$(s)||u.keepFreeFloatingNodes||i||null!==e&&"@graph"!==p||(0===R||"@value"in s||"@list"in s||1===R&&"@id"in s)&&(s=null)}return s},h.prototype.createNodeMap=function(e,t){var i={"@default":{}};return E(e,i,"@default",(t=t||{}).namer||t.issuer||new C("_:b")),S(i)},h.prototype.flatten=function(e){for(var t=this.createNodeMap(e),i=[],n=Object.keys(t).sort(),r=0;r<n.length;++r){var o=t[n[r]];z(o)||i.push(o)}return i},h.prototype.frame=function(e,t,i){var i={options:i,graphs:{"@default":{},"@merged":{}},subjectStack:[],link:{}},n=new C("_:b"),e=(E(e,i.graphs,"@merged",n),i.subjects=i.graphs["@merged"],[]);return function e(t,i,n,r,o){Z(n);n=n[0];var s=t.options;var a={embed:F(n,s,"embed"),explicit:F(n,s,"explicit"),requireAll:F(n,s,"requireAll")};var l=ee(t,i,n,a);var u=Object.keys(l).sort();for(var c=0;c<u.length;++c){var d=u[c],h=l[d];if("@link"===a.embed&&d in t.link)T(r,o,t.link[d]);else{null===o&&(t.uniqueEmbeds={});var p={};if(p["@id"]=d,t.link[d]=p,"@never"===a.embed||Y(h,t.subjectStack))T(r,o,p);else{"@last"===a.embed&&(d in t.uniqueEmbeds&&te(t,d),t.uniqueEmbeds[d]={parent:r,property:o}),t.subjectStack.push(h);for(var f=Object.keys(h).sort(),g=0;g<f.length;g++)if(U(k=f[g]))p[k]=D(h[k]);else if(!a.explicit||k in n)for(var m=h[k],v=0;v<m.length;++v){var y=m[v];if(H(y)){var b,w,x={"@list":[]},_=(T(p,k,x),y["@list"]);for(b in _)z(y=_[b])?(w=k in n?n[k][0]["@list"]:J(a),e(t,[y["@id"]],w,x,"@list")):T(x,"@list",D(y))}else z(y)?(w=k in n?n[k]:J(a),e(t,[y["@id"]],w,p,k)):T(p,k,D(y))}for(var k,C,E,f=Object.keys(n).sort(),g=0;g<f.length;++g)U(k=f[g])||(C=n[k][0],F(C,s,"omitDefault"))||k in p||(E="@null",B(E="@default"in C?D(C["@default"]):E)||(E=[E]),p[k]=[{"@preserve":E}]);T(r,o,p),t.subjectStack.pop()}}}}(i,Object.keys(i.subjects).sort(),t,e,null),e},h.prototype.normalize=function(e,t,i){return"URDNA2015"===t.algorithm?new l(t).main(e,i):"URGNA2012"===t.algorithm?new c(t).main(e,i):void i(new Error("Invalid RDF Dataset Normalization algorithm: "+t.algorithm))},h.prototype.fromRDF=function(e,t,i){var n,r={},o={"@default":r},s={};for(n in e)for(var a=e[n],l=(n in o||(o[n]={}),"@default"===n||n in r||(r[n]={"@id":n}),o[n]),u=0;u<a.length;++u){var c,d=a[u],h=d.subject.value,p=d.predicate.value,d=d.object,f=(h in l||(l[h]={"@id":h}),l[h]),h="IRI"===d.type||"blank node"===d.type;!h||d.value in l||(l[d.value]={"@id":d.value}),p===K&&!t.useRdfType&&h?I.addValue(f,"@type",d.value,{propertyIsArray:!0}):(c=function(e,t){if("IRI"===e.type||"blank node"===e.type)return{"@id":e.value};var i={"@value":e.value};e.language?i["@language"]=e.language:(e=(e=e.datatype)||A,t?(e===X?"true"===i["@value"]?i["@value"]=!0:"false"===i["@value"]&&(i["@value"]=!1):function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(i["@value"])&&(e===W?(t=parseInt(i["@value"],10)).toFixed(0)===i["@value"]&&(i["@value"]=t):e===j&&(i["@value"]=parseFloat(i["@value"]))),-1===[X,W,j,A].indexOf(e)&&(i["@type"]=e)):e!==A&&(i["@type"]=e));return i}(d,t.useNativeTypes),I.addValue(f,p,c,{propertyIsArray:!0}),h&&(d.value===L?("usages"in(h=l[d.value])||(h.usages=[]),h.usages.push({node:f,property:p,value:c})):d.value in s?s[d.value]=!1:s[d.value]={node:f,property:p,value:c}))}for(n in o)if(L in(T=o[n])){for(var g=T[L],m=0;m<g.usages.length;++m){for(var v=g.usages[m],f=v.node,y=v.property,b=v.value,w=[],x=[],_=Object.keys(f).length;y===N&&$(s[f["@id"]])&&B(f[O])&&1===f[O].length&&B(f[N])&&1===f[N].length&&(3===_||4===_&&B(f["@type"])&&1===f["@type"].length&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#List"===f["@type"][0])&&(w.push(f[O][0]),x.push(f["@id"]),f=(v=s[f["@id"]]).node,y=v.property,b=v.value,_=Object.keys(f).length,0===f["@id"].indexOf("_:")););if(y===O){if(f["@id"]===L)continue;b=T[b["@id"]][N][0],w.pop(),x.pop()}delete b["@id"],b["@list"]=w.reverse();for(var k=0;k<x.length;++k)delete T[x[k]]}delete g.usages}for(var C=[],E=Object.keys(r).sort(),m=0;m<E.length;++m){var F=E[m],f=r[F];if(F in o)for(var a=f["@graph"]=[],T=o[F],D=Object.keys(T).sort(),S=0;S<D.length;++S){var R=T[D[S]];z(R)||a.push(R)}z(f)||C.push(f)}i(null,C)},h.prototype.toRDF=function(e,t){for(var i=new C("_:b"),n={"@default":{}},r=(E(e,n,"@default",i),{}),o=Object.keys(n).sort(),s=0;s<o.length;++s){var a=o[s];"@default"!==a&&!G(a)||(r[a]=function(e,t,i){for(var n=[],r=Object.keys(e).sort(),o=0;o<r.length;++o)for(var s=r[o],a=e[s],l=Object.keys(a).sort(),u=0;u<l.length;++u){var c=l[u],d=a[c];if("@type"===c)c=K;else if(U(c))continue;for(var h=0;h<d.length;++h){var p,f=d[h],g={};g.type=0===s.indexOf("_:")?"blank node":"IRI",G(g.value=s)&&((p={}).type=0===c.indexOf("_:")?"blank node":"IRI",G(p.value=c))&&("blank node"!==p.type||i.produceGeneralizedRdf)&&(H(f)?function(e,t,i,n,r){for(var o={type:"IRI",value:O},s={type:"IRI",value:N},a={type:"IRI",value:L},l=0;l<e.length;++l){var u=e[l],c={type:"blank node",value:t.getId()},c=(r.push({subject:i,predicate:n,object:c}),i=c,n=o,w(u));c&&r.push({subject:i,predicate:n,object:c}),n=s}r.push({subject:i,predicate:n,object:a})}(f["@list"],t,g,p,n):(f=w(f))&&n.push({subject:g,predicate:p,object:f}))}}return n}(n[a],i,t))}return r},h.prototype.processContext=function(e,t,i){$(t)&&"@context"in t&&B(t["@context"])&&(t=t["@context"]);var n=B(t)?t:[t];if(0===n.length)return e.clone();for(var r=e,o=0;o<n.length;++o){var s=n[o];if(null===s)r=e=x(i);else{if($(s)&&"@context"in s&&(s=s["@context"]),!$(s))throw new P("Invalid JSON-LD syntax; @context must be an object.","jsonld.SyntaxError",{code:"invalid local context",context:s});if(I.cache.activeCtx){var a=I.cache.activeCtx.get(e,s);if(a){r=e=a;continue}}var l,u,r=(e=r).clone(),c={};if("@base"in s){a=s["@base"];if(null===a)a=null;else{if(!Q(a))throw new P('Invalid JSON-LD syntax; the value of "@base" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid base IRI",context:s});if(""!==a&&!G(a))throw new P('Invalid JSON-LD syntax; the value of "@base" in a @context must be an absolute IRI or the empty string.',"jsonld.SyntaxError",{code:"invalid base IRI",context:s})}null!==a&&(a=I.url.parse(a||"")),r["@base"]=a,c["@base"]=!0}if("@vocab"in s){if(null===(l=s["@vocab"]))delete r["@vocab"];else{if(!Q(l))throw new P('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:s});if(!G(l))throw new P('Invalid JSON-LD syntax; the value of "@vocab" in a @context must be an absolute IRI.',"jsonld.SyntaxError",{code:"invalid vocab mapping",context:s});r["@vocab"]=l}c["@vocab"]=!0}if("@language"in s){if(null===(l=s["@language"]))delete r["@language"];else{if(!Q(l))throw new P('Invalid JSON-LD syntax; the value of "@language" in a @context must be a string or null.',"jsonld.SyntaxError",{code:"invalid default language",context:s});r["@language"]=l.toLowerCase()}c["@language"]=!0}for(u in s)d(r,s,u,c);I.cache.activeCtx&&I.cache.activeCtx.set(e,s,r)}}return r},u={subject:"s",object:"o",name:"g"},i.prototype.doWork=function(i,n){var r=this.schedule;if(r.totalDepth>=r.MAX_TOTAL_DEPTH)return n(new Error("Maximum total call stack depth exceeded; normalization aborting."));!function e(){var t;return r.depth===r.MAX_DEPTH?(r.depth=0,r.running=!1,I.nextTick(e)):(t=(new Date).getTime(),r.running||(r.start=(new Date).getTime(),r.deadline=r.start+r.timeSlice),t<r.deadline?(r.running=!0,r.depth++,r.totalDepth++,i(function(e,t){r.depth--,r.totalDepth--,n(e,t)})):(r.depth=0,r.running=!1,void I.setImmediate(e)))}()},i.prototype.forEach=function(e,n,r){var t,i,o,s=this,a=0;o=B(e)?(i=e.length,function(){return a!==i&&(o.value=e[a++],o.key=a,!0)}):(t=Object.keys(e),i=t.length,function(){return a!==i&&(o.key=t[a++],o.value=e[o.key],!0)}),function e(t,i){return t?r(t):o()?s.doWork(function(){n(o.value,o.key,e)}):void r()}()},i.prototype.waterfall=function(e,t){var n=this;n.forEach(e,function(e,t,i){n.doWork(e,i)},t)},i.prototype.whilst=function(i,n,r){var o=this;!function e(t){return t?r(t):i()?void o.doWork(n,e):r()}()},i.prototype.main=function(t,i){var r,o=this;if(o.schedule.start=(new Date).getTime(),o.options.format&&"application/nquads"!==o.options.format)return i(new P("Unknown output format.","jsonld.UnknownFormat",{format:o.options.format}));var s={};o.waterfall([function(e){o.forEach(t,function(e,n,t){"@default"===n&&(n=null),o.forEach(e,function(t,e,i){null!==n&&(0===n.indexOf("_:")?t.name={type:"blank node",value:n}:t.name={type:"IRI",value:n}),o.quads.push(t),o.forEachComponent(t,function(e){"blank node"===e.type&&((e=e.value)in o.blankNodeInfo?o.blankNodeInfo[e].quads.push(t):(s[e]=!0,o.blankNodeInfo[e]={quads:[t]}))}),i()},t)},e)},function(e){var r=!0;o.whilst(function(){return r},function(e){r=!1,o.hashToBlankNodes={},o.waterfall([function(e){o.forEach(s,function(e,i,n){o.hashFirstDegreeQuads(i,function(e,t){if(e)return n(e);t in o.hashToBlankNodes?o.hashToBlankNodes[t].push(i):o.hashToBlankNodes[t]=[i],n()})},e)},function(e){var t=Object.keys(o.hashToBlankNodes).sort();o.forEach(t,function(e,t,i){var n=o.hashToBlankNodes[e];if(1<n.length)return i();n=n[0];o.canonicalIssuer.getId(n),delete s[n],delete o.hashToBlankNodes[e],r=!0,i()},e)}],e)},e)},function(e){var t=Object.keys(o.hashToBlankNodes).sort();o.forEach(t,function(e,t,i){var r=[],n=o.hashToBlankNodes[e];o.waterfall([function(e){o.forEach(n,function(e,t,i){if(o.canonicalIssuer.hasId(e))return i();var n=new C("_:b");n.getId(e),o.hashNDegreeQuads(e,n,function(e,t){if(e)return i(e);r.push(t),i()})},e)},function(e){r.sort(function(e,t){return e.hash<t.hash?-1:e.hash>t.hash?1:0}),o.forEach(r,function(e,t,i){for(var n in e.issuer.existing)o.canonicalIssuer.getId(n);i()},e)}],i)},e)},function(e){var n=[];o.waterfall([function(e){o.forEach(o.quads,function(e,t,i){o.forEachComponent(e,function(e){"blank node"===e.type&&0!==e.value.indexOf(o.canonicalIssuer.prefix)&&(e.value=o.canonicalIssuer.getId(e.value))}),n.push(ae(e)),i()},e)},function(e){if(n.sort(),"application/nquads"===o.options.format)return r=n.join(""),e();r=se(n.join("")),e()}],e)}],function(e){i(e,r)})},i.prototype.hashFirstDegreeQuads=function(r,t){var o=this,i=o.blankNodeInfo[r];if("hash"in i)return t(null,i.hash);var s=[],e=i.quads;o.forEach(e,function(e,t,i){var n={predicate:e.predicate};o.forEachComponent(e,function(e,t){n[t]=o.modifyFirstDegreeComponent(r,e,t)}),s.push(ae(n)),i()},function(e){if(e)return t(e);s.sort(),i.hash=a.hashNQuads(o.name,s),t(null,i.hash)})},i.prototype.modifyFirstDegreeComponent=function(e,t){return"blank node"===t.type&&((t=D(t)).value=t.value===e?"_:a":"_:z"),t},i.prototype.hashRelatedBlankNode=function(e,t,n,i,r){var o,s=this;s.waterfall([function(i){return s.canonicalIssuer.hasId(e)?(o=s.canonicalIssuer.getId(e),i()):n.hasId(e)?(o=n.getId(e),i()):void s.hashFirstDegreeQuads(e,function(e,t){if(e)return i(e);o=t,i()})}],function(e){return e?r(e):((e=new a(s.name)).update(i),"g"!==i&&e.update(s.getRelatedPredicate(t)),e.update(o),r(null,e.digest()))})},i.prototype.getRelatedPredicate=function(e){return"<"+e.predicate.value+">"},i.prototype.hashNDegreeQuads=function(e,c,t){var n,d=this,r=new a(d.name);d.waterfall([function(i){d.createHashToRelated(e,c,function(e,t){if(e)return i(e);n=t,i()})},function(e){var t=Object.keys(n).sort();d.forEach(t,function(e,t,i){r.update(e);var a,l="",u=new ce(n[e]);d.whilst(function(){return u.hasNext()},function(r){var t=u.next(),o=c.clone(),s="",n=[];d.waterfall([function(e){d.forEach(t,function(e,t,i){if(d.canonicalIssuer.hasId(e)?s+=d.canonicalIssuer.getId(e):(o.hasId(e)||n.push(e),s+=o.getId(e)),0!==l.length&&s.length>=l.length&&l<s)return r();i()},e)},function(e){d.forEach(n,function(i,e,n){d.hashNDegreeQuads(i,o,function(e,t){return e?n(e):(s=(s+=o.getId(i))+("<"+t.hash)+">",o=t.issuer,0!==l.length&&s.length>=l.length&&l<s?r():void n())})},e)},function(e){(0===l.length||s<l)&&(l=s,a=o),e()}],r)},function(e){if(e)return i(e);r.update(l),c=a,i()})},e)}],function(e){t(e,{hash:r.digest(),issuer:c})})},i.prototype.createHashToRelated=function(o,s,t){var a=this,l={},e=a.blankNodeInfo[o].quads;a.forEach(e,function(r,e,t){a.forEach(r,function(e,t,i){if("predicate"===t||"blank node"!==e.type||e.value===o)return i();var n=e.value;a.hashRelatedBlankNode(n,r,s,u[t],function(e,t){if(e)return i(e);t in l?l[t].push(n):l[t]=[n],i()})},t)},function(e){t(e,l)})},i.prototype.forEachComponent=function(e,t){for(var i in e)"predicate"!==i&&t(e[i],i,e)};var u,l=i;function i(e){e=e||{},this.name="URDNA2015",this.options=e,this.blankNodeInfo={},this.hashToBlankNodes={},this.canonicalIssuer=new C("_:c14n"),this.quads=[],this.schedule={},"maxCallStackDepth"in e?this.schedule.MAX_DEPTH=e.maxCallStackDepth:this.schedule.MAX_DEPTH=500,"maxTotalCallStackDepth"in e?this.schedule.MAX_TOTAL_DEPTH=e.maxCallStackDepth:this.schedule.MAX_TOTAL_DEPTH=4294967295,this.schedule.depth=0,this.schedule.totalDepth=0,"timeSlice"in e?this.schedule.timeSlice=e.timeSlice:this.schedule.timeSlice=10}(n.prototype=new l).modifyFirstDegreeComponent=function(e,t,i){return"blank node"===t.type&&((t=D(t)).value="name"===i?"_:g":t.value===e?"_:a":"_:z"),t},n.prototype.getRelatedPredicate=function(e){return e.predicate.value},n.prototype.createHashToRelated=function(o,s,t){var a=this,l={},e=a.blankNodeInfo[o].quads;a.forEach(e,function(e,t,i){var n,r;if("blank node"===e.subject.type&&e.subject.value!==o)r=e.subject.value,n="p";else{if("blank node"!==e.object.type||e.object.value===o)return i();r=e.object.value,n="r"}a.hashRelatedBlankNode(r,e,s,n,function(e,t){t in l?l[t].push(r):l[t]=[r],i()})},function(e){t(e,l)})};var c=n;function n(e){l.call(this,e),this.name="URGNA2012"}function E(e,t,i,n,r,o){if(B(e))for(var s=0;s<e.length;++s)E(e[s],t,i,n,void 0,o);else if($(e))if(q(e))"@type"in e&&0===(a=e["@type"]).indexOf("_:")&&(e["@type"]=a=n.getId(a)),o&&o.push(e);else{if("@type"in e)for(var a,l=e["@type"],s=0;s<l.length;++s)0===(a=l[s]).indexOf("_:")&&n.getId(a);V(r)&&(r=ne(e)?n.getId(e["@id"]):e["@id"]),o&&o.push({"@id":r});for(var u=t[i],c=u[r]=u[r]||{},d=(c["@id"]=r,Object.keys(e).sort()),h=0;h<d.length;++h){var p=d[h];if("@id"!==p)if("@reverse"===p){var f,g={"@id":r},m=e["@reverse"];for(f in m)for(var v=m[f],y=0;y<v.length;++y){var b=v[y],w=b["@id"];ne(b)&&(w=n.getId(w)),E(b,t,i,n,w),I.addValue(u[w],f,g,{propertyIsArray:!0,allowDuplicate:!1})}}else if("@graph"===p)r in t||(t[r]={}),E(e[p],t,"@merged"===i?i:r,n);else if("@type"!==p&&U(p)){if("@index"===p&&p in c&&(e[p]!==c[p]||e[p]["@id"]!==c[p]["@id"]))throw new P("Invalid JSON-LD syntax; conflicting @index property detected.","jsonld.SyntaxError",{code:"conflicting indexes",subject:c});c[p]=e[p]}else{var x=e[p];if(0===p.indexOf("_:")&&(p=n.getId(p)),0===x.length)I.addValue(c,p,[],{propertyIsArray:!0});else for(var _=0;_<x.length;++_){var k,C=x[_];(function(e){var t=!1;{var i;$(e)&&!("@value"in e||"@set"in e||"@list"in e)&&(i=Object.keys(e).length,t=1<i||!("@id"in e))}return t})(C="@type"===p?0===C.indexOf("_:")?n.getId(C):C:C)||z(C)?(k=ne(C)?n.getId(C["@id"]):C["@id"],I.addValue(c,p,{"@id":k},{propertyIsArray:!0,allowDuplicate:!1}),E(C,t,i,n,k)):H(C)?(E(C["@list"],t,i,n,r,k=[]),I.addValue(c,p,C={"@list":k},{propertyIsArray:!0,allowDuplicate:!1})):(E(C,t,i,n,r),I.addValue(c,p,C,{propertyIsArray:!0,allowDuplicate:!1}))}}}}else o&&o.push(e)}function S(e){for(var t=e["@default"],i=Object.keys(e).sort(),n=0;n<i.length;++n){var r=i[n];if("@default"!==r)for(var o=e[r],s=t[r],a=(s?"@graph"in s||(s["@graph"]=[]):t[r]=s={"@id":r,"@graph":[]},s["@graph"]),l=Object.keys(o).sort(),u=0;u<l.length;++u){var c=o[l[u]];z(c)||a.push(c)}}return t}function J(e){var t,i={};for(t in e)void 0!==e[t]&&(i["@"+t]=[e[t]]);return[i]}function Y(e,t){for(var i=t.length-1;0<=i;--i)if(t[i]["@id"]===e["@id"])return!0;return!1}function F(e,t,i){var n="@"+i,e=n in e?e[n][0]:t[i];return"embed"===i&&(!0===e?e="@last":!1===e?e="@never":"@always"!==e&&"@never"!==e&&"@link"!==e&&(e="@last")),e}function Z(e){if(!B(e)||1!==e.length||!$(e[0]))throw new P("Invalid JSON-LD syntax; a JSON-LD frame must be a single object.","jsonld.SyntaxError",{frame:e})}function ee(e,t,i,n){for(var r={},o=0;o<t.length;++o){var s=t[o],a=e.subjects[s];!function(e,t,i){if("@type"in t&&(1!==t["@type"].length||!$(t["@type"][0]))){for(var n=t["@type"],r=0;r<n.length;++r)if(I.hasValue(e,"@type",n[r]))return 1;return}var o,s=!0,a=!1;for(o in t){if(U(o)){if("@id"!==o&&"@type"!==o)continue;if(s=!1,"@id"===o&&Q(t[o])){if(e[o]!==t[o])return;a=!0;continue}}if(s=!1,o in e){if(B(t[o])&&0===t[o].length&&void 0!==e[o])return;a=!0}else{var l=B(t[o])&&$(t[o][0])&&"@default"in t[o][0];if(i.requireAll&&!l)return}}return s||a}(a,i,n)||(r[s]=a)}return r}function te(e,t){var r=e.uniqueEmbeds,e=r[t],i=e.parent,e=e.property,n={"@id":t};if(B(i)){for(var o=0;o<i.length;++o)if(I.compareValues(i[o],n)){i[o]=n;break}}else{var s=B(i[e]);I.removeValue(i,e,n,{propertyIsArray:s}),I.addValue(i,e,n,{propertyIsArray:s})}function a(e){for(var t=Object.keys(r),i=0;i<t.length;++i){var n=t[i];n in r&&$(r[n].parent)&&r[n].parent["@id"]===e&&(delete r[n],a(n))}}a(t)}function T(e,t,i){$(e)?I.addValue(e,t,i,{propertyIsArray:!0}):e.push(i)}function ie(e,t){return e.length<t.length?-1:t.length<e.length?1:e===t?0:e<t?-1:1}function R(e,t,i,n,r){if(null===t)return t;V(i)&&(i=null),V(r)&&(r=!1),n=n||{};var o=e.getInverse();if(U(t))return t in o?o[t]["@none"]["@type"]["@none"]:t;if(n.vocab&&t in o){var o=e["@language"]||"@none",s=[],a=($(i)&&"@index"in i&&s.push("@index"),"@language"),l="@null";if(r)a="@type",l="@reverse",s.push("@set");else if(H(i)){"@index"in i||s.push("@list");for(var u=i["@list"],c=0===u.length?o:null,d=null,h=0;h<u.length;++h){var p=u[h],f="@none",g="@none";if(q(p)?"@language"in p?f=p["@language"]:"@type"in p?g=p["@type"]:f="@null":g="@id",null===c?c=f:f!==c&&q(p)&&(c="@none"),null===d?d=g:g!==d&&(d="@none"),"@none"===c&&"@none"===d)break}c=c||"@none",l="@none"!==(d=d||"@none")?(a="@type",d):c}else q(i)?"@language"in i&&!("@index"in i)?(s.push("@language"),l=i["@language"]):"@type"in i&&(l=i[a="@type"]):(a="@type",l="@id"),s.push("@set");s.push("@none");r=function(e,t,i,n,r,o){for(var s=[],a=("@id"!==(o=null===o?"@null":o)&&"@reverse"!==o||!z(i)?s.push(o):("@reverse"===o&&s.push("@reverse"),(o=R(e,i["@id"],null,{vocab:!0}))in e.mappings&&e.mappings[o]&&e.mappings[o]["@id"]===i["@id"]?s.push.apply(s,["@vocab","@id"]):s.push.apply(s,["@id","@vocab"])),s.push("@none"),e.inverse[t]),l=0;l<n.length;++l){var u=n[l];if(u in a)for(var c=a[u][r],d=0;d<s.length;++d){var h=s[d];if(h in c)return c[h]}}return null}(e,t,i,s,a,l);if(null!==r)return r}if(n.vocab&&"@vocab"in e){o=e["@vocab"];if(0===t.indexOf(o)&&t!==o){s=t.substr(o.length);if(!(s in e.mappings))return s}}for(var m=null,v=0,y=[],b=e.fastCurieMap,w=t.length-1;v<w&&t[v]in b;++v)""in(b=b[t[v]])&&y.push(b[""][0]);for(h=y.length-1;0<=h;--h)for(var x=y[h],_=x.terms,k=0;k<_.length;++k){var C=_[k]+":"+t.substr(x.iri.length);(!(C in e.mappings)||null===i&&e.mappings[C]["@id"]===t)&&(null===m||ie(C,m)<0)&&(m=C)}if(null!==m)return m;if(n.vocab)return t;a=e["@base"],l=t;if(null===a)return l;Q(a)&&(a=I.url.parse(a||""));r="";if(""!==a.href?r+=(a.protocol||"")+"//"+(a.authority||""):l.indexOf("//")&&(r+="//"),0!==l.indexOf(r))return l;for(var l=I.url.parse(l.substr(r.length)),E=a.normalizedPath.split("/"),F=l.normalizedPath.split("/"),T=l.fragment||l.query?0:1;0<E.length&&F.length>T&&E[0]===F[0];)E.shift(),F.shift();var D="";if(0<E.length){E.pop();for(var S=0;S<E.length;++S)D+="../"}return D+=F.join("/"),null!==l.query&&(D+="?"+l.query),null!==l.fragment&&(D+="#"+l.fragment),D=""===D?"./":D}function d(e,t,i,n){if(i in n){if(n[i])return;throw new P("Cyclical context definition detected.","jsonld.CyclicalContext",{code:"cyclic IRI mapping",context:t,term:i})}if(n[i]=!1,U(i))throw new P("Invalid JSON-LD syntax; keywords cannot be overridden.","jsonld.SyntaxError",{code:"keyword redefinition",context:t,term:i});if(""===i)throw new P("Invalid JSON-LD syntax; a term cannot be an empty string.","jsonld.SyntaxError",{code:"invalid term definition",context:t});e.mappings[i]&&delete e.mappings[i];var r=t[i];if(null===r||$(r)&&null===r["@id"])e.mappings[i]=null,n[i]=!0;else{if(!$(r=Q(r)?{"@id":r}:r))throw new P("Invalid JSON-LD syntax; @context property values must be strings or objects.","jsonld.SyntaxError",{code:"invalid term definition",context:t});var o=e.mappings[i]={reverse:!1};if("@reverse"in r){if("@id"in r)throw new P("Invalid JSON-LD syntax; a @reverse term definition must not contain @id.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});var s=r["@reverse"];if(!Q(s))throw new P("Invalid JSON-LD syntax; a @context @reverse value must be a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(!G(s=M(e,s,{vocab:!0,base:!1},t,n)))throw new P("Invalid JSON-LD syntax; a @context @reverse value must be an absolute IRI or a blank node identifier.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=s,o.reverse=!0}else if("@id"in r){if(!Q(s=r["@id"]))throw new P("Invalid JSON-LD syntax; a @context @id value must be an array of strings or a string.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});if(s!==i){if(!G(s=M(e,s,{vocab:!0,base:!1},t,n))&&!U(s))throw new P("Invalid JSON-LD syntax; a @context @id value must be an absolute IRI, a blank node identifier, or a keyword.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t});o["@id"]=s}}var a=i.indexOf(":");if(o._termHasColon=-1!==a,!("@id"in o))if(o._termHasColon){var l=i.substr(0,a);l in t&&d(e,t,l,n),e.mappings[l]?(a=i.substr(a+1),o["@id"]=e.mappings[l]["@id"]+a):o["@id"]=i}else{if(!("@vocab"in e))throw new P("Invalid JSON-LD syntax; @context terms must define an @id.","jsonld.SyntaxError",{code:"invalid IRI mapping",context:t,term:i});o["@id"]=e["@vocab"]+i}if(n[i]=!0,"@type"in r){l=r["@type"];if(!Q(l))throw new P("Invalid JSON-LD syntax; an @context @type values must be a string.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if("@id"!==l&&"@vocab"!==l){if(!G(l=M(e,l,{vocab:!0,base:!1},t,n)))throw new P("Invalid JSON-LD syntax; an @context @type value must be an absolute IRI.","jsonld.SyntaxError",{code:"invalid type mapping",context:t});if(0===l.indexOf("_:"))throw new P("Invalid JSON-LD syntax; an @context @type values must be an IRI, not a blank node identifier.","jsonld.SyntaxError",{code:"invalid type mapping",context:t})}o["@type"]=l}if("@container"in r){a=r["@container"];if("@list"!==a&&"@set"!==a&&"@index"!==a&&"@language"!==a)throw new P("Invalid JSON-LD syntax; @context @container value must be one of the following: @list, @set, @index, or @language.","jsonld.SyntaxError",{code:"invalid container mapping",context:t});if(o.reverse&&"@index"!==a&&"@set"!==a&&null!==a)throw new P("Invalid JSON-LD syntax; @context @container value for a @reverse type definition must be @index or @set.","jsonld.SyntaxError",{code:"invalid reverse property",context:t});o["@container"]=a}if("@language"in r&&!("@type"in r)){i=r["@language"];if(null!==i&&!Q(i))throw new P("Invalid JSON-LD syntax; @context @language value must be a string or null.","jsonld.SyntaxError",{code:"invalid language mapping",context:t});null!==i&&(i=i.toLowerCase()),o["@language"]=i}if("@context"===(s=o["@id"])||"@preserve"===s)throw new P("Invalid JSON-LD syntax; @context and @preserve cannot be aliased.","jsonld.SyntaxError",{code:"invalid keyword alias",context:t})}}function M(e,t,i,n,r){if(null===t||U(t))return t;if(t=String(t),n&&t in n&&!0!==r[t]&&d(e,n,t,r),(i=i||{}).vocab){if(null===(s=e.mappings[t]))return null;if(s)return s["@id"]}var o,s,a=t.indexOf(":");return-1!==a?(o=t.substr(0,a),a=t.substr(a+1),"_"!==o&&0!==a.indexOf("//")&&(n&&o in n&&d(e,n,o,r),s=e.mappings[o])?s["@id"]+a:t):i.vocab&&"@vocab"in e?e["@vocab"]+t:(n=t,i.base?I.prependBase(e["@base"],n):n)}function x(e){return{"@base":I.url.parse(e.base||""),mappings:{},inverse:null,getInverse:function(){if(this.inverse)return this.inverse;for(var e,t=this.inverse={},i=this.fastCurieMap={},n={},r=this["@language"]||"@none",o=this.mappings,s=Object.keys(o).sort(ie),a=0;a<s.length;++a){var l=s[a],u=o[l];if(null!==u){var c=u["@container"]||"@none",d=u["@id"];B(d)||(d=[d]);for(var h=0;h<d.length;++h){var p=d[h],f=t[p],g=U(p);f?g||u._termHasColon||n[p].push(l):(t[p]=f={},g||u._termHasColon||(n[p]=[l],g={iri:p,terms:n[p]},p[0]in i?i[p[0]].push(g):i[p[0]]=[g])),f[c]||(f[c]={"@language":{},"@type":{}}),f=f[c],u.reverse?m(0,l,f["@type"],"@reverse"):"@type"in u?m(0,l,f["@type"],u["@type"]):"@language"in u?(p=u["@language"]||"@null",m(0,l,f["@language"],p)):(m(0,l,f["@language"],r),m(0,l,f["@type"],"@none"),m(0,l,f["@language"],"@none"))}}}for(e in i)!function e(t,i,n){var r=t[i];var o=t[i]={};var s;for(var a=0;a<r.length;++a)s=r[a].iri,(s=n>=s.length?"":s[n])in o?o[s].push(r[a]):o[s]=[r[a]];for(var i in o)""!==i&&e(o,i,n+1)}(i,e,1);return t},clone:function(){var e={};e["@base"]=this["@base"],e.mappings=D(this.mappings),e.clone=this.clone,e.inverse=null,e.getInverse=this.getInverse,"@language"in this&&(e["@language"]=this["@language"]);"@vocab"in this&&(e["@vocab"]=this["@vocab"]);return e}};function m(e,t,i,n){n in i||(i[n]=t)}}function U(e){if(Q(e))switch(e){case"@base":case"@context":case"@container":case"@default":case"@embed":case"@explicit":case"@graph":case"@id":case"@index":case"@language":case"@list":case"@omitDefault":case"@preserve":case"@requireAll":case"@reverse":case"@set":case"@type":case"@value":case"@vocab":return!0}return!1}function $(e){return"[object Object]"===Object.prototype.toString.call(e)}function B(e){return Array.isArray(e)}function Q(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)}function _(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function k(e){return _(e)&&-1!==String(e).indexOf(".")}function V(e){return void 0===e}function z(e){return $(e)&&1===Object.keys(e).length&&"@id"in e}function q(e){return $(e)&&"@value"in e}function H(e){return $(e)&&"@list"in e}function ne(e){var t=!1;return t=$(e)?"@id"in e?0===e["@id"].indexOf("_:"):0===Object.keys(e).length||!("@value"in e||"@set"in e||"@list"in e):t}function G(e){return Q(e)&&-1!==e.indexOf(":")}function D(e){if(e&&"object"==typeof e){if(B(e))for(var t=[],i=0;i<e.length;++i)t[i]=D(e[i]);else if($(e))for(var n in t={},e)t[n]=D(e[n]);else t=e.toString();return t}return e}function re(e,t,i,n){var r=Object.keys(t).length;if(B(e)){for(var o=0;o<e.length;++o)re(e[o],t,i,n);return r<Object.keys(t).length}if($(e)){for(var s in e)if("@context"!==s)re(e[s],t,i,n);else{var a=e[s];if(B(a))for(var l=a.length,o=0;o<l;++o){var u=a[o];Q(u)&&(u=I.prependBase(n,u),i?B(u=t[u])?(Array.prototype.splice.apply(a,[o,1].concat(u)),o+=u.length-1,l=a.length):a[o]=u:u in t||(t[u]=!1))}else Q(a)&&(a=I.prependBase(n,a),i?e[s]=t[a]:a in t||(t[a]=!1))}return r<Object.keys(t).length}}function oe(e,t,i){function d(e,i,o,t,s){if(Object.keys(i).length>b)return h=new P("Maximum number of @context URLs exceeded.","jsonld.ContextUrlError",{code:"loading remote context failed",max:b}),s(h);function a(){re(e,l,!0,t),s(null,e)}var l={};if(!re(e,l,!1,t))return a();var n,r=[];for(n in l)!1===l[n]&&r.push(n);for(var u=r.length,c=0;c<r.length;++c)!function(n){var r,e,t;n in i?(h=new P("Cyclical @context URLs detected.","jsonld.ContextUrlError",{code:"recursive context inclusion",url:n}),s(h)):((r=D(i))[n]=!0,(t=o(n,e=function(t,e){if(!h){var i=e?e.document:null;if(!t&&Q(i))try{i=JSON.parse(i)}catch(e){t=e}if(t?t=new P("Dereferencing a URL did not result in a valid JSON-LD object. Possible causes are an inaccessible URL perhaps due to a same-origin policy (ensure the server uses CORS if you are using client-side JavaScript), too many redirects, a non-JSON response, or more than one HTTP Link Header was provided for a remote context.","jsonld.InvalidUrl",{code:"loading remote context failed",url:n,cause:t}):$(i)||(t=new P("Dereferencing a URL did not result in a JSON object. The response was valid JSON, but it was not a JSON object.","jsonld.InvalidUrl",{code:"invalid remote context",url:n,cause:t})),t)return s(h=t);i="@context"in i?{"@context":i["@context"]}:{"@context":{}},e.contextUrl&&(B(i["@context"])||(i["@context"]=[i["@context"]]),i["@context"].push(e.contextUrl)),d(i,r,o,n,function(e,t){if(e)return s(e);l[n]=t["@context"],0===--u&&a()})}}))&&"then"in t&&t.then(e.bind(null,null),e))}(r[c])}var h=null,n=t.documentLoader;d(e,{},n,t.base,i)}function se(e){for(var t=new RegExp("^[ \\t]*(?:#.*)?$"),i=new RegExp('^[ \\t]*(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-z0-9]+)))[ \\t]+(?:<([^:]+:[^>]*)>)[ \\t]+(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-z0-9]+))|(?:"([^"\\\\]*(?:\\\\.[^"\\\\]*)*)"(?:(?:\\^\\^(?:<([^:]+:[^>]*)>))|(?:@([a-z]+(?:-[a-z0-9]+)*)))?))[ \\t]*(?:\\.|(?:(?:(?:<([^:]+:[^>]*)>)|(_:(?:[A-Za-z0-9]+)))[ \\t]*\\.))[ \\t]*(?:#.*)?$'),n={},r=e.split(/(?:\r\n)|(?:\n)|(?:\r)/g),o=0,s=0;s<r.length;++s){var a=r[s];if(o++,!t.test(a)){a=a.match(i);if(null===a)throw new P("Error while parsing N-Quads; invalid quad.","jsonld.ParseError",{line:o});var l={},u=(V(a[1])?l.subject={type:"blank node",value:a[2]}:l.subject={type:"IRI",value:a[1]},l.predicate={type:"IRI",value:a[3]},V(a[4])?V(a[5])?(l.object={type:"literal"},V(a[7])?V(a[8])?l.object.datatype=A:(l.object.datatype=v,l.object.language=a[8]):l.object.datatype=a[7],u=a[6].replace(/\\"/g,'"').replace(/\\t/g,"\t").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\/g,"\\"),l.object.value=u):l.object={type:"blank node",value:a[5]}:l.object={type:"IRI",value:a[4]},"@default");if(V(a[9])?V(a[10])||(u=a[10]):u=a[9],u in n){for(var c=!0,d=n[u],h=0;c&&h<d.length;++h)!function(e,t){for(var i=["subject","predicate","object"],n=0;n<i.length;++n){var r=i[n];if(e[r].type!==t[r].type||e[r].value!==t[r].value)return}return e.object.language===t.object.language&&e.object.datatype===t.object.datatype}(d[h],l)||(c=!1);c&&d.push(l)}else n[u]=[l]}}return n}function ae(e,t){var i=e.subject,n=e.predicate,r=e.object,t=t||null,e=("name"in e&&e.name&&(t=e.name.value),"");return"IRI"===i.type?e+="<"+i.value+">":e+=i.value,e+=" ","IRI"===n.type?e+="<"+n.value+">":e+=n.value,e+=" ","IRI"===r.type?e+="<"+r.value+">":"blank node"===r.type?e+=r.value:(e+='"'+r.value.replace(/\\/g,"\\\\").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\"/g,'\\"')+'"',r.datatype===v?r.language&&(e+="@"+r.language):r.datatype!==A&&(e+="^^<"+r.datatype+">")),null!=t&&(0!==t.indexOf("_:")?e+=" <"+t+">":e+=" "+t),e+=" .\n"}function C(e){this.prefix=e,this.counter=0,this.existing={}}Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on non-object");var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}),I.registerRDFParser("application/nquads",se),I.registerRDFParser("rdfa-api",function(e){for(var t={"@default":[]},i=e.getSubjects(),n=0;n<i.length;++n){var r=i[n];if(null!==r){var o=e.getSubjectTriples(r);if(null!==o){var s,a=o.predicates;for(s in a)for(var l=a[s].objects,u=0;u<l.length;++u){var c=l[u],d={},h=(0===r.indexOf("_:")?d.subject={type:"blank node",value:r}:d.subject={type:"IRI",value:r},0===s.indexOf("_:")?d.predicate={type:"blank node",value:s}:d.predicate={type:"IRI",value:s},c.value);if("http://www.w3.org/1999/02/22-rdf-syntax-ns#XMLLiteral"===c.type){g||ue();for(var p=new g,h="",f=0;f<c.value.length;f++)c.value[f].nodeType===m.ELEMENT_NODE?h+=p.serializeToString(c.value[f]):c.value[f].nodeType===m.TEXT_NODE&&(h+=c.value[f].nodeValue)}d.object={},"http://www.w3.org/1999/02/22-rdf-syntax-ns#object"===c.type?0===c.value.indexOf("_:")?d.object.type="blank node":d.object.type="IRI":(d.object.type="literal","http://www.w3.org/1999/02/22-rdf-syntax-ns#PlainLiteral"===c.type?c.language?(d.object.datatype=v,d.object.language=c.language):d.object.datatype=A:d.object.datatype=c.type),d.object.value=h,t["@default"].push(d)}}}}return t}),I.IdentifierIssuer=C,(I.UniqueNamer=C).prototype.clone=function(){var e=new C(this.prefix);return e.counter=this.counter,e.existing=D(this.existing),e},C.prototype.getId=function(e){var t;return e&&e in this.existing?this.existing[e]:(t=this.prefix+this.counter,this.counter+=1,e&&(this.existing[e]=t),t)},C.prototype.isNamed=C.prototype.hasId=function(e){return e in this.existing};var le,r,p,y,ue,ce=function(e){this.list=e.sort(),this.done=!1,this.left={};for(var t=0;t<e.length;++t)this.left[e[t]]=!0},a=(ce.prototype.hasNext=function(){return!this.done},ce.prototype.next=function(){for(var e=this.list.slice(),t=null,i=0,n=this.list.length,r=0;r<n;++r){var o=this.list[r],s=this.left[o];(null===t||t<o)&&(s&&0<r&&o>this.list[r-1]||!s&&r<n-1&&o>this.list[r+1])&&(t=o,i=r)}if(null===t)this.done=!0;else{var a=this.left[t]?i-1:i+1;this.list[i]=this.list[a],this.list[a]=t;for(r=0;r<n;++r)this.list[r]>t&&(this.left[this.list[r]]=!this.left[this.list[r]])}return e},function(e){if(!(this instanceof a))return new a(e);if(-1===["URDNA2015","URGNA2012"].indexOf(e))throw new Error("Invalid RDF Dataset Normalization algorithm: "+e);a._init.call(this,e)});function de(e,t){for(var i="",n=(0===e.indexOf("/")&&(i="/"),e.split("/")),r=[];0<n.length;)"."===n[0]||""===n[0]&&1<n.length?n.shift():".."===n[0]?(n.shift(),t||0<r.length&&".."!==r[r.length-1]?r.pop():r.push("..")):r.push(n.shift());return i+r.join("/")}return a.hashNQuads=function(e,t){for(var i=new a(e),n=0;n<t.length;++n)i.update(t[n]);return i.digest()},ge?(le=ve("crypto"),a._init=function(e){this.md=le.createHash(e="URDNA2015"===e?"sha256":"sha1")},a.prototype.update=function(e){return this.md.update(e,"utf8")},a.prototype.digest=function(){return this.md.digest("hex")}):(a._init=function(e){e=new("URDNA2015"===e?y:p).Algorithm,this.md=new r(e)},a.prototype.update=function(e){return this.md.update(e)},a.prototype.digest=function(){return this.md.digest().toHex()},(r=function(e){if(!(this instanceof r))return new r(e);if(this._algorithm=e,!r._padding||r._padding.length<this._algorithm.blockSize){r._padding=String.fromCharCode(128);for(var t=String.fromCharCode(0),i=64;0<i;)1&i&&(r._padding+=t),0<(i>>>=1)&&(t+=t)}this.start()}).prototype.start=function(){this.messageLength=0,this.fullMessageLength=[];for(var e=this._algorithm.messageLengthSize/4,t=0;t<e;++t)this.fullMessageLength.push(0);return this._input=new r.ByteBuffer,this.state=this._algorithm.start(),this},r.prototype.update=function(e){e=new r.ByteBuffer(unescape(encodeURIComponent(e))),this.messageLength+=e.length();for(var t=[(t=e.length())/4294967296>>>0,t>>>0],i=this.fullMessageLength.length-1;0<=i;--i)this.fullMessageLength[i]+=t[1],t[1]=t[0]+(this.fullMessageLength[i]/4294967296>>>0),this.fullMessageLength[i]=this.fullMessageLength[i]>>>0,t[0]=t[1]/4294967296>>>0;for(this._input.putBytes(e.bytes());this._input.length()>=this._algorithm.blockSize;)this.state=this._algorithm.digest(this.state,this._input);return(2048<this._input.read||0===this._input.length())&&this._input.compact(),this},r.prototype.digest=function(){var e=new r.ByteBuffer;e.putBytes(this._input.bytes());for(var t=this.fullMessageLength[this.fullMessageLength.length-1]+this._algorithm.messageLengthSize&this._algorithm.blockSize-1,i=(e.putBytes(r._padding.substr(0,this._algorithm.blockSize-t)),new r.ByteBuffer),n=0;n<this.fullMessageLength.length;++n)i.putInt32(this.fullMessageLength[n]<<3|this.fullMessageLength[n+1]>>>28);this._algorithm.writeMessageLength(e,i);t=this._algorithm.digest(this.state.copy(),e),e=new r.ByteBuffer;return t.write(e),e},r.ByteBuffer=function(e){this.data="string"==typeof e?e:"",this.read=0},r.ByteBuffer.prototype.putInt32=function(e){this.data+=String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)},r.ByteBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},r.ByteBuffer.prototype.putBytes=function(e){this.data+=e},r.ByteBuffer.prototype.bytes=function(){return this.data.slice(this.read)},r.ByteBuffer.prototype.length=function(){return this.data.length-this.read},r.ByteBuffer.prototype.compact=function(){this.data=this.data.slice(this.read),this.read=0},r.ByteBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var i=this.data.charCodeAt(t);i<16&&(e+="0"),e+=i.toString(16)}return e},(p={_w:null}).Algorithm=function(){this.name="sha1",this.blockSize=64,this.digestLength=20,this.messageLengthSize=8},p.Algorithm.prototype.start=function(){return p._w||(p._w=new Array(80)),p._createState()},p.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},p.Algorithm.prototype.digest=function(e,t){for(var i,n,r,o,s,a,l,u=t.length(),c=p._w;64<=u;){for(n=e.h0,r=e.h1,o=e.h2,s=e.h3,a=e.h4,l=0;l<16;++l)i=t.getInt32(),i=(n<<5|n>>>27)+(s^r&(o^s))+a+1518500249+(c[l]=i),a=s,s=o,o=r<<30|r>>>2,r=n,n=i;for(;l<20;++l)i=c[l-3]^c[l-8]^c[l-14]^c[l-16],i=(n<<5|n>>>27)+(s^r&(o^s))+a+1518500249+(c[l]=i=i<<1|i>>>31),a=s,s=o,o=r<<30|r>>>2,r=n,n=i;for(;l<32;++l)i=c[l-3]^c[l-8]^c[l-14]^c[l-16],i=(n<<5|n>>>27)+(r^o^s)+a+1859775393+(c[l]=i=i<<1|i>>>31),a=s,s=o,o=r<<30|r>>>2,r=n,n=i;for(;l<40;++l)i=c[l-6]^c[l-16]^c[l-28]^c[l-32],i=(n<<5|n>>>27)+(r^o^s)+a+1859775393+(c[l]=i=i<<2|i>>>30),a=s,s=o,o=r<<30|r>>>2,r=n,n=i;for(;l<60;++l)i=c[l-6]^c[l-16]^c[l-28]^c[l-32],i=(n<<5|n>>>27)+(r&o|s&(r^o))+a+2400959708+(c[l]=i=i<<2|i>>>30),a=s,s=o,o=r<<30|r>>>2,r=n,n=i;for(;l<80;++l)i=c[l-6]^c[l-16]^c[l-28]^c[l-32],i=(n<<5|n>>>27)+(r^o^s)+a+3395469782+(c[l]=i=i<<2|i>>>30),a=s,s=o,o=r<<30|r>>>2,r=n,n=i;e.h0=e.h0+n|0,e.h1=e.h1+r|0,e.h2=e.h2+o|0,e.h3=e.h3+s|0,e.h4=e.h4+a|0,u-=64}return e},p._createState=function(){var t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520,copy:function(){var e=p._createState();return e.h0=t.h0,e.h1=t.h1,e.h2=t.h2,e.h3=t.h3,e.h4=t.h4,e},write:function(e){e.putInt32(t.h0),e.putInt32(t.h1),e.putInt32(t.h2),e.putInt32(t.h3),e.putInt32(t.h4)}};return t},(y={_k:null,_w:null}).Algorithm=function(){this.name="sha256",this.blockSize=64,this.digestLength=32,this.messageLengthSize=8},y.Algorithm.prototype.start=function(){return y._k||y._init(),y._createState()},y.Algorithm.prototype.writeMessageLength=function(e,t){e.putBytes(t.bytes())},y.Algorithm.prototype.digest=function(e,t){for(var i,n,r,o,s,a,l,u,c,d,h,p,f=t.length(),g=y._k,m=y._w;64<=f;){for(o=0;o<16;++o)m[o]=t.getInt32();for(;o<64;++o)i=m[o-2],n=m[o-15],m[o]=(i=(i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)+m[o-7]+(n=(n>>>7|n<<25)^(n>>>18|n<<14)^n>>>3)+m[o-16]|0;for(s=e.h0,a=e.h1,l=e.h2,u=e.h3,c=e.h4,d=e.h5,h=e.h6,p=e.h7,o=0;o<64;++o)r=s&a|l&(s^a),i=p+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(h^c&(d^h))+g[o]+m[o],p=h,h=d,d=c,c=u+i|0,u=l,l=a,s=i+(n=(((a=s)>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+r)|0;e.h0=e.h0+s|0,e.h1=e.h1+a|0,e.h2=e.h2+l|0,e.h3=e.h3+u|0,e.h4=e.h4+c|0,e.h5=e.h5+d|0,e.h6=e.h6+h|0,e.h7=e.h7+p|0,f-=64}return e},y._createState=function(){var t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225,copy:function(){var e=y._createState();return e.h0=t.h0,e.h1=t.h1,e.h2=t.h2,e.h3=t.h3,e.h4=t.h4,e.h5=t.h5,e.h6=t.h6,e.h7=t.h7,e},write:function(e){e.putInt32(t.h0),e.putInt32(t.h1),e.putInt32(t.h2),e.putInt32(t.h3),e.putInt32(t.h4),e.putInt32(t.h5),e.putInt32(t.h6),e.putInt32(t.h7)}};return t},y._init=function(){y._k=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],y._w=new Array(64)}),g||(ue=function(){g=ve("xmldom").XMLSerializer}),I.url={},I.url.parsers={simple:{keys:["href","scheme","authority","path","query","fragment"],regex:/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},full:{keys:["href","protocol","scheme","authority","auth","user","password","hostname","port","path","directory","file","query","fragment"],regex:/^(([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(?:(((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/}},I.url.parse=function(e,t){for(var i={},n=I.url.parsers[t||"full"],r=n.regex.exec(e),o=n.keys.length;o--;)i[n.keys[o]]=void 0===r[o]?null:r[o];return i.normalizedPath=de(i.path,!!i.authority),i},ge?I.useDocumentLoader("node"):"undefined"!=typeof XMLHttpRequest&&I.useDocumentLoader("xhr"),ge&&(I.use=function(e){if("request"!==e)throw new P("Unknown extension.","jsonld.UnknownExtension",{extension:e});I.request=ve("jsonld-request")},t={exports:{},filename:fe},ve("pkginfo")(t,"version"),I.version=t.exports.version),I}function t(){return e(t)}var ge=void 0!==he&&he.versions&&he.versions.node,me=!ge&&("undefined"!=typeof window||"undefined"!=typeof self);me&&void 0===pe&&("undefined"!=typeof window?pe=window:"undefined"!=typeof self?pe=self:"undefined"!=typeof $&&(pe=$)),!ge&&"function"==typeof define&&define.amd?define([],function(){return e(t),t}):(e(t),"function"==typeof ve&&void 0!==i&&i.exports&&(i.exports=t),me&&("undefined"==typeof jsonld?jsonld=jsonldjs=t:jsonldjs=t))}.call(this,ve("2ionoC"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},"/..\\node_modules\\jsonld\\js")},{"2ionoC":10,crypto:26,"es6-promise":3,http:26,"jsonld-request":26,pkginfo:26,request:26,util:26,xmldom:26}],28:[function(e,t,i){var n=e,i=t.exports={Lexer:(e=function(){})("./lib/N3Lexer"),Parser:e("./lib/N3Parser"),Writer:e("./lib/N3Writer"),Store:e("./lib/N3Store"),StreamParser:e("./lib/N3StreamParser"),StreamWriter:e("./lib/N3StreamWriter"),Util:e("./lib/N3Util")};Object.keys(i).forEach(function(e){Object.defineProperty(i,e,{configurable:!0,enumerable:!0,get:function(){return delete i[e],i[e]=n("./lib/N3"+e)}})})},{"./lib/N3Lexer":29,"./lib/N3Parser":30,"./lib/N3Store":31,"./lib/N3StreamParser":32,"./lib/N3StreamWriter":33,"./lib/N3Util":34,"./lib/N3Writer":35}],29:[function(e,t,i){var o=String.fromCharCode,s="function"==typeof setImmediate?setImmediate:function(e){setTimeout(e,0)},n=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\[uU]|\\(.)/g,a={"\\":"\\","'":"'",'"':'"',n:"\n",r:"\r",t:"\t",f:"\f",b:"\b",_:"_","~":"~",".":".","-":"-","!":"!",$:"$","&":"&","(":"(",")":")","*":"*","+":"+",",":",",";":";","=":"=","/":"/","?":"?","#":"#","@":"@","%":"%"},m=/[\x00-\x20<>\\"\{\}\|\^\`]/;function r(e){if(!(this instanceof r))return new r(e);var n;(e=e||{}).lineMode&&(this._tripleQuotedString=this._number=this._boolean=/$0^/,(n=this)._tokenize=this.tokenize,this.tokenize=function(e,i){this._tokenize(e,function(e,t){!e&&/^(?:IRI|blank|literal|langcode|typeIRI|\.|eof)$/.test(t.type)?i&&i(e,t):i&&i(e||n._syntaxError(t.type,i=null))})}),this._n3Mode=!1!==e.n3,this._comments=!!e.comments}r.prototype={_iri:/^<((?:[^ <>{}\\]|\\[uU])+)>[ \t]*/,_unescapedIri:/^<([^\x00-\x20<>\\"\{\}\|\^\`]*)>[ \t]*/,_unescapedString:/^"[^"\\\r\n]+"/,_singleQuotedString:/^"(?:[^"\\\r\n]|\\.)*"(?=[^"])|^'(?:[^'\\\r\n]|\\.)*'(?=[^'])/,_tripleQuotedString:/^""("[^"\\]*(?:(?:\\.|"(?!""))[^"\\]*)*")""|^''('[^'\\]*(?:(?:\\.|'(?!''))[^'\\]*)*')''/,_langcode:/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i,_prefix:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s<])/,_prefixed:/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}"'<]))/,_variable:/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}"'<])/,_blank:/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}"'<]))/,_number:/^[\-+]?(?:\d+\.?\d*([eE](?:[\-\+])?\d+)|\d*\.?\d+)(?=\.?[,;:\s#()\[\]\{\}"'<])/,_boolean:/^(?:true|false)(?=[.,;\s#()\[\]\{\}"'<])/,_keyword:/^@[a-z]+(?=[\s#<:])/i,_sparqlKeyword:/^(?:PREFIX|BASE|GRAPH)(?=[\s#<])/i,_shortPredicates:/^a(?=\s+|<)/,_newline:/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/,_comment:/#([^\n\r]*)/,_whitespace:/^[ \t]+/,_endOfFile:/^(?:#[^\n\r]*)?$/,_tokenizeToEnd:function(t,e){for(var i,n,r=this._input,o=this._comments;;){for(;i=this._newline.exec(r);)o&&(n=this._comment.exec(i[0]))&&t(null,{line:this._line,type:"comment",value:n[1],prefix:""}),r=r.substr(i[0].length,r.length),this._line++;if((i=this._whitespace.exec(r))&&(r=r.substr(i[0].length,r.length)),this._endOfFile.test(r))return e&&(o&&(n=this._comment.exec(r))&&t(null,{line:this._line,type:"comment",value:n[1],prefix:""}),t(r=null,{line:this._line,type:"eof",value:"",prefix:""})),this._input=r;var s,a=this._line,l="",u="",c="",d=r[0],h=null,p=0,f=!1;switch(d){case"^":if(r.length<3)break;if("^"!==r[1]){this._n3Mode&&(p=1,l="^");break}if(this._previousMarker="^^","<"!==(r=r.substr(2))[0]){f=!0;break}case"<":if(h=this._unescapedIri.exec(r))l="IRI",u=h[1];else if(h=this._iri.exec(r)){if(null===(s=this._unescape(h[1]))||m.test(s))return g(this);l="IRI",u=s}else this._n3Mode&&1<r.length&&"="===r[1]&&(l="inverse",p=2,u="http://www.w3.org/2000/10/swap/log#implies");break;case"_":((h=this._blank.exec(r))||e&&(h=this._blank.exec(r+" ")))&&(l="blank",c="_",u=h[1]);break;case'"':case"'":if(h=this._unescapedString.exec(r))l="literal",u=h[0];else if(h=this._singleQuotedString.exec(r)){if(null===(s=this._unescape(h[0])))return g(this);l="literal",u=s.replace(/^'|'$/g,'"')}else if(h=this._tripleQuotedString.exec(r)){if(s=h[1]||h[2],this._line+=s.split(/\r\n|\r|\n/).length-1,null===(s=this._unescape(s)))return g(this);l="literal",u=s.replace(/^'|'$/g,'"')}break;case"?":this._n3Mode&&(h=this._variable.exec(r))&&(l="var",u=h[0]);break;case"@":"literal"===this._previousMarker&&(h=this._langcode.exec(r))?(l="langcode",u=h[1]):(h=this._keyword.exec(r))&&(l=h[0]);break;case".":if(1===r.length?e:r[1]<"0"||"9"<r[1]){l=".",p=1;break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"+":case"-":(h=this._number.exec(r)||e&&this._number.exec(r+" "))&&(l="literal",u='"'+h[0]+'"^^http://www.w3.org/2001/XMLSchema#'+(h[1]?"double":/^[+\-]?\d+$/.test(h[0])?"integer":"decimal"));break;case"B":case"b":case"p":case"P":case"G":case"g":(h=this._sparqlKeyword.exec(r))?l=h[0].toUpperCase():f=!0;break;case"f":case"t":(h=this._boolean.exec(r))?(l="literal",u='"'+h[0]+'"^^http://www.w3.org/2001/XMLSchema#boolean'):f=!0;break;case"a":(h=this._shortPredicates.exec(r))?(l="abbreviation",u="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"):f=!0;break;case"=":this._n3Mode&&1<r.length&&(l="abbreviation",u=">"!==r[1]?(p=1,"http://www.w3.org/2002/07/owl#sameAs"):(p=2,"http://www.w3.org/2000/10/swap/log#implies"));break;case"!":if(!this._n3Mode)break;case",":case";":case"[":case"]":case"(":case")":case"{":case"}":p=1,l=d;break;default:f=!0}if(f&&("@prefix"!==this._previousMarker&&"PREFIX"!==this._previousMarker||!(h=this._prefix.exec(r))?((h=this._prefixed.exec(r))||e&&(h=this._prefixed.exec(r+" ")))&&(l="prefixed",c=h[1]||"",u=this._unescape(h[2])):(l="prefix",u=h[1]||"")),"^^"===this._previousMarker)switch(l){case"prefixed":l="type";break;case"IRI":l="typeIRI";break;default:l=""}if(!l)return e||!/^'''|^"""/.test(r)&&/\n|\r/.test(r)?g(this):this._input=r;a={line:a,type:l,value:u,prefix:c};t(null,a),this.previousToken=a,this._previousMarker=l,r=r.substr(p||h[0].length,r.length)}function g(e){t(e._syntaxError(/^\S*/.exec(r)[0]))}},_unescape:function(e){try{return e.replace(n,function(e,t,i,n){var r;if(t){if(r=parseInt(t,16),isNaN(r))throw new Error;return o(r)}if(i){if(r=parseInt(i,16),isNaN(r))throw new Error;return r<=65535?o(r):o(55296+(r-=65536)/1024,56320+(1023&r))}t=a[n];if(t)return t;throw new Error})}catch(e){return null}},_syntaxError:function(e){this._input=null;e=new Error('Unexpected "'+e+'" on line '+this._line+".");return e.context={token:void 0,line:this._line,previousToken:this.previousToken},e},tokenize:function(e,t){var i=this;if(this._line=1,"string"==typeof e){if(this._input=e,"function"!=typeof t){var n,r=[];if(this._tokenizeToEnd(function(e,t){e?n=e:r.push(t)},!0),n)throw n;return r}s(function(){i._tokenizeToEnd(t,!0)})}else this._input="","function"==typeof e.setEncoding&&e.setEncoding("utf8"),e.on("data",function(e){null!==i._input&&(i._input+=e,i._tokenizeToEnd(t,!1))}),e.on("end",function(){null!==i._input&&i._tokenizeToEnd(t,!0)}),e.on("error",t)}},t.exports=r},{}],30:[function(e,t,i){var s=e("./N3Lexer"),e="http://www.w3.org/1999/02/22-rdf-syntax-ns#",l=e+"nil",u=e+"first",c=e+"rest",n="urn:n3:quantifiers",r=/^[a-z][a-z0-9+.-]*:/i,o=/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i,a=/(?:^|\/)\.\.?(?:$|[\/#?])/,d=0,h=0;function p(e){if(!(this instanceof p))return new p(e);this._contextStack=[],this._graph=null,this._setBase((e=e||{}).documentIRI);var t="string"==typeof e.format?e.format.match(/\w*$/)[0].toLowerCase():"",i="turtle"===t,n="trig"===t,r=/triple/.test(t),o=/quad/.test(t),t=this._n3Mode=/n3/.test(t),o=r||o;(this._supportsNamedGraphs=!(i||t))||(this._readPredicateOrNamedGraph=this._readPredicate),this._supportsQuads=!(i||n||r||t),o&&(this._base="",this._resolveIRI=function(e){return this._error("Disallowed relative IRI",e),this._callback=f,this._subject=null}),this._blankNodePrefix="string"!=typeof e.blankNodePrefix?"":"_:"+e.blankNodePrefix.replace(/^_:/,""),this._lexer=e.lexer||new s({lineMode:o,n3:t}),this._explicitQuantifiers=!!e.explicitQuantifiers}function f(){}p._resetBlankNodeIds=function(){d=h=0},p.prototype={_setBase:function(e){var t;e?(0<=(t=e.indexOf("#"))&&(e=e.substr(0,t)),this._base=e,this._basePath=e.indexOf("/")<0?e:e.replace(/[^\/?]*(?:\?.*)?$/,""),e=e.match(o),this._baseRoot=e[0],this._baseScheme=e[1]):this._base=null},_saveContext:function(e,t,i,n,r){var o=this._n3Mode;this._contextStack.push({subject:i,predicate:n,object:r,graph:t,type:e,inverse:!!o&&this._inversePredicate,blankPrefix:o?this._prefixes._:"",quantified:o?this._quantified:null}),o&&(this._inversePredicate=!1,this._prefixes._=this._graph+".",this._quantified=Object.create(this._quantified))},_restoreContext:function(){var e=this._contextStack.pop(),t=this._n3Mode;this._subject=e.subject,this._predicate=e.predicate,this._object=e.object,this._graph=e.graph,t&&(this._inversePredicate=e.inverse,this._prefixes._=e.blankPrefix,this._quantified=e.quantified)},_readInTopContext:function(e){switch(e.type){case"eof":return null!==this._graph?this._error("Unclosed graph",e):(delete this._prefixes._,this._callback(null,null,this._prefixes));case"PREFIX":this._sparqlStyle=!0;case"@prefix":return this._readPrefix;case"BASE":this._sparqlStyle=!0;case"@base":return this._readBaseIRI;case"{":if(this._supportsNamedGraphs)return this._graph="",this._subject=null,this._readSubject;case"GRAPH":if(this._supportsNamedGraphs)return this._readNamedGraphLabel;default:return this._readSubject(e)}},_readEntity:function(e,t){var i;switch(e.type){case"IRI":case"typeIRI":i=null===this._base||r.test(e.value)?e.value:this._resolveIRI(e);break;case"type":case"blank":case"prefixed":var n=this._prefixes[e.prefix];if(void 0===n)return this._error('Undefined prefix "'+e.prefix+':"',e);i=n+e.value;break;case"var":return e.value;default:return this._error("Expected entity but got "+e.type,e)}return i=!t&&this._n3Mode&&i in this._quantified?this._quantified[i]:i},_readSubject:function(e){switch(this._predicate=null,e.type){case"[":return this._saveContext("blank",this._graph,this._subject="_:b"+h++,null,null),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,l,null,null),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._graph="_:b"+h++,null,null),this._readSubject):this._error("Unexpected graph",e);case"}":return this._readPunctuation(e);case"@forSome":return this._n3Mode?(this._subject=null,this._predicate="http://www.w3.org/2000/10/swap/reify#forSome",this._quantifiedPrefix="_:b",this._readQuantifierList):this._error('Unexpected "@forSome"',e);case"@forAll":return this._n3Mode?(this._subject=null,this._predicate="http://www.w3.org/2000/10/swap/reify#forAll",this._quantifiedPrefix="?b-",this._readQuantifierList):this._error('Unexpected "@forAll"',e);default:if(void 0===(this._subject=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._readPredicateOrNamedGraph)}return this._readPredicateOrNamedGraph},_readPredicate:function(e){var t=e.type;switch(t){case"inverse":this._inversePredicate=!0;case"abbreviation":this._predicate=e.value;break;case".":case"]":case"}":return null===this._predicate?this._error("Unexpected "+t,e):(this._subject=null,"]"===t?this._readBlankNodeTail(e):this._readPunctuation(e));case";":return null!==this._predicate?this._readPredicate:this._error("Expected predicate but got ;",e);case"blank":if(!this._n3Mode)return this._error("Disallowed blank node as predicate",e);default:if(void 0===(this._predicate=this._readEntity(e)))return}return this._readObject},_readObject:function(e){switch(e.type){case"literal":return this._object=e.value,this._readDataTypeOrLang;case"[":return this._saveContext("blank",this._graph,this._subject,this._predicate,this._subject="_:b"+h++),this._readBlankNodeHead;case"(":return this._saveContext("list",this._graph,this._subject,this._predicate,l),this._subject=null,this._readListItem;case"{":return this._n3Mode?(this._saveContext("formula",this._graph,this._subject,this._predicate,this._graph="_:b"+h++),this._readSubject):this._error("Unexpected graph",e);default:if(void 0===(this._object=this._readEntity(e)))return;if(this._n3Mode)return this._getPathReader(this._getContextEndReader())}return this._getContextEndReader()},_readPredicateOrNamedGraph:function(e){return"{"===e.type?this._readGraph(e):this._readPredicate(e)},_readGraph:function(e){return"{"!==e.type?this._error("Expected graph but got "+e.type,e):(this._graph=this._subject,this._subject=null,this._readSubject)},_readBlankNodeHead:function(e){return"]"===e.type?(this._subject=null,this._readBlankNodeTail(e)):(this._predicate=null,this._readPredicate(e))},_readBlankNodeTail:function(e){if("]"!==e.type)return this._readBlankNodePunctuation(e);null!==this._subject&&this._triple(this._subject,this._predicate,this._object,this._graph);e=null===this._predicate;return this._restoreContext(),null===this._object?e?this._readPredicateOrNamedGraph:this._readPredicateAfterBlank:this._getContextEndReader()},_readPredicateAfterBlank:function(e){return"."!==e.type||this._contextStack.length?this._readPredicate(e):(this._subject=null,this._readPunctuation(e))},_readListItem:function(e){var t=null,i=null,n=this._subject,r=this._contextStack,o=r[r.length-1],s=this._readListItem,a=!0;switch(e.type){case"[":this._saveContext("blank",this._graph,i="_:b"+h++,u,this._subject=t="_:b"+h++),s=this._readBlankNodeHead;break;case"(":this._saveContext("list",this._graph,i="_:b"+h++,u,l),this._subject=null;break;case")":if(this._restoreContext(),0!==r.length&&"list"===r[r.length-1].type&&this._triple(this._subject,this._predicate,this._object,this._graph),null===this._predicate){if(s=this._readPredicate,this._subject===l)return s}else if(s=this._getContextEndReader(),this._object===l)return s;i=l;break;case"literal":t=e.value,a=!1,s=this._readListItemDataTypeOrLang;break;default:if(void 0===(t=this._readEntity(e)))return}if(null===i&&(this._subject=i="_:b"+h++),null===n?null===o.predicate?o.subject=i:o.object=i:this._triple(n,c,i,this._graph),null!==t){if(this._n3Mode&&("IRI"===e.type||"prefixed"===e.type))return this._saveContext("item",this._graph,i,u,t),this._subject=t,this._predicate=null,this._getPathReader(this._readListItem);a?this._triple(i,u,t,this._graph):this._object=t}return s},_readDataTypeOrLang:function(e){return this._completeLiteral(e,!1)},_readListItemDataTypeOrLang:function(e){return this._completeLiteral(e,!0)},_completeLiteral:function(e,t){var i=!1;switch(e.type){case"type":case"typeIRI":var n=this._readEntity(e);if(void 0===n)return;i=!0,this._object+="^^"+n;break;case"langcode":i=!0,this._object+="@"+e.value.toLowerCase()}return t&&this._triple(this._subject,u,this._object,this._graph),i?this._getContextEndReader():(this._readCallback=this._getContextEndReader(),this._readCallback(e))},_readFormulaTail:function(e){return"}"!==e.type?this._readPunctuation(e):(null!==this._subject&&this._triple(this._subject,this._predicate,this._object,this._graph),this._restoreContext(),null===this._object?this._readPredicate:this._getContextEndReader())},_readPunctuation:function(e){var t,i,n,r=this._subject,o=this._graph,s=this._inversePredicate;switch(e.type){case"}":if(null===this._graph)return this._error("Unexpected graph closing",e);if(this._n3Mode)return this._readFormulaTail(e);this._graph=null;case".":this._subject=null,t=this._contextStack.length?this._readSubject:this._readInTopContext,s&&(this._inversePredicate=!1);break;case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:if(this._supportsQuads&&null===this._graph&&void 0!==(o=this._readEntity(e))){t=this._readQuadPunctuation;break}return this._error('Expected punctuation to follow "'+this._object+'"',e)}return null!==r&&(i=this._predicate,n=this._object,s?this._triple(n,i,r,o):this._triple(r,i,n,o)),t},_readBlankNodePunctuation:function(e){var t;switch(e.type){case";":t=this._readPredicate;break;case",":t=this._readObject;break;default:return this._error('Expected punctuation to follow "'+this._object+'"',e)}return this._triple(this._subject,this._predicate,this._object,this._graph),t},_readQuadPunctuation:function(e){return"."!==e.type?this._error("Expected dot to follow quad",e):this._readInTopContext},_readPrefix:function(e){return"prefix"!==e.type?this._error("Expected prefix to follow @prefix",e):(this._prefix=e.value,this._readPrefixIRI)},_readPrefixIRI:function(e){return"IRI"!==e.type?this._error('Expected IRI to follow prefix "'+this._prefix+':"',e):(e=this._readEntity(e),this._prefixes[this._prefix]=e,this._prefixCallback(this._prefix,e),this._readDeclarationPunctuation)},_readBaseIRI:function(e){return"IRI"!==e.type?this._error("Expected IRI to follow base declaration",e):(this._setBase(null===this._base||r.test(e.value)?e.value:this._resolveIRI(e)),this._readDeclarationPunctuation)},_readNamedGraphLabel:function(e){switch(e.type){case"IRI":case"blank":case"prefixed":return this._readSubject(e),this._readGraph;case"[":return this._readNamedGraphBlankLabel;default:return this._error("Invalid graph label",e)}},_readNamedGraphBlankLabel:function(e){return"]"!==e.type?this._error("Invalid graph label",e):(this._subject="_:b"+h++,this._readGraph)},_readDeclarationPunctuation:function(e){return this._sparqlStyle?(this._sparqlStyle=!1,this._readInTopContext(e)):"."!==e.type?this._error("Expected declaration to end with a dot",e):this._readInTopContext},_readQuantifierList:function(e){var t;switch(e.type){case"IRI":case"prefixed":if(void 0!==(t=this._readEntity(e,!0)))break;default:return this._error("Unexpected "+e.type,e)}return this._explicitQuantifiers?(null===this._subject?this._triple(this._graph||"",this._predicate,this._subject="_:b"+h++,n):this._triple(this._subject,c,this._subject="_:b"+h++,n),this._triple(this._subject,u,t,n)):this._quantified[t]=this._quantifiedPrefix+h++,this._readQuantifierPunctuation},_readQuantifierPunctuation:function(e){return","===e.type?this._readQuantifierList:(this._explicitQuantifiers&&(this._triple(this._subject,c,l,n),this._subject=null),this._readCallback=this._getContextEndReader(),this._readCallback(e))},_getPathReader:function(e){return this._afterPath=e,this._readPath},_readPath:function(e){switch(e.type){case"!":return this._readForwardPath;case"^":return this._readBackwardPath;default:var t=this._contextStack,t=t.length&&t[t.length-1];return t&&"item"===t.type&&(t=this._subject,this._restoreContext(),this._triple(this._subject,u,t,this._graph)),this._afterPath(e)}},_readForwardPath:function(e){var t,i="_:b"+h++;if(void 0!==(e=this._readEntity(e)))return null===this._predicate?(t=this._subject,this._subject=i):(t=this._object,this._object=i),this._triple(t,e,i,this._graph),this._readPath},_readBackwardPath:function(e){var t,i="_:b"+h++;if(void 0!==(e=this._readEntity(e)))return null===this._predicate?(t=this._subject,this._subject=i):(t=this._object,this._object=i),this._triple(i,e,t,this._graph),this._readPath},_getContextEndReader:function(){var e=this._contextStack;if(!e.length)return this._readPunctuation;switch(e[e.length-1].type){case"blank":return this._readBlankNodeTail;case"list":return this._readListItem;case"formula":return this._readFormulaTail}},_triple:function(e,t,i,n){this._callback(null,{subject:e,predicate:t,object:i,graph:n||""})},_error:function(e,t){e=new Error(e+" on line "+t.line+".");e.context={token:t,line:t.line,previousToken:this._lexer.previousToken},this._callback(e),this._callback=f},_resolveIRI:function(e){var t=e.value;switch(t[0]){case void 0:return this._base;case"#":return this._base+t;case"?":return this._base.replace(/(?:\?.*)?$/,t);case"/":return("/"===t[1]?this._baseScheme:this._baseRoot)+this._removeDotSegments(t);default:return this._removeDotSegments(this._basePath+t)}},_removeDotSegments:function(e){if(!a.test(e))return e;for(var t="",i=e.length,n=-1,r=-1,o=0,s="/";n<i;){switch(s){case":":if(r<0&&"/"===e[++n]&&"/"===e[++n])for(;(r=n+1)<i&&"/"!==e[r];)n=r;break;case"?":case"#":n=i;break;case"/":if("."===e[n+1])switch(s=e[++n+1]){case"/":t+=e.substring(o,n-1),o=n+1;break;case void 0:case"?":case"#":return t+e.substring(o,n)+e.substr(n+1);case".":if(void 0===(s=e[++n+1])||"/"===s||"?"===s||"#"===s){if((o=(t+=e.substring(o,n-2)).lastIndexOf("/"))>=r&&(t=t.substr(0,o)),"/"!==s)return t+"/"+e.substr(n+1);o=n+1}}}s=e[++n]}return t+e.substring(o)},parse:function(e,t,i){var n=this;if(this._readCallback=this._readInTopContext,this._sparqlStyle=!1,this._prefixes=Object.create(null),this._prefixes._=this._blankNodePrefix||"_:b"+d+++"_",this._prefixCallback=i||f,this._inversePredicate=!1,this._quantified=Object.create(null),!t){var r,o=[];if(this._callback=function(e,t){e?r=e:t&&o.push(t)},this._lexer.tokenize(e).every(function(e){return n._readCallback=n._readCallback(e)}),r)throw r;return o}this._callback=t,this._lexer.tokenize(e,function(e,t){null!==e?(n._callback(e),n._callback=f):n._readCallback&&(n._readCallback=n._readCallback(t))})}},t.exports=p},{"./N3Lexer":29}],31:[function(e,t,i){var s=e("./N3Util").expandPrefixedName;function n(e,t){if(!(this instanceof n))return new n(e,t);this._size=0,this._graphs=Object.create(null),this._id=0,this._ids=Object.create(null),this._ids["><"]=0,this._entities=Object.create(null),this._blankNodeIndex=0,t||!e||e[0]||(t=e,e=null),t=t||{},this._prefixes=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes),e&&this.addTriples(e)}function d(e){return"string"==typeof e||e instanceof String}n.prototype={get size(){if(null!==(n=this._size))return n;var e,t,i,n=0,r=this._graphs;for(i in r)for(var o in e=r[i].subjects)for(var s in t=e[o])n+=Object.keys(t[s]).length;return this._size=n},_addToIndex:function(e,t,i,n){e=e[t]||(e[t]={}),t=e[i]||(e[i]={}),e=n in t;return e||(t[n]=null),!e},_removeFromIndex:function(e,t,i,n){var r,o=e[t],s=o[i];for(r in delete s[n],s)return;for(r in delete o[i],o)return;delete e[t]},_findInIndex:function(e,t,i,n,r,o,s,a,l,u){var c,d,h,p=1<!t+!i+!n?Object.keys(this._ids):this._entities;for(h in t&&(c=e,(e={})[t]=c[t]),e){var f=p[h];if(d=e[h])for(var g in i&&(c=d,(d={})[i]=c[i]),d){var m=p[g];if(g=d[g])for(var v=(n?n in g?[n]:[]:Object.keys(g)),y=v.length-1;0<=y;y--){var b={subject:"",predicate:"",object:"",graph:a};if(b[r]=f,b[o]=m,b[s]=p[v[y]],u)u.push(b);else if(l(b))return!0}}}return u},_loop:function(e,t){for(var i in e)t(i)},_loopByKey0:function(e,t,i){if(e=e[t])for(var n in e)i(n)},_loopByKey1:function(e,t,i){for(var n in e)e[n][t]&&i(n)},_loopBy2Keys:function(e,t,i,n){if((e=e[t])&&(t=e[i]))for(var r in t)n(r)},_countInIndex:function(e,t,i,n){var r,o,s,a=0;for(s in t&&(r=e,(e={})[t]=r[t]),e)if(o=e[s])for(var l in i&&(r=o,(o={})[i]=r[i]),o)(l=o[l])&&(n?n in l&&a++:a+=Object.keys(l).length);return a},_getGraphs:function(e){var t;return d(e)?((t={})[e]=this._graphs[e],t):this._graphs},_uniqueEntities:function(t){var i=Object.create(null),n=this._entities;return function(e){e in i||(i[e]=!0,t(n[e]))}},addTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject);var r=this._graphs[n=n||""],n=(r||(r=this._graphs[n]={subjects:{},predicates:{},objects:{}},Object.freeze(r)),this._ids),o=this._entities,n=(e=n[e]||(n[o[++this._id]=e]=this._id),t=n[t]||(n[o[++this._id]=t]=this._id),i=n[i]||(n[o[++this._id]=i]=this._id),this._addToIndex(r.subjects,e,t,i));return this._addToIndex(r.predicates,t,i,e),this._addToIndex(r.objects,i,e,t),this._size=null,n},addTriples:function(e){for(var t=e.length-1;0<=t;t--)this.addTriple(e[t])},addPrefix:function(e,t){this._prefixes[e]=t},addPrefixes:function(e){for(var t in e)this.addPrefix(t,e[t])},removeTriple:function(e,t,i,n){t||(n=e.graph,i=e.object,t=e.predicate,e=e.subject),n=n||"";var r,o=this._ids,s=this._graphs;if(!((e=o[e])&&(t=o[t])&&(i=o[i])&&(r=s[n])&&(o=r.subjects[e])&&(o=o[t])&&i in o))return!1;for(e in this._removeFromIndex(r.subjects,e,t,i),this._removeFromIndex(r.predicates,t,i,e),this._removeFromIndex(r.objects,i,e,t),null!==this._size&&this._size--,r.subjects)return!0;return delete s[n],!0},removeTriples:function(e){for(var t=e.length-1;0<=t;t--)this.removeTriple(e[t])},getTriples:function(e,t,i,n){var r=this._prefixes;return this.getTriplesByIRI(s(e,r),s(t,r),s(i,r),s(n,r))},getTriplesByIRI:function(e,t,i,n){var r,o,s,a,l=[],u=this._getGraphs(n),n=this._ids;if(!(d(e)&&!(o=n[e])||d(t)&&!(s=n[t])||d(i)&&!(a=n[i])))for(var c in u)(r=u[c])&&(o?a?this._findInIndex(r.objects,a,o,s,"object","subject","predicate",c,null,l):this._findInIndex(r.subjects,o,s,null,"subject","predicate","object",c,null,l):s?this._findInIndex(r.predicates,s,a,null,"predicate","object","subject",c,null,l):a?this._findInIndex(r.objects,a,null,null,"object","subject","predicate",c,null,l):this._findInIndex(r.subjects,null,null,null,"subject","predicate","object",c,null,l));return l},countTriples:function(e,t,i,n){var r=this._prefixes;return this.countTriplesByIRI(s(e,r),s(t,r),s(i,r),s(n,r))},countTriplesByIRI:function(e,t,i,n){var r,o,s,a,l,u=0,c=this._getGraphs(n),n=this._ids;if(d(e)&&!(o=n[e])||d(t)&&!(s=n[t])||d(i)&&!(a=n[i]))return 0;for(l in c)(r=c[l])&&(u+=e?i?this._countInIndex(r.objects,a,o,s):this._countInIndex(r.subjects,o,s,a):t?this._countInIndex(r.predicates,s,a,o):this._countInIndex(r.objects,a,o,s));return u},forEach:function(e,t,i,n,r){var o=this._prefixes;this.forEachByIRI(e,s(t,o),s(i,o),s(n,o),s(r,o))},forEachByIRI:function(t,e,i,n,r){this.someByIRI(function(e){return t(e),!1},e,i,n,r)},every:function(e,t,i,n,r){var o=this._prefixes;return this.everyByIRI(e,s(t,o),s(i,o),s(n,o),s(r,o))},everyByIRI:function(t,e,i,n,r){var o=!1,e=!this.someByIRI(function(e){return o=!0,!t(e)},e,i,n,r);return o&&e},some:function(e,t,i,n,r){var o=this._prefixes;return this.someByIRI(e,s(t,o),s(i,o),s(n,o),s(r,o))},someByIRI:function(e,t,i,n,r){var o,s,a,l,u=this._getGraphs(r),r=this._ids;if(!(d(t)&&!(s=r[t])||d(i)&&!(a=r[i])||d(n)&&!(l=r[n])))for(var c in u)if(o=u[c])if(s){if(l){if(this._findInIndex(o.objects,l,s,a,"object","subject","predicate",c,e,null))return!0}else if(this._findInIndex(o.subjects,s,a,null,"subject","predicate","object",c,e,null))return!0}else if(a){if(this._findInIndex(o.predicates,a,l,null,"predicate","object","subject",c,e,null))return!0}else if(l){if(this._findInIndex(o.objects,l,null,null,"object","subject","predicate",c,e,null))return!0}else if(this._findInIndex(o.subjects,null,null,null,"subject","predicate","object",c,e,null))return!0;return!1},getSubjects:function(e,t,i){var n=this._prefixes;return this.getSubjectsByIRI(s(e,n),s(t,n),s(i,n))},getSubjectsByIRI:function(e,t,i){var n=[];return this.forSubjectsByIRI(function(e){n.push(e)},e,t,i),n},forSubjects:function(e,t,i,n){var r=this._prefixes;this.forSubjectsByIRI(e,s(t,r),s(i,r),s(n,r))},forSubjectsByIRI:function(e,t,i,n){var r,o,s,a=this._ids,l=this._getGraphs(n);if(e=this._uniqueEntities(e),!(d(t)&&!(o=a[t])||d(i)&&!(s=a[i])))for(n in l)(r=l[n])&&(o?s?this._loopBy2Keys(r.predicates,o,s,e):this._loopByKey1(r.subjects,o,e):s?this._loopByKey0(r.objects,s,e):this._loop(r.subjects,e))},getPredicates:function(e,t,i){var n=this._prefixes;return this.getPredicatesByIRI(s(e,n),s(t,n),s(i,n))},getPredicatesByIRI:function(e,t,i){var n=[];return this.forPredicatesByIRI(function(e){n.push(e)},e,t,i),n},forPredicates:function(e,t,i,n){var r=this._prefixes;this.forPredicatesByIRI(e,s(t,r),s(i,r),s(n,r))},forPredicatesByIRI:function(e,t,i,n){var r,o,s,a=this._ids,l=this._getGraphs(n);if(e=this._uniqueEntities(e),!(d(t)&&!(o=a[t])||d(i)&&!(s=a[i])))for(n in l)(r=l[n])&&(o?s?this._loopBy2Keys(r.objects,s,o,e):this._loopByKey0(r.subjects,o,e):s?this._loopByKey1(r.predicates,s,e):this._loop(r.predicates,e))},getObjects:function(e,t,i){var n=this._prefixes;return this.getObjectsByIRI(s(e,n),s(t,n),s(i,n))},getObjectsByIRI:function(e,t,i){var n=[];return this.forObjectsByIRI(function(e){n.push(e)},e,t,i),n},forObjects:function(e,t,i,n){var r=this._prefixes;this.forObjectsByIRI(e,s(t,r),s(i,r),s(n,r))},forObjectsByIRI:function(e,t,i,n){var r,o,s,a=this._ids,l=this._getGraphs(n);if(e=this._uniqueEntities(e),!(d(t)&&!(o=a[t])||d(i)&&!(s=a[i])))for(n in l)(r=l[n])&&(o?s?this._loopBy2Keys(r.subjects,o,s,e):this._loopByKey1(r.objects,o,e):s?this._loopByKey0(r.predicates,s,e):this._loop(r.objects,e))},getGraphs:function(e,t,i){var n=this._prefixes;return this.getGraphsByIRI(s(e,n),s(t,n),s(i,n))},getGraphsByIRI:function(e,t,i){var n=[];return this.forGraphsByIRI(function(e){n.push(e)},e,t,i),n},forGraphs:function(e,t,i,n){var r=this._prefixes;this.forGraphsByIRI(e,s(t,r),s(i,r),s(n,r))},forGraphsByIRI:function(t,e,i,n){for(var r in this._graphs)this.someByIRI(function(e){return t(e.graph),!0},e,i,n,r)},createBlankNode:function(e){var t,i;if(e)for(t=e="_:"+e,i=1;this._ids[t];)t=e+i++;else for(;t="_:b"+this._blankNodeIndex++,this._ids[t];);return this._ids[t]=++this._id,this._entities[this._id]=t}},t.exports=n},{"./N3Util":34}],32:[function(e,t,i){var o=e("stream").Transform,n=e("util"),s=e("./N3Parser.js");function a(e){if(!(this instanceof a))return new a(e);o.call(this,{decodeStrings:!0}),this._readableState.objectMode=!0;var n,i,r=this;new s(e).parse({on:function(e,t){switch(e){case"data":n=t;break;case"end":i=t}}},function(e,t){e&&r.emit("error",e)||t&&r.push(t)},function(e,t){r.emit("prefix",e,t)}),this._transform=function(e,t,i){n(e),i()},this._flush=function(e){i(),e()}}n.inherits(a,o),t.exports=a},{"./N3Parser.js":30,stream:16,util:38}],33:[function(e,t,i){var o=e("stream").Transform,n=e("util"),s=e("./N3Writer.js");function a(e){if(!(this instanceof a))return new a(e);o.call(this,{encoding:"utf8"}),this._writableState.objectMode=!0;var n=this,r=new s({write:function(e,t,i){n.push(e),i&&i()},end:function(e){n.push(null),e&&e()}},e);this._transform=function(e,t,i){r.addTriple(e,i)},this._flush=function(e){r.end(e)}}n.inherits(a,o),t.exports=a},{"./N3Writer.js":35,stream:16,util:38}],34:[function(e,t,i){var n="http://www.w3.org/2001/XMLSchema#",r=n+"double",o={isIRI:function(e){return"string"==typeof e&&(0===e.length||'"'!==(e=e[0])&&"_"!==e)},isLiteral:function(e){return"string"==typeof e&&'"'===e[0]},isBlank:function(e){return"string"==typeof e&&"_:"===e.substr(0,2)},isDefaultGraph:function(e){return!e},inDefaultGraph:function(e){return!e.graph},getLiteralValue:function(e){var t=/^"([^]*)"/.exec(e);if(t)return t[1];throw new Error(e+" is not a literal")},getLiteralType:function(e){var t=/^"[^]*"(?:\^\^([^"]+)|(@)[^@"]+)?$/.exec(e);if(t)return t[1]||(t[2]?"http://www.w3.org/1999/02/22-rdf-syntax-ns#langString":"http://www.w3.org/2001/XMLSchema#string");throw new Error(e+" is not a literal")},getLiteralLanguage:function(e){var t=/^"[^]*"(?:@([^@"]+)|\^\^[^"]+)?$/.exec(e);if(t)return t[1]?t[1].toLowerCase():"";throw new Error(e+" is not a literal")},isPrefixedName:function(e){return"string"==typeof e&&/^[^:\/"']*:[^:\/"']+$/.test(e)},expandPrefixedName:function(e,t){var i,n,r,o=/(?:^|"\^\^)([^:\/#"'\^_]*):[^\/]*$/.exec(e);return o&&(n=t[i=o[1]],r=o.index),void 0===n?e:0===r?n+e.substr(i.length+1):e.substr(0,r+3)+n+e.substr(r+i.length+4)},createIRI:function(e){return e&&'"'===e[0]?o.getLiteralValue(e):e},createLiteral:function(e,t){if(!t)switch(typeof e){case"boolean":t="http://www.w3.org/2001/XMLSchema#boolean";break;case"number":isFinite(e)?t=e%1==0?"http://www.w3.org/2001/XMLSchema#integer":r:(t=r,isNaN(e)||(e=0<e?"INF":"-INF"));break;default:return'"'+e+'"'}return'"'+e+(/^[a-z]+(-[a-z0-9]+)*$/i.test(t)?'"@'+t.toLowerCase():'"^^'+t)},prefix:function(e){return o.prefixes({"":e})("")},prefixes:function(e){var t,n=Object.create(null);for(t in e)i(t,e[t]);function i(e,t){var i;return!t&&e in n||(i=Object.create(null),t=t||"",n[e]=function(e){return i[e]||(i[e]=t+e)}),n[e]}return i}};t.exports=o},{}],35:[function(e,t,i){var n=/^"([^]*)"(?:\^\^(.+)|@([a-z]+(?:-[a-z0-9]+)*))?$/i,r=/["\\\t\n\r\b\f\u0000-\u0019\ud800-\udbff]/,o=/["\\\t\n\r\b\f\u0000-\u0019]|[\ud800-\udbff][\udc00-\udfff]/g,s={"\\":"\\\\",'"':'\\"',"\t":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};function a(e,t){if(!(this instanceof a))return new a(e,t);var n;e&&"function"!=typeof e.write&&(t=e,e=null),t=t||{},e?(this._outputStream=e,this._endStream=void 0===t.end||!!t.end):(n="",this._outputStream={write:function(e,t,i){n+=e,i&&i()},end:function(e){e&&e(null,n)}},this._endStream=!0),this._subject=null,/triple|quad/i.test(t.format)?this._writeTriple=this._writeTripleLine:(this._graph="",this._prefixIRIs=Object.create(null),t.prefixes&&this.addPrefixes(t.prefixes))}function l(e){var t=s[e];return t=void 0===t?1===e.length?(t=e.charCodeAt(0).toString(16),"\\u0000".substr(0,6-t.length)+t):(t=(1024*(e.charCodeAt(0)-55296)+e.charCodeAt(1)+9216).toString(16),"\\U00000000".substr(0,10-t.length)+t):t}a.prototype={_write:function(e,t){this._outputStream.write(e,"utf8",t)},_writeTriple:function(e,t,i,n,r){try{this._graph!==n&&(this._write((null===this._subject?"":this._graph?"\n}\n":".\n")+(n?this._encodeIriOrBlankNode(n)+" {\n":"")),this._subject=null,this._graph="["!==n[0]?n:"]"),this._subject===e?this._predicate===t?this._write(", "+this._encodeObject(i),r):this._write(";\n    "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(i),r):this._write((null===this._subject?"":".\n")+this._encodeSubject(this._subject=e)+" "+this._encodePredicate(this._predicate=t)+" "+this._encodeObject(i),r)}catch(e){r&&r(e)}},_writeTripleLine:function(e,t,i,n,r){delete this._prefixMatch;try{this._write(this.tripleToString(e,t,i,n),r)}catch(e){r&&r(e)}},tripleToString:function(e,t,i,n){return this._encodeIriOrBlankNode(e)+" "+this._encodeIriOrBlankNode(t)+" "+this._encodeObject(i)+(n?" "+this._encodeIriOrBlankNode(n)+".\n":".\n")},triplesToString:function(e){return e.map(function(e){return this.tripleToString(e.subject,e.predicate,e.object,e.graph)},this).join("")},_encodeIriOrBlankNode:function(e){var t=e[0];if("["===t||"("===t||"_"===t&&":"===e[1])return e;r.test(e)&&(e=e.replace(o,l));t=this._prefixRegex.exec(e);return t?t[1]?this._prefixIRIs[t[1]]+t[2]:e:"<"+e+">"},_encodeLiteral:function(e,t,i){return r.test(e)&&(e=e.replace(o,l)),i?'"'+e+'"@'+i:t?'"'+e+'"^^'+this._encodeIriOrBlankNode(t):'"'+e+'"'},_encodeSubject:function(e){if('"'===e[0])throw new Error("A literal as subject is not allowed: "+e);return"["===e[0]&&(this._subject="]"),this._encodeIriOrBlankNode(e)},_encodePredicate:function(e){if('"'===e[0])throw new Error("A literal as predicate is not allowed: "+e);return"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===e?"a":this._encodeIriOrBlankNode(e)},_encodeObject:function(e){if('"'!==e[0])return this._encodeIriOrBlankNode(e);var t=n.exec(e);if(t)return this._encodeLiteral(t[1],t[2],t[3]);throw new Error("Invalid literal: "+e)},_blockedWrite:function(){throw new Error("Cannot write because the writer has been closed.")},addTriple:function(e,t,i,n,r){void 0===i?this._writeTriple(e.subject,e.predicate,e.object,e.graph||"",t):"string"!=typeof n?this._writeTriple(e,t,i,"",n):this._writeTriple(e,t,i,n,r)},addTriples:function(e){for(var t=0;t<e.length;t++)this.addTriple(e[t])},addPrefix:function(e,t,i){var n={};n[e]=t,this.addPrefixes(n,i)},addPrefixes:function(e,t){var i,n=this._prefixIRIs,r=!1;for(i in e){var o=e[i];/[#\/]$/.test(o)&&n[o]!==(i+=":")&&(r=!0,n[o]=i,null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null,this._graph=""),this._write("@prefix "+i+" <"+o+">.\n"))}if(r){var s,a="",l="";for(s in n)a+=a?"|"+s:s,l+=(l?"|":"")+n[s];a=a.replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&"),this._prefixRegex=new RegExp("^(?:"+l+")[^/]*$|^("+a+")([a-zA-Z][\\-_a-zA-Z0-9]*)$")}this._write(r?"\n":"",t)},blank:function(e,t){var i,n,r=e;switch(void 0===e?r=[]:"string"==typeof e?r=[{predicate:e,object:t}]:"length"in e||(r=[e]),n=r.length){case 0:return"[]";case 1:if("["!==(i=r[0]).object[0])return"[ "+this._encodePredicate(i.predicate)+" "+this._encodeObject(i.object)+" ]";default:for(var o="[",s=0;s<n;s++)(i=r[s]).predicate===e?o+=", "+this._encodeObject(i.object):(o+=(s?";\n  ":"\n  ")+this._encodePredicate(i.predicate)+" "+this._encodeObject(i.object),e=i.predicate);return o+"\n]"}},list:function(e){for(var t=e&&e.length||0,i=new Array(t),n=0;n<t;n++)i[n]=this._encodeObject(e[n]);return"("+i.join(" ")+")"},_prefixRegex:/$0^/,end:function(i){null!==this._subject&&(this._write(this._graph?"\n}\n":".\n"),this._subject=null),this._write=this._blockedWrite;var n=i&&function(e,t){n=null,i(e,t)};if(this._endStream)try{return this._outputStream.end(n)}catch(e){}n&&n()}},t.exports=a},{}],36:[function(e,t,i){var C=e("punycode");function h(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}i.parse=r,i.resolve=function(e,t){return r(e,!1,!0).resolve(t)},i.resolveObject=function(e,t){return e?r(e,!1,!0).resolveObject(t):t},i.format=function(e){N(e)&&(e=r(e));return e instanceof h?e.format():h.prototype.format.call(e)},i.Url=h;var E=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,i=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),F=["'"].concat(i),T=["%","/","?",";","#"].concat(F),D=["/","?","#"],S=/^[a-z0-9A-Z_-]{0,63}$/,R=/^([a-z0-9A-Z_-]{0,63})(.*)$/,j={javascript:!0,"javascript:":!0},I={javascript:!0,"javascript:":!0},A={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},O=e("querystring");function r(e,t,i){var n;return e&&s(e)&&e instanceof h?e:((n=new h).parse(e,t,i),n)}function N(e){return"string"==typeof e}function s(e){return"object"==typeof e&&null!==e}function p(e){return null===e}h.prototype.parse=function(e,t,i){if(!N(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n,r=(r=e).trim(),e=E.exec(r);if(e&&(n=(e=e[0]).toLowerCase(),this.protocol=n,r=r.substr(e.length)),!(i||e||r.match(/^\/\/[^@\/]+@[^@\/]+/))||!(k="//"===r.substr(0,2))||e&&I[e]||(r=r.substr(2),this.slashes=!0),!I[e]&&(k||e&&!A[e])){for(var o=-1,s=0;s<D.length;s++)-1!==(a=r.indexOf(D[s]))&&(-1===o||a<o)&&(o=a);-1!==(i=-1===o?r.lastIndexOf("@"):r.lastIndexOf("@",o))&&(k=r.slice(0,i),r=r.slice(i+1),this.auth=decodeURIComponent(k));for(var a,o=-1,s=0;s<T.length;s++)-1!==(a=r.indexOf(T[s]))&&(-1===o||a<o)&&(o=a);-1===o&&(o=r.length),this.host=r.slice(0,o),r=r.slice(o),this.parseHost(),this.hostname=this.hostname||"";e="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!e)for(var l=this.hostname.split(/\./),s=0,u=l.length;s<u;s++){var c=l[s];if(c&&!c.match(S)){for(var d="",h=0,p=c.length;h<p;h++)127<c.charCodeAt(h)?d+="x":d+=c[h];if(!d.match(S)){var f=l.slice(0,s),g=l.slice(s+1),m=c.match(R);m&&(f.push(m[1]),g.unshift(m[2])),g.length&&(r="/"+g.join(".")+r),this.hostname=f.join(".");break}}}if(255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),!e){for(var v=this.hostname.split("."),y=[],s=0;s<v.length;++s){var b=v[s];y.push(b.match(/[^A-Za-z0-9_-]/)?"xn--"+C.encode(b):b)}this.hostname=y.join(".")}var w=this.port?":"+this.port:"",i=this.hostname||"";this.host=i+w,this.href+=this.host,e&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==r[0])&&(r="/"+r)}if(!j[n])for(s=0,u=F.length;s<u;s++){var x=F[s],_=encodeURIComponent(x);_===x&&(_=escape(x)),r=r.split(x).join(_)}var k=r.indexOf("#"),i=(-1!==k&&(this.hash=r.substr(k),r=r.slice(0,k)),r.indexOf("?"));return-1!==i?(this.search=r.substr(i),this.query=r.substr(i+1),t&&(this.query=O.parse(this.query)),r=r.slice(0,i)):t&&(this.search="",this.query={}),r&&(this.pathname=r),A[n]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(w=this.pathname||"",b=this.search||"",this.path=w+b),this.href=this.format(),this},h.prototype.format=function(){var e=this.auth||"",t=(e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@"),this.protocol||""),i=this.pathname||"",n=this.hash||"",r=!1,o="",e=(this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port)&&(r+=":"+this.port),this.query&&s(this.query)&&Object.keys(this.query).length&&(o=O.stringify(this.query)),this.search||o&&"?"+o||"");return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||A[t])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r=r||"",n&&"#"!==n.charAt(0)&&(n="#"+n),e&&"?"!==e.charAt(0)&&(e="?"+e),t+r+(i=i.replace(/[?#]/g,function(e){return encodeURIComponent(e)}))+(e=e.replace("#","%23"))+n},h.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},h.prototype.resolveObject=function(t){N(t)&&((n=new h).parse(t,!1,!0),t=n);var i=new h;if(Object.keys(this).forEach(function(e){i[e]=this[e]},this),i.hash=t.hash,""!==t.href)if(t.slashes&&!t.protocol)Object.keys(t).forEach(function(e){"protocol"!==e&&(i[e]=t[e])}),A[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/");else if(t.protocol&&t.protocol!==i.protocol)if(A[t.protocol]){if(i.protocol=t.protocol,t.host||I[t.protocol])i.pathname=t.pathname;else{for(var e=(t.pathname||"").split("/");e.length&&!(t.host=e.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==e[0]&&e.unshift(""),e.length<2&&e.unshift(""),i.pathname=e.join("/")}i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,(i.pathname||i.search)&&(n=i.pathname||"",r=i.search||"",i.path=n+r),i.slashes=i.slashes||t.slashes}else Object.keys(t).forEach(function(e){i[e]=t[e]});else{var n=i.pathname&&"/"===i.pathname.charAt(0),r=t.host||t.pathname&&"/"===t.pathname.charAt(0),n=r||n||i.host&&t.pathname,o=n,s=i.pathname&&i.pathname.split("/")||[],e=t.pathname&&t.pathname.split("/")||[],a=i.protocol&&!A[i.protocol];if(a&&(i.hostname="",i.port=null,i.host&&(""===s[0]?s[0]=i.host:s.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===e[0]?e[0]=t.host:e.unshift(t.host)),t.host=null),n=n&&(""===e[0]||""===s[0])),r)i.host=(t.host||""===t.host?t:i).host,i.hostname=(t.hostname||""===t.hostname?t:i).hostname,i.search=t.search,i.query=t.query,s=e;else if(e.length)(s=s||[]).pop(),s=s.concat(e),i.search=t.search,i.query=t.query;else if(null!=t.search)return a&&(i.hostname=i.host=s.shift(),d=!!(i.host&&0<i.host.indexOf("@"))&&i.host.split("@"))&&(i.auth=d.shift(),i.host=i.hostname=d.shift()),i.search=t.search,i.query=t.query,p(i.pathname)&&p(i.search)||(i.path=(i.pathname||"")+(i.search||"")),i.href=i.format(),i;if(s.length){for(var l=s.slice(-1)[0],r=(i.host||t.host)&&("."===l||".."===l)||""===l,u=0,c=s.length;0<=c;c--)"."==(l=s[c])?s.splice(c,1):".."===l?(s.splice(c,1),u++):u&&(s.splice(c,1),u--);if(!n&&!o)for(;u--;)s.unshift("..");!n||""===s[0]||s[0]&&"/"===s[0].charAt(0)||s.unshift(""),r&&"/"!==s.join("/").substr(-1)&&s.push("");var d,o=""===s[0]||s[0]&&"/"===s[0].charAt(0);a&&(i.hostname=i.host=!o&&s.length?s.shift():"",d=!!(i.host&&0<i.host.indexOf("@"))&&i.host.split("@"))&&(i.auth=d.shift(),i.host=i.hostname=d.shift()),(n=n||i.host&&s.length)&&!o&&s.unshift(""),s.length?i.pathname=s.join("/"):(i.pathname=null,i.path=null),p(i.pathname)&&p(i.search)||(i.path=(i.pathname||"")+(i.search||"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes}else i.pathname=null,i.search?i.path="/"+i.search:i.path=null}return i.href=i.format(),i},h.prototype.parseHost=function(){var e=this.host,t=n.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:11,querystring:14}],37:[function(e,t,i){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],38:[function(F,e,T){!function(n,r){var e,a=/%[sdj%]/g,o=(T.format=function(e){if(!v(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(l(arguments[i]));return t.join(" ")}for(var i=1,n=arguments,r=n.length,o=String(e).replace(a,function(e){if("%%"===e)return"%";if(r<=i)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}default:return e}}),s=n[i];i<r;s=n[++i])g(s)||!w(s)?o+=" "+s:o+=" "+l(s);return o},T.deprecate=function(e,t){var i;return y(r.process)?function(){return T.deprecate(e,t).apply(this,arguments)}:!0===n.noDeprecation?e:(i=!1,function(){if(!i){if(n.throwDeprecation)throw new Error(t);n.traceDeprecation?console.trace(t):console.error(t),i=!0}return e.apply(this,arguments)})},{});function l(e,t){var i={seen:[],stylize:u};return 3<=arguments.length&&(i.depth=arguments[2]),4<=arguments.length&&(i.colors=arguments[3]),f(t)?i.showHidden=t:t&&T._extend(i,t),y(i.showHidden)&&(i.showHidden=!1),y(i.depth)&&(i.depth=2),y(i.colors)&&(i.colors=!1),y(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=s),c(i,e,i.depth)}function s(e,t){t=l.styles[t];return t?"["+l.colors[t][0]+"m"+e+"["+l.colors[t][1]+"m":e}function u(e,t){return e}function c(t,i,n){if(t.customInspect&&i&&k(i.inspect)&&i.inspect!==T.inspect&&(!i.constructor||i.constructor.prototype!==i))return v(e=i.inspect(n,t))?e:c(t,e,n);var e=function(e,t){if(y(t))return e.stylize("undefined","undefined");{var i;if(v(t))return i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'",e.stylize(i,"string")}return m(t)?e.stylize(""+t,"number"):f(t)?e.stylize(""+t,"boolean"):g(t)?e.stylize("null","null"):void 0}(t,i);if(e)return e;var r,e=Object.keys(i),o=(r={},e.forEach(function(e,t){r[e]=!0}),r);if(t.showHidden&&(e=Object.getOwnPropertyNames(i)),_(i)&&(0<=e.indexOf("message")||0<=e.indexOf("description")))return d(i);if(0===e.length){if(k(i))return s=i.name?": "+i.name:"",t.stylize("[Function"+s+"]","special");if(b(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(x(i))return t.stylize(Date.prototype.toString.call(i),"date");if(_(i))return d(i)}var s="",a=!1,l=["{","}"];if(p(i)&&(a=!0,l=["[","]"]),k(i)&&(s=" [Function"+(i.name?": "+i.name:"")+"]"),b(i)&&(s=" "+RegExp.prototype.toString.call(i)),x(i)&&(s=" "+Date.prototype.toUTCString.call(i)),_(i)&&(s=" "+d(i)),0===e.length&&(!a||0==i.length))return l[0]+s+l[1];if(n<0)return b(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special");t.seen.push(i),u=a?function(t,i,n,r,e){for(var o=[],s=0,a=i.length;s<a;++s)E(i,String(s))?o.push(h(t,i,n,r,String(s),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(h(t,i,n,r,e,!0))}),o}(t,i,n,o,e):e.map(function(e){return h(t,i,n,o,e,a)}),t.seen.pop();var u;return 60<u.reduce(function(e,t){return 0<=t.indexOf("\n")&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?l[0]+(""===s?"":s+"\n ")+" "+u.join(",\n  ")+" "+l[1]:l[0]+s+" "+u.join(", ")+" "+l[1]}function d(e){return"["+Error.prototype.toString.call(e)+"]"}function h(e,t,i,n,r,o){var s,a,t=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]};if(t.get?a=t.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):t.set&&(a=e.stylize("[Setter]","special")),E(n,r)||(s="["+r+"]"),a||(e.seen.indexOf(t.value)<0?-1<(a=g(i)?c(e,t.value,null):c(e,t.value,i-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),y(s)){if(o&&r.match(/^\d+$/))return a;s=(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),e.stylize(s,"string"))}return s+": "+a}function p(e){return Array.isArray(e)}function f(e){return"boolean"==typeof e}function g(e){return null===e}function m(e){return"number"==typeof e}function v(e){return"string"==typeof e}function y(e){return void 0===e}function b(e){return w(e)&&"[object RegExp]"===t(e)}function w(e){return"object"==typeof e&&null!==e}function x(e){return w(e)&&"[object Date]"===t(e)}function _(e){return w(e)&&("[object Error]"===t(e)||e instanceof Error)}function k(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function i(e){return e<10?"0"+e.toString(10):e.toString(10)}T.debuglog=function(t){var i;return y(e)&&(e=n.env.NODE_DEBUG||""),t=t.toUpperCase(),o[t]||(new RegExp("\\b"+t+"\\b","i").test(e)?(i=n.pid,o[t]=function(){var e=T.format.apply(T,arguments);console.error("%s %d: %s",t,i,e)}):o[t]=function(){}),o[t]},(T.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},T.isArray=p,T.isBoolean=f,T.isNull=g,T.isNullOrUndefined=function(e){return null==e},T.isNumber=m,T.isString=v,T.isSymbol=function(e){return"symbol"==typeof e},T.isUndefined=y,T.isRegExp=b,T.isObject=w,T.isDate=x,T.isError=_,T.isFunction=k,T.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},T.isBuffer=F("./support/isBuffer");var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(e,t){return Object.prototype.hasOwnProperty.call(e,t)}T.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[i(e.getHours()),i(e.getMinutes()),i(e.getSeconds())].join(":"),[e.getDate(),C[e.getMonth()],t].join(" ")),T.format.apply(T,arguments))},T.inherits=F("inherits"),T._extend=function(e,t){if(t&&w(t))for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e}}.call(this,F("2ionoC"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":37,"2ionoC":10,inherits:25}],39:[function(e,t,i){var n=e("./parser"),a=e("./utils"),c=a;function u(e,t){this.name="NonSupportedSparqlFeatureError",this.feature=e,this.message=t||"SPARQL feature "+e+" non supported"}function r(e){this.name=ParserError,this.message=e||"Error parsing SPARQL query"}u.prototype=new Error,u.constructor=u,r.prototype=new Error,r.constructor=r,(AbstractQueryTree=function(){}).prototype.parseQueryString=function(e){return n.parse(e)},AbstractQueryTree.prototype.parseExecutableUnit=function(e){if("select"===e.kind)return this.parseSelect(e);if("ask"===e.kind)return this.parseSelect(e);if("modify"===e.kind)return this.parseSelect(e);if("construct"===e.kind)return this.parseSelect(e);if("insertdata"===e.kind)return this.parseInsertData(e);if("deletedata"===e.kind)return this.parseInsertData(e);if("load"===e.kind)return e;if("clear"===e.kind)return e;if("drop"===e.kind)return e;if("create"===e.kind)return e;throw new Error("unknown executable unit: "+e.kind)},AbstractQueryTree.prototype.parseSelect=function(e){return null==e?(console.log("error parsing query"),null):(e.pattern=this.build(e.pattern,{freshCounter:0}),e)},AbstractQueryTree.prototype.parseInsertData=function(e){return null==e?(console.log("error parsing query"),null):e},AbstractQueryTree.prototype.build=function(e,t){if("groupgraphpattern"===e.token)return this._buildGroupGraphPattern(e,t);var i;if("basicgraphpattern"===e.token)return i={kind:"BGP",value:e.triplesContext},AbstractQueryTree.translatePathExpressionsInBGP(i,t);if("graphunionpattern"===e.token)return{kind:"UNION",value:[this.build(e.value[0],t),this.build(e.value[1],t)]};if("graphgraphpattern"===e.token)return{kind:"GRAPH",value:this.build(e.value,t),graph:e.graph};throw null!=e.token?new u(e.token,"Non implemented SPARQL graph pattern: '"+e.token+"'"):new r("Error parsing graph pattern: '"+JSON.stringify(e)+"'")},AbstractQueryTree.translatePathExpressionsInBGP=function(e,t){for(var i=[],n=0;n<e.value.length;n++)if(e.value[n].predicate&&"path"===e.value[n].predicate.token){var r,o=e.value[n],s=e.value.slice(n+1),a=AbstractQueryTree.translatePathExpression(o,t),l=null;if("BGP"!==a.kind){if("ZERO_OR_MORE_PATH"!==a.kind&&"ONE_OR_MORE_PATH"!==a.kind)return a;if(o=0<i.length?{kind:"JOIN",lvalue:{kind:"BGP",value:i},rvalue:a}:a,"ZERO_OR_MORE_PATH"===a.kind)if("var"===a.y.token&&0===a.y.value.indexOf("fresh:")&&"var"===a.x.token&&0===a.x.value.indexOf("fresh:"))for(var u=0;u<e.value.length;u++)e.value[u].object&&"var"===e.value[u].object.token&&e.value[u].object.value===a.x.value&&((l=c.clone(e.value[u],!0)).object=a.y);else if("var"===a.y.token&&0===a.y.value.indexOf("fresh:"))for(u=0;u<e.value.length;u++)e.value[u].subject&&"var"===e.value[u].subject.token&&e.value[u].subject.value===a.y.value&&((l=c.clone(e.value[u],!0)).subject=a.x);return 0<s.length?(r=AbstractQueryTree.translatePathExpressionsInBGP({kind:"BGP",value:s},t),null!=l?{kind:"UNION",value:[{kind:"JOIN",lvalue:o,rvalue:r},{kind:"BGP",value:i.concat([l]).concat(s)}]}:{kind:"JOIN",lvalue:o,rvalue:r}):o}i=i.concat(a.value)}else i.push(e.value[n]);return e.value=i,e},AbstractQueryTree.translatePathExpression=function(e,t){if("element"===e.predicate.kind)return"+"===e.predicate.modifier?(e.predicate.modifier=null,{kind:"ONE_OR_MORE_PATH",path:AbstractQueryTree.translatePathExpression(e,t),x:e.subject,y:e.object}):"*"===e.predicate.modifier?(e.predicate.modifier=null,{kind:"ZERO_OR_MORE_PATH",path:AbstractQueryTree.translatePathExpression(e,t),x:e.subject,y:e.object}):(e.predicate=e.predicate.value,{kind:"BGP",value:[e]});if("sequence"!==e.predicate.kind)throw new u("Non supported path expression "+e.predicate.kind);for(var i,n,r=e.subject,o=e.object,s=e.graph,a=[],l=0;l<e.predicate.value.length;l++)l!=e.predicate.value.length-1?(i={token:"var",value:"fresh:"+t.freshCounter},t.freshCounter++):i=o,n={subject:r,predicate:e.predicate.value[l],object:i},null!=s&&(n.graph=c.clone(s,!0)),a.push(n),l!=e.predicate.value.length-1&&(r=c.clone(i,!0));return AbstractQueryTree.translatePathExpressionsInBGP({kind:"BGP",value:a},t)},AbstractQueryTree.prototype._buildGroupGraphPattern=function(e,t){for(var i=e.filters||[],n=e.binds||[],r={kind:"EMPTY_PATTERN"},o=0;o<e.patterns.length;o++){var s,a=e.patterns[o];r="optionalgraphpattern"===a.token?"FILTER"===(s=this.build(a.value,t)).kind?{kind:"LEFT_JOIN",lvalue:r,rvalue:s.value,filter:s.filter}:{kind:"LEFT_JOIN",lvalue:r,rvalue:s,filter:!0}:(s=this.build(a,t),"EMPTY_PATTERN"==r.kind?s:{kind:"JOIN",lvalue:r,rvalue:s})}if(r.binds=n,0==i.length)return r;if("EMPTY_PATTERN"===r.kind)return{kind:"FILTER",filter:i,value:r};if("LEFT_JOIN"===r.kind&&!0===r.filter)return{kind:"FILTER",filter:i,value:r};if("LEFT_JOIN"===r.kind)return{kind:"FILTER",filter:i,value:r};if("JOIN"===r.kind)return{kind:"FILTER",filter:i,value:r};if("UNION"===r.kind)return{kind:"FILTER",filter:i,value:r};if("GRAPH"===r.kind)return{kind:"FILTER",filter:i,value:r};if("BGP"===r.kind)return{kind:"FILTER",filter:i,value:r};throw new Error("Unknow kind of algebra expression: "+r.kind)},AbstractQueryTree.prototype.collectBasicTriples=function(e,t){if(null==t&&(t=[]),"select"===e.kind)t=this.collectBasicTriples(e.pattern,t);else if("BGP"===e.kind)t=t.concat(e.value);else if("ZERO_OR_MORE_PATH"===e.kind)t=this.collectBasicTriples(e.path);else if("UNION"===e.kind)t=this.collectBasicTriples(e.value[0],t),t=this.collectBasicTriples(e.value[1],t);else if("GRAPH"===e.kind)t=this.collectBasicTriples(e.value,t);else if("LEFT_JOIN"===e.kind||"JOIN"===e.kind)t=this.collectBasicTriples(e.lvalue,t),t=this.collectBasicTriples(e.rvalue,t);else if("FILTER"===e.kind)t=this.collectBasicTriples(e.value,t);else if("construct"===e.kind)t=this.collectBasicTriples(e.pattern,t);else if("EMPTY_PATTERN"!==e.kind)throw"Unknown pattern: "+e.kind;return t},AbstractQueryTree.prototype.bind=function(e,t){if(null!=e.graph&&e.graph.token&&"var"===e.graph.token&&null!=t[e.graph.value]&&(e.graph=t[e.graph.value]),null!=e.filter){for(var i=[],n=0;n<e.filter.length;n++)e.filter[n].value=this._bindFilter(e.filter[n].value,t),i.push(e.filter[n]);e.filter=i}if("select"===e.kind)e.pattern=this.bind(e.pattern,t);else if("BGP"===e.kind)e.value=this._bindTripleContext(e.value,t);else if("ZERO_OR_MORE_PATH"===e.kind)e.path=this._bindTripleContext(e.path,t),e.x&&"var"===e.x.token&&null!=t[e.x.value]&&(e.x=t[e.x.value]),e.y&&"var"===e.y.token&&null!=t[e.y.value]&&(e.y=t[e.y.value]);else if("UNION"===e.kind)e.value[0]=this.bind(e.value[0],t),e.value[1]=this.bind(e.value[1],t);else if("GRAPH"===e.kind)e.value=this.bind(e.value,t);else if("LEFT_JOIN"===e.kind||"JOIN"===e.kind)e.lvalue=this.bind(e.lvalue,t),e.rvalue=this.bind(e.rvalue,t);else if("FILTER"===e.kind){var r=this;e.value=this.bind(e.value,t),e.filter=e.filter.map(function(e){return{token:"filter",value:r._bindFilter(e.value,t)}})}else if("EMPTY_PATTERN"!==e.kind)throw"Unknown pattern: "+e.kind;return e},AbstractQueryTree.prototype._bindTripleContext=function(e,t){for(var i=0;i<e.length;i++)for(var n in delete e[i].graph,delete e[i].variables,e[i]){var r=e[i][n];"var"===r.token&&null!=t[r.value]&&(e[i][n]=t[r.value])}return e},AbstractQueryTree.prototype._bindFilter=function(e,t){if(null!=e.expressionType){var i=e.expressionType;if("relationalexpression"==i)e.op1=this._bindFilter(e.op1,t),e.op2=this._bindFilter(e.op2,t);else if("conditionalor"==i||"conditionaland"==i)for(var n=0;n<e.operands.length;n++)e.operands[n]=this._bindFilter(e.operands[n],t);else if("additiveexpression"==i){e.summand=this._bindFilter(e.summand,t);for(n=0;n<e.summands.length;n++)e.summands[n].expression=this._bindFilter(e.summands[n].expression,t)}else if("builtincall"==i)for(n=0;n<e.args.length;n++)e.args[n]=this._bindFilter(e.args[n],t);else if("multiplicativeexpression"==i){e.factor=this._bindFilter(e.factor,t);for(n=0;n<e.factors.length;n++)e.factors[n].expression=this._bindFilter(e.factors[n].expression,t)}else if("unaryexpression"==i)e.expression=this._bindFilter(e.expression,t);else if("irireforfunction"==i)for(n=0;n<e.factors.args;n++)e.args[n]=this._bindFilter(e.args[n],t);else"atomic"==i&&"var"==e.primaryexpression&&null!=t[e.value.value]&&("uri"===(i=t[e.value.value]).token?e.primaryexpression="iri":e.primaryexpression="literal",e.value=i)}return e},AbstractQueryTree.prototype.replace=function(e,t,i,n){if(null!=e.graph&&e.graph.token&&e.graph.token===t.token&&e.graph.value==t.value&&(e.graph=c.clone(i,!0)),null!=e.filter){for(var r=[],o=0;o<e.filter.length;o++)e.filter[o].value=this._replaceFilter(e.filter[o].value,t,i,n),r.push(e.filter[o]);e.filter=r}if("select"===e.kind)e.pattern=this.replace(e.pattern,t,i,n);else if("BGP"===e.kind)e.value=this._replaceTripleContext(e.value,t,i,n);else if("ZERO_OR_MORE_PATH"===e.kind)e.path=this._replaceTripleContext(e.path,t,i,n),e.x&&e.x.token===t.token&&e.value===t.value&&(e.x=c.clone(i,!0)),e.y&&e.y.token===t.token&&e.value===t.value&&(e.y=c.clone(i,!0));else if("UNION"===e.kind)e.value[0]=this.replace(e.value[0],t,i,n),e.value[1]=this.replace(e.value[1],t,i,n);else if("GRAPH"===e.kind)e.value=this.replace(e.value,t,i);else if("LEFT_JOIN"===e.kind||"JOIN"===e.kind)e.lvalue=this.replace(e.lvalue,t,i,n),e.rvalue=this.replace(e.rvalue,t,i,n);else if("FILTER"===e.kind)e.value=this._replaceFilter(e.value,t,i,n);else if("EMPTY_PATTERN"!==e.kind)throw"Unknown pattern: "+e.kind;return e},AbstractQueryTree.prototype._replaceTripleContext=function(e,t,i,n){for(var r=0;r<e.length;r++)for(var o in e[r]){var s=e[r][o];("var"!==s.token||"var"!==t.token||s.value!==t.value)&&("blank"!==s.token||"blank"!==t.token||s.value!==t.value)&&("literal"!==s.token&&"uri"!==s.token||"literal"!==t.token&&"uri"!==t.token||s.token!==t.token||a.lexicalFormTerm(s,n)[s.token]!==a.lexicalFormTerm(t,n)[s.token])||(e[r][o]=i)}return e},AbstractQueryTree.prototype._replaceFilter=function(e,t,i,n){if(null!=e.expressionType){var r=e.expressionType;if("relationalexpression"==r)e.op1=this._replaceFilter(e.op1,t,i,n),e.op2=this._replaceFilter(e.op2,t,i,n);else if("conditionalor"==r||"conditionaland"==r)for(var o=0;o<e.operands.length;o++)e.operands[o]=this._replaceFilter(e.operands[o],t,i,n);else if("additiveexpression"==r){e.summand=this._replaceFilter(e.summand,t,i,n);for(o=0;o<e.summands.length;o++)e.summands[o].expression=this._replaceFilter(e.summands[o].expression,t,i,n)}else if("builtincall"==r)for(o=0;o<e.args.length;o++)e.args[o]=this._replaceFilter(e.args[o],t,i,n);else if("multiplicativeexpression"==r){e.factor=this._replaceFilter(e.factor,t,i,n);for(o=0;o<e.factors.length;o++)e.factors[o].expression=this._replaceFilter(e.factors[o].expression,t,i,n)}else if("unaryexpression"==r)e.expression=this._replaceFilter(e.expression,t,i,n);else if("irireforfunction"==r)for(o=0;o<e.factors.args;o++)e.args[o]=this._replaceFilter(e.args[o],t,i,n);else"atomic"==r&&(r=null)!=(r=e.primaryexpression==t.token&&e.value==t.value||"iri"==e.primaryexpression&&"uri"==t.token&&e.value==t.value?i.value:r)&&("uri"===i.token?e.primaryexpression="iri":e.primaryexpression=i.token,e.value=r)}return e},AbstractQueryTree.prototype.treeWithUnion=function(e){return null!=e&&null!=e.kind&&("select"===e.kind?this.treeWithUnion(e.pattern):"BGP"===e.kind?this.treeWithUnion(e.value):"ZERO_OR_MORE_PATH"!==e.kind&&("UNION"===e.kind?null==e.value[0].value||null==e.value[0].value.variables||null==e.value[1].value||null==e.value[1].value.variables||(e.value[0].variables.join("/")===e.values[1].variables.join("/")?!!this.treeWithUnion(e.value[0])||this.treeWithUnion(e.value[1]):void 0):"GRAPH"!==e.kind&&("LEFT_JOIN"!==e.kind&&"JOIN"!==e.kind?("FILTER"===e.kind||e.kind,!1):!!this.treeWithUnion(e.lvalue)||void this.treeWithUnion(e.rvalue))))},t.exports={AbstractQueryTree:AbstractQueryTree,NonSupportedSparqlFeatureError:u,SparqlParserError:r}},{"./parser":46,"./utils":57}],40:[function(e,t,i){"use strict";function n(e,t){var i;0!=arguments.length&&(this.order=e,this.root=this._allocateNode(),this.root.isLeaf=!0,this.root.level=0,(i=this)._diskWrite(this.root,function(e){i.root=e,i._updateRootNode(i.root,function(e){i.comparator=function(e,t){return e<t?-1:t<e?1:0},(i.merger=null)!=t&&t(i)})}))}var e=e("./utils"),s=e,r=e.nextTick,o=(n.prototype._allocateNode=function(){return new o},n.prototype._diskWrite=function(e,t){r(function(){t(e)})},n.prototype._diskRead=function(e,t){r(function(){t(e)})},n.prototype._diskDelete=function(e,t){r(function(){t()})},n.prototype._updateRootNode=function(e,t){t(e)},n.prototype.search=function(e,t,i){var n=this.root;this.__search(this,e,n,t,i)},n.prototype.__search=function(t,i,e,n,r){for(var o=0;o<e.numberActives&&1===t.comparator(i,e.keys[o].key);)o++;o<e.numberActives&&0===t.comparator(e.keys[o].key,i)?n(null!=r&&1==r||e.keys[o].data):!0===e.isLeaf?n(null):t._diskRead(e.children[o],function(e){t.__search(t,i,e,n,r)})},n.prototype.walk=function(e,t){this.__walk(this,this.root,e,t)},n.prototype.__walk=function(i,n,r,t){var e=n.numberActives,o=0;if(n.isLeaf){for(o=0;o<n.numberActives;o++)r(n.keys[o]);return t()}s.whilst(function(){return o<e},function(t){i._diskRead(n.children[o],function(e){i.__walk(i,e,r,function(){i._diskRead(n.keys[o],function(e){r(e),o++,t()})})})},function(){i._diskRead(n.children[e],function(e){i.__walk(i,e,r,function(){t()})})})},n.prototype.walkNodes=function(e){this.__walkNodes(this,root,e,function(){})},n.prototype.__walkNodes=function(i,e,n,t){if(e.isLeaf)return n(e),t();n(e);var r=e.numberActives,o=0;s.whilst(function(){return o<r},function(t){i._diskRead(e.children[o],function(e){i.__walkNodes(i,e,n,function(){o++,t()})})},function(){i._diskRead(e.children[r],function(e){i.__walkNodes(i,e,n,function(){})})})},n.prototype._splitChild=function(t,i,n,r){var e=this._allocateNode(),o=(e.isLeaf=n.isLeaf,e.level=n.level,e.numberActives=this.order-1,n.keys[this.order-1]);n.keys[this.order-1]=null;for(var s=0;s<this.order-1;s++)e.keys[s]=n.keys[s+this.order],n.keys[s+this.order]=null,n.isLeaf||(e.children[s]=n.children[s+this.order],n.children[s+this.order]=null);for(n.isLeaf||(e.children[s]=n.children[s+this.order],n.children[s+this.order]=null),n.numberActives=this.order-1,s=t.numberActives+1;i+1<s;s--)t.children[s]=t.children[s-1];for(t.children[i+1]=e,s=t.numberActives;i<s;s--)t.keys[s]=t.keys[s-1];t.keys[i]=o,t.numberActives++;var a=this;this._diskWrite(e,function(e){a._diskWrite(t,function(t){t.children[i+1]=e,a._diskWrite(n,function(e){return r(t)})})})},n.prototype.insert=function(t,i,n){var r,o;this.root.numberActives===2*this.order-1?((r=this._allocateNode()).isLeaf=!1,r.level=this.root.level+1,r.numberActives=0,r.children[0]=this.root,(o=this)._splitChild(r,0,this.root,function(e){r=e,o.root=r,o._updateRootNode(r,function(e){o._insertNonFull(e,t,i,n)})})):this._insertNonFull(this.root,t,i,n)},n.prototype._insertNonFull=function(e,t,i,n){var r=e.numberActives-1;this.__insertNonFull(this,e,r,t,i,n)},n.prototype.__insertNonFull=function(t,i,n,r,o,s){if(i.isLeaf){for(;0<=n&&-1===t.comparator(r,i.keys[n].key);)i.keys[n+1]=i.keys[n],n--;0<=n&&0===t.comparator(r,i.keys[n].key)?i.keys[n]={key:r,data:o}:(i.keys[n+1]={key:r,data:o},i.numberActives++),t._diskWrite(i,function(e){return s(e)})}else{for(;0<=n&&-1===t.comparator(r,i.keys[n].key);)n--;n++;var a=t;t._diskRead(i.children[n],function(e){e.numberActives===2*a.order-1?a._splitChild(i,n,e,function(){1===a.comparator(r,i.keys[n].key)&&n++,a._diskRead(i.children[n],function(e){n=e.numberActives-1,a.__insertNonFull(t,e,n,r,o,s)})}):a._diskRead(i.children[n],function(e){n=e.numberActives-1,a.__insertNonFull(t,e,n,r,o,s)})})}},n.prototype.delete=function(e,t){var i=this.root;n.prototype.__deleteSearchNode(this,e,i,t)},n.prototype.__deleteSearchNode=function(o,s,e,a){var l=0;if(0===e.numberActives)return a(!1);for(;l<e.numberActives&&1===o.comparator(s,e.keys[l].key);)l++;var u,c=l;return l<e.numberActives&&0===o.comparator(s,e.keys[l].key)?o.__deleteNodeFound(o,c,s,e,a):!0===e.isLeaf?a(!1):void o._diskRead((u=e).children[l],function(i){if(null===i)return a(!1);var n=!1,r=!1,e=null,t=null;c===u.numberActives?(r=!0,t=u.children[c-1],e=u.children[c-1]):0===c?(n=!0,e=u.children[1],t=u.children[1]):(t=u.children[c-1],e=u.children[c+1]),o._diskRead(t,function(t){o._diskRead(e,function(e){!0===r&&(e=null),!0===n&&(t=null),i.numberActives===o.order-1&&null!=u?null!=e&&e.numberActives>o.order-1?o._moveKey(u,l,-1,function(e){o.__deleteSearchNode(o,s,i,a)}):null!=t&&t.numberActives>o.order-1?o._moveKey(u,l,1,function(e){o.__deleteSearchNode(o,s,i,a)}):null!=t&&t.numberActives===o.order-1?o._mergeSiblings(u,l,-1,function(e){o.__deleteSearchNode(o,s,e,a)}):null!=e&&e.numberActives===o.order-1&&o._mergeSiblings(u,l,1,function(e){o.__deleteSearchNode(o,s,e,a)}):o.__deleteSearchNode(o,s,i,a)})})})},n.prototype.__deleteNodeFound=function(n,r,o,s,a){return s.isLeaf&&s.numberActives>n.order-1||s.isLeaf&&s===n.root?(n._deleteKeyFromNode(s,r,function(){a(!0)}),!0):(!1===s.isLeaf&&n._diskRead(s.children[r],function(i){i.numberActives>n.order-1?n._getMaxKeyPos(n,i,function(e){o=e.node.keys[e.index],s.keys[r]=o,n._diskWrite(s,function(e){o=o.key,n.__deleteSearchNode(n,o,i,a)})}):n._diskRead(s.children[r+1],function(t){t.numberActives>n.order-1?n._getMinKeyPos(n,t,function(e){o=e.node.keys[e.index],s.keys[r]=o,n._diskWrite(s,function(e){o=o.key,n.__deleteSearchNode(n,o,t,a)})}):i.numberActives===n.order-1&&t.numberActives===n.order-1&&n._mergeNodes(i,s.keys[r],t,function(t){s.children[r]=t;for(var e=++r;e<s.numberActives;e++)s.children[e]=s.children[e+1],s.keys[e-1]=s.keys[e];s.children[e]=null,s.keys[e-1]=null,s.numberActives--,0===s.numberActives&&n.root===s&&(n.root=t),n._diskWrite(s,function(e){n.__deleteSearchNode(n,o,t,a)})})})}),void(s.isLeaf&&s.numberActives>n.order-1&&n._deleteKeyFromNode(s,r,function(e){n.__deleteSearchNode(n,o,e,a)})))},n.prototype._moveKey=function(n,r,o,s){1===o&&r--;var a=this;a._diskRead(n.children[r],function(i){a._diskRead(n.children[r+1],function(t){if(-1==o){i.keys[i.numberActives]=n.keys[r],i.children[i.numberActives+1]=t.children[0],t.children[0]=null,i.numberActives++,n.keys[r]=t.keys[0];for(var e=1;e<t.numberActives;e++)t.keys[e-1]=t.keys[e],t.children[e-1]=t.children[e];t.children[t.numberActives-1]=t.children[t.numberActives],t.numberActives--}else{t.children[t.numberActives+1]=t.children[t.numberActives];for(e=t.numberActives;0<e;e--)t.children[e]=t.children[e-1],t.keys[e]=t.keys[e-1];t.keys[0]=null,t.children[0]=null,t.children[0]=i.children[i.numberActives],t.keys[0]=n.keys[r],t.numberActives++,i.children[i.numberActives]=null,n.keys[r]=i.keys[i.numberActives-1],i.keys[i.numberActives-1]=null,i.numberActives--}a._diskWrite(i,function(e){a._diskWrite(t,function(e){a._diskWrite(n,function(e){return s(e)})})})})})},n.prototype._mergeSiblings=function(r,t,e,o){var s,a,i,l=t===r.numberActives?(t--,i=r.children[r.numberActives-1],r.children[r.numberActives]):(i=r.children[t],r.children[t+1]),u=this;u._diskRead(i,function(n){u._diskRead(l,function(i){var e=u._allocateNode();for(e.isLeaf=n.isLeaf,e.level=n.level,a=0;a<u.order-1;a++)e.keys[a]=n.keys[a],e.children[a]=n.children[a];for(e.keys[u.order-1]=r.keys[t],e.children[u.order-1]=n.children[u.order-1],a=0;a<u.order-1;a++)e.keys[a+u.order]=i.keys[a],e.children[a+u.order]=i.children[a];for(e.children[2*u.order-1]=i.children[u.order-1],r.children[t]=e,a=t;a<r.numberActives;a++)r.keys[a]=r.keys[a+1],r.children[a+1]=r.children[a+2];for(e.numberActives=n.numberActives+i.numberActives+1,r.numberActives--,s=r.numberActives;s<2*u.order-1;s++)r.keys[s]=null;0===r.numberActives&&u.root===r&&((u.root=e).level?e.isLeaf=!1:e.isLeaf=!0),u._diskWrite(e,function(t){u._diskWrite(r,function(e){u._diskDelete(n,function(){u._diskDelete(i,function(){if(u.root!==t)return o(t);u._updateRootNode(u.root,function(){return o(t)})})})})})})})},n.prototype._deleteKeyFromNode=function(e,t,i){var n=2*this.order-1;if(e.numberActives<n&&(n=e.numberActives),!1===e.isLeaf)return!1;e.keys[t];for(var r=t;r<n-1;r++)e.keys[r]=e.keys[r+1];e.keys.pop(),e.numberActives--,this._diskWrite(e,function(e){return i(e)})},n.prototype._mergeNodes=function(t,e,i,n){var r,o=this._allocateNode();for(o.isLeaf=!0,r=0;r<t.numberActives;r++)o.keys[r]=t.keys[r],o.children[r]=t.children[r];for(o.children[t.numberActives]=t.children[t.numberActives],o.keys[t.numberActives]=e,r=0;r<i.numberActives;r++)o.keys[r+t.numberActives+1]=i.keys[r],o.children[r+t.numberActives+1]=i.children[r];o.children[2*this.order-1]=i.children[i.numberActives],o.numberActives=t.numberActives+i.numberActives+1,o.isLeaf=t.isLeaf,o.level=t.level;var s=this;this._diskWrite(o,function(e){s._diskDelete(t,function(){s._diskDelete(i,function(){return n(e)})})})},n.prototype.audit=function(o){function s(e){for(var t,i=0;i<l.length;i++)0===c.comparator(l[i],e)&&(t=" !!! duplicated key "+e,!0===o&&console.log(t),a.push(t))}var a=[],l=[],u=null,c=this;return this.walkNodes(function(e){!0===o&&(console.log("--- Node at "+e.level+" level"),console.log(" - leaf? "+e.isLeaf),console.log(" - num actives? "+e.numberActives),console.log(" - keys: "));for(var t=e.numberActives;t<e.keys.length;t++)null!=e.keys[t]&&!0===o&&(console.log(" * warning : redundant key data"),a.push(" * warning : redundant key data"));for(t=e.numberActives+1;t<e.children.length;t++)null!=e.children[t]&&!0===o&&(console.log(" * warning : redundant children data"),a.push(" * warning : redundant key data"));if(!1===e.isLeaf)for(t=0;t<e.numberActives;t++){var i,n=this._diskRead(e.children[t]).keys[this._diskRead(e.children[t]).numberActives-1].key,r=this._diskRead(e.children[t+1]).keys[0].key;!0===o&&console.log("   "+e.keys[t].key+"("+n+","+r+")"),-1===c.comparator(e.keys[t].key,n)&&(i=" !!! value max left "+n+" > key "+e.keys[t].key,!0===o&&console.log(i),a.push(i)),1===c.comparator(e.keys[t].key,r)&&(i=" !!! value min right "+r+" < key "+e.keys[t].key,!0===o&&console.log(i),a.push(i)),s(e.keys[t].key),l.push(e.keys[t].key)}else{null===u?u=e.level:u!=e.level&&(i=" !!! Leaf node with wrong level value",!0===o&&console.log(i),a.push(i));for(t=0;t<e.numberActives;t++)!0===o&&console.log(" "+e.keys[t].key),s(e.keys[t].key),l.push(e.keys[t].key)}e!=c.root&&(e.numberActives>2*c.order-1&&(!0===o&&(i=" !!!! MAX num keys restriction violated "),console.log(i),a.push(i)),e.numberActives<c.order-1)&&(!0===o&&(i=" !!!! MIN num keys restriction violated "),console.log(i),a.push(i))}),a},n.prototype._getMaxKeyPos=function(t,e,i){var n={};return null===e?i(null):!0===e.isLeaf?(n.node=e,n.index=e.numberActives-1,i(n)):(n.node=e,n.index=e.numberActives-1,void t._diskRead(e.children[e.numberActives],function(e){return t._getMaxKeyPos(t,e,i)}))},n.prototype._getMinKeyPos=function(t,e,i){var n={};if(null===e&&i(null),!0===e.isLeaf)return n.node=e,n.index=0,i(n);t._diskRead((n.node=e).children[n.index=0],function(e){return t._getMinKeyPos(t,e,i)})},function(){this.numberActives=0,this.isLeaf=null,this.keys=[],this.children=[],this.level=0});t.exports={Tree:n,Node:o}},{"./utils":57}],41:[function(e,t,i){var a=e("./query_engine").QueryEngine,l=e("./quad_backend").QuadBackend,u=e("./persistent_quad_backend").PersistentQuadBackend,c=e("./lexicon").Lexicon,d=e("./persistent_lexicon").PersistentLexicon,h=e("./rdf_model"),p=e("./utils");(Store=function(e,t){var n=null,r=null;if(0==arguments.length)r={};else if(1==arguments.length)r={},n=e;else{if(!(1<arguments.length))throw"An optional argument map and a callback must be provided";r=e,n=t}null==r.treeOrder&&(r.treeOrder=15);var i=c,o=l,s=(!0===r.persistent&&(i=d,o=u),this.functionMap={},this);this.customFns={},new i(function(i){function e(){new o(r,function(e){function t(){r.backend=e,r.lexicon=i,s.engine=new a(r),n(null,s)}r.overwrite?e.clear(t):t()})}!0===r.overwrite?i.clear(e):e()},r.name)}).prototype.rdf=h.rdf,Store.prototype.rdf.api=h,Store.prototype.registerCustomFunction=function(e,t){this.customFns[e]=t,this.engine.setCustomFunctions(this.customFns)},Store.prototype.execute=function(){var e,t;3===arguments.length?this.executeWithEnvironment(arguments[0],arguments[1],arguments[2]):4===arguments.length?this.executeWithEnvironment(arguments[0],arguments[1],arguments[2],arguments[3]):(1===arguments.length?(e=arguments[0],t=function(){}):2===arguments.length&&(e=arguments[0],t=arguments[1]),this.engine.execute(e,t))},Store.prototype.executeWithEnvironment=function(){var e,t,i,n;3===arguments.length?(e=arguments[0],n=function(){},t=arguments[1],i=arguments[2]):4===arguments.length&&(e=arguments[0],n=arguments[3],t=arguments[1],i=arguments[2]),t=p.map(t,function(e){return{token:"uri",value:e}}),i=p.map(i,function(e){return{token:"uri",value:e}}),this.engine.execute(e,n,t,i)},Store.prototype.graph=function(){var e=null,t=null;if(1===arguments.length)t=arguments[0]||function(){},e=this.engine.lexicon.defaultGraphUri;else{if(2!==arguments.length)throw"An optional graph URI and a callback function must be provided";t=arguments[1]||function(){},e=arguments[0]}null!=this.rdf.resolve(e)&&(e=this.rdf.resolve(e)),this.engine.execute("CONSTRUCT { ?s ?p ?o } WHERE { GRAPH <"+e+"> { ?s ?p ?o } }",t)},Store.prototype.node=function(){var e=null,t=null,i=null;if(2===arguments.length)i=arguments[0],t=arguments[1]||function(){},e=this.engine.lexicon.defaultGraphUri;else{if(3!==arguments.length)throw"An optional graph URI, node URI and a callback function must be provided";i=arguments[0],e=arguments[1],t=arguments[2]||function(){}}null!=this.rdf.resolve(e)&&(e=this.rdf.resolve(e)),null!=this.rdf.resolve(i)&&(i=this.rdf.resolve(i)),this.engine.execute("CONSTRUCT { <"+i+"> ?p ?o } WHERE { GRAPH <"+e+"> { <"+i+"> ?p ?o } }",t)},Store.prototype.startObservingNode=function(){2===arguments.length?this.engine.callbacksBackend.observeNode(arguments[0],arguments[1],function(){}):3===arguments.length&&this.engine.callbacksBackend.observeNode(arguments[0],arguments[1],arguments[2],function(){})},Store.prototype.stopObservingNode=function(e){this.engine.callbacksBackend.stopObservingNode(e)},Store.prototype.startObservingQuery=function(){var e=arguments[0],t=arguments[1],i=arguments[2];null!=i?this.engine.callbacksBackend.observeQuery(e,t,i):this.engine.callbacksBackend.observeQuery(e,t,function(){})},Store.prototype.stopObservingQuery=function(e){this.engine.callbacksBackend.stopObservingQuery(e)},Store.prototype.subscribe=function(e,t,i,n,a){function r(e,t){var r=[],o={blanks:{},outCache:{}},s=[];p.each(t,function(e){var t=h.buildRDFResource(e.subject,s,l.engine,o),i=h.buildRDFResource(e.predicate,s,l.engine,o),n=h.buildRDFResource(e.object,s,l.engine,o);null!=t&&null!=i&&null!=n&&(e=new h.Triple(t,i,n),r.push(e))}),a(e,r)}var l=this;this.functionMap[a]=r,this.engine.callbacksBackend.subscribe(e,t,i,n,r,function(){})},Store.prototype.unsubscribe=function(e){var t=this.functionMap[e];this.engine.callbacksBackend.unsubscribe(t),delete this.functionMap[e]},Store.prototype.setPrefix=function(e,t){this.rdf.setPrefix(e,t)},Store.prototype.setDefaultPrefix=function(e){this.rdf.setDefaultPrefix(e)},Store.prototype.insert=function(){var e,t,i;if(1===arguments.length)t=arguments[0],i=function(){};else if(2===arguments.length)t=arguments[0],i=arguments[1]||function(){};else{if(3!==arguments.length)throw"The triples to insert, an optional graph and callback must be provided";t=arguments[0],e=this.rdf.createNamedNode(arguments[1]),i=arguments[2]||function(){}}var n="",r=this;t.forEach(function(e){n=n+r._nodeToQuery(e.subject)+r._nodeToQuery(e.predicate)+r._nodeToQuery(e.object)+"."}),n=null!=e?"INSERT DATA { GRAPH "+this._nodeToQuery(e)+" { "+n+" } }":"INSERT DATA { "+n+" }",this.engine.execute(n,i)},Store.prototype._nodeToQuery=function(e){var t;return"NamedNode"===e.interfaceName?null!=(t=this.rdf.resolve(e.valueOf()))?"<"+t+">":"<"+e.valueOf()+">":e.toString()},Store.prototype.delete=function(){var e,t,i;if(1===arguments.length)t=arguments[0],i=function(){};else if(2===arguments.length)t=arguments[0],i=arguments[1]||function(){};else{if(3!==arguments.length)throw"The triples to delete, an optional graph and callback must be provided";t=arguments[0],e=this.rdf.createNamedNode(arguments[1]),i=arguments[2]||function(){}}var n="",r=this;t.forEach(function(e){n=n+r._nodeToQuery(e.subject)+r._nodeToQuery(e.predicate)+r._nodeToQuery(e.object)+"."}),n=null!=e?"DELETE DATA { GRAPH "+this._nodeToQuery(e)+" { "+n+" } }":"DELETE DATA { "+n+" }",this.engine.execute(n,i)},Store.prototype.clear=function(){if(0===arguments.length)var e=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),t=function(){};else if(1===arguments.length)e=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),t=arguments[0]||function(){};else{if(2!==arguments.length)throw"The optional graph and a callback must be provided";e=this.rdf.createNamedNode(arguments[0]),t=arguments[1]||function(){}}e="CLEAR GRAPH "+this._nodeToQuery(e);this.engine.execute(e,t)},Store.prototype.setBatchLoadEvents=function(e){this.engine.eventsOnBatchLoad=e},Store.prototype.registerDefaultNamespace=function(e,t){this.rdf.prefixes.set(e,t),this.engine.registerDefaultNamespace(e,t)},Store.prototype.registerDefaultProfileNamespaces=function(){var e,t=this.rdf.prefixes.values();for(e in t)this.registerDefaultNamespace(e,t[e])},Store.prototype.load=function(){var e,i,t={};if(3===arguments.length)e=this.rdf.createNamedNode(this.engine.lexicon.defaultGraphUri),s=arguments[0],n=arguments[1],i=arguments[2]||function(){};else if(4===arguments.length)s=arguments[0],n=arguments[1],"string"==typeof(t=arguments[2])?(e=this.rdf.createNamedNode(t),t={}):(e=this.rdf.createNamedNode(t.graph||this.engine.lexicon.defaultGraphUri),delete t.graph),i=arguments[3]||function(){};else if(2===arguments.length)throw"The mediaType of the parser, the data a callback and an optional graph must be provided";if("remote"===s){var n,r="LOAD <"+(n=this.rdf.createNamedNode(n)).valueOf()+"> INTO GRAPH <"+e.valueOf()+">";this.engine.execute(r,i)}else{var o=this,r=this.engine.rdfLoader.parsers[s];if(!r)return i(new Error("Cannot find parser for the provided media type:"+s));var s=[r,{token:"uri",value:e.valueOf()},n,t,function(e,t){e?i(e,t):o.engine.batchLoad(t,function(e){null!=e?i(null,e):i(new Error("Erro batch-loading triples."))})}];(n&&"string"==typeof n&&0===n.indexOf("file://")?this.engine.rdfLoader.loadFromFile:this.engine.rdfLoader.tryToParse).apply(null,s)}},Store.prototype.registerParser=function(e,t){this.engine.rdfLoader.registerParser(e,t)},Store.prototype.registeredGraphs=function(t){this.engine.lexicon.registeredGraphs(!0,function(e){e=p.map(e,function(e){return new h.NamedNode(e)});t(null,e)})},Store.prototype.getNetworkTransport=function(){return NetworkTransport},Store.prototype.setNetworkTransport=function(e){NetworkTransport=e},Store.prototype.close=function(e){null==e&&(e=function(){}),this.engine.close?this.engine.close(e):e()},Store.VERSION="0.9.17";Store.yieldFrequency=function(e){p.yieldFrequency(e)},t.exports.Store=Store,t.exports.create=function(){return 1==arguments.length?new Store(arguments[0]):2==arguments.length?new Store(arguments[0],arguments[1]):new Store},t.exports.connect=function(){var e=1==arguments.length?arguments[0]:2==arguments.length?arguments[1]:arguments[2];e(new Error("Store#connect is not supported in the 0.9.X series of the library"))}},{"./lexicon":44,"./persistent_lexicon":47,"./persistent_quad_backend":48,"./quad_backend":49,"./query_engine":51,"./rdf_model":55,"./utils":57}],42:[function(e,t,i){var c=e("./utils"),s=e("./utils"),u=(e("./quad_index").QuadIndex,e("./quad_index").Pattern),p=e("./rdf_model"),n=e("./abstract_query_tree").AbstractQueryTree;(Callbacks={ANYTHING:{token:"var",value:"_"},added:"added",deleted:"deleted",eventsFlushed:"eventsFlushed",CallbacksBackend:function(){this.aqt=new n,this.engine=arguments[0],this.indexMap={},this.observersMap={},this.queriesIndexMap={},this.emptyNotificationsMap={},this.queriesList=[],this.pendingQueries=[],this.matchedQueries=[],this.updateInProgress=null,this.indices=["SPOG","GP","OGS","POG","GSP","OS"],this.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]},this.callbackCounter=0,this.callbacksMap={},this.callbacksInverseMap={},this.queryCounter=0,this.queriesMap={},this.queriesCallbacksMap={},this.queriesInverseMap={};for(var e=0;e<this.indices.length;e++){var t=this.indices[e];this.indexMap[t]={},this.queriesIndexMap[t]={}}}}).CallbacksBackend.prototype.startGraphModification=function(){!0!==this.ongoingModification&&(this.pendingQueries=[].concat(this.queriesList),this.matchedQueries=[],null==this.updateInProgress)&&(this.updateInProgress={},this.updateInProgress[Callbacks.added]=[],this.updateInProgress[Callbacks.deleted]=[])},Callbacks.CallbacksBackend.prototype.nextGraphModification=function(e,t){this.updateInProgress[e].push(t)},Callbacks.CallbacksBackend.prototype.endGraphModification=function(e){var t,i;!0!==this.ongoingModification&&null!=(t=this).updateInProgress?(i=t.updateInProgress,t.updateInProgress=null,this.sendNotification(Callbacks.deleted,i[Callbacks.deleted],function(){t.sendNotification(Callbacks.added,i[Callbacks.added],function(){t.sendEmptyNotification(Callbacks.eventsFlushed,null,function(){t.dispatchQueries(function(){e(!0)})})})})):e(!0)},Callbacks.CallbacksBackend.prototype.cancelGraphModification=function(){!0!==this.ongoingModification&&(this.updateInProgress=null)},Callbacks.CallbacksBackend.prototype.sendNotification=function(e,t,i){for(var n={},r=0;r<t.length;r++){var o,s=t[r];for(o in this.indexMap){var a=this.indexMap[o],l=this.componentOrders[o];this._searchCallbacksInIndex(a,l,e,s,n),0!=this.pendingQueries.length&&(a=this.queriesIndexMap[o],this._searchQueriesInIndex(a,l,s))}}this.dispatchNotifications(n),null!=i&&i(!0)},Callbacks.CallbacksBackend.prototype.sendEmptyNotification=function(e,t,i){for(var n=this.emptyNotificationsMap[e]||[],r=0;r<n.length;r++)n[r](e,t);i()},Callbacks.CallbacksBackend.prototype.dispatchNotifications=function(e){for(var t in e){var i,n=this.callbacksMap[t],r=e[t][Callbacks.deleted];if(null!=r)try{n(Callbacks.deleted,r)}catch(e){}for(i in e[t])if(i!=Callbacks.deleted)try{n(i,e[t][i])}catch(e){}}},Callbacks.CallbacksBackend.prototype._searchCallbacksInIndex=function(e,t,i,n,r){for(var o=n[1],n=n[0],s=0;s<t.length+1;s++){for(var a=e._||[],l=[],u=0;u<a.length;u++){var c=a[u];null!=this.callbacksMap[c]&&(r[c]=r[c]||{},r[c][i]=r[c][i]||[],r[c][i].push(n),l.push(c))}e._=l;var d=t[s];if(null==e[""+o[d]])break;e=e[""+o[d]]}},Callbacks.CallbacksBackend.prototype.subscribeEmpty=function(e,t){var i=this.emptyNotificationsMap[e]||[];i.push(t),this.emptyNotificationsMap[e]=i},Callbacks.CallbacksBackend.prototype.unsubscribeEmpty=function(e,t){var i=this.emptyNotificationsMap[e];null!=i&&(i=c.reject(i,function(e){return e===t})),this.emptyNotificationsMap[e]=i},Callbacks.CallbacksBackend.prototype.subscribe=function(e,t,i,n,s,a){var e=this._tokenizeComponents(e,t,i,n),t={blanks:{},outCache:{}},l=(this.engine.registerNsInEnvironment(null,t),this);this.engine.normalizeQuad(e,t,!0,function(e){for(var t=new u(e),t=l._indexForPattern(t),i=l.componentOrders[t],n=l.indexMap[t],r=0;r<i.length;r++){var o=e[i[r]];if("_"===o){null==n._&&(n._=[]),l.callbackCounter++,n._.push(l.callbackCounter),l.callbacksMap[l.callbackCounter]=s,l.callbacksInverseMap[s]=l.callbackCounter;break}r===i.length-1?(n[o]=n[o]||{_:[]},l.callbackCounter++,n[o]._.push(l.callbackCounter),l.callbacksMap[l.callbackCounter]=s,l.callbacksInverseMap[s]=l.callbackCounter):(n[o]=n[o]||{},n=n[o])}null!=a&&a(!0)})},Callbacks.CallbacksBackend.prototype.unsubscribe=function(e){var t=this.callbacksInverseMap[e];null!=t&&(delete this.callbacksInverseMap[e],delete this.callbacksMap[t])},Callbacks.CallbacksBackend.prototype._tokenizeComponents=function(e,t,i,n){var r={};return null==e?r.subject=Callbacks.ANYTHING:0==e.indexOf("_:")?r.subject={token:"blank",value:e}:r.subject={token:"uri",value:e},r.predicate=null==t?Callbacks.ANYTHING:{token:"uri",value:t},r.object=null==i?Callbacks.ANYTHING:{token:"uri",value:i},r.graph=null==n?Callbacks.ANYTHING:{token:"uri",value:n},r},Callbacks.CallbacksBackend.prototype._indexForPattern=function(e){for(var t=e.indexKey,i=this.indices,n=0;n<i.length;n++)for(var r=i[n],o=this.componentOrders[r],s=0;s<o.length&&!1!==c.include(t,o[s]);s++)if(s==t.length-1)return r;return"SPOG"},Callbacks.CallbacksBackend.prototype.observeNode=function(){var i,u,n=4===arguments.length?(i=arguments[0],e=arguments[1],u=arguments[2],arguments[3]):(i=arguments[0],e=this.engine.lexicon.defaultGraphUri,u=arguments[1],arguments[2]),e="CONSTRUCT { <"+i+"> ?p ?o } WHERE { GRAPH <"+e+"> { <"+i+"> ?p ?o } }",c=this,d={blanks:{},outCache:{}},h=(this.engine.registerNsInEnvironment(null,d),[]);this.engine.execute(e,function(e,t){var a,l;e?n&&n(!1):(a=t,l=!1,c.observersMap[u]=e=function(e,t){if("eventsFlushed"===e&&l){l=!1;try{u(a)}catch(e){}}else if("eventsFlushed"!==e){l=!0;for(var i=0;i<t.length;i++){var n=t[i],r=p.buildRDFResource(n.subject,h,c.engine,d),o=p.buildRDFResource(n.predicate,h,c.engine,d),s=p.buildRDFResource(n.object,h,c.engine,d);null!=r&&null!=o&&null!=s&&(n=new p.Triple(r,o,s),e===Callbacks.added?a.add(n):e===Callbacks.deleted&&a.remove(n))}}},c.subscribeEmpty(Callbacks.eventsFlushed,e),c.subscribe(i,null,null,null,e,function(){try{u(a)}catch(e){}n&&n(!0)}))})},Callbacks.CallbacksBackend.prototype.stopObservingNode=function(e){e=this.observersMap[e];return!!e&&(this.unsubscribe(e),this.unsubscribeEmpty(Callbacks.eventsFlushed,e),!0)},Callbacks.CallbacksBackend.prototype.observeQuery=function(e,i,t){var n=this.aqt.parseQueryString(e),n=this.aqt.parseSelect(n.units[0]),n=this.aqt.collectBasicTriples(n),a=this,r={blanks:{},outCache:{}},l=(this.engine.registerNsInEnvironment(null,r),this.queryCounter);this.queryCounter++,this.queriesMap[l]=e,this.queriesInverseMap[e]=l,this.queriesList.push(l),this.queriesCallbacksMap[l]=i,s.eachSeries(n,function(e,s){null==e.graph&&(e.graph=a.engine.lexicon.defaultGraphUriTerm),a.engine.normalizeQuad(e,r,!0,function(e){for(var t=new u(e),t=a._indexForPattern(t),i=a.componentOrders[t],n=a.queriesIndexMap[t],r=0;r<i.length;r++){var o=e[i[r]];if("string"==typeof o){null==n._&&(n._=[]),n._.push(l);break}r===i.length-1?(n[o]=n[o]||{_:[]},n[o]._.push(l)):(n[o]=n[o]||{},n=n[o])}s()})},function(){a.engine.execute(e,function(e,t){e?console.log("ERROR in query callback "+t):i(t)}),null!=t&&t()})},Callbacks.CallbacksBackend.prototype.stopObservingQuery=function(e){var t=this.queriesInverseMap[e];null!=t&&(delete this.queriesInverseMap[e],delete this.queriesMap[t],this.queriesList=c.reject(this.queriesList,function(e){return e===t}))},Callbacks.CallbacksBackend.prototype._searchQueriesInIndex=function(e,t,i){for(var n=i[1],i=i[0],r=0;r<t.length+1;r++){for(var o=e._||[],s=[],a=0;a<o.length;a++){var l=o[a];c.include(this.pendingQueries,l)&&(c.remove(this.pendingQueries,function(e){return e===l}),this.matchedQueries.push(l)),null!=this.queriesMap[l]&&s.push(l)}e._=s;var u=t[r];if(null==e[""+n[u]])break;e=e[""+n[u]]}},Callbacks.CallbacksBackend.prototype.dispatchQueries=function(e){var t,n,r=this,o={};s.eachSeries(this.matchedQueries,function(e,i){null==o[e]?(o[e]=!0,t=r.queriesMap[e],n=r.queriesCallbacksMap[e],r.engine.execute(t,function(e,t){if(!e)try{n(t)}catch(e){}i()})):i()},function(){e()})},Callbacks.CallbacksBackend.added=Callbacks.added,Callbacks.CallbacksBackend.deleted=Callbacks.deleted,Callbacks.CallbacksBackend.eventsFlushed=Callbacks.eventsFlushed,t.exports=Callbacks},{"./abstract_query_tree":39,"./quad_index":50,"./rdf_model":55,"./utils":57}],43:[function(e,t,i){function r(e,u,c){var d=null;n.normalize(e,{},function(e,t){if(e)c(e);else{var i,n=function(e){return"blank node"===e.type?{blank:e.value}:"IRI"===e.type?{token:"uri",value:e.value}:"literal"===e.type?null!=e.language?{literal:'"'+e.value+'"@'+e.language}:null!==e.datatype?{literal:'"'+e.value+'"^^<'+e.datatype+">"}:{literal:'"'+e.value+'"'}:void 0};d=[];for(i in t)for(var r=t[i],o=0;o<r.length;o++){var s=r[o];a=s.subject,l=s.predicate,s=s.object,d.push({subject:n(a),predicate:n(l),object:n(s),graph:u})}c(null,d)}var a,l})}var n=e("jsonld"),e=(i.JSONLDParser={},i.JSONLDParser);e.parser={async:!0,parse:function(e,t,i,n){try{"string"==typeof e&&(e=JSON.parse(e)),r(e,t,n)}catch(e){n(e)}}},t.exports={JSONLDParser:e}},{jsonld:27}],44:[function(e,t,i){var a=e("./utils"),n=e("./btree").Tree;(Lexicon=function(e){var i=this;this.defaultGraphOid=0,this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph",this.defaultGraphUriTerm={token:"uri",prefix:null,suffix:null,value:this.defaultGraphUri},this.oidCounter=1,a.seq(function(t){new n(2,function(e){i.uris=e,t()})},function(t){new n(2,function(e){i.literals=e,t()})},function(t){new n(2,function(e){i.knownGraphs=e,t()})},function(t){new n(2,function(e){i.oidUris=e,t()})},function(t){new n(2,function(e){i.oidLiterals=e,t()})},function(t){new n(2,function(e){i.oidBlanks=e,t()})})(function(){null!=e&&e(i)})}).prototype.registerGraph=function(e,t,i){e!=this.defaultGraphOid?this.knownGraphs.insert(e,t,function(){i()}):i()},Lexicon.prototype.registeredGraphs=function(t,e){var i=[];this.knownGraphs.walk(function(e){i.push(!0===t?e.data:e.key)},function(){e(i)})},Lexicon.prototype.registerUri=function(n,r){var o=this;n===this.defaultGraphUri?r(this.defaultGraphOid):this.uris.search(n,function(e){var t,i;null==e?(t=o.oidCounter,i="u"+t,o.oidCounter++,a.seq(function(e){o.uris.insert(n,[t,0],function(){e()})},function(e){o.oidUris.insert(i,n,function(){e()})})(function(){r(t)})):(t=e[0],e[1]=e[1]+1,r(t))})},Lexicon.prototype.resolveUri=function(e,t){e===this.defaultGraphUri?t(this.defaultGraphOid):this.uris.search(e,function(e){t(null!=e?e[0]:-1)})},Lexicon.prototype.resolveUriCost=function(e,t){e===this.defaultGraphUri?t(0):this.uris.search(e,function(e){t(null!=e?e[1]:-1)})},Lexicon.prototype.registerBlank=function(e){var t=this.oidCounter,i=(this.oidCounter++,""+t);this.oidBlanks.insert(i,i,function(){e(t)})},Lexicon.prototype.resolveBlank=function(e,t){var i=this;this.oidBlanks.search(e,function(e){null!=e?t(e):(e=i.oidCounter,this.oidCounter++,t(""+e))})},Lexicon.prototype.resolveBlankCost=function(e,t){t(0)},Lexicon.prototype.registerLiteral=function(n,r){var o=this;this.literals.search(n,function(e){var t,i;null==e?(t="l"+(i=o.oidCounter),o.oidCounter++,a.seq(function(e){o.literals.insert(n,[i,0],function(){e()})},function(e){o.oidLiterals.insert(t,n,function(){e()})})(function(){r(i)})):(i=e[0],e[1]=e[1]+1,r(i))})},Lexicon.prototype.resolveLiteral=function(e,t){this.literals.search(e,function(e){t(null!=e?e[0]:-1)})},Lexicon.prototype.resolveLiteralCost=function(e,t){this.literals.search(e,function(e){t(null!=e?e[1]:-1)})},Lexicon.prototype.parseLiteral=function(e){var t;return-1!=(t=e.lastIndexOf("@"))&&'"'===e[t-1]&&null!=e.substring(t,e.length).match(/^@[a-zA-Z\-]+$/g)?{token:"literal",value:e.substring(1,t-1),lang:e.substring(t+1,e.length)}:-1!=(t=e.lastIndexOf("^^"))&&'"'===e[t-1]&&"<"===e[t+2]&&">"===e[e.length-1]?{token:"literal",value:e.substring(1,t-1),type:e.substring(t+3,e.length-1)}:{token:"literal",value:e.substring(1,e.length-1)}},Lexicon.prototype.parseUri=function(e){return{token:"uri",value:e}},Lexicon.prototype.retrieve=function(i,n){var r=this;i===this.defaultGraphOid?n({token:"uri",value:this.defaultGraphUri,prefix:null,suffix:null,defaultGraph:!0}):a.seq(function(e,t){r.oidUris.search("u"+i,function(e){t(null,null!=e?r.parseUri(e):null)})},function(e,t){null==e?r.oidLiterals.search("l"+i,function(e){t(null,null!=e?r.parseLiteral(e):null)}):t(null,e)},function(e,t){null==e?r.oidBlanks.search(""+i,function(e){t(null,null!=e?{token:"blank",value:"_:"+i}:null)}):t(null,e)})(null,function(e,t){n(t)})},Lexicon.prototype.clear=function(e){var i=this;this.defaultGraphOid=0,this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph",this.defaultGraphUriTerm={token:"uri",prefix:null,suffix:null,value:this.defaultGraphUri},this.oidCounter=1,a.seq(function(t){new n(2,function(e){i.uris=e,t()})},function(t){new n(2,function(e){i.literals=e,t()})},function(t){new n(2,function(e){i.knownGraphs=e,t()})},function(t){new n(2,function(e){i.oidUris=e,t()})},function(t){new n(2,function(e){i.oidLiterals=e,t()})},function(t){new n(2,function(e){i.oidBlanks=e,t()})})(function(){null!=e&&e()})},Lexicon.prototype.unregister=function(t,i,e){var n=this;a.seq(function(e){n._unregisterTerm(t.subject.token,i.subject,e)},function(e){n._unregisterTerm(t.predicate.token,i.predicate,e)},function(e){n._unregisterTerm(t.object.token,i.object,e)},function(e){null!=t.graph?n._unregisterTerm(t.graph.token,i.graph,e):e()})(function(){e(!0)})},Lexicon.prototype._unregisterTerm=function(e,n,r){var o,s=this;"uri"===e?n!=this.defaultGraphOid?(o="u"+n,s.oidUris.search(o,function(i){s.uris.search(i,function(e){var t=e[1];""+e[0]==""+n?0===t?a.seq(function(e){s.oidUris.delete(o,function(){e()})},function(e){s.uris.delete(i,function(){e()})},function(e){s.knownGraphs.delete(n,function(){e()})})(function(){r()}):s.uris.insert(i,[n,t-1],function(){r()}):r()})})):r():"literal"===e?(this.oidCounter++,o="l"+n,s.oidLiterals.search(o,function(i){s.literals.search(i,function(e){var t=e[1];""+e[0]==""+n?0===t?a.seq(function(e){s.oidLiterals.delete(o,function(){e()})},function(e){s.literals.delete(i,function(){e()})})(function(){r()}):s.literals.insert(i,[n,t-1],function(){r()}):r()})})):"blank"===e?s.oidBlanks.delete(""+n,function(){r()}):r()},t.exports={Lexicon:Lexicon}},{"./btree":40,"./utils":57}],45:[function(e,t,i){var n,a,l;e("./utils").isWorker()||(n=e("http"),a=e("https"),l=e("url"),NetworkTransport={load:function(e,r,o,t){var s=null==t?3:t,t=l.parse(e,!0,!0),e={host:t.host,hostname:t.hostname,method:"GET",path:t.path,headers:{host:t.hostname,Accept:r}},i=null,t=("http:"===t.protocol?(e.port=t.port||80,i=n):"https:"===t.protocol&&(e.port=t.port||443,i=a),i.request(e,function(e){var t,i=e.headers,n="";"2"==(""+e.statusCode)[0]?(e.on("end",function(){o(null,{headers:i,data:n})}),e.on("data",function(e){n+=e})):"3"==(""+e.statusCode)[0]?0==s?o(new Error("Too many redirections")):null!=(t=i.Location||i.location)?NetworkTransport.load(t,r,o,s-1):o(new Error("Redirection without location header")):o(new Error("HTTP error: "+e.statusCode))}));t.on("error",o),t.end()}},t.exports={NetworkTransport:NetworkTransport})},{"./utils":57,http:7,https:23,url:36}],46:[function(e,t,i){t.exports=function(){"use strict";function gg(e,t,i,n){this.message=e,this.expected=t,this.found=i,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,gg)}function e(){this.constructor=t}var t,i;return t=gg,i=Error,e.prototype=i.prototype,t.prototype=new e,gg.buildMessage=function(e,t){var o={literal:function(e){return'"'+n(e.text)+'"'},class:function(e){for(var t="",i=0;i<e.parts.length;i++)t+=e.parts[i]instanceof Array?r(e.parts[i][0])+"-"+r(e.parts[i][1]):r(e.parts[i]);return"["+(e.inverted?"^":"")+t+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function i(e){return e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}function r(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+i(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+i(e)})}return"Expected "+function(e){for(var t,i,n=new Array(e.length),r=0;r<e.length;r++)n[r]=(i=e[r],o[i.type](i));if(n.sort(),0<n.length){for(t=r=1;r<n.length;r++)n[r-1]!==n[r]&&(n[t]=n[r],t++);n.length=t}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+((e=t)?'"'+n(e)+'"':"end of input")+" found."},{SyntaxError:gg,parse:function(w,r){function l(e,t){return{token:"prologue",base:e,prefixes:t}}function f(e,t,i,n){for(var r={named:[],implicit:[]},o=0;o<t.length;o++){var s=t[o];("default"===s.kind?r.implicit:r.named).push(s.graph)}0===r.named.length&&0===r.implicit.length&&r.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var a={kind:"select",token:"executableunit"};return a.dataset=r,a.projection=e.vars,a.modifier=e.modifier,a.pattern=i,null!=n&&null!=n.limit&&(a.limit=n.limit),null!=n&&null!=n.offset&&(a.offset=n.offset),null!=n&&null!=n.order&&""!=n.order&&(a.order=n.order),null!=n&&null!=n.group&&(a.group=n.group),a}function $(e,t,i,n){for(var r={named:[],implicit:[]},o=0;o<t.length;o++){var s=t[o];("default"===s.kind?r.implicit:r.named).push(s.graph)}0===r.named.length&&0===r.implicit.length&&r.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var a={kind:"construct",token:"executableunit"};return a.dataset=r,a.template=e,a.pattern=i,null!=n&&null!=n.limit&&(a.limit=n.limit),null!=n&&null!=n.offset&&(a.offset=n.offset),null!=n&&null!=n.order&&""!=n.order&&(a.order=n.order),a}function B(e,t,i){for(var n={named:[],implicit:[]},r=0;r<e.length;r++){var o=e[r];("default"===o.kind?n.implicit:n.named).push(o.graph)}0===n.named.length&&0===n.implicit.length&&n.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var s={kind:"construct",token:"executableunit"};return s.dataset=n,s.template=t,s.pattern={token:"basicgraphpattern",triplesContext:t.triplesContext},null!=i&&null!=i.limit&&(s.limit=i.limit),null!=i&&null!=i.offset&&(s.offset=i.offset),null!=i&&null!=i.order&&""!=i.order&&(s.order=i.order),s}function u(e,t){for(var i={named:[],implicit:[]},n=0;n<e.length;n++){var r=e[n];("implicit"===r.kind?i.implicit:i.named).push(r.graph)}0===i.named.length&&0===i.implicit.length&&i.implicit.push({token:"uri",prefix:null,suffix:null,value:"https://github.com/antoniogarrote/rdfstore-js#default_graph"});var o={kind:"ask",token:"executableunit"};return o.dataset=i,o.pattern=t,o}function Q(e){return{graph:e,kind:"default",token:"graphClause"}}function V(e){return{graph:e,kind:"named",token:"graphCluase"}}function z(e){for(var t={},i=0;i<e.length;i++){var n=e[i];null!=n&&null!=n.limit?t.limit=n.limit:null!=n&&null!=n.offset&&(t.offset=n.offset)}return t}function q(e){return null!=e?e[1]:null}function H(e){return null!=e.length?{kind:"named",uri:e[2]}:{kind:"default",uri:e}}function G(){return"default"}function X(){return"named"}function W(e,t){var i=[];if(null!=t)for(var n=0;n<t.triplesContext.length;n++){var r=t.triplesContext[n];r.graph=e,i.push(r)}return{token:"quadsnottriples",quadsContext:i}}function K(e,t){return e=e.triplesContext,{token:"triplespattern",triplesContext:e=null!=t&&"object"==typeof t&&null!=t&&null!=t.length&&null!=t[2]&&null!=t[2].triplesContext?e.concat(t[2].triplesContext):e}}function J(e,t){return{token:"inlineData",values:[{var:e,value:t}]}}function Y(e,t){return{token:"inlineData",values:[],todo:!0}}function Z(){var e={token:"args",value:[]};return e}function ee(e,t,i){for(var n=[],r=0;r<i.length;r++)n.push(i[r][2]);var o={token:"args"};return o.value=[t].concat(n),null!=e&&"DISTINCT"===e.toUpperCase()?o.distinct=!0:o.distinct=!1,o}function te(e,t){for(var i=[],n=0;n<t.length;n++)i.push(t[n][2]);var r={token:"args"};return r.value=[e].concat(i),r}function ie(e,t){return e=e.triplesContext,{token:"triplestemplate",triplesContext:e=null!=t&&"object"==typeof t&&null!=t.length&&null!=t[3]&&null!=t[3].triplesContext?e.concat(t[3].triplesContext):e}}function ne(e,t,i){for(var n={token:"propertylist"},r=[],o=[],s=0;s<t.length;s++)null!=t[s].triplesContext?(r=r.concat(t[s].triplesContext),"triplesnodecollection"===t[s].token&&null!=t[s].chainSubject.length?o.push([e,t[s].chainSubject[0]]):o.push([e,t[s].chainSubject])):o.push([e,t[s]]);for(s=0;s<i.length;s++)for(var a=i[s][3],l=a[0],u=a[2]||[],c=0;c<u.length;c++)null!=u[c].triplesContext?(r=r.concat(u[c].triplesContext),o.push([l,u[c].chainSubject])):o.push([l,u[c]]);return n.pairs=o,n.triplesContext=r,n}function re(e,t,i){for(var n={token:"propertylist"},r=[],o=[],s=0;s<t.length;s++)null!=t[s].triplesContext?(r=r.concat(t[s].triplesContext),"triplesnodecollection"===t[s].token&&null!=t[s].chainSubject.length?o.push([e,t[s].chainSubject[0]]):o.push([e,t[s].chainSubject])):o.push([e,t[s]]);for(s=0;s<i.length;s++)for(var a=i[s][3],l=a[0],u=a[1]||[],c=0;c<u.length;c++)null!=u[c].triplesContext?(r=r.concat(u[c].triplesContext),o.push([l,u[c].chainSubject])):o.push([l,u[c]]);return n.pairs=o,n.triplesContext=r,n}function oe(e,t){if(null!=t&&0!==t.length){for(var i=[e],n=0;n<t.length;n++)i.push(t[n][1]);(e={token:"path",kind:"sequence"}).value=i}return e}function se(e,t){var i;return e.token&&"path"!=e.token&&""==t?e:e.token&&e.token!=i&&""!=t?((i={token:"path",kind:"element"}).value=e,i.modifier=t,i):(e.modifier=t,e)}function ae(e){for(var t=[],i=[],n=null,r=0;r<e.length;r++){a++;var o=null;null==e[r].chainSubject&&null==e[r].triplesContext?o=e[r]:(o=e[r].chainSubject,t=t.concat(e[r].triplesContext)),n={subject:{token:"blank",value:"_:"+a},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"},object:o},0==r&&i.push(n.subject),t.push(n),n=r===e.length-1?{subject:{token:"blank",value:"_:"+a},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}}:{subject:{token:"blank",value:"_:"+a},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"blank",value:"_:"+(a+1)}},t.push(n)}return{token:"triplesnodecollection",triplesContext:t,chainSubject:i}}function le(e){for(var t=[],i=[],n=null,r=0;r<e.length;r++){a++;var o=null;null==e[r].chainSubject&&null==e[r].triplesContext?o=e[r]:(o=e[r].chainSubject,t=t.concat(o.triplesContext)),n={subject:{token:"blank",value:"_:"+a},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"},object:o},0==r&&i.push(n.subject),t.push(n),n=r===e.length-1?{subject:{token:"blank",value:"_:"+a},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}}:{subject:{token:"blank",value:"_:"+a},predicate:{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"},object:{token:"blank",value:"_:"+(a+1)}},t.push(n)}return{token:"triplesnodecollection",triplesContext:t,chainSubject:i}}function ue(e,t){if(0===t.length)return e;for(var i={token:"expression",expressionType:"conditionalor"},n=[e],r=0;r<t.length;r++)n.push(t[r][3]);return i.operands=n,i}function ce(e,t){if(0===t.length)return e;var i={token:"expression",expressionType:"multiplicativeexpression"};i.factor=e,i.factors=[];for(var n=0;n<t.length;n++){var r=t[n],o={};o.operator=r[1],o.expression=r[3],i.factors.push(o)}return i}function de(e){var t={token:"expression",expressionType:"atomic",primaryexpression:"rdfliteral"};return t.value=e,t}function he(e){var t={token:"expression",expressionType:"atomic",primaryexpression:"numericliteral"};return t.value=e,t}function pe(e){var t={token:"expression",expressionType:"atomic",primaryexpression:"booleanliteral"};return t.value=e,t}function fe(e){var t={token:"expression",expressionType:"atomic",primaryexpression:"var"};return t.value=e,t}function ge(e,t,i){var n={token:"expression",expressionType:"regex"};return n.text=e,n.pattern=t,null!=i&&(n.flags=i[2]),n}function me(e){var t={token:"expression",expressionType:"builtincall",builtincall:"exists"};return t.args=[e],t}function ve(e){var t={token:"expression",expressionType:"builtincall",builtincall:"notexists"};return t.args=[e],t}function ye(e){return{token:"string",value:e}}function be(e){return{token:"uri",prefix:e[0],suffix:e[1],value:null}}function we(e){return{token:"uri",prefix:e,suffix:"",value:null}}function xe(e){return{token:"blank",value:e}}function _e(){return{token:"blank",value:"_:"+ ++a}}function ke(e){return e.join("")}function Ce(e,t){return(0===t.length?"@"+e.join(""):"@"+e.join("")+"-"+t[0][1].join("")).toLowerCase()}function Ee(e,t,i){return pg([e,t,i])}function Fe(e,t){if("."==t[t.length-1])throw new Error("Wrong PN_PREFIX, cannot finish with '.'");return e+t.join("")}function Te(e,t){return e+(t||[]).join("")}function De(e){return e.join("")}var x={},Se={DOCUMENT:Up},Re=Up,je=n("[1] QueryUnit"),Ie=n("[2] Query"),Ae=function(e,t,i){return{token:"query",kind:"query",prologue:e,units:[t],inlineData:i}},Oe=n("[3] Prologue"),Ne=n("[4] BaseDecl"),Le="BASE",Pe=e("BASE",!1),Me="base",Ue=e("base",!1),$e=function(e){fg.null=e;var t={};return t.token="base",t.value=e,t},Be=n("[5] PrefixDecl"),Qe="PREFIX",Ve=e("PREFIX",!1),ze="prefix",qe=e("prefix",!1),He=function(e,t){fg[e]=t;var i={};return i.token="prefix",i.prefix=e,i.local=t,i},Ge=n("[6] SelectQuery"),Xe=n("[7] SubSelect"),We=n("[8] SelectClause"),Ke="SELECT",Je=e("SELECT",!1),Ye="select",Ze=e("select",!1),_="DISTINCT",et=e("DISTINCT",!1),k="distinct",tt=e("distinct",!1),it="REDUCED",nt=e("REDUCED",!1),rt="reduced",ot=e("reduced",!1),C="(",E=e("(",!1),st="AS",at=e("AS",!1),lt="as",ut=e("as",!1),F=")",T=e(")",!1),D="*",ct=e("*",!1),dt=function(e,t){var i=[];if(3===t.length&&"*"===t[1])return{vars:[{token:"variable",kind:"*"}],modifier:hg(e)};for(var n=0;n<t.length;n++){var r=t[n];3===r.length?i.push({token:"variable",kind:"var",value:r[1]}):i.push({token:"variable",kind:"aliased",expression:r[3],alias:r[7]})}return{vars:i,modifier:hg(e)}},ht=n("[9] ConstructQuery"),pt="CONSTRUCT",ft=e("CONSTRUCT",!1),gt="construct",mt=e("construct",!1),vt="WHERE",yt=e("WHERE",!1),bt="where",wt=e("where",!1),m="{",v=e("{",!1),y="}",b=e("}",!1),xt=n("[10] DescribeQuery"),_t="DESCRIBE",kt=e("DESCRIBE",!1),Ct=n("[11] AskQuery"),Et="ASK",Ft=e("ASK",!1),Tt="ask",Dt=e("ask",!1),St=n("[12] DatasetClause"),Rt="FROM",jt=e("FROM",!1),It="from",At=e("from",!1),Ot=function(e){return e},Nt=n("[13] DefaultGraphClause"),Lt=n("[14] NamedGraphClause"),Pt="NAMED",Mt=e("NAMED",!1),Ut="named",$t=e("named",!1),Bt=n("[15] SourceSelector"),Qt=n("[16] WhereClause"),Vt=function(e){return e},zt=n("[17] SolutionModifier"),qt=function(e,t,i){var n={};return null!=i&&(null!=i.limit&&(n.limit=i.limit),null!=i.offset)&&(n.offset=i.offset),null!=e&&(n.group=e),n.order=t,n},Ht=n("[18] GroupClause"),Gt="GROUP",Xt=e("GROUP",!1),Wt="group",Kt=e("group",!1),Jt="BY",Yt=e("BY",!1),Zt="by",ei=e("by",!1),ti=n("[19] GroupCondition"),ii=function(e){return e},ni=function(e){return e},ri=function(e,t){return 0!=t.length?{token:"aliased_expression",expression:e,alias:t[2]}:e},oi=function(e){return e},si=n("[20] HavingClause"),ai="HAVING",li=e("HAVING",!1),ui=n("[21] HavingCondition"),ci=n("[22] OrderClause"),di="ORDER",hi=e("ORDER",!1),pi="order",fi=e("order",!1),gi=n("[23] OrderCondition"),mi="ASC",vi=e("ASC",!1),yi="asc",bi=e("asc",!1),wi="DESC",xi=e("DESC",!1),_i="desc",ki=e("desc",!1),Ci=function(e,t){return{direction:e.toUpperCase(),expression:t}},Ei=function(e){return{direction:"ASC",expression:e="var"===e.token?{token:"expression",expressionType:"atomic",primaryexpression:"var",value:e}:e}},Fi=n("[24] LimitOffsetClauses"),Ti=n("[25] LimitClause"),Di="LIMIT",Si=e("LIMIT",!1),Ri="limit",ji=e("limit",!1),Ii=function(e){return{limit:parseInt(e.value)}},Ai=n("[26] OffsetClause"),Oi="OFFSET",Ni=e("OFFSET",!1),Li="offset",Pi=e("offset",!1),Mi=function(e){return{offset:parseInt(e.value)}},Ui=n("[27] BindingsClause"),$i="BINDINGS",Bi=e("BINDINGS",!1),Qi=n("[28] BindingValue"),Vi="UNDEF",zi=e("UNDEF",!1),qi=n("[28]\tValuesClause\t  ::=\t( 'VALUES' DataBlock )?"),Hi="VALUES",Gi=e("VALUES",!1),Xi="values",Wi=e("values",!1),Ki=n("[29] UpdateUnit"),Ji=n("[30] Update"),Yi=";",Zi=e(";",!1),en=function(e,t,i){var n={token:"query",kind:"update"},e=(n.prologue=e,[t]);return null!=i&&null!=i.length&&null!=i[3]&&null!=i[3].units&&(e=e.concat(i[3].units)),n.units=e,n},tn=n("[31] Update1"),nn=n("[32] Load"),rn="LOAD",on=e("LOAD",!1),sn="load",an=e("load",!1),ln="INTO",un=e("INTO",!1),cn="into",dn=e("into",!1),hn=function(e,t){var i={kind:"load",token:"executableunit"};return i.sourceGraph=e,null!=t&&(i.destinyGraph=t[2]),i},pn=n("[33] Clear"),fn="CLEAR",gn=e("CLEAR",!1),mn="clear",vn=e("clear",!1),yn="SILENT",bn=e("SILENT",!1),wn="silent",xn=e("silent",!1),_n=function(e){var t={kind:"clear",token:"executableunit"};return t.destinyGraph=e,t},kn=n("[34] Drop"),Cn="DROP",En=e("DROP",!1),Fn="drop",Tn=e("drop",!1),Dn=function(e){var t={kind:"drop",token:"executableunit"};return t.destinyGraph=e,t},Sn=n("[35] Create"),Rn="CREATE",jn=e("CREATE",!1),In="create",An=e("create",!1),On=function(e){var t={kind:"create",token:"executableunit"};return t.destinyGraph=e,t},Nn=n("[36] InsertData"),Ln="INSERT",Pn=e("INSERT",!1),Mn="insert",Un=e("insert",!1),$n="DATA",Bn=e("DATA",!1),Qn="data",Vn=e("data",!1),zn=function(e){var t={kind:"insertdata",token:"executableunit"};return t.quads=e,t},qn=n("[37] DeleteData"),Hn="DELETE",Gn=e("DELETE",!1),Xn="delete",Wn=e("delete",!1),Kn=function(e){var t={kind:"deletedata",token:"executableunit"};return t.quads=e,t},Jn=n("[38] DeleteWhere"),Yn=function(e){var t={kind:"modify"};t.pattern=e,t.with=null;for(var i=[],n=((t.using=null)==(n=e.patterns[0]).triplesContext&&null!=n.patterns?n.patterns[0]:n).triplesContext,r=0;r<n.length;r++){var o={},s=n[r];o.subject=s.subject,o.predicate=s.predicate,o.object=s.object,o.graph=s.graph,i.push(o)}return t.delete=i,t},Zn=n("[39] Modify"),er="WITH",tr=e("WITH",!1),ir="with",nr=e("with",!1),rr=function(e,t,i,n){var r={kind:"modify"};return r.with=""!=e&&null!=e?e[2]:null,3!==t.length||""!==t[2]&&null!=t[2]?3===t.length&&null!=t[0].length&&null!=t[1].length&&null!=t[2].length?(r.delete=t[0],r.insert=t[2]):(r.insert=t,r.delete=null):(r.delete=t[0],r.insert=null),""!=i&&(r.using=i),r.pattern=n,r},or=n("[40] DeleteClause"),sr=n("[41] InsertClause"),ar=n("[42] UsingClause"),lr="USING",ur=e("USING",!1),cr="using",dr=e("using",!1),hr=n("[43] GraphRef"),pr="GRAPH",fr=e("GRAPH",!1),gr="graph",mr=e("graph",!1),vr=n("[44] GraphRefAll"),yr="DEFAULT",br=e("DEFAULT",!1),wr="default",xr=e("default",!1),_r="ALL",kr=e("ALL",!1),Cr="all",Er=e("all",!1),Fr=n("[45] QuadPattern"),Tr=function(e){return e.quadsContext},Dr=n("[46] QuadData"),Sr=n("[47] Quads"),g=".",S=e(".",!1),Rr=function(e,t){var i=[];if(null!=e&&null!=e.triplesContext)for(var n=0;n<e.triplesContext.length;n++)(r=e.triplesContext[n]).graph=null,i.push(r);if(t&&0<t.length&&0<t[0].length&&(i=i.concat(t[0][0].quadsContext),null!=t[0][2])&&null!=t[0][2].triplesContext)for(var r,n=0;n<t[0][2].triplesContext.length;n++)(r=t[0][2].triplesContext[n]).graph=null,i.push(r);return{token:"quads",quadsContext:i}},jr=n("[48] QuadsNotTriples"),Ir=n("[49] TriplesTemplate"),Ar=function(e,t){e=e.triplesContext;return{token:"triplestemplate",triplesContext:e=null!=t&&"object"==typeof t&&null!=t.length&&null!=t[3]&&null!=t[3].triplesContext?e.concat(t[3].triplesContext):e}},Or=n("[50] GroupGraphPattern"),Nr=function(e){return e},Lr=n("[51] GroupGraphPatternSub"),Pr=function(e,t){var i=[];null!=e&&e!=[]&&i.push(e);for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)null!=t[n][r]&&null!=t[n][r].token&&i.push(t[n][r]);for(var o=[],s=[],a=[],l=[],n=0;n<i.length;n++)if("triplespattern"!==i[n].token&&"filter"!==i[n].token&&"bind"!==i[n].token){if(0!=s.length||0!=a.length){for(var u=[],r=0;r<s.length;r++)u=u.concat(s[r].triplesContext);0<u.length&&o.push({token:"basicgraphpattern",triplesContext:u}),s=[]}o.push(i[n])}else("triplespattern"===i[n].token?s:"bind"===i[n].token?l:a).push(i[n]);if(0!=s.length||0!=a.length){for(u=[],r=0;r<s.length;r++)u=u.concat(s[r].triplesContext);0<u.length&&o.push({token:"basicgraphpattern",triplesContext:u})}return{token:"groupgraphpattern",patterns:o,filters:a,binds:l}},Mr=n("[54] TriplesBlock"),Ur=n("[53] GraphPatternNotTriples"),$r=n("[54] OptionalGraphPattern"),Br="OPTIONAL",Qr=e("OPTIONAL",!1),Vr="optional",zr=e("optional",!1),qr=function(e){return{token:"optionalgraphpattern",value:e}},Hr=n("[55] GraphGraphPattern"),Gr=function(e,t){for(var i=0;i<t.patterns.length;i++)for(var n=t.patterns[i],r=0;r<n.triplesContext.length;r++)n.triplesContext[r].graph=e;return t.token="groupgraphpattern",t},Xr=n("[56] ServiceGraphPattern"),Wr="SERVICE",Kr=e("SERVICE",!1),Jr=function(e,t){return{token:"servicegraphpattern",status:"todo",value:[e,t]}},Yr=n("[57] MinusGraphPattern"),Zr="MINUS",eo=e("MINUS",!1),to="minus",io=e("minus",!1),no=function(e){return{token:"minusgraphpattern",status:"todo",value:e}},ro=n("[58] GroupOrUnionGraphPattern"),oo="UNION",so=e("UNION",!1),ao="union",lo=e("union",!1),uo=function(e,t){if(0===t.length)return e;for(var i={token:"graphunionpattern",value:[e]},n=0;n<t.length;n++)n==t.length-1?i.value.push(t[n][3]):(i.value.push(t[n][3]),i={token:"graphunionpattern",value:[i]});return i},co=n("[59] Filter"),ho="FILTER",po=e("FILTER",!1),fo="filter",go=e("filter",!1),mo=function(e){return{token:"filter",value:e}},vo=n("[60] Bind"),yo="BIND",bo=e("BIND",!1),wo="bind",xo=e("bind",!1),_o=function(e,t){return{token:"bind",expression:e,as:t}},ko=n("[60] Constraint"),Co=n("[61] InlineData"),Eo=function(e){return e},Fo=n("[62] DataBlock"),To=n("[63] InlineDataOneVar"),Do=n("[64] InlineDataFull"),So=n("[65] DataBlockValue"),Ro=n("[61] FunctionCall"),jo=function(e,t){var i={token:"expression",expressionType:"irireforfunction"};return i.iriref=e,i.args=t.value,i},Io=n("[62] ArgList"),R=",",j=e(",",!1),Ao=n("[63] ExpressionList"),Oo=n("[64] ConstructTemplate"),No=function(e){return e},Lo=n("[65] ConstructTriples"),Po=n("[66] TriplesSameSubject"),Mo=function(e,t){var i=t.triplesContext,n=e;if(t.pairs)for(var r=0;r<t.pairs.length;r++){var o=t.pairs[r],s=null;null!=o[1].length&&(o[1]=o[1][0]),n.token&&"triplesnodecollection"===n.token?(s={subject:n.chainSubject[0],predicate:o[0],object:o[1]},i.push(s),i=i.concat(n.triplesContext)):(s={subject:n,predicate:o[0],object:o[1]},i.push(s))}e={token:"triplessamesubject"};return e.triplesContext=i,e.chainSubject=n,e},Uo=function(e,t){var i=e.triplesContext,n=e.chainSubject;if(t.pairs)for(var r=0;r<t.pairs.length;r++){var o=t.pairs[r];if(null!=o[1].length&&(o[1]=o[1][0]),"triplesnodecollection"===e.token)for(var s=0;s<n.length;s++){var a=n[s];null!=a.triplesContext?(l={subject:a.chainSubject,predicate:o[0],object:o[1]},i.concat(a.triplesContext)):(l={subject:n[s],predicate:o[0],object:o[1]},i.push(l))}else{var l={subject:n,predicate:o[0],object:o[1]};i.push(l)}}var u={token:"triplessamesubject"};return u.triplesContext=i,u.chainSubject=n,u},$o=n("[83] PropertyListPathNotEmpty"),Bo=n("[67] PropertyListNotEmpty"),Qo=n("[68] PropertyList"),Vo=n("[86] ObjectListPath"),zo=function(e,t){var i=[];i.push(e);for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)"object"==typeof t[n][r]&&null!=t[n][r].token&&i.push(t[n][r]);return i},qo=n("[69] ObjectList"),Ho=function(e,t){var i=[];i.push(e);for(var n=0;n<t.length;n++)for(var r=0;r<t[n].length;r++)"object"==typeof t[n][r]&&null!=t[n][r].token&&i.push(t[n][r]);return i},Go=n("[87] ObjectPath"),Xo=n("[70] Object"),Wo=n("[71] Verb"),Ko="a",Jo=e("a",!1),Yo=function(){return{token:"uri",prefix:null,suffix:null,value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"}},Zo=n("[72] TriplesSameSubjectPath"),es=function(e,t){var i=t.triplesContext,n=e;if(t.pairs)for(var r=0;r<t.pairs.length;r++){var o=t.pairs[r],s=null;null!=o[1].length&&(o[1]=o[1][0]),n.token&&"triplesnodecollection"===n.token?("path"===(s={subject:n.chainSubject[0],predicate:o[0],object:o[1]}).predicate.token&&"element"===s.predicate.kind&&(s.predicate=s.predicate.value),i.push(s),i=i.concat(n.triplesContext)):("path"===(s={subject:n,predicate:o[0],object:o[1]}).predicate.token&&"element"===s.predicate.kind&&(s.predicate=s.predicate.value),i.push(s))}e={token:"triplessamesubject"};return e.triplesContext=i,e.chainSubject=n,e},ts=function(e,t){var i=e.triplesContext,n=e.chainSubject;if(null!=t&&null!=t.pairs)for(var r=0;r<t.pairs.length;r++){var o=t.pairs[r];if(null!=o[1].length&&(o[1]=o[1][0]),"triplesnodecollection"===e.token)for(var s=0;s<n.length;s++){var a=n[s];null!=a.triplesContext?(l={subject:a.chainSubject,predicate:o[0],object:o[1]},i.concat(a.triplesContext)):(l={subject:n[s],predicate:o[0],object:o[1]},i.push(l))}else{var l={subject:n,predicate:o[0],object:o[1]};i.push(l)}}var u={token:"triplessamesubject"};return u.triplesContext=i,u.chainSubject=n,u},is=n("[73] PropertyListNotEmptyPath"),ns=n("[74] PropertyListPath"),rs=n("[75]"),os=function(e){return e},ss=n("[76] VerbSimple"),as=n("[77] Path"),ls=n("[78] PathAlternative"),us="|",cs=e("|",!1),ds=function(e,t){if(null==t||0===t.length)return e;for(var i=[],n=0;n<t.length;n++)i.push(t[1]);e={token:"path",kind:"alternative"};return e.value=i,e},hs=n("[79] PathSequence"),ps="/",fs=e("/",!1),gs=n("[88] PathElt"),ms=n("[81] PathEltOrInverse"),vs="^",ys=e("^",!1),bs=function(e){var t={token:"path",kind:"inversePath"};return t.value=e,t},ws=n("[82] PathMod"),xs="?",_s=e("?",!1),ks="+",Cs=e("+",!1),Es=n("[83] PathPrimary"),Fs="!",Ts=e("!",!1),Ds=n("[85] PathOneInPropertySet"),Ss=n("[86] Integer"),Rs=n("[100] TriplesNodePath"),js=n("[87] TriplesNode"),Is=n("[101] BlankNodePropertyListPath"),As="[",Os=e("[",!1),Ns="]",Ls=e("]",!1),Ps=function(e){for(var t={token:"blank",value:"_:"+ ++a},i=[],n=0;n<e.pairs.length;n++){var r=e.pairs[n],o={};o.subject=t,o.predicate=r[0],null!=r[1].length&&(r[1]=r[1][0]),o.object=r[1],i.push(o)}return{token:"triplesnode",kind:"blanknodepropertylist",triplesContext:e.triplesContext.concat(i),chainSubject:t}},Ms=n("[88] BlankNodePropertyList"),Us=function(e){for(var t={token:"blank",value:"_:"+ ++a},i=[],n=0;n<e.pairs.length;n++){var r=e.pairs[n],o={};o.subject=t,o.predicate=r[0],null!=r[1].length&&(r[1]=r[1][0]),o.object=r[1],i.push(o)}return{token:"triplesnode",kind:"blanknodepropertylist",triplesContext:e.triplesContext.concat(i),chainSubject:t}},$s=n("[103] CollectionPath"),Bs=function(e){return e},Qs=n("[89] Collection"),Vs=n("[105] GraphNodePath"),zs=function(e){return e[1]},qs=n("[90] GraphNode"),Hs=n("[91] VarOrTerm"),Gs=n("[92] VarOrIRIref"),Xs=n("[93] Var"),Ws=function(e){var t={token:"var"};return t.value=e,t},Ks=n("[94] GraphTerm"),Js=n("[95] Expression"),Ys=n("[96] ConditionalOrExpression"),Zs="||",ea=e("||",!1),ta=n("[97] ConditionalAndExpression"),ia="&&",na=e("&&",!1),ra=function(e,t){if(0===t.length)return e;for(var i={token:"expression",expressionType:"conditionaland"},n=[e],r=0;r<t.length;r++)n.push(t[r][3]);return i.operands=n,i},oa=n("[98] ValueLogical"),sa=n("[99] RelationalExpression"),aa="=",la=e("=",!1),ua="!=",ca=e("!=",!1),da="<",ha=e("<",!1),pa=">",fa=e(">",!1),ga="<=",ma=e("<=",!1),va=">=",ya=e(">=",!1),ba="I",wa=e("I",!1),xa="i",_a=e("i",!1),ka="N",Ca=e("N",!1),Ea="n",Fa=e("n",!1),Ta="O",Da=e("O",!1),Sa="o",Ra=e("o",!1),ja="T",Ia=e("T",!1),Aa="t",Oa=e("t",!1),Na=function(e,t){if(0===t.length)return e;if("i"===t[0][1]||"I"===t[0][1]||"n"===t[0][1]||"N"===t[0][1]){for(var i,n={},r=("i"===t[0][1]||"I"===t[0][1]?(i="=",n.expressionType="conditionalor"):(i="!=",n.expressionType="conditionaland"),e),o=[],s=0;s<t[0].length;s++)if("args"===t[0][s].token){o=t[0][s].value;break}n.token="expression",n.operands=[];for(var a=0;a<o.length;a++){var l={token:"expression",expressionType:"relationalexpression"};l.operator=i,l.op1=r,l.op2=o[a],n.operands.push(l)}}else(n={expressionType:"relationalexpression"}).operator=t[0][1],n.op1=e,n.op2=t[0][3],n.token="expression";return n},La=n("[100] NumericExpression"),Pa=n("[101] AdditiveExpression"),c="-",d=e("-",!1),Ma=function(e,t){if(0===t.length)return e;var i={token:"expression",expressionType:"additiveexpression"};i.summand=e,i.summands=[];for(var n=0;n<t.length;n++){var r,o,s=t[n],a={};4==s.length&&"string"==typeof s[1]?(a.operator=s[1],a.expression=s[3]):(s={},a[1][1],o=a[1][3],(r=a[0]).value<0?(a.operator="-",r.value=-r.value):a.operator="+",s.token="expression",s.expressionType="multiplicativeexpression",s.operator=r,s.factors=[{operator:null,expression:o}],a.expression=s),i.summands.push(a)}return i},Ua=n("[102] MultiplicativeExpression"),$a=n("[103] UnaryExpression"),Ba=function(e){var t={token:"expression",expressionType:"unaryexpression",unaryexpression:"!"};return t.expression=e,t},Qa=function(e){var t={token:"expression",expressionType:"unaryexpression",unaryexpression:"+"};return t.expression=e,t},Va=function(e){var t={token:"expression",expressionType:"unaryexpression",unaryexpression:"-"};return t.expression=e,t},za=n("[104] PrimaryExpression"),qa=n("[105] BrackettedExpression"),Ha=function(e){return e},Ga=n("[106] BuiltInCall"),Xa="STR",Wa=e("STR",!1),Ka="str",Ja=e("str",!1),Ya=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"str"};return t.args=[e],t},Za="LANG",el=e("LANG",!1),tl="lang",il=e("lang",!1),nl=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"lang"};return t.args=[e],t},rl="LANGMATCHES",ol=e("LANGMATCHES",!1),sl="langmatches",al=e("langmatches",!1),ll=function(e,t){var i={token:"expression",expressionType:"builtincall",builtincall:"langmatches"};return i.args=[e,t],i},ul="DATATYPE",cl=e("DATATYPE",!1),dl="datatype",hl=e("datatype",!1),pl=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"datatype"};return t.args=[e],t},fl="BOUND",gl=e("BOUND",!1),ml="bound",vl=e("bound",!1),yl=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"bound"};return t.args=[e],t},bl="IRI",wl=e("IRI",!1),xl="iri",_l=e("iri",!1),kl=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"iri"};return t.args=[e],t},Cl="URI",El=e("URI",!1),Fl="uri",Tl=e("uri",!1),Dl=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"uri"};return t.args=[e],t},Sl="BNODE",Rl=e("BNODE",!1),jl="bnode",Il=e("bnode",!1),Al=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"bnode"};return 5===e.length?t.args=[e[2]]:t.args=null,t},Ol="COALESCE",Nl=e("COALESCE",!1),Ll="coalesce",Pl=e("coalesce",!1),Ml=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"coalesce"};return t.args=e,t},Ul="IF",$l=e("IF",!1),Bl="if",Ql=e("if",!1),Vl=function(e,t,i){var n={token:"expression",expressionType:"builtincall",builtincall:"if"};return n.args=[e,t,i],n},zl="ISLITERAL",ql=e("ISLITERAL",!1),Hl="isliteral",Gl=e("isliteral",!1),Xl="isLITERAL",Wl=e("isLITERAL",!1),Kl=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"isliteral"};return t.args=[e],t},Jl="ISBLANK",Yl=e("ISBLANK",!1),Zl="isblank",eu=e("isblank",!1),tu="isBLANK",iu=e("isBLANK",!1),nu=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"isblank"};return t.args=[e],t},ru="SAMETERM",ou=e("SAMETERM",!1),su="sameterm",au=e("sameterm",!1),lu=function(e,t){var i={token:"expression",expressionType:"builtincall",builtincall:"sameterm"};return i.args=[e,t],i},uu="ISURI",cu=e("ISURI",!1),du="isuri",hu=e("isuri",!1),pu="isURI",fu=e("isURI",!1),gu="ISIRI",mu=e("ISIRI",!1),vu="isiri",yu=e("isiri",!1),bu="isIRI",wu=e("isIRI",!1),xu=function(e){var t={token:"expression",expressionType:"builtincall",builtincall:"isuri"};return t.args=[e],t},_u="custom:",ku=e("custom:",!1),Cu="CUSTOM:",Eu=e("CUSTOM:",!1),Fu=/^[a-zA-Z0-9_]/,Tu=i([["a","z"],["A","Z"],["0","9"],"_"],!1,!1),Du=function(e,t,i){var n={token:"expression",expressionType:"custom"};n.name=e.join("");for(var r=[],o=0;o<t.length;o++)r.push(t[o][1]);return r.push(i),n.args=r,n},Su=n("[107] RegexExpression"),Ru="REGEX",ju=e("REGEX",!1),Iu="regex",Au=e("regex",!1),Ou=n("[108] ExistsFunc"),Nu="EXISTS",Lu=e("EXISTS",!1),Pu="exists",Mu=e("exists",!1),Uu=n("[109] NotExistsFunc"),$u="NOT",Bu=e("NOT",!1),Qu="not",Vu=e("not",!1),zu=n("[110] Aggregate"),qu="COUNT",Hu=e("COUNT",!1),Gu="count",Xu=e("count",!1),Wu=function(e,t){var i={token:"expression",expressionType:"aggregate",aggregateType:"count"};return i.distinct=""!=e&&null!=e?"DISTINCT":e,i.expression=t,i},Ku="GROUP_CONCAT",Ju=e("GROUP_CONCAT",!1),Yu="group_concat",Zu=e("group_concat",!1),ec="SEPARATOR",tc=e("SEPARATOR",!1),ic=function(e,t,i){var n={token:"expression",expressionType:"aggregate",aggregateType:"group_concat"};return n.distinct=""!=e&&null!=e?"DISTINCT":e,n.expression=t,n.separator=i,n},nc="SUM",rc=e("SUM",!1),oc="sum",sc=e("sum",!1),ac=function(e,t){var i={token:"expression",expressionType:"aggregate",aggregateType:"sum"};return i.distinct=""!=e&&null!=e?"DISTINCT":e,i.expression=t,i},lc="MIN",uc=e("MIN",!1),cc="min",dc=e("min",!1),hc=function(e,t){var i={token:"expression",expressionType:"aggregate",aggregateType:"min"};return i.distinct=""!=e&&null!=e?"DISTINCT":e,i.expression=t,i},pc="MAX",fc=e("MAX",!1),gc="max",mc=e("max",!1),vc=function(e,t){var i={token:"expression",expressionType:"aggregate",aggregateType:"max"};return i.distinct=""!=e&&null!=e?"DISTINCT":e,i.expression=t,i},yc="AVG",bc=e("AVG",!1),wc="avg",xc=e("avg",!1),_c=function(e,t){var i={token:"expression",expressionType:"aggregate",aggregateType:"avg"};return i.distinct=""!=e&&null!=e?"DISTINCT":e,i.expression=t,i},kc=n("[117] IRIrefOrFunction"),Cc=function(e,t){var i={token:"expression",expressionType:"irireforfunction"};return i.iriref=e,i.args=null!=t?t.value:t,i},Ec=n("[112] RDFLiteral"),Fc="^^",Tc=e("^^",!1),Dc=function(e,t){return"string"==typeof t&&0<t.length?{token:"literal",value:e.value,lang:t.slice(1),type:null}:null!=t&&"object"==typeof t?(t.shift(),{token:"literal",value:e.value,lang:null,type:t[0]}):{token:"literal",value:e.value,lang:null,type:null}},Sc=n("[113] NumericLiteral"),Rc=n("[114] NumericLiteralUnsigned"),jc=n("[115] NumericLiteralPositive"),Ic=n("[116] NumericLiteralNegative"),Ac=n("[117] BooleanLiteral"),Oc="TRUE",Nc=e("TRUE",!1),Lc="true",Pc=e("true",!1),Mc=function(){var e={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#boolean",value:!0};return e},Uc="FALSE",$c=e("FALSE",!1),Bc="false",Qc=e("false",!1),Vc=function(){var e={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#boolean",value:!1};return e},zc=n("[118] String"),qc=n("[119] IRIref"),Hc=function(e){return{token:"uri",prefix:null,suffix:null,value:e}},Gc=function(e){return e},Xc=n("[120] PrefixedName"),Wc=n("[121] BlankNode"),Kc=n("[122] IRI_REF"),Jc=/^[^<>"{}|\^`\\]/,Yc=i(["<",">",'"',"{","}","|","^","`","\\"],!0,!1),Zc=n("[123] PNAME_NS"),ed=":",td=e(":",!1),id=n("[124] PNAME_LN"),nd=function(e,t){return[e,t]},rd=n("[125] BLANK_NODE_LABEL"),od="_:",sd=e("_:",!1),ad=function(e){return e},ld=n("[126] VAR1"),ud=n("[127] VAR2"),cd="$",dd=e("$",!1),hd=n("[128] LANGTAG"),pd="@",fd=e("@",!1),gd=/^[a-zA-Z]/,md=i([["a","z"],["A","Z"]],!1,!1),vd=/^[a-zA-Z0-9]/,yd=i([["a","z"],["A","Z"],["0","9"]],!1,!1),bd=n("[129] INTEGER"),o=/^[0-9]/,s=i([["0","9"]],!1,!1),wd=function(e){var t={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#integer"};return t.value=pg(e),t},xd=n("[130] DECIMAL"),_d=function(e,t,i){var n={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#decimal"};return n.value=pg([e,t,i]),n},kd=function(e,t){var i={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#decimal"};return i.value=pg([e,t]),i},Cd=n("[131] DOUBLE"),Ed=function(e,t,i,n){var r={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};return r.value=pg([e,t,i,n]),r},Fd=function(e,t,i){var n={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};return n.value=pg([e,t,i]),n},Td=function(e,t){var i={token:"literal",lang:null,type:"http://www.w3.org/2001/XMLSchema#double"};return i.value=pg([e,t]),i},Dd=n("[132] INTEGER_POSITIVE"),Sd=function(e){return e.value="+"+e.value,e},Rd=n("[133] DECIMAL_POSITIVE"),jd=function(e){return e.value="+"+e.value,e},Id=n("[134] DOUBLE_POSITIVE"),Ad=n("[135] INTEGER_NEGATIVE"),Od=function(e){return e.value="-"+e.value,e},Nd=n("[136] DECIMAL_NEGATIVE"),Ld=n("[137] DOUBLE_NEGATIVE"),Pd=n("[138] EXPONENT"),Md=/^[eE]/,Ud=i(["e","E"],!1,!1),$d=/^[+\-]/,Bd=i(["+","-"],!1,!1),Qd=n("[139] STRING_LITERAL1"),Vd="'",zd=e("'",!1),qd=/^[^'\\\n\r]/,Hd=i(["'","\\","\n","\r"],!0,!1),Gd=function(e){return pg(e)},Xd=n("[140] STRING_LITERAL2"),Wd='"',Kd=e('"',!1),Jd=/^[^"\\\n\r]/,Yd=i(['"',"\\","\n","\r"],!0,!1),Zd=n("[141] STRING_LITERAL_LONG1"),eh="'''",th=e("'''",!1),ih=/^[^'\\]/,nh=i(["'","\\"],!0,!1),rh=n("[142] STRING_LITERAL_LONG2"),oh='"""',sh=e('"""',!1),ah=/^[^"\\]/,lh=i(['"',"\\"],!0,!1),uh=n("[143] ECHAR"),ch="\\",dh=e("\\",!1),hh=/^[tbnrf"']/,ph=i(["t","b","n","r","f",'"',"'"],!1,!1),fh=n("[144] NIL"),gh=function(){return{token:"triplesnodecollection",triplesContext:[],chainSubject:[{token:"uri",value:"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"}]}},mh=n("[145] WS"),vh=/^[ ]/,yh=i([" "],!1,!1),bh=/^[\t]/,wh=i(["\t"],!1,!1),xh=/^[\r]/,_h=i(["\r"],!1,!1),kh=/^[\n]/,Ch=i(["\n"],!1,!1),Eh=n(" COMMENT"),Fh="#",Th=e("#",!1),Dh=/^[^\n\r]/,Sh=i(["\n","\r"],!0,!1),Rh=n("[146] ANON"),jh=n("[147] PN_CHARS_BASE"),Ih=/^[A-Z]/,Ah=i([["A","Z"]],!1,!1),Oh=/^[a-z]/,Nh=i([["a","z"]],!1,!1),Lh=/^[\xC0-\xD6]/,Ph=i([["À","Ö"]],!1,!1),Mh=/^[\xD8-\xF6]/,Uh=i([["Ø","ö"]],!1,!1),$h=/^[\xF8-\u02FF]/,Bh=i([["ø","˿"]],!1,!1),Qh=/^[\u0370-\u037D]/,Vh=i([["Ͱ","ͽ"]],!1,!1),zh=/^[\u037F-\u1FFF]/,qh=i([["Ϳ","῿"]],!1,!1),Hh=/^[\u200C-\u200D]/,Gh=i([["‌","‍"]],!1,!1),Xh=/^[\u2070-\u218F]/,Wh=i([["⁰","↏"]],!1,!1),Kh=/^[\u2C00-\u2FEF]/,Jh=i([["Ⰰ","⿯"]],!1,!1),Yh=/^[\u3001-\uD7FF]/,Zh=i([["、","퟿"]],!1,!1),ep=/^[\uF900-\uFDCF]/,tp=i([["豈","﷏"]],!1,!1),ip=/^[\uFDF0-\uFFFD]/,np=i([["ﷰ","�"]],!1,!1),rp=/^[\u1000-\uEFFF]/,op=i([["က",""]],!1,!1),sp=n("[148] PN_CHARS_U"),ap="_",lp=e("_",!1),up=n("[149] VARNAME"),cp=/^[\xB7]/,dp=i(["·"],!1,!1),hp=/^[\u0300-\u036F]/,pp=i([["̀","ͯ"]],!1,!1),fp=/^[\u203F-\u2040]/,gp=i([["‿","⁀"]],!1,!1),mp=function(e,t){return e+t.join("")},vp=n("[150] PN_CHARS"),yp=n("[151] PN_PREFIX"),bp=n("[152] PN_LOCAL"),wp=n("[170] PLX"),xp=n("[171] PERCENT"),_p="%",kp=e("%",!1),Cp=n("[172] HEX"),Ep=/^[A-F]/,Fp=i([["A","F"]],!1,!1),Tp=/^[a-f]/,Dp=i([["a","f"]],!1,!1),Sp=n("[173] PN_LOCAL_ESC"),Rp="~",jp=e("~",!1),Ip="&",Ap=e("&",!1),I=0,Op=[{line:1,column:1}],t=0,Np=[],A=0;if("startRule"in(r=void 0!==r?r:{})){if(!(r.startRule in Se))throw new Error("Can't start parsing from rule \""+r.startRule+'".');Re=Se[r.startRule]}function e(e,t){return{type:"literal",text:e,ignoreCase:t}}function i(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function n(e){return{type:"other",description:e}}function Lp(e){var t,i=Op[e];if(i)return i;for(t=e-1;!Op[t];)t--;for(i={line:(i=Op[t]).line,column:i.column};t<e;)10===w.charCodeAt(t)?(i.line++,i.column=1):i.column++,t++;return Op[e]=i}function Pp(e,t){var i=Lp(e),n=Lp(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function O(e){I<t||(t<I&&(t=I,Np=[]),Np.push(e))}function Mp(e,t,i){return new gg(gg.buildMessage(e,t),e,t,i)}function Up(){var e;return e=(e=function(){var e;A++,e=function(){var e,t,i,n;A++,e=I,e=(t=$p())!==x&&((i=function(){var e,t,i,n,r,o,s,a,l,u;if(A++,e=I,(t=Qp())!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){for(n=[],r=N();r!==x;)n.push(r),r=N();if(n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=zp())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=qp())!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();e=l!==x&&(u=function(){var e,t,i,n,r,o,s,a,l;A++,e=I,w.substr(I,8)===$i?(t=$i,I+=8):(t=x,0===A&&O(Bi));if(t!==x){for(i=[],n=P();n!==x;)i.push(n),n=P();if(i!==x)if(123===w.charCodeAt(I)?(n=m,I++):(n=x,0===A&&O(v)),n!==x){if(r=[],o=I,40===w.charCodeAt(I)?(s=C,I++):(s=x,0===A&&O(E)),s!==x){if(a=[],(l=Jp())!==x)for(;l!==x;)a.push(l),l=Jp();else a=x;o=a!==x&&(41===w.charCodeAt(I)?(l=F,I++):(l=x,0===A&&O(T)),l!==x)?s=[s,a,l]:(I=o,x)}else I=o,o=x;for(o===x&&(o=rg());o!==x;){if(r.push(o),o=I,40===w.charCodeAt(I)?(s=C,I++):(s=x,0===A&&O(E)),s!==x){if(a=[],(l=Jp())!==x)for(;l!==x;)a.push(l),l=Jp();else a=x;o=a!==x&&(41===w.charCodeAt(I)?(l=F,I++):(l=x,0===A&&O(T)),l!==x)?s=[s,a,l]:(I=o,x)}else I=o,o=x;o===x&&(o=rg())}e=r!==x&&(125===w.charCodeAt(I)?(o=y,I++):(o=x,0===A&&O(b)),o!==x)?t=[t,i,n,r,o]:(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;e===x&&(e=null);A--,e===x&&(t=x,0===A)&&O(Ui);return e}())!==x?t=f(t,n,o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ge);return e}())===x&&(i=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h,p,f;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,9)===pt?(i=pt,I+=9):(i=x,0===A&&O(ft)),i===x&&(w.substr(I,9)===gt?(i=gt,I+=9):(i=x,0===A&&O(mt))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=function(){var e,t,i,n,r,o;A++,e=I,123===w.charCodeAt(I)?(t=m,I++):(t=x,0===A&&O(v));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=(n=function e(){var t,i,n,r,o,s,a;A++;t=I;i=vf();if(i!==x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(46===w.charCodeAt(I)?(o=g,I++):(o=x,0===A&&O(S)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=(a=e())===x?null:a)!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;t=(n=n===x?null:n)!==x?i=ie(i,n):(I=t,x)}else I=t,t=x;A--;t===x&&(i=x,0===A)&&O(Lo);return t}())===x?null:n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(125===w.charCodeAt(I)?(o=y,I++):(o=x,0===A&&O(b)),o!==x)?t=No(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Oo);return e}())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x){for(s=[],a=N();a!==x;)s.push(a),a=N();if(s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();if(a!==x)if((l=zp())!==x){for(u=[],c=U();c!==x;)u.push(c),c=U();e=u!==x&&(c=qp())!==x?t=$(r,s,l,c):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;if(e===x){for(e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,9)===pt?(i=pt,I+=9):(i=x,0===A&&O(ft)),i===x&&(w.substr(I,9)===gt?(i=gt,I+=9):(i=x,0===A&&O(mt))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x){for(r=[],o=N();o!==x;)r.push(o),o=N();if(r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(w.substr(I,5)===vt?(s=vt,I+=5):(s=x,0===A&&O(yt)),s===x&&(w.substr(I,5)===bt?(s=bt,I+=5):(s=x,0===A&&O(wt))),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();if(a!==x)if(123===w.charCodeAt(I)?(l=m,I++):(l=x,0===A&&O(v)),l!==x){for(u=[],c=U();c!==x;)u.push(c),c=U();if(u!==x)if((c=(c=lf())===x?null:c)!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();if(d!==x)if(125===w.charCodeAt(I)?(h=y,I++):(h=x,0===A&&O(b)),h!==x){for(p=[],f=U();f!==x;)p.push(f),f=U();e=p!==x&&(f=qp())!==x?t=B(r,c,f):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}A--,e===x&&(t=x,0===A)&&O(ht);return e}())===x&&(i=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,8)===_t?(t=_t,I+=8):(t=x,0===A&&O(kt));if(t!==x){if(i=[],(n=Mf())!==x)for(;n!==x;)i.push(n),n=Mf();else i=x;if(i===x&&(42===w.charCodeAt(I)?(i=D,I++):(i=x,0===A&&O(ct))),i!==x){for(n=[],r=N();r!==x;)n.push(r),r=N();e=n!==x&&(r=(r=zp())===x?null:r)!==x&&(o=qp())!==x?t=[t,i,n,r,o]:(I=e,x)}else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(xt);return e}())===x&&(i=function(){var e,t,i,n,r,o,s;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,3)===Et?(i=Et,I+=3):(i=x,0===A&&O(Ft)),i===x&&(w.substr(I,3)===Tt?(i=Tt,I+=3):(i=x,0===A&&O(Dt))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x){for(r=[],o=N();o!==x;)r.push(o),o=N();if(r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();e=o!==x&&(s=zp())!==x?t=u(r,s):(I=e,x)}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ct);return e}()),i!==x)&&(n=function(){var e,t,i,n;A++,t=e=I,w.substr(I,6)===Hi?(i=Hi,I+=6):(i=x,0===A&&O(Gi));i===x&&(w.substr(I,6)===Xi?(i=Xi,I+=6):(i=x,0===A&&O(Wi)));t=i!==x&&(n=hf(),n!==x)?i=[i,n]:(I=t,x);t===x&&(t=null);t!==x&&(t=q(t));A--,(e=t)===x&&(t=x,0===A)&&O(qi);return e}())!==x?t=Ae(t,i,n):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Ie);return e}(),A--,e===x&&0===A&&O(je);return e}())===x?function(){var e;A++,e=function e(){var t,i,n,r,o,s,a,l,u;A++;t=I;i=$p();if(i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=Yp())!==x){for(o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=(u=e())===x?null:u)!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x;t=(o=o===x?null:o)!==x?i=en(i,r,o):(I=t,x)}else I=t,t=x;else I=t,t=x}else I=t,t=x;A--;t===x&&(i=x,0===A)&&O(Ji);return t}(),A--,e===x&&0===A&&O(Ki);return e}():e}function $p(){var e,t,i,n,r;if(A++,e=I,(t=(t=function(){var e,t,i,n,r;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,4)===Le?(i=Le,I+=4):(i=x,0===A&&O(Pe)),i===x&&(w.substr(I,4)===Me?(i=Me,I+=4):(i=x,0===A&&O(Ue))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=Jf())!==x?t=$e(r):(I=e,x)}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ne);return e}())===x?null:t)!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){for(n=[],r=Bp();r!==x;)n.push(r),r=Bp();e=n!==x?t=l(t,n):(I=e,x)}else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Oe),e}function Bp(){var e,t,i,n,r,o,s;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,6)===Qe?(i=Qe,I+=6):(i=x,0===A&&O(Ve)),i===x&&(w.substr(I,6)===ze?(i=ze,I+=6):(i=x,0===A&&O(qe))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=Yf())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();e=o!==x&&(s=Jf())!==x?t=He(r,s):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Be),e}function Qp(){var e,t,i,n,r,o,s,a,l,u,c,d,h,p,f,g,m,v,y,b;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,6)===Ke?(i=Ke,I+=6):(i=x,0===A&&O(Je)),i===x&&(w.substr(I,6)===Ye?(i=Ye,I+=6):(i=x,0===A&&O(Ze))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if(w.substr(I,8)===_?(r=_,I+=8):(r=x,0===A&&O(et)),r===x&&(w.substr(I,8)===k?(r=k,I+=8):(r=x,0===A&&O(tt))),r===x&&(w.substr(I,7)===it?(r=it,I+=7):(r=x,0===A&&O(nt)),r===x)&&(w.substr(I,7)===rt?(r=rt,I+=7):(r=x,0===A&&O(ot))),(r=r===x?null:r)!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x){for(s=[],a=I,l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=P())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();a=c!==x?l=[l,u,c]:(I=a,x)}else I=a,a=x;else I=a,a=x;if(a===x){for(a=I,l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(40===w.charCodeAt(I)?(u=C,I++):(u=x,0===A&&O(E)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x)if((d=M())!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();if(h!==x)if(w.substr(I,2)===st?(p=st,I+=2):(p=x,0===A&&O(at)),p===x&&(w.substr(I,2)===lt?(p=lt,I+=2):(p=x,0===A&&O(ut))),p!==x){for(f=[],g=U();g!==x;)f.push(g),g=U();if(f!==x)if((g=P())!==x){for(m=[],v=U();v!==x;)m.push(v),v=U();if(m!==x)if(41===w.charCodeAt(I)?(v=F,I++):(v=x,0===A&&O(T)),v!==x){for(y=[],b=U();b!==x;)y.push(b),b=U();a=y!==x?l=[l,u,c,d,h,p,f,g,m,v,y]:(I=a,x)}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}if(a!==x)for(;a!==x;){for(s.push(a),a=I,l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=P())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();a=c!==x?l=[l,u,c]:(I=a,x)}else I=a,a=x;else I=a,a=x;if(a===x){for(a=I,l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(40===w.charCodeAt(I)?(u=C,I++):(u=x,0===A&&O(E)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x)if((d=M())!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();if(h!==x)if(w.substr(I,2)===st?(p=st,I+=2):(p=x,0===A&&O(at)),p===x&&(w.substr(I,2)===lt?(p=lt,I+=2):(p=x,0===A&&O(ut))),p!==x){for(f=[],g=U();g!==x;)f.push(g),g=U();if(f!==x)if((g=P())!==x){for(m=[],v=U();v!==x;)m.push(v),v=U();if(m!==x)if(41===w.charCodeAt(I)?(v=F,I++):(v=x,0===A&&O(T)),v!==x){for(y=[],b=U();b!==x;)y.push(b),b=U();a=y!==x?l=[l,u,c,d,h,p,f,g,m,v,y]:(I=a,x)}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}else I=a,a=x;else I=a,a=x}}else s=x;if(s===x){for(s=I,a=[],l=U();l!==x;)a.push(l),l=U();if(a!==x)if(42===w.charCodeAt(I)?(l=D,I++):(l=x,0===A&&O(ct)),l!==x){for(u=[],c=U();c!==x;)u.push(c),c=U();s=u!==x?a=[a,l,u]:(I=s,x)}else I=s,s=x;else I=s,s=x}e=s!==x?t=dt(r,s):(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(We),e}function N(){var e,t,i,n,r,o;if(A++,e=I,w.substr(I,4)===Rt?(t=Rt,I+=4):(t=x,0===A&&O(jt)),t===x&&(w.substr(I,4)===It?(t=It,I+=4):(t=x,0===A&&O(At))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=(n=function(){var e,t,i;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();e=t!==x&&(i=Vp(),i!==x)?t=Q(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Nt);return e}())===x?function(){var e,t,i,n;A++,e=I,w.substr(I,5)===Pt?(t=Pt,I+=5):(t=x,0===A&&O(Mt));t===x&&(w.substr(I,5)===Ut?(t=Ut,I+=5):(t=x,0===A&&O($t)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=Vp())!==x?t=V(n):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Lt);return e}():n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x?t=Ot(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(St),e}function Vp(){var e;return A++,e=h(),A--,e===x&&0===A&&O(Bt),e}function zp(){var e,t,i,n,r,o;if(A++,e=I,w.substr(I,5)===vt?(t=vt,I+=5):(t=x,0===A&&O(yt)),t===x&&(w.substr(I,5)===bt?(t=bt,I+=5):(t=x,0===A&&O(wt))),(t=t===x?null:t)!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=L())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x?t=Vt(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Qt),e}function qp(){var e,t,i,n;return A++,e=I,e=(t=(t=function(){var e,t,i,n,r,o,s;A++,e=I,w.substr(I,5)===Gt?(t=Gt,I+=5):(t=x,0===A&&O(Xt));t===x&&(w.substr(I,5)===Wt?(t=Wt,I+=5):(t=x,0===A&&O(Kt)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,2)===Jt?(n=Jt,I+=2):(n=x,0===A&&O(Yt)),n===x&&(w.substr(I,2)===Zt?(n=Zt,I+=2):(n=x,0===A&&O(ei))),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x){if(o=[],(s=Hp())!==x)for(;s!==x;)o.push(s),s=Hp();else o=x;e=o!==x?t=o:(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ht);return e}())===x?null:t)!==x&&(i=(i=function(){var e,t,i,n;A++,e=I,w.substr(I,6)===ai?(t=ai,I+=6):(t=x,0===A&&O(li));if(t!==x){if(i=[],(n=Gp())!==x)for(;n!==x;)i.push(n),n=Gp();else i=x;e=i!==x?t=[t,i]:(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(si);return e}())===x?null:i)!==x&&(i=(i=function(){var e,t,i,n,r,o,s,a;A++,e=I,w.substr(I,5)===di?(t=di,I+=5):(t=x,0===A&&O(hi));t===x&&(w.substr(I,5)===pi?(t=pi,I+=5):(t=x,0===A&&O(fi)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,2)===Jt?(n=Jt,I+=2):(n=x,0===A&&O(Yt)),n===x&&(w.substr(I,2)===Zt?(n=Zt,I+=2):(n=x,0===A&&O(ei))),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x){if(o=[],(s=Xp())!==x)for(;s!==x;)o.push(s),s=Xp();else o=x;if(o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x?t=o:(I=e,x)}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(ci);return e}())===x?null:i)!==x&&(n=(n=function(){var e,t,i,n;A++,t=e=I,t=(i=Wp())!==x&&(n=Kp(),(n=n===x?null:n)!==x)?i=[i,n]:(I=t,x);t===x&&(t=I,i=Kp(),t=i!==x&&(n=(n=Wp())===x?null:n)!==x?i=[i,n]:(I=t,x));t!==x&&(t=z(t));A--,(e=t)===x&&(t=x,0===A)&&O(Fi);return e}())===x?null:n)!==x?t=qt(t,i,n):(I=e,x),A--,e===x&&(t=x,0===A)&&O(zt),e}function Hp(){var e,t,i,n,r,o,s,a,l,u,c;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=qf())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x?t=ii(i):(I=e,x)}else I=e,e=x;else I=e,e=x;if(e===x){for(e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=ff())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x?t=ni(i):(I=e,x)}else I=e,e=x;else I=e,e=x;if(e===x){for(e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(40===w.charCodeAt(I)?(i=C,I++):(i=x,0===A&&O(E)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=M())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x){if(s=I,w.substr(I,2)===st?(a=st,I+=2):(a=x,0===A&&O(at)),a===x&&(w.substr(I,2)===lt?(a=lt,I+=2):(a=x,0===A&&O(ut))),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();s=l!==x&&(u=P())!==x?a=[a,l,u]:(I=s,x)}else I=s,s=x;if((s=s===x?null:s)!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();if(a!==x)if(41===w.charCodeAt(I)?(l=F,I++):(l=x,0===A&&O(T)),l!==x){for(u=[],c=U();c!==x;)u.push(c),c=U();e=u!==x?t=ri(r,s):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;if(e===x){for(e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=P())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x?t=oi(i):(I=e,x)}else I=e,e=x;else I=e,e=x}}}return A--,e===x&&(t=x,0===A)&&O(ti),e}function Gp(){var e;return A++,e=df(),A--,e===x&&0===A&&O(ui),e}function Xp(){var e,t,i,n,r,o;if(A++,e=I,w.substr(I,3)===mi?(t=mi,I+=3):(t=x,0===A&&O(vi)),t===x&&(w.substr(I,3)===yi?(t=yi,I+=3):(t=x,0===A&&O(bi)),t===x)&&(w.substr(I,4)===wi?(t=wi,I+=4):(t=x,0===A&&O(xi)),t===x)&&(w.substr(I,4)===_i?(t=_i,I+=4):(t=x,0===A&&O(ki))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=zf())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x?t=Ci(t,n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x)if(e=I,(t=(t=df())===x?P():t)!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x?t=Ei(t):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(gi),e}function Wp(){var e,t,i,n,r,o;if(A++,e=I,w.substr(I,5)===Di?(t=Di,I+=5):(t=x,0===A&&O(Si)),t===x&&(w.substr(I,5)===Ri?(t=Ri,I+=5):(t=x,0===A&&O(ji))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=Zf())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x?t=Ii(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Ti),e}function Kp(){var e,t,i,n,r,o;if(A++,e=I,w.substr(I,6)===Oi?(t=Oi,I+=6):(t=x,0===A&&O(Ni)),t===x&&(w.substr(I,6)===Li?(t=Li,I+=6):(t=x,0===A&&O(Pi))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=Zf())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x?t=Mi(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Ai),e}function Jp(){var e;return A++,(e=h())===x&&(e=Hf())===x&&(e=Gf())===x&&(e=Wf())===x&&(w.substr(I,5)===Vi?(e=Vi,I+=5):(e=x,0===A&&O(zi))),A--,e===x&&0===A&&O(Qi),e}function Yp(){var e;return A++,(e=function(){var e,t,i,n,r,o,s,a,l;A++,e=I,w.substr(I,4)===rn?(t=rn,I+=4):(t=x,0===A&&O(on));t===x&&(w.substr(I,4)===sn?(t=sn,I+=4):(t=x,0===A&&O(an)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=h())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x){if(o=I,w.substr(I,4)===ln?(s=ln,I+=4):(s=x,0===A&&O(un)),s===x&&(w.substr(I,4)===cn?(s=cn,I+=4):(s=x,0===A&&O(dn))),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();o=a!==x&&(l=tf())!==x?s=[s,a,l]:(I=o,x)}else I=o,o=x;e=(o=o===x?null:o)!==x?t=hn(n,o):(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(nn);return e}())===x&&(e=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,5)===fn?(t=fn,I+=5):(t=x,0===A&&O(gn));t===x&&(w.substr(I,5)===mn?(t=mn,I+=5):(t=x,0===A&&O(vn)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,6)===yn?(n=yn,I+=6):(n=x,0===A&&O(bn)),n===x&&(w.substr(I,6)===wn?(n=wn,I+=6):(n=x,0===A&&O(xn))),(n=n===x?null:n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(o=nf())!==x?t=_n(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(pn);return e}())===x&&(e=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,4)===Cn?(t=Cn,I+=4):(t=x,0===A&&O(En));t===x&&(w.substr(I,4)===Fn?(t=Fn,I+=4):(t=x,0===A&&O(Tn)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,6)===yn?(n=yn,I+=6):(n=x,0===A&&O(bn)),n===x&&(w.substr(I,6)===wn?(n=wn,I+=6):(n=x,0===A&&O(xn))),(n=n===x?null:n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(o=nf())!==x?t=Dn(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(kn);return e}())===x&&(e=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,6)===Rn?(t=Rn,I+=6):(t=x,0===A&&O(jn));t===x&&(w.substr(I,6)===In?(t=In,I+=6):(t=x,0===A&&O(An)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,6)===yn?(n=yn,I+=6):(n=x,0===A&&O(bn)),n===x&&(w.substr(I,6)===wn?(n=wn,I+=6):(n=x,0===A&&O(xn))),(n=n===x?null:n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(o=tf())!==x?t=On(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Sn);return e}())===x&&(e=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,6)===Ln?(t=Ln,I+=6):(t=x,0===A&&O(Pn));t===x&&(w.substr(I,6)===Mn?(t=Mn,I+=6):(t=x,0===A&&O(Un)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,4)===$n?(n=$n,I+=4):(n=x,0===A&&O(Bn)),n===x&&(w.substr(I,4)===Qn?(n=Qn,I+=4):(n=x,0===A&&O(Vn))),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(o=of())!==x?t=zn(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Nn);return e}())===x&&(e=function(){var e,t,i,n,r;A++,e=I,w.substr(I,6)===Hn?(t=Hn,I+=6):(t=x,0===A&&O(Gn));t===x&&(w.substr(I,6)===Xn?(t=Xn,I+=6):(t=x,0===A&&O(Wn)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(w.substr(I,4)===$n?(n=$n,I+=4):(n=x,0===A&&O(Bn)),n===x&&(w.substr(I,4)===Qn?(n=Qn,I+=4):(n=x,0===A&&O(Vn))),n!==x)&&(r=of())!==x?t=Kn(r):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(qn);return e}())===x&&(e=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,6)===Hn?(t=Hn,I+=6):(t=x,0===A&&O(Gn));t===x&&(w.substr(I,6)===Xn?(t=Xn,I+=6):(t=x,0===A&&O(Wn)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,5)===vt?(n=vt,I+=5):(n=x,0===A&&O(yt)),n===x&&(w.substr(I,5)===bt?(n=bt,I+=5):(n=x,0===A&&O(wt))),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(o=L())!==x?t=Yn(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Jn);return e}())===x&&(e=function(){var e,t,i,n,r,o,s,a,l,u,c,d;A++,t=e=I,w.substr(I,4)===er?(i=er,I+=4):(i=x,0===A&&O(tr));i===x&&(w.substr(I,4)===ir?(i=ir,I+=4):(i=x,0===A&&O(nr)));if(i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();t=n!==x&&(r=h())!==x?i=[i,n,r]:(I=t,x)}else I=t,t=x;t===x&&(t=null);if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){if(n=I,(r=function(){var e,t,i;A++,e=I,w.substr(I,6)===Hn?(t=Hn,I+=6):(t=x,0===A&&O(Gn));t===x&&(w.substr(I,6)===Xn?(t=Xn,I+=6):(t=x,0===A&&O(Wn)));e=t!==x&&(i=rf(),i!==x)?t=i:(I=e,x);A--,e===x&&(t=x,0===A)&&O(or);return e}())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();n=o!==x&&(s=(s=Zp())===x?null:s)!==x?r=[r,o,s]:(I=n,x)}else I=n,n=x;if((n=n===x?Zp():n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x){for(o=[],s=ef();s!==x;)o.push(s),s=ef();if(o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(w.substr(I,5)===vt?(a=vt,I+=5):(a=x,0===A&&O(yt)),a===x&&(w.substr(I,5)===bt?(a=bt,I+=5):(a=x,0===A&&O(wt))),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=L())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=rr(t,n,o,u):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Zn);return e}()),A--,e===x&&0===A&&O(tn),e}function Zp(){var e,t,i;return A++,e=I,w.substr(I,6)===Ln?(t=Ln,I+=6):(t=x,0===A&&O(Pn)),t===x&&(w.substr(I,6)===Mn?(t=Mn,I+=6):(t=x,0===A&&O(Un))),e=t!==x&&(i=rf())!==x?t=i:(I=e,x),A--,e===x&&(t=x,0===A)&&O(sr),e}function ef(){var e,t,i,n,r,o,s,a;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,5)===lr?(i=lr,I+=5):(i=x,0===A&&O(ur)),i===x&&(w.substr(I,5)===cr?(i=cr,I+=5):(i=x,0===A&&O(dr))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x){if((r=h())===x)if(r=I,w.substr(I,5)===Pt?(o=Pt,I+=5):(o=x,0===A&&O(Mt)),o===x&&(w.substr(I,5)===Ut?(o=Ut,I+=5):(o=x,0===A&&O($t))),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();r=s!==x&&(a=h())!==x?o=[o,s,a]:(I=r,x)}else I=r,r=x;e=r!==x?t=H(r):(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(ar),e}function tf(){var e,t,i,n;if(A++,e=I,w.substr(I,5)===pr?(t=pr,I+=5):(t=x,0===A&&O(fr)),t===x&&(w.substr(I,5)===gr?(t=gr,I+=5):(t=x,0===A&&O(mr))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=h())!==x?t=n:(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(hr),e}function nf(){var e,t;return A++,e=I,(t=tf())!==x&&(t=Vt(t)),(e=t)===x&&(e=I,w.substr(I,7)===yr?(t=yr,I+=7):(t=x,0===A&&O(br)),t===x&&(w.substr(I,7)===wr?(t=wr,I+=7):(t=x,0===A&&O(xr))),t!==x&&(t=G()),(e=t)===x)&&(e=I,w.substr(I,5)===Pt?(t=Pt,I+=5):(t=x,0===A&&O(Mt)),t===x&&(w.substr(I,5)===Ut?(t=Ut,I+=5):(t=x,0===A&&O($t))),t!==x&&(t=X()),(e=t)===x)&&(e=I,w.substr(I,3)===_r?(t=_r,I+=3):(t=x,0===A&&O(kr)),t===x&&(w.substr(I,3)===Cr?(t=Cr,I+=3):(t=x,0===A&&O(Er))),t!==x&&(t="all"),e=t),A--,e===x&&(t=x,0===A)&&O(vr),e}function rf(){var e,t,i,n,r,o,s,a,l;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(123===w.charCodeAt(I)?(i=m,I++):(i=x,0===A&&O(v)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=sf())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(125===w.charCodeAt(I)?(s=y,I++):(s=x,0===A&&O(b)),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();e=a!==x?t=Tr(r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Fr),e}function of(){var e,t,i,n,r,o,s,a,l;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(123===w.charCodeAt(I)?(i=m,I++):(i=x,0===A&&O(v)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=sf())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(125===w.charCodeAt(I)?(s=y,I++):(s=x,0===A&&O(b)),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();e=a!==x?t=Tr(r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Dr),e}function sf(){var e,t,i,n,r,o,s;if(A++,e=I,(t=(t=lf())===x?null:t)!==x){for(i=[],n=I,n=(r=af())!==x&&(46===w.charCodeAt(I)?(o=g,I++):(o=x,0===A&&O(S)),(o=o===x?null:o)!==x)&&(s=(s=lf())===x?null:s)!==x?r=[r,o,s]:(I=n,x);n!==x;)i.push(n),n=I,n=(r=af())!==x&&(46===w.charCodeAt(I)?(o=g,I++):(o=x,0===A&&O(S)),(o=o===x?null:o)!==x)&&(s=(s=lf())===x?null:s)!==x?r=[r,o,s]:(I=n,x);e=i!==x?t=Rr(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Sr),e}function af(){var e,t,i,n,r,o,s,a,l,u,c,d,h;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,5)===pr?(i=pr,I+=5):(i=x,0===A&&O(fr)),i===x&&(w.substr(I,5)===gr?(i=gr,I+=5):(i=x,0===A&&O(mr))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=Mf())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(123===w.charCodeAt(I)?(s=m,I++):(s=x,0===A&&O(v)),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();if(a!==x)if((l=(l=lf())===x?null:l)!==x){for(u=[],c=U();c!==x;)u.push(c),c=U();if(u!==x)if(125===w.charCodeAt(I)?(c=y,I++):(c=x,0===A&&O(b)),c!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();e=d!==x?t=W(r,l):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(jr),e}function lf(){var e,t,i,n,r,o,s;if(A++,e=I,(t=vf())!==x){for(i=I,n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if(46===w.charCodeAt(I)?(r=g,I++):(r=x,0===A&&O(S)),r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();i=o!==x&&(s=(s=lf())===x?null:s)!==x?n=[n,r,o,s]:(I=i,x)}else I=i,i=x;else I=i,i=x;e=(i=i===x?null:i)!==x?t=Ar(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Ir),e}function L(){var e,t,i,n,r,o,s,a,l,u,c,d;if(A++,e=I,123===w.charCodeAt(I)?(t=m,I++):(t=x,0===A&&O(v)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(A++,s=I,s=(a=Qp())!==x&&(u=zp())!==x&&(c=qp())!==x?(l=a,u=u,c=c,(d={kind:"select",token:"subselect"}).projection=l.vars,d.modifier=l.modifier,d.pattern=u,null!=c&&null!=c.limit&&(d.limit=c.limit),null!=c&&null!=c.offset&&(d.offset=c.offset),null!=c&&null!=c.order&&""!=c.order&&(d.order=c.order),null!=c&&null!=c.group&&(d.group=c.group),a=d):(I=s,x),A--,s===x&&(a=x,0===A)&&O(Xe),(n=s)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(125===w.charCodeAt(I)?(o=y,I++):(o=x,0===A&&O(b)),o!==x)?t=Nr(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x)if(e=I,123===w.charCodeAt(I)?(t=m,I++):(t=x,0===A&&O(v)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=function(){var e,t,i,n,r,o,s,a,l,u;A++,e=I,(t=uf())===x&&(t=null);if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){if(n=[],r=I,(o=cf())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(46===w.charCodeAt(I)?(a=g,I++):(a=x,0===A&&O(S)),(a=a===x?null:a)!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();r=l!==x&&(u=(u=uf())===x?null:u)!==x?o=[o,s,a,l,u]:(I=r,x)}else I=r,r=x;else I=r,r=x}else I=r,r=x;for(;r!==x;)if(n.push(r),r=I,(o=cf())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(46===w.charCodeAt(I)?(a=g,I++):(a=x,0===A&&O(S)),(a=a===x?null:a)!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();r=l!==x&&(u=(u=uf())===x?null:u)!==x?o=[o,s,a,l,u]:(I=r,x)}else I=r,r=x;else I=r,r=x}else I=r,r=x;e=n!==x?t=Pr(t,n):(I=e,x)}else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Lr);return e}())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(125===w.charCodeAt(I)?(o=y,I++):(o=x,0===A&&O(b)),o!==x)?t=Nr(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Or),e}function uf(){var e,t,i,n,r,o;if(A++,e=I,(t=function(){var e,t,i,n,r;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if((i=Pf())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=Cf())!==x?t=es(i,r):(I=e,x)}else I=e,e=x;else I=e,e=x;if(e===x){for(e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=Af())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=function(){var e;A++,(e=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h;A++,e=I,(t=Ef())===x&&(t=Ff());if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=bf())!==x){for(r=[],o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x){if(u=I,(c=(c=Ef())===x?Ff():c)!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();u=d!==x&&(h=wf())!==x?c=[c,d,h]:(I=u,x)}else I=u,u=x;o=(u=u===x?null:u)!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x}else I=o,o=x;else I=o,o=x;for(;o!==x;){for(r.push(o),o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x){if(u=I,(c=(c=Ef())===x?Ff():c)!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();u=d!==x&&(h=wf())!==x?c=[c,d,h]:(I=u,x)}else I=u,u=x;o=(u=u===x?null:u)!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x}else I=o,o=x;else I=o,o=x}e=r!==x?t=function(e,t,i){for(var n={token:"propertylist"},r=[],o=[],s=0;s<t.length;s++)null!=t[s].triplesContext?(r=r.concat(t[s].triplesContext),"triplesnodecollection"===t[s].token&&null!=t[s].chainSubject.length?o.push([e,t[s].chainSubject[0]]):o.push([e,t[s].chainSubject])):o.push([e,t[s]]);for(s=0;s<i.length;s++)for(var a=i[s][3],l=a[0],u=a[2]||[],c=0;c<u.length;c++)null!=u[c].triplesContext?(r=r.concat(u[c].triplesContext),o.push([l,u[c].chainSubject])):o.push([l,u[c]]);return n.pairs=o,n.triplesContext=r,n}(t,n,r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O($o);return e}())===x&&(e=null);A--,e===x&&0===A&&O(ns);return e}())!==x?t=ts(i,r):(I=e,x)}else I=e,e=x;else I=e,e=x}A--,e===x&&(t=x,0===A)&&O(Zo);return e}())!==x){for(i=I,n=[],r=U();r!==x;)n.push(r),r=U();e=(i=(i=n!==x&&(46===w.charCodeAt(I)?(r=g,I++):(r=x,0===A&&O(S)),r!==x)&&(o=(o=uf())===x?null:o)!==x?n=[n,r,o]:(I=i,x))===x?null:i)!==x?t=K(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Mr),e}function cf(){var e;return A++,(e=function(){var e,t,i,n,r,o,s,a;if(A++,e=I,(t=L())!==x){for(i=[],n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,5)===oo?(o=oo,I+=5):(o=x,0===A&&O(so)),o===x&&(w.substr(I,5)===ao?(o=ao,I+=5):(o=x,0===A&&O(lo))),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=L())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;for(;n!==x;){for(i.push(n),n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,5)===oo?(o=oo,I+=5):(o=x,0===A&&O(so)),o===x&&(w.substr(I,5)===ao?(o=ao,I+=5):(o=x,0===A&&O(lo))),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=L())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x}e=i!==x?t=uo(t,i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(ro);return e}())===x&&(e=function(){var e,t,i,n,r;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,8)===Br?(i=Br,I+=8):(i=x,0===A&&O(Qr)),i===x&&(w.substr(I,8)===Vr?(i=Vr,I+=8):(i=x,0===A&&O(zr))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=L())!==x?t=qr(r):(I=e,x)}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O($r);return e}())===x&&(e=function(){var e,t,i,n;A++,e=I,w.substr(I,5)===Zr?(t=Zr,I+=5):(t=x,0===A&&O(eo));t===x&&(w.substr(I,5)===to?(t=to,I+=5):(t=x,0===A&&O(io)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=L())!==x?t=no(n):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Yr);return e}())===x&&(e=function(){var e,t,i,n,r,o,s;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,5)===pr?(i=pr,I+=5):(i=x,0===A&&O(fr)),i===x&&(w.substr(I,5)===gr?(i=gr,I+=5):(i=x,0===A&&O(mr))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=Mf())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();e=o!==x&&(s=L())!==x?t=Gr(r,s):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Hr);return e}())===x&&(e=function(){var e,t,i,n;A++,e=I,w.substr(I,7)===Wr?(t=Wr,I+=7):(t=x,0===A&&O(Kr));e=t!==x&&(i=Mf(),i!==x)&&(n=L())!==x?t=Jr(i,n):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Xr);return e}())===x&&(e=function(){var e,t,i,n,r;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,6)===ho?(i=ho,I+=6):(i=x,0===A&&O(po)),i===x&&(w.substr(I,6)===fo?(i=fo,I+=6):(i=x,0===A&&O(go))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=df())!==x?t=mo(r):(I=e,x)}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(co);return e}())===x&&(e=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,4)===yo?(i=yo,I+=4):(i=x,0===A&&O(bo)),i===x&&(w.substr(I,4)===wo?(i=wo,I+=4):(i=x,0===A&&O(xo))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if(40===w.charCodeAt(I)?(r=C,I++):(r=x,0===A&&O(E)),r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if((s=M())!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();if(a!==x)if(w.substr(I,2)===lt?(l=lt,I+=2):(l=x,0===A&&O(ut)),l===x&&(w.substr(I,2)===st?(l=st,I+=2):(l=x,0===A&&O(at))),l!==x){for(u=[],c=U();c!==x;)u.push(c),c=U();if(u!==x)if((c=P())!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();e=d!==x&&(41===w.charCodeAt(I)?(h=F,I++):(h=x,0===A&&O(T)),h!==x)?t=_o(s,c):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(vo);return e}())===x&&(e=function(){var e,t,i,n,r;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(w.substr(I,6)===Hi?(i=Hi,I+=6):(i=x,0===A&&O(Gi)),i===x&&(w.substr(I,6)===Xi?(i=Xi,I+=6):(i=x,0===A&&O(Wi))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=hf())!==x?t=Eo(r):(I=e,x)}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Co);return e}()),A--,e===x&&0===A&&O(Ur),e}function df(){var e;return A++,(e=zf())===x&&(e=qf())===x&&(e=ff()),A--,e===x&&0===A&&O(ko),e}function hf(){var e;return A++,(e=function(){var e,t,i,n,r,o,s,a;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if((i=P())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if(123===w.charCodeAt(I)?(r=m,I++):(r=x,0===A&&O(v)),r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x){for(s=[],a=pf();a!==x;)s.push(a),a=pf();e=s!==x&&(125===w.charCodeAt(I)?(a=y,I++):(a=x,0===A&&O(b)),a!==x)?t=J(i,s):(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(To);return e}())===x&&(e=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h,p,f,g;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x){if((i=rg())===x)if(i=I,40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x){for(o=[],s=P();s!==x;)o.push(s),s=P();if(o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();i=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?n=[n,r,o,s,a]:(I=i,x)}else I=i,i=x}else I=i,i=x}else I=i,i=x;if(i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if(123===w.charCodeAt(I)?(r=m,I++):(r=x,0===A&&O(v)),r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x){for(s=[],a=I,l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(40===w.charCodeAt(I)?(u=C,I++):(u=x,0===A&&O(E)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x){for(d=[],h=pf();h!==x;)d.push(h),h=pf();if(d!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();if(h!==x)if(41===w.charCodeAt(I)?(p=F,I++):(p=x,0===A&&O(T)),p!==x){for(f=[],g=U();g!==x;)f.push(g),g=U();a=f!==x?l=[l,u,c,d,h,p,f]:(I=a,x)}else I=a,a=x;else I=a,a=x}else I=a,a=x}else I=a,a=x}else I=a,a=x;else I=a,a=x;for(a===x&&(a=rg());a!==x;){for(s.push(a),a=I,l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(40===w.charCodeAt(I)?(u=C,I++):(u=x,0===A&&O(E)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x){for(d=[],h=pf();h!==x;)d.push(h),h=pf();if(d!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();if(h!==x)if(41===w.charCodeAt(I)?(p=F,I++):(p=x,0===A&&O(T)),p!==x){for(f=[],g=U();g!==x;)f.push(g),g=U();a=f!==x?l=[l,u,c,d,h,p,f]:(I=a,x)}else I=a,a=x;else I=a,a=x}else I=a,a=x}else I=a,a=x}else I=a,a=x;else I=a,a=x;a===x&&(a=rg())}if(s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();e=a!==x&&(125===w.charCodeAt(I)?(l=y,I++):(l=x,0===A&&O(b)),l!==x)?t=Y():(I=e,x)}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Do);return e}()),A--,e===x&&0===A&&O(Fo),e}function pf(){var e,t,i,n,r;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=Jf())===x&&(i=Hf())===x&&(i=Gf())===x&&(i=Wf())===x&&(w.substr(I,5)===Vi?(i=Vi,I+=5):(i=x,0===A&&O(zi))),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x?t=oi(i):(I=e,x)}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(So),e}function ff(){var e,t,i,n;if(A++,e=I,(t=h())!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=gf())!==x?t=jo(t,n):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Ro),e}function gf(){var e,t,i,n,r,o,s,a,l,u,c,d;if(A++,e=I,(t=rg())!==x&&(t=Z()),(e=t)===x)if(e=I,40===w.charCodeAt(I)?(t=C,I++):(t=x,0===A&&O(E)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,8)===_?(n=_,I+=8):(n=x,0===A&&O(et)),n===x&&(w.substr(I,8)===k?(n=k,I+=8):(n=x,0===A&&O(tt))),(n=n===x?null:n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x){if(a=[],l=I,44===w.charCodeAt(I)?(u=R,I++):(u=x,0===A&&O(j)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();l=c!==x&&(d=M())!==x?u=[u,c,d]:(I=l,x)}else I=l,l=x;for(;l!==x;)if(a.push(l),l=I,44===w.charCodeAt(I)?(u=R,I++):(u=x,0===A&&O(j)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();l=c!==x&&(d=M())!==x?u=[u,c,d]:(I=l,x)}else I=l,l=x;e=a!==x&&(41===w.charCodeAt(I)?(l=F,I++):(l=x,0===A&&O(T)),l!==x)?t=ee(n,o,a):(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Io),e}function mf(){var e,t,i,n,r,o,s,a,l,u;if(A++,e=I,(t=rg())!==x&&(t=Z()),(e=t)===x)if(e=I,40===w.charCodeAt(I)?(t=C,I++):(t=x,0===A&&O(E)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=(n=h())===x?M():n)!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x){if(o=[],s=I,44===w.charCodeAt(I)?(a=R,I++):(a=x,0===A&&O(j)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();s=l!==x&&(u=(u=h())===x?M():u)!==x?a=[a,l,u]:(I=s,x)}else I=s,s=x;for(;s!==x;)if(o.push(s),s=I,44===w.charCodeAt(I)?(a=R,I++):(a=x,0===A&&O(j)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();s=l!==x&&(u=(u=h())===x?M():u)!==x?a=[a,l,u]:(I=s,x)}else I=s,s=x;e=o!==x&&(41===w.charCodeAt(I)?(s=F,I++):(s=x,0===A&&O(T)),s!==x)?t=te(n,o):(I=e,x)}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Ao),e}function vf(){var e,t,i,n,r;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=Pf())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=yf())!==x?t=Mo(i,r):(I=e,x)}else I=e,e=x;else I=e,e=x;if(e===x){for(e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=Of())!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x&&(r=function(){var e;A++,(e=yf())===x&&(e=null);A--,e===x&&0===A&&O(Qo);return e}())!==x?t=Uo(i,r):(I=e,x)}else I=e,e=x;else I=e,e=x}return A--,e===x&&(t=x,0===A)&&O(Po),e}function yf(){var e,t,i,n,r,o,s,a,l,u,c,d,h;if(A++,e=I,(t=kf())!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=wf())!==x){for(r=[],o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x){if(u=I,(c=kf())!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();u=d!==x&&(h=wf())!==x?c=[c,d,h]:(I=u,x)}else I=u,u=x;o=(u=u===x?null:u)!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x}else I=o,o=x;else I=o,o=x;for(;o!==x;){for(r.push(o),o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x){if(u=I,(c=kf())!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();u=d!==x&&(h=wf())!==x?c=[c,d,h]:(I=u,x)}else I=u,u=x;o=(u=u===x?null:u)!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x}else I=o,o=x;else I=o,o=x}e=r!==x?t=ne(t,n,r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Bo),e}function bf(){var e,t,i,n,r,o,s,a;if(A++,e=I,(t=xf())!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){if(n=[],r=I,44===w.charCodeAt(I)?(o=R,I++):(o=x,0===A&&O(j)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();r=s!==x&&(a=xf())!==x?o=[o,s,a]:(I=r,x)}else I=r,r=x;for(;r!==x;)if(n.push(r),r=I,44===w.charCodeAt(I)?(o=R,I++):(o=x,0===A&&O(j)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();r=s!==x&&(a=xf())!==x?o=[o,s,a]:(I=r,x)}else I=r,r=x;e=n!==x?t=zo(t,n):(I=e,x)}else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Vo),e}function wf(){var e,t,i,n,r,o,s,a;if(A++,e=I,(t=_f())!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){if(n=[],r=I,44===w.charCodeAt(I)?(o=R,I++):(o=x,0===A&&O(j)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();r=s!==x&&(a=_f())!==x?o=[o,s,a]:(I=r,x)}else I=r,r=x;for(;r!==x;)if(n.push(r),r=I,44===w.charCodeAt(I)?(o=R,I++):(o=x,0===A&&O(j)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();r=s!==x&&(a=_f())!==x?o=[o,s,a]:(I=r,x)}else I=r,r=x;e=n!==x?t=Ho(t,n):(I=e,x)}else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(qo),e}function xf(){var e;return A++,e=Nf(),A--,e===x&&0===A&&O(Go),e}function _f(){var e;return A++,e=Lf(),A--,e===x&&0===A&&O(Xo),e}function kf(){var e,t;return A++,(e=Mf())===x&&(e=I,97===w.charCodeAt(I)?(t=Ko,I++):(t=x,0===A&&O(Jo)),t!==x&&(t=Yo()),e=t),A--,e===x&&(t=x,0===A)&&O(Wo),e}function Cf(){var e,t,i,n,r,o,s,a,l,u,c,d;if(A++,e=I,(t=(t=Ef())===x?Ff():t)!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=bf())!==x){for(r=[],o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=I,(u=(u=(c=(c=Ef())===x?Ff():c)!==x&&(d=wf())!==x?c=[c,d]:(I=u,x))===x?null:u)!==x)?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x;for(;o!==x;){for(r.push(o),o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(59===w.charCodeAt(I)?(a=Yi,I++):(a=x,0===A&&O(Zi)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=I,(u=(u=(c=(c=Ef())===x?Ff():c)!==x&&(d=wf())!==x?c=[c,d]:(I=u,x))===x?null:u)!==x)?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x}e=r!==x?t=re(t,n,r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(is),e}function Ef(){var e,t;return A++,e=I,(t=Tf())!==x&&(t=os(t)),A--,(e=t)===x&&(t=x,0===A)&&O(rs),e}function Ff(){var e;return A++,e=P(),A--,e===x&&0===A&&O(ss),e}function Tf(){var e;return A++,e=function(){var e,t,i,n,r,o;if(A++,e=I,(t=Df())!==x){for(i=[],n=I,124===w.charCodeAt(I)?(r=us,I++):(r=x,0===A&&O(cs)),n=r!==x&&(o=Df())!==x?r=[r,o]:(I=n,x);n!==x;)i.push(n),n=I,124===w.charCodeAt(I)?(r=us,I++):(r=x,0===A&&O(cs)),n=r!==x&&(o=Df())!==x?r=[r,o]:(I=n,x);e=i!==x?t=ds(t,i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(ls);return e}(),A--,e===x&&0===A&&O(as),e}function Df(){var e,t,i,n,r,o;if(A++,e=I,(t=Rf())!==x){for(i=[],n=I,47===w.charCodeAt(I)?(r=ps,I++):(r=x,0===A&&O(fs)),n=r!==x&&(o=Rf())!==x?r=[r,o]:(I=n,x);n!==x;)i.push(n),n=I,47===w.charCodeAt(I)?(r=ps,I++):(r=x,0===A&&O(fs)),n=r!==x&&(o=Rf())!==x?r=[r,o]:(I=n,x);e=i!==x?t=oe(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(hs),e}function Sf(){var e,t,i;return A++,e=I,e=(t=function(){var e,t,i,n;A++,(e=h())===x&&(e=I,97===w.charCodeAt(I)?(t=Ko,I++):(t=x,0===A&&O(Jo)),t!==x&&(t=Yo()),(e=t)===x)&&(e=I,33===w.charCodeAt(I)?(t=Fs,I++):(t=x,0===A&&O(Ts)),(e=t!==x&&(i=function(){var e,t,i,n,r,o,s,a;if((e=jf())===x)if(e=I,40===w.charCodeAt(I)?(t=C,I++):(t=x,0===A&&O(E)),t!==x){if(i=I,(n=jf())!==x){for(r=[],o=I,124===w.charCodeAt(I)?(s=us,I++):(s=x,0===A&&O(cs)),o=s!==x&&(a=jf())!==x?s=[s,a]:(I=o,x);o!==x;)r.push(o),o=I,124===w.charCodeAt(I)?(s=us,I++):(s=x,0===A&&O(cs)),o=s!==x&&(a=jf())!==x?s=[s,a]:(I=o,x);i=r!==x?n=[n,r]:(I=i,x)}else I=i,i=x;e=(i=i===x?null:i)!==x&&(41===w.charCodeAt(I)?(n=F,I++):(n=x,0===A&&O(T)),n!==x)?t=[t,i,n]:(I=e,x)}else I=e,e=x;return e}())!==x?t=[t,i]:(I=e,x))===x)&&(e=I,40===w.charCodeAt(I)?(t=C,I++):(t=x,0===A&&O(E)),e=t!==x&&(i=Tf())!==x&&(41===w.charCodeAt(I)?(n=F,I++):(n=x,0===A&&O(T)),n!==x)?t=Nr(i):(I=e,x));A--,e===x&&(t=x,0===A)&&O(Es);return e}())!==x&&(i=(i=function(){var e,t,i,n,r,o,s,a,l;A++,42===w.charCodeAt(I)?(e=D,I++):(e=x,0===A&&O(ct));e===x&&(63===w.charCodeAt(I)?(e=xs,I++):(e=x,0===A&&O(_s)),e===x)&&(43===w.charCodeAt(I)?(e=ks,I++):(e=x,0===A&&O(Cs)),e===x)&&(e=I,123===w.charCodeAt(I)?(t=m,I++):(t=x,0===A&&O(v)),e=t!==x&&(i=I,n=If(),(i=n!==x&&(r=I,44===w.charCodeAt(I)?(o=R,I++):(o=x,0===A&&O(j)),(r=o!==x&&(125===w.charCodeAt(I)?(s=y,I++):(s=x,0===A&&O(b)),s===x&&(s=I,a=If(),s=a!==x&&(125===w.charCodeAt(I)?(l=y,I++):(l=x,0===A&&O(b)),l!==x)?a=[a,l]:(I=s,x)),s!==x)?o=[o,s]:(I=r,x))===x&&(125===w.charCodeAt(I)?(r=y,I++):(r=x,0===A&&O(b))),r!==x)?n=[n,r]:(I=i,x))===x&&(i=I,44===w.charCodeAt(I)?(n=R,I++):(n=x,0===A&&O(j)),i=n!==x&&(r=If())!==x&&(125===w.charCodeAt(I)?(o=y,I++):(o=x,0===A&&O(b)),o!==x)?n=[n,r,o]:(I=i,x)),i!==x)?t=[t,i]:(I=e,x));A--,e===x&&(t=x,0===A)&&O(ws);return e}())===x?null:i)!==x?t=se(t,i):(I=e,x),A--,e===x&&(t=x,0===A)&&O(gs),e}function Rf(){var e,t,i;return A++,(e=Sf())===x&&(e=I,94===w.charCodeAt(I)?(t=vs,I++):(t=x,0===A&&O(ys)),e=t!==x&&(i=Sf())!==x?t=bs(i):(I=e,x)),A--,e===x&&(t=x,0===A)&&O(ms),e}function jf(){var e,t,i;return A++,(e=h())===x&&(97===w.charCodeAt(I)?(e=Ko,I++):(e=x,0===A&&O(Jo)),e===x)&&(e=I,94===w.charCodeAt(I)?(t=vs,I++):(t=x,0===A&&O(ys)),e=t!==x&&((i=h())===x&&(97===w.charCodeAt(I)?(i=Ko,I++):(i=x,0===A&&O(Jo))),i!==x)?t=[t,i]:(I=e,x)),A--,e===x&&(t=x,0===A)&&O(Ds),e}function If(){var e;return A++,e=Zf(),A--,e===x&&0===A&&O(Ss),e}function Af(){var e,t;return A++,e=I,(t=function(){var e,t,i,n,r,o,s,a,l;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(40===w.charCodeAt(I)?(i=C,I++):(i=x,0===A&&O(E)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x){if(r=[],(o=Nf())!==x)for(;o!==x;)r.push(o),o=Nf();else r=x;if(r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(41===w.charCodeAt(I)?(s=F,I++):(s=x,0===A&&O(T)),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();e=a!==x?t=Bs(r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O($s);return e}())!==x&&(t=ae(t)),(e=t)===x&&(e=function(){var e,t,i,n,r,o,s,a;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(91===w.charCodeAt(I)?(i=As,I++):(i=x,0===A&&O(Os)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=Cf())!==x)if(93===w.charCodeAt(I)?(o=Ns,I++):(o=x,0===A&&O(Ls)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x?t=Ps(r):(I=e,x)}else I=e,e=x;else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Is);return e}()),A--,e===x&&(t=x,0===A)&&O(Rs),e}function Of(){var e,t;return A++,e=I,(t=function(){var e,t,i,n,r,o,s,a,l;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(40===w.charCodeAt(I)?(i=C,I++):(i=x,0===A&&O(E)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x){if(r=[],(o=Lf())!==x)for(;o!==x;)r.push(o),o=Lf();else r=x;if(r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(41===w.charCodeAt(I)?(s=F,I++):(s=x,0===A&&O(T)),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();e=a!==x?t=Bs(r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Qs);return e}())!==x&&(t=le(t)),(e=t)===x&&(e=function(){var e,t,i,n,r,o,s,a,l;A++,e=I,t=[],i=U();for(;i!==x;)t.push(i),i=U();if(t!==x)if(91===w.charCodeAt(I)?(i=As,I++):(i=x,0===A&&O(Os)),i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if((r=yf())!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if(93===w.charCodeAt(I)?(s=Ns,I++):(s=x,0===A&&O(Ls)),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();e=a!==x?t=Us(r):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ms);return e}()),A--,e===x&&(t=x,0===A)&&O(js),e}function Nf(){var e,t,i,n,r,o;for(A++,t=e=I,i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=Pf())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();t=r!==x?i=[i,n,r]:(I=t,x)}else I=t,t=x;else I=t,t=x;if(t===x){for(t=I,i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=Af())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();t=r!==x?i=[i,n,r]:(I=t,x)}else I=t,t=x;else I=t,t=x}return t!==x&&(t=zs(t)),A--,(e=t)===x&&(t=x,0===A)&&O(Vs),e}function Lf(){var e,t,i,n,r,o;for(A++,t=e=I,i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=Pf())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();t=r!==x?i=[i,n,r]:(I=t,x)}else I=t,t=x;else I=t,t=x;if(t===x){for(t=I,i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=Of())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();t=r!==x?i=[i,n,r]:(I=t,x)}else I=t,t=x;else I=t,t=x}return t!==x&&(t=zs(t)),A--,(e=t)===x&&(t=x,0===A)&&O(qs),e}function Pf(){var e;return A++,(e=P())===x&&(e=function(){var e;A++,(e=h())!==x||(e=Hf())===x&&(e=Gf())===x&&(e=Wf())===x&&(e=function(){var e,t;A++,e=I,(t=function(){var e,t,i;A++,e=I,w.substr(I,2)===od?(t=od,I+=2):(t=x,0===A&&O(sd));e=t!==x&&(i=ug(),i!==x)?t=ad(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(rd);return e}())!==x&&(t=xe(t));(e=t)===x&&(e=I,(t=function(){var e,t,i,n;A++,e=I,91===w.charCodeAt(I)?(t=As,I++):(t=x,0===A&&O(Os));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(93===w.charCodeAt(I)?(n=Ns,I++):(n=x,0===A&&O(Ls)),n!==x)?t=[t,i,n]:(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Rh);return e}())!==x&&(t=_e()),e=t);A--,e===x&&(t=x,0===A)&&O(Wc);return e}())===x&&(e=rg());A--,e===x&&0===A&&O(Ks);return e}()),A--,e===x&&0===A&&O(Hs),e}function Mf(){var e;return A++,(e=P())===x&&(e=h()),A--,e===x&&0===A&&O(Gs),e}function P(){var e,t,i,n,r;for(A++,e=I,t=[],i=U();i!==x;)t.push(i),i=U();if(t!==x)if((i=(i=function(){var e,t,i;A++,e=I,63===w.charCodeAt(I)?(t=xs,I++):(t=x,0===A&&O(_s));e=t!==x&&(i=ag(),i!==x)?t=i:(I=e,x);A--,e===x&&(t=x,0===A)&&O(ld);return e}())===x?function(){var e,t,i;A++,e=I,36===w.charCodeAt(I)?(t=cd,I++):(t=x,0===A&&O(dd));e=t!==x&&(i=ag(),i!==x)?t=i:(I=e,x);A--,e===x&&(t=x,0===A)&&O(ud);return e}():i)!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();e=n!==x?t=Ws(i):(I=e,x)}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Xs),e}function M(){var e;return A++,e=function(){var e,t,i,n,r,o,s,a;if(A++,e=I,(t=Uf())!==x){for(i=[],n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===Zs?(o=Zs,I+=2):(o=x,0===A&&O(ea)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Uf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;for(;n!==x;){for(i.push(n),n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===Zs?(o=Zs,I+=2):(o=x,0===A&&O(ea)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Uf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x}e=i!==x?t=ue(t,i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ys);return e}(),A--,e===x&&0===A&&O(Js),e}function Uf(){var e,t,i,n,r,o,s,a;if(A++,e=I,(t=$f())!==x){for(i=[],n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===ia?(o=ia,I+=2):(o=x,0===A&&O(na)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=$f())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;for(;n!==x;){for(i.push(n),n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===ia?(o=ia,I+=2):(o=x,0===A&&O(na)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=$f())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x}e=i!==x?t=ra(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(ta),e}function $f(){var e;return A++,e=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h;if(A++,e=I,(t=p())!==x){for(i=[],n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(61===w.charCodeAt(I)?(o=aa,I++):(o=x,0===A&&O(la)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===ua?(o=ua,I+=2):(o=x,0===A&&O(ca)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(60===w.charCodeAt(I)?(o=da,I++):(o=x,0===A&&O(ha)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(62===w.charCodeAt(I)?(o=pa,I++):(o=x,0===A&&O(fa)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===ga?(o=ga,I+=2):(o=x,0===A&&O(ma)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===va?(o=va,I+=2):(o=x,0===A&&O(ya)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(73===w.charCodeAt(I)?(o=ba,I++):(o=x,0===A&&O(wa)),o===x&&(105===w.charCodeAt(I)?(o=xa,I++):(o=x,0===A&&O(_a))),o!==x)if(78===w.charCodeAt(I)?(s=ka,I++):(s=x,0===A&&O(Ca)),s===x&&(110===w.charCodeAt(I)?(s=Ea,I++):(s=x,0===A&&O(Fa))),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();n=a!==x&&(l=mf())!==x?r=[r,o,s,a,l]:(I=n,x)}else I=n,n=x;else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(78===w.charCodeAt(I)?(o=ka,I++):(o=x,0===A&&O(Ca)),o===x&&(110===w.charCodeAt(I)?(o=Ea,I++):(o=x,0===A&&O(Fa))),o!==x)if(79===w.charCodeAt(I)?(s=Ta,I++):(s=x,0===A&&O(Da)),s===x&&(111===w.charCodeAt(I)?(s=Sa,I++):(s=x,0===A&&O(Ra))),s!==x)if(84===w.charCodeAt(I)?(a=ja,I++):(a=x,0===A&&O(Ia)),a===x&&(116===w.charCodeAt(I)?(a=Aa,I++):(a=x,0===A&&O(Oa))),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(73===w.charCodeAt(I)?(u=ba,I++):(u=x,0===A&&O(wa)),u===x&&(105===w.charCodeAt(I)?(u=xa,I++):(u=x,0===A&&O(_a))),u!==x)if(78===w.charCodeAt(I)?(c=ka,I++):(c=x,0===A&&O(Ca)),c===x&&(110===w.charCodeAt(I)?(c=Ea,I++):(c=x,0===A&&O(Fa))),c!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();n=d!==x&&(h=mf())!==x?r=[r,o,s,a,l,u,c,d,h]:(I=n,x)}else I=n,n=x;else I=n,n=x;else I=n,n=x}else I=n,n=x;else I=n,n=x;else I=n,n=x;else I=n,n=x}}}}}}}for(;n!==x;){for(i.push(n),n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(61===w.charCodeAt(I)?(o=aa,I++):(o=x,0===A&&O(la)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===ua?(o=ua,I+=2):(o=x,0===A&&O(ca)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(60===w.charCodeAt(I)?(o=da,I++):(o=x,0===A&&O(ha)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(62===w.charCodeAt(I)?(o=pa,I++):(o=x,0===A&&O(fa)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===ga?(o=ga,I+=2):(o=x,0===A&&O(ma)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,2)===va?(o=va,I+=2):(o=x,0===A&&O(ya)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=p())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(73===w.charCodeAt(I)?(o=ba,I++):(o=x,0===A&&O(wa)),o===x&&(105===w.charCodeAt(I)?(o=xa,I++):(o=x,0===A&&O(_a))),o!==x)if(78===w.charCodeAt(I)?(s=ka,I++):(s=x,0===A&&O(Ca)),s===x&&(110===w.charCodeAt(I)?(s=Ea,I++):(s=x,0===A&&O(Fa))),s!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();n=a!==x&&(l=mf())!==x?r=[r,o,s,a,l]:(I=n,x)}else I=n,n=x;else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(78===w.charCodeAt(I)?(o=ka,I++):(o=x,0===A&&O(Ca)),o===x&&(110===w.charCodeAt(I)?(o=Ea,I++):(o=x,0===A&&O(Fa))),o!==x)if(79===w.charCodeAt(I)?(s=Ta,I++):(s=x,0===A&&O(Da)),s===x&&(111===w.charCodeAt(I)?(s=Sa,I++):(s=x,0===A&&O(Ra))),s!==x)if(84===w.charCodeAt(I)?(a=ja,I++):(a=x,0===A&&O(Ia)),a===x&&(116===w.charCodeAt(I)?(a=Aa,I++):(a=x,0===A&&O(Oa))),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(73===w.charCodeAt(I)?(u=ba,I++):(u=x,0===A&&O(wa)),u===x&&(105===w.charCodeAt(I)?(u=xa,I++):(u=x,0===A&&O(_a))),u!==x)if(78===w.charCodeAt(I)?(c=ka,I++):(c=x,0===A&&O(Ca)),c===x&&(110===w.charCodeAt(I)?(c=Ea,I++):(c=x,0===A&&O(Fa))),c!==x){for(d=[],h=U();h!==x;)d.push(h),h=U();n=d!==x&&(h=mf())!==x?r=[r,o,s,a,l,u,c,d,h]:(I=n,x)}else I=n,n=x;else I=n,n=x;else I=n,n=x}else I=n,n=x;else I=n,n=x;else I=n,n=x;else I=n,n=x}}}}}}}}e=i!==x?t=Na(t,i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(sa);return e}(),A--,e===x&&0===A&&O(oa),e}function p(){var e;return A++,e=function(){var e,t,i,n,r,o,s,a,l,u;if(A++,e=I,(t=Bf())!==x){for(i=[],n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(43===w.charCodeAt(I)?(o=ks,I++):(o=x,0===A&&O(Cs)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Bf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(45===w.charCodeAt(I)?(o=c,I++):(o=x,0===A&&O(d)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Bf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x)if(n=I,(r=(r=Xf())===x?Xf():r)!==x){for(o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(42===w.charCodeAt(I)?(a=D,I++):(a=x,0===A&&O(ct)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=Qf())!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x;if(o===x){for(o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(47===w.charCodeAt(I)?(a=ps,I++):(a=x,0===A&&O(fs)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=Qf())!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x}n=(o=o===x?null:o)!==x?r=[r,o]:(I=n,x)}else I=n,n=x}for(;n!==x;){for(i.push(n),n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(43===w.charCodeAt(I)?(o=ks,I++):(o=x,0===A&&O(Cs)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Bf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(45===w.charCodeAt(I)?(o=c,I++):(o=x,0===A&&O(d)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Bf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x)if(n=I,(r=(r=Xf())===x?Xf():r)!==x){for(o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(42===w.charCodeAt(I)?(a=D,I++):(a=x,0===A&&O(ct)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=Qf())!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x;if(o===x){for(o=I,s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(47===w.charCodeAt(I)?(a=ps,I++):(a=x,0===A&&O(fs)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();o=l!==x&&(u=Qf())!==x?s=[s,a,l,u]:(I=o,x)}else I=o,o=x;else I=o,o=x}n=(o=o===x?null:o)!==x?r=[r,o]:(I=n,x)}else I=n,n=x}}e=i!==x?t=Ma(t,i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Pa);return e}(),A--,e===x&&0===A&&O(La),e}function Bf(){var e,t,i,n,r,o,s,a;if(A++,e=I,(t=Qf())!==x){for(i=[],n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(42===w.charCodeAt(I)?(o=D,I++):(o=x,0===A&&O(ct)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Qf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(47===w.charCodeAt(I)?(o=ps,I++):(o=x,0===A&&O(fs)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Qf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x}for(;n!==x;){for(i.push(n),n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(42===w.charCodeAt(I)?(o=D,I++):(o=x,0===A&&O(ct)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Qf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x;if(n===x){for(n=I,r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(47===w.charCodeAt(I)?(o=ps,I++):(o=x,0===A&&O(fs)),o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();n=s!==x&&(a=Qf())!==x?r=[r,o,s,a]:(I=n,x)}else I=n,n=x;else I=n,n=x}}e=i!==x?t=ce(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Ua),e}function Qf(){var e,t,i,n;if(A++,e=I,33===w.charCodeAt(I)?(t=Fs,I++):(t=x,0===A&&O(Ts)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=Vf())!==x?t=Ba(n):(I=e,x)}else I=e,e=x;if(e===x){if(e=I,43===w.charCodeAt(I)?(t=ks,I++):(t=x,0===A&&O(Cs)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=Vf())!==x?t=Qa(n):(I=e,x)}else I=e,e=x;if(e===x){if(e=I,45===w.charCodeAt(I)?(t=c,I++):(t=x,0===A&&O(d)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=Vf())!==x?t=Va(n):(I=e,x)}else I=e,e=x;e===x&&(e=Vf())}}return A--,e===x&&(t=x,0===A)&&O($a),e}function Vf(){var e,t;return A++,(e=zf())===x&&(e=qf())===x&&(e=function(){var e,t,i,n;if(A++,e=I,(t=h())!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=(n=gf())===x?null:n)!==x?t=Cc(t,n):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(kc);return e}())===x&&(e=I,(t=Hf())!==x&&(t=de(t)),(e=t)===x)&&(e=I,(t=Gf())!==x&&(t=he(t)),(e=t)===x)&&(e=I,(t=Wf())!==x&&(t=pe(t)),(e=t)===x)&&(e=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h,p,f,g,m,v;A++,e=I,w.substr(I,5)===qu?(t=qu,I+=5):(t=x,0===A&&O(Hu));t===x&&(w.substr(I,5)===Gu?(t=Gu,I+=5):(t=x,0===A&&O(Xu)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,8)===_?(o=_,I+=8):(o=x,0===A&&O(et)),o===x&&(w.substr(I,8)===k?(o=k,I+=8):(o=x,0===A&&O(tt))),(o=o===x?null:o)!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(42===w.charCodeAt(I)?(a=D,I++):(a=x,0===A&&O(ct)),(a=a===x?M():a)!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=Wu(o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,12)===Ku?(t=Ku,I+=12):(t=x,0===A&&O(Ju)),t===x&&(w.substr(I,12)===Yu?(t=Yu,I+=12):(t=x,0===A&&O(Zu))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,8)===_?(o=_,I+=8):(o=x,0===A&&O(et)),o===x&&(w.substr(I,8)===k?(o=k,I+=8):(o=x,0===A&&O(tt))),(o=o===x?null:o)!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=M())!==x){if(l=I,59===w.charCodeAt(I)?(u=Yi,I++):(u=x,0===A&&O(Zi)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x)if(w.substr(I,9)===ec?(d=ec,I+=9):(d=x,0===A&&O(tc)),d!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();if(h!==x)if(61===w.charCodeAt(I)?(p=aa,I++):(p=x,0===A&&O(la)),p!==x){for(f=[],g=U();g!==x;)f.push(g),g=U();if(f!==x)if((g=Kf())!==x){for(m=[],v=U();v!==x;)m.push(v),v=U();l=m!==x?u=[u,c,d,h,p,f,g,m]:(I=l,x)}else I=l,l=x;else I=l,l=x}else I=l,l=x;else I=l,l=x}else I=l,l=x;else I=l,l=x}else I=l,l=x;if((l=l===x?null:l)!==x)if(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=ic(o,a,l):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,3)===nc?(t=nc,I+=3):(t=x,0===A&&O(rc)),t===x&&(w.substr(I,3)===oc?(t=oc,I+=3):(t=x,0===A&&O(sc))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,8)===_?(o=_,I+=8):(o=x,0===A&&O(et)),o===x&&(w.substr(I,8)===k?(o=k,I+=8):(o=x,0===A&&O(tt))),(o=o===x?null:o)!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=M())!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=ac(o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,3)===lc?(t=lc,I+=3):(t=x,0===A&&O(uc)),t===x&&(w.substr(I,3)===cc?(t=cc,I+=3):(t=x,0===A&&O(dc))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,8)===_?(o=_,I+=8):(o=x,0===A&&O(et)),o===x&&(w.substr(I,8)===k?(o=k,I+=8):(o=x,0===A&&O(tt))),(o=o===x?null:o)!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=M())!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=hc(o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,3)===pc?(t=pc,I+=3):(t=x,0===A&&O(fc)),t===x&&(w.substr(I,3)===gc?(t=gc,I+=3):(t=x,0===A&&O(mc))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,8)===_?(o=_,I+=8):(o=x,0===A&&O(et)),o===x&&(w.substr(I,8)===k?(o=k,I+=8):(o=x,0===A&&O(tt))),(o=o===x?null:o)!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=M())!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=vc(o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x)if(e=I,w.substr(I,3)===yc?(t=yc,I+=3):(t=x,0===A&&O(bc)),t===x&&(w.substr(I,3)===wc?(t=wc,I+=3):(t=x,0===A&&O(xc))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if(w.substr(I,8)===_?(o=_,I+=8):(o=x,0===A&&O(et)),o===x&&(w.substr(I,8)===k?(o=k,I+=8):(o=x,0===A&&O(tt))),(o=o===x?null:o)!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=M())!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x?t=_c(o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x}}}}A--,e===x&&(t=x,0===A)&&O(zu);return e}())===x&&(e=I,(t=P())!==x&&(t=fe(t)),e=t),A--,e===x&&(t=x,0===A)&&O(za),e}function zf(){var e,t,i,n,r,o;if(A++,e=I,40===w.charCodeAt(I)?(t=C,I++):(t=x,0===A&&O(E)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if((n=M())!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(41===w.charCodeAt(I)?(o=F,I++):(o=x,0===A&&O(T)),o!==x)?t=Ha(n):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(qa),e}function qf(){var e,t,i,n,r,o,s,a,l,u,c,d,h,p,f,g;if(A++,e=I,w.substr(I,3)===Xa?(t=Xa,I+=3):(t=x,0===A&&O(Wa)),t===x&&(w.substr(I,3)===Ka?(t=Ka,I+=3):(t=x,0===A&&O(Ja))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=Ya(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,4)===Za?(t=Za,I+=4):(t=x,0===A&&O(el)),t===x&&(w.substr(I,4)===tl?(t=tl,I+=4):(t=x,0===A&&O(il))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=nl(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,11)===rl?(t=rl,I+=11):(t=x,0===A&&O(ol)),t===x&&(w.substr(I,11)===sl?(t=sl,I+=11):(t=x,0===A&&O(al))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(44===w.charCodeAt(I)?(a=R,I++):(a=x,0===A&&O(j)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=M())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x&&(41===w.charCodeAt(I)?(d=F,I++):(d=x,0===A&&O(T)),d!==x)?t=ll(o,u):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,8)===ul?(t=ul,I+=8):(t=x,0===A&&O(cl)),t===x&&(w.substr(I,8)===dl?(t=dl,I+=8):(t=x,0===A&&O(hl))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=pl(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,5)===fl?(t=fl,I+=5):(t=x,0===A&&O(gl)),t===x&&(w.substr(I,5)===ml?(t=ml,I+=5):(t=x,0===A&&O(vl))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=P())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=yl(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,3)===bl?(t=bl,I+=3):(t=x,0===A&&O(wl)),t===x&&(w.substr(I,3)===xl?(t=xl,I+=3):(t=x,0===A&&O(_l))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=kl(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,3)===Cl?(t=Cl,I+=3):(t=x,0===A&&O(El)),t===x&&(w.substr(I,3)===Fl?(t=Fl,I+=3):(t=x,0===A&&O(Tl))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=Dl(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,5)===Sl?(t=Sl,I+=5):(t=x,0===A&&O(Rl)),t===x&&(w.substr(I,5)===jl?(t=jl,I+=5):(t=x,0===A&&O(Il))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x){if(n=I,40===w.charCodeAt(I)?(r=C,I++):(r=x,0===A&&O(E)),r!==x){for(o=[],s=U();s!==x;)o.push(s),s=U();if(o!==x)if((s=M())!==x){for(a=[],l=U();l!==x;)a.push(l),l=U();n=a!==x&&(41===w.charCodeAt(I)?(l=F,I++):(l=x,0===A&&O(T)),l!==x)?r=[r,o,s,a,l]:(I=n,x)}else I=n,n=x;else I=n,n=x}else I=n,n=x;e=(n=n===x?rg():n)!==x?t=Al(n):(I=e,x)}else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,8)===Ol?(t=Ol,I+=8):(t=x,0===A&&O(Nl)),t===x&&(w.substr(I,8)===Ll?(t=Ll,I+=8):(t=x,0===A&&O(Pl))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=mf())!==x?t=Ml(n):(I=e,x)}else I=e,e=x;if(e===x){if(e=I,w.substr(I,2)===Ul?(t=Ul,I+=2):(t=x,0===A&&O($l)),t===x&&(w.substr(I,2)===Bl?(t=Bl,I+=2):(t=x,0===A&&O(Ql))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(44===w.charCodeAt(I)?(a=R,I++):(a=x,0===A&&O(j)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=M())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x)if(44===w.charCodeAt(I)?(d=R,I++):(d=x,0===A&&O(j)),d!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();if(h!==x)if((p=M())!==x){for(f=[],g=U();g!==x;)f.push(g),g=U();e=f!==x&&(41===w.charCodeAt(I)?(g=F,I++):(g=x,0===A&&O(T)),g!==x)?t=Vl(o,u,p):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,9)===zl?(t=zl,I+=9):(t=x,0===A&&O(ql)),t===x&&(w.substr(I,9)===Hl?(t=Hl,I+=9):(t=x,0===A&&O(Gl)),t===x)&&(w.substr(I,9)===Xl?(t=Xl,I+=9):(t=x,0===A&&O(Wl))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=Kl(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,7)===Jl?(t=Jl,I+=7):(t=x,0===A&&O(Yl)),t===x&&(w.substr(I,7)===Zl?(t=Zl,I+=7):(t=x,0===A&&O(eu)),t===x)&&(w.substr(I,7)===tu?(t=tu,I+=7):(t=x,0===A&&O(iu))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=nu(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,8)===ru?(t=ru,I+=8):(t=x,0===A&&O(ou)),t===x&&(w.substr(I,8)===su?(t=su,I+=8):(t=x,0===A&&O(au))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(44===w.charCodeAt(I)?(a=R,I++):(a=x,0===A&&O(j)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=M())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();e=c!==x&&(41===w.charCodeAt(I)?(d=F,I++):(d=x,0===A&&O(T)),d!==x)?t=lu(o,u):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,5)===uu?(t=uu,I+=5):(t=x,0===A&&O(cu)),t===x&&(w.substr(I,5)===du?(t=du,I+=5):(t=x,0===A&&O(hu)),t===x)&&(w.substr(I,5)===pu?(t=pu,I+=5):(t=x,0===A&&O(fu)),t===x)&&(w.substr(I,5)===gu?(t=gu,I+=5):(t=x,0===A&&O(mu)),t===x)&&(w.substr(I,5)===vu?(t=vu,I+=5):(t=x,0===A&&O(yu)),t===x)&&(w.substr(I,5)===bu?(t=bu,I+=5):(t=x,0===A&&O(wu))),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();e=s!==x&&(41===w.charCodeAt(I)?(a=F,I++):(a=x,0===A&&O(T)),a!==x)?t=xu(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;if(e===x){if(e=I,w.substr(I,7)===_u?(t=_u,I+=7):(t=x,0===A&&O(ku)),t===x&&(w.substr(I,7)===Cu?(t=Cu,I+=7):(t=x,0===A&&O(Eu))),t!==x){if(i=[],Fu.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Tu)),n!==x)for(;n!==x;)i.push(n),Fu.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Tu));else i=x;if(i!==x){for(n=[],r=U();r!==x;)n.push(r),r=U();if(n!==x)if(40===w.charCodeAt(I)?(r=C,I++):(r=x,0===A&&O(E)),r!==x){for(o=[],s=I,a=[],l=U();l!==x;)a.push(l),l=U();for(s=a!==x&&(l=M())!==x&&(44===w.charCodeAt(I)?(u=R,I++):(u=x,0===A&&O(j)),u!==x)?a=[a,l,u]:(I=s,x);s!==x;){for(o.push(s),s=I,a=[],l=U();l!==x;)a.push(l),l=U();s=a!==x&&(l=M())!==x&&(44===w.charCodeAt(I)?(u=R,I++):(u=x,0===A&&O(j)),u!==x)?a=[a,l,u]:(I=s,x)}if(o!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if((a=M())!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();e=l!==x&&(41===w.charCodeAt(I)?(u=F,I++):(u=x,0===A&&O(T)),u!==x)?t=Du(i,o,a):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x}else I=e,e=x;e===x&&(e=function(){var e,t,i,n,r,o,s,a,l,u,c,d,h,p,f;A++,e=I,w.substr(I,5)===Ru?(t=Ru,I+=5):(t=x,0===A&&O(ju));t===x&&(w.substr(I,5)===Iu?(t=Iu,I+=5):(t=x,0===A&&O(Au)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(40===w.charCodeAt(I)?(n=C,I++):(n=x,0===A&&O(E)),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();if(r!==x)if((o=M())!==x){for(s=[],a=U();a!==x;)s.push(a),a=U();if(s!==x)if(44===w.charCodeAt(I)?(a=R,I++):(a=x,0===A&&O(j)),a!==x){for(l=[],u=U();u!==x;)l.push(u),u=U();if(l!==x)if((u=M())!==x){for(c=[],d=U();d!==x;)c.push(d),d=U();if(c!==x){if(d=I,44===w.charCodeAt(I)?(h=R,I++):(h=x,0===A&&O(j)),h!==x){for(p=[],f=U();f!==x;)p.push(f),f=U();d=p!==x&&(f=M())!==x?h=[h,p,f]:(I=d,x)}else I=d,d=x;if((d=d===x?null:d)!==x){for(h=[],p=U();p!==x;)h.push(p),p=U();e=h!==x&&(41===w.charCodeAt(I)?(p=F,I++):(p=x,0===A&&O(T)),p!==x)?t=ge(o,u,d):(I=e,x)}else I=e,e=x}else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Su);return e}())===x&&(e=function(){var e,t,i,n;A++,e=I,w.substr(I,6)===Nu?(t=Nu,I+=6):(t=x,0===A&&O(Lu));t===x&&(w.substr(I,6)===Pu?(t=Pu,I+=6):(t=x,0===A&&O(Mu)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(n=L())!==x?t=me(n):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Ou);return e}())===x&&(e=function(){var e,t,i,n,r,o;A++,e=I,w.substr(I,3)===$u?(t=$u,I+=3):(t=x,0===A&&O(Bu));t===x&&(w.substr(I,3)===Qu?(t=Qu,I+=3):(t=x,0===A&&O(Vu)));if(t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();if(i!==x)if(w.substr(I,6)===Nu?(n=Nu,I+=6):(n=x,0===A&&O(Lu)),n===x&&(w.substr(I,6)===Pu?(n=Pu,I+=6):(n=x,0===A&&O(Mu))),n!==x){for(r=[],o=U();o!==x;)r.push(o),o=U();e=r!==x&&(o=L())!==x?t=ve(o):(I=e,x)}else I=e,e=x;else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Uu);return e}())}}}}}}}}}}}}}}return A--,e===x&&(t=x,0===A)&&O(Ga),e}function Hf(){var e,t,i,n,r;return A++,e=I,e=(t=Kf())!==x&&((i=function(){var e,t,i,n,r,o,s,a;A++,e=I,64===w.charCodeAt(I)?(t=pd,I++):(t=x,0===A&&O(fd));if(t!==x){if(i=[],gd.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(md)),n!==x)for(;n!==x;)i.push(n),gd.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(md));else i=x;if(i!==x){if(n=[],r=I,45===w.charCodeAt(I)?(o=c,I++):(o=x,0===A&&O(d)),o!==x){if(s=[],vd.test(w.charAt(I))?(a=w.charAt(I),I++):(a=x,0===A&&O(yd)),a!==x)for(;a!==x;)s.push(a),vd.test(w.charAt(I))?(a=w.charAt(I),I++):(a=x,0===A&&O(yd));else s=x;r=s!==x?o=[o,s]:(I=r,x)}else I=r,r=x;for(;r!==x;)if(n.push(r),r=I,45===w.charCodeAt(I)?(o=c,I++):(o=x,0===A&&O(d)),o!==x){if(s=[],vd.test(w.charAt(I))?(a=w.charAt(I),I++):(a=x,0===A&&O(yd)),a!==x)for(;a!==x;)s.push(a),vd.test(w.charAt(I))?(a=w.charAt(I),I++):(a=x,0===A&&O(yd));else s=x;r=s!==x?o=[o,s]:(I=r,x)}else I=r,r=x;e=n!==x?t=Ce(i,n):(I=e,x)}else I=e,e=x}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(hd);return e}())===x&&(i=I,w.substr(I,2)===Fc?(n=Fc,I+=2):(n=x,0===A&&O(Tc)),i=n!==x&&(r=h())!==x?n=[n,r]:(I=i,x)),(i=i===x?null:i)!==x)?t=Dc(t,i):(I=e,x),A--,e===x&&(t=x,0===A)&&O(Ec),e}function Gf(){var e;return A++,(e=function(){var e;A++,(e=tg())!==x||(e=eg())===x&&(e=Zf());A--,e===x&&0===A&&O(Rc);return e}())===x&&(e=function(){var e;A++,(e=function(){var e,t,i;A++,e=I,43===w.charCodeAt(I)?(t=ks,I++):(t=x,0===A&&O(Cs));e=t!==x&&(i=tg(),i!==x)?t=jd(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Id);return e}())!==x||(e=function(){var e,t,i;A++,e=I,43===w.charCodeAt(I)?(t=ks,I++):(t=x,0===A&&O(Cs));e=t!==x&&(i=eg(),i!==x)?t=jd(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Rd);return e}())===x&&(e=function(){var e,t,i;A++,e=I,43===w.charCodeAt(I)?(t=ks,I++):(t=x,0===A&&O(Cs));e=t!==x&&(i=Zf(),i!==x)?t=Sd(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Dd);return e}());A--,e===x&&0===A&&O(jc);return e}())===x&&(e=Xf()),A--,e===x&&0===A&&O(Sc),e}function Xf(){var e;return A++,(e=function(){var e,t,i;A++,e=I,45===w.charCodeAt(I)?(t=c,I++):(t=x,0===A&&O(d));e=t!==x&&(i=tg(),i!==x)?t=Od(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Ld);return e}())===x&&(e=function(){var e,t,i;A++,e=I,45===w.charCodeAt(I)?(t=c,I++):(t=x,0===A&&O(d));e=t!==x&&(i=eg(),i!==x)?t=Od(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Nd);return e}())===x&&(e=function(){var e,t,i;A++,e=I,45===w.charCodeAt(I)?(t=c,I++):(t=x,0===A&&O(d));e=t!==x&&(i=Zf(),i!==x)?t=Od(i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(Ad);return e}()),A--,e===x&&0===A&&O(Ic),e}function Wf(){var e,t;return A++,e=I,w.substr(I,4)===Oc?(t=Oc,I+=4):(t=x,0===A&&O(Nc)),t===x&&(w.substr(I,4)===Lc?(t=Lc,I+=4):(t=x,0===A&&O(Pc))),t!==x&&(t=Mc()),(e=t)===x&&(e=I,w.substr(I,5)===Uc?(t=Uc,I+=5):(t=x,0===A&&O($c)),t===x&&(w.substr(I,5)===Bc?(t=Bc,I+=5):(t=x,0===A&&O(Qc))),t!==x&&(t=Vc()),e=t),A--,e===x&&(t=x,0===A)&&O(Ac),e}function Kf(){var e,t;return A++,e=I,(t=function(){var e,t,i,n;A++,e=I,w.substr(I,3)===eh?(t=eh,I+=3):(t=x,0===A&&O(th));if(t!==x){for(i=[],ih.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(nh)),n===x&&(n=ng());n!==x;)i.push(n),ih.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(nh)),n===x&&(n=ng());e=i!==x&&(w.substr(I,3)===eh?(n=eh,I+=3):(n=x,0===A&&O(th)),n!==x)?t=Gd(i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Zd);return e}())!==x&&(t=ye(t)),(e=t)===x&&(e=I,(t=function(){var e,t,i,n;A++,e=I,w.substr(I,3)===oh?(t=oh,I+=3):(t=x,0===A&&O(sh));if(t!==x){for(i=[],ah.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(lh)),n===x&&(n=ng());n!==x;)i.push(n),ah.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(lh)),n===x&&(n=ng());e=i!==x&&(w.substr(I,3)===oh?(n=oh,I+=3):(n=x,0===A&&O(sh)),n!==x)?t=Gd(i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(rh);return e}())!==x&&(t=ye(t)),(e=t)===x)&&(e=I,(t=function(){var e,t,i,n;A++,e=I,39===w.charCodeAt(I)?(t=Vd,I++):(t=x,0===A&&O(zd));if(t!==x){for(i=[],qd.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Hd)),n===x&&(n=ng());n!==x;)i.push(n),qd.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Hd)),n===x&&(n=ng());e=i!==x&&(39===w.charCodeAt(I)?(n=Vd,I++):(n=x,0===A&&O(zd)),n!==x)?t=Gd(i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Qd);return e}())!==x&&(t=ye(t)),(e=t)===x)&&(e=I,(t=function(){var e,t,i,n;A++,e=I,34===w.charCodeAt(I)?(t=Wd,I++):(t=x,0===A&&O(Kd));if(t!==x){for(i=[],Jd.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Yd)),n===x&&(n=ng());n!==x;)i.push(n),Jd.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Yd)),n===x&&(n=ng());e=i!==x&&(34===w.charCodeAt(I)?(n=Wd,I++):(n=x,0===A&&O(Kd)),n!==x)?t=Gd(i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Xd);return e}())!==x&&(t=ye(t)),e=t),A--,e===x&&(t=x,0===A)&&O(zc),e}function h(){var e,t;return A++,e=I,(t=Jf())!==x&&(t=Hc(t)),(e=t)===x&&(e=I,(t=function(){var e,t;A++,e=I,(t=function(){var e,t,i;A++,e=I,e=(t=Yf())!==x&&(i=ug(),i!==x)?t=nd(t,i):(I=e,x);A--,e===x&&(t=x,0===A)&&O(id);return e}())!==x&&(t=be(t));(e=t)===x&&(e=I,(t=Yf())!==x&&(t=we(t)),e=t);A--,e===x&&(t=x,0===A)&&O(Xc);return e}())!==x&&(t=Gc(t)),e=t),A--,e===x&&(t=x,0===A)&&O(qc),e}function Jf(){var e,t,i,n;if(A++,e=I,60===w.charCodeAt(I)?(t=da,I++):(t=x,0===A&&O(ha)),t!==x){for(i=[],Jc.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Yc));n!==x;)i.push(n),Jc.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Yc));e=i!==x&&(62===w.charCodeAt(I)?(n=pa,I++):(n=x,0===A&&O(fa)),n!==x)?t=ke(i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Kc),e}function Yf(){var e,t,i;return A++,e=I,e=(t=(t=function(){var e,t,i,n;if(A++,e=I,(t=og())!==x){for(i=[],(n=lg())===x&&(46===w.charCodeAt(I)?(n=g,I++):(n=x,0===A&&O(S)));n!==x;)i.push(n),(n=lg())===x&&(46===w.charCodeAt(I)?(n=g,I++):(n=x,0===A&&O(S)));e=i!==x?t=Fe(t,i):(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(yp);return e}())===x?null:t)!==x&&(58===w.charCodeAt(I)?(i=ed,I++):(i=x,0===A&&O(td)),i!==x)?t=Gc(t):(I=e,x),A--,e===x&&(t=x,0===A)&&O(Zc),e}function Zf(){var e,t,i;if(A++,e=I,t=[],o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s)),i!==x)for(;i!==x;)t.push(i),o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s));else t=x;return t!==x&&(t=wd(t)),A--,(e=t)===x&&(t=x,0===A)&&O(bd),e}function eg(){var e,t,i,n,r;if(A++,e=I,t=[],o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s)),i!==x)for(;i!==x;)t.push(i),o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s));else t=x;if(t!==x)if(46===w.charCodeAt(I)?(i=g,I++):(i=x,0===A&&O(S)),i!==x){for(n=[],o.test(w.charAt(I))?(r=w.charAt(I),I++):(r=x,0===A&&O(s));r!==x;)n.push(r),o.test(w.charAt(I))?(r=w.charAt(I),I++):(r=x,0===A&&O(s));e=n!==x?t=_d(t,i,n):(I=e,x)}else I=e,e=x;else I=e,e=x;if(e===x)if(e=I,46===w.charCodeAt(I)?(t=g,I++):(t=x,0===A&&O(S)),t!==x){if(i=[],o.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(s)),n!==x)for(;n!==x;)i.push(n),o.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(s));else i=x;e=i!==x?t=kd(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(xd),e}function tg(){var e,t,i,n,r;if(A++,e=I,t=[],o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s)),i!==x)for(;i!==x;)t.push(i),o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s));else t=x;if(t!==x)if(46===w.charCodeAt(I)?(i=g,I++):(i=x,0===A&&O(S)),i!==x){for(n=[],o.test(w.charAt(I))?(r=w.charAt(I),I++):(r=x,0===A&&O(s));r!==x;)n.push(r),o.test(w.charAt(I))?(r=w.charAt(I),I++):(r=x,0===A&&O(s));e=n!==x&&(r=ig())!==x?t=Ed(t,i,n,r):(I=e,x)}else I=e,e=x;else I=e,e=x;if(e===x){if(e=I,46===w.charCodeAt(I)?(t=g,I++):(t=x,0===A&&O(S)),t!==x){if(i=[],o.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(s)),n!==x)for(;n!==x;)i.push(n),o.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(s));else i=x;e=i!==x&&(n=ig())!==x?t=Fd(t,i,n):(I=e,x)}else I=e,e=x;if(e===x){if(e=I,t=[],o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s)),i!==x)for(;i!==x;)t.push(i),o.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(s));else t=x;e=t!==x&&(i=ig())!==x?t=Td(t,i):(I=e,x)}}return A--,e===x&&(t=x,0===A)&&O(Cd),e}function ig(){var e,t,i,n,r;if(A++,e=I,Md.test(w.charAt(I))?(t=w.charAt(I),I++):(t=x,0===A&&O(Ud)),t!==x)if($d.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(Bd)),(i=i===x?null:i)!==x){if(n=[],o.test(w.charAt(I))?(r=w.charAt(I),I++):(r=x,0===A&&O(s)),r!==x)for(;r!==x;)n.push(r),o.test(w.charAt(I))?(r=w.charAt(I),I++):(r=x,0===A&&O(s));else n=x;e=n!==x?t=Ee(t,i,n):(I=e,x)}else I=e,e=x;else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(Pd),e}function ng(){var e,t,i;return A++,e=I,92===w.charCodeAt(I)?(t=ch,I++):(t=x,0===A&&O(dh)),e=t!==x&&(hh.test(w.charAt(I))?(i=w.charAt(I),I++):(i=x,0===A&&O(ph)),i!==x)?t=[t,i]:(I=e,x),A--,e===x&&(t=x,0===A)&&O(uh),e}function rg(){var e,t,i,n;if(A++,e=I,40===w.charCodeAt(I)?(t=C,I++):(t=x,0===A&&O(E)),t!==x){for(i=[],n=U();n!==x;)i.push(n),n=U();e=i!==x&&(41===w.charCodeAt(I)?(n=F,I++):(n=x,0===A&&O(T)),n!==x)?t=gh():(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(fh),e}function U(){var e;return A++,vh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(yh)),e===x&&(bh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(wh)),e===x)&&(xh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(_h)),e===x)&&(kh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Ch)),e===x)&&(e=function(){var e,t,i,n;A++,e=I,35===w.charCodeAt(I)?(t=Fh,I++):(t=x,0===A&&O(Th));if(t!==x){for(i=[],Dh.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Sh));n!==x;)i.push(n),Dh.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(Sh));e=i!==x?t=[t,i]:(I=e,x)}else I=e,e=x;A--,e===x&&(t=x,0===A)&&O(Eh);return e}()),A--,e===x&&0===A&&O(mh),e}function og(){var e;return A++,Ih.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Ah)),e===x&&(Oh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Nh)),e===x)&&(Lh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Ph)),e===x)&&(Mh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Uh)),e===x)&&($h.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Bh)),e===x)&&(Qh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Vh)),e===x)&&(zh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(qh)),e===x)&&(Hh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Gh)),e===x)&&(Xh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Wh)),e===x)&&(Kh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Jh)),e===x)&&(Yh.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Zh)),e===x)&&(ep.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(tp)),e===x)&&(ip.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(np)),e===x)&&(rp.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(op))),A--,e===x&&0===A&&O(jh),e}function sg(){var e;return A++,(e=og())===x&&(95===w.charCodeAt(I)?(e=ap,I++):(e=x,0===A&&O(lp))),A--,e===x&&0===A&&O(sp),e}function ag(){var e,t,i,n;if(A++,e=I,(t=sg())===x&&(o.test(w.charAt(I))?(t=w.charAt(I),I++):(t=x,0===A&&O(s))),t!==x){for(i=[],(n=sg())===x&&(o.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(s)),n===x)&&(cp.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(dp)),n===x)&&(hp.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(pp)),n===x)&&(fp.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(gp)));n!==x;)i.push(n),(n=sg())===x&&(o.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(s)),n===x)&&(cp.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(dp)),n===x)&&(hp.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(pp)),n===x)&&(fp.test(w.charAt(I))?(n=w.charAt(I),I++):(n=x,0===A&&O(gp)));e=i!==x?t=mp(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(up),e}function lg(){var e;return A++,(e=sg())===x&&(45===w.charCodeAt(I)?(e=c,I++):(e=x,0===A&&O(d)),e===x)&&(o.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(s)),e===x)&&(cp.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(dp)),e===x)&&(hp.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(pp)),e===x)&&(fp.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(gp))),A--,e===x&&0===A&&O(vp),e}function ug(){var e,t,i,n;if(A++,e=I,(t=(t=sg())===x&&(o.test(w.charAt(I))?(t=w.charAt(I),I++):(t=x,0===A&&O(s)),t===x)&&(58===w.charCodeAt(I)?(t=ed,I++):(t=x,0===A&&O(td)),t===x)?cg():t)!==x){for(i=[],(n=lg())===x&&(46===w.charCodeAt(I)?(n=g,I++):(n=x,0===A&&O(S)),n===x)&&(58===w.charCodeAt(I)?(n=ed,I++):(n=x,0===A&&O(td)),n===x)&&(n=cg());n!==x;)i.push(n),(n=lg())===x&&(46===w.charCodeAt(I)?(n=g,I++):(n=x,0===A&&O(S)),n===x)&&(58===w.charCodeAt(I)?(n=ed,I++):(n=x,0===A&&O(td)),n===x)&&(n=cg());e=i!==x?t=Te(t,i):(I=e,x)}else I=e,e=x;return A--,e===x&&(t=x,0===A)&&O(bp),e}function cg(){var e;return A++,(e=function(){var e,t,i,n,r;A++,t=e=I,37===w.charCodeAt(I)?(i=_p,I++):(i=x,0===A&&O(kp));t=i!==x&&(n=dg(),n!==x)&&(r=dg())!==x?i=[i,n,r]:(I=t,x);t!==x&&(t=De(t));A--,(e=t)===x&&(t=x,0===A)&&O(xp);return e}())===x&&(e=function(){var e,t,i;A++,e=I,92===w.charCodeAt(I)?(t=ch,I++):(t=x,0===A&&O(dh));e=t!==x&&(95===w.charCodeAt(I)?(i=ap,I++):(i=x,0===A&&O(lp)),i===x&&(126===w.charCodeAt(I)?(i=Rp,I++):(i=x,0===A&&O(jp)),i===x)&&(46===w.charCodeAt(I)?(i=g,I++):(i=x,0===A&&O(S)),i===x)&&(45===w.charCodeAt(I)?(i=c,I++):(i=x,0===A&&O(d)),i===x)&&(33===w.charCodeAt(I)?(i=Fs,I++):(i=x,0===A&&O(Ts)),i===x)&&(36===w.charCodeAt(I)?(i=cd,I++):(i=x,0===A&&O(dd)),i===x)&&(38===w.charCodeAt(I)?(i=Ip,I++):(i=x,0===A&&O(Ap)),i===x)&&(39===w.charCodeAt(I)?(i=Vd,I++):(i=x,0===A&&O(zd)),i===x)&&(40===w.charCodeAt(I)?(i=C,I++):(i=x,0===A&&O(E)),i===x)&&(41===w.charCodeAt(I)?(i=F,I++):(i=x,0===A&&O(T)),i===x)&&(42===w.charCodeAt(I)?(i=D,I++):(i=x,0===A&&O(ct)),i===x)&&(43===w.charCodeAt(I)?(i=ks,I++):(i=x,0===A&&O(Cs)),i===x)&&(44===w.charCodeAt(I)?(i=R,I++):(i=x,0===A&&O(j)),i===x)&&(59===w.charCodeAt(I)?(i=Yi,I++):(i=x,0===A&&O(Zi)),i===x)&&(58===w.charCodeAt(I)?(i=ed,I++):(i=x,0===A&&O(td)),i===x)&&(61===w.charCodeAt(I)?(i=aa,I++):(i=x,0===A&&O(la)),i===x)&&(47===w.charCodeAt(I)?(i=ps,I++):(i=x,0===A&&O(fs)),i===x)&&(63===w.charCodeAt(I)?(i=xs,I++):(i=x,0===A&&O(_s)),i===x)&&(35===w.charCodeAt(I)?(i=Fh,I++):(i=x,0===A&&O(Th)),i===x)&&(64===w.charCodeAt(I)?(i=pd,I++):(i=x,0===A&&O(fd)),i===x)&&(37===w.charCodeAt(I)?(i=_p,I++):(i=x,0===A&&O(kp))),i!==x)?t="\\"+i:(I=e,x);A--,e===x&&(t=x,0===A)&&O(Sp);return e}()),A--,e===x&&0===A&&O(wp),e}function dg(){var e;return A++,o.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(s)),e===x&&(Ep.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Fp)),e===x)&&(Tp.test(w.charAt(I))?(e=w.charAt(I),I++):(e=x,0===A&&O(Dp))),A--,e===x&&0===A&&O(Cp),e}function hg(e){var t="";if(null==e)return null;for(var i=0;i<e.length;i++)t+=e[i];return t.toUpperCase()}var pg=function(e){for(var t="",i=0;i<e.length;i++)"string"==typeof e[i]?t+=e[i]:t+=e[i].join("");return t},a=0,fg={};if((Se=Re())!==x&&I===w.length)return Se;throw Se!==x&&I<w.length&&O({type:"end"}),Mp(Np,t<w.length?w.charAt(t):null,t<w.length?Pp(t,t+1):Pp(t,t))}}}()},{}],47:[function(e,t,i){e("./btree").Tree;var n=e("./utils"),r=n,o=e("./lexicon").Lexicon;(PersistentLexicon=function(t,e){var i=this,e=(n.registerIndexedDB(i),this.defaultGraphOid=0,this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph",this.defaultGraphUriTerm={token:"uri",prefix:null,suffix:null,value:this.defaultGraphUri},this.oidCounter=1,i.dbName=e||"rdfstorejs",i.indexedDB.open(this.dbName+"_lexicon",1));e.onerror=function(e){t(null,new Error("Error opening IndexedDB: "+e.target.errorCode))},e.onsuccess=function(e){i.db=e.target.result,t(i)},e.onupgradeneeded=function(e){i.db=e.target.result,i.db.createObjectStore("knownGraphs",{keyPath:"oid"}).createIndex("uriToken","uriToken",{unique:!0}),i.db.createObjectStore("components",{keyPath:"id",autoIncrement:!0}).createIndex("value","value",{unique:!0})}}).prototype.registerGraph=function(t,i,n){var e,r;t!=this.defaultGraphOid?((e=this.db.transaction(["knownGraphs"],"readwrite")).onerror=function(e){n(null,new Error(e.target.statusCode))},(r=e.objectStore("knownGraphs")).get(i).onsuccess=function(e){e.target.result?n(!0):r.add({oid:t,uriToken:i}).onsuccess=function(e){n(!0)}}):n()},PersistentLexicon.prototype.registeredGraphs=function(t,i){var n=[],e=this.db.transaction(["knownGraphs"],"readwrite").objectStore("knownGraphs").openCursor();e.onsuccess=function(e){e=e.target.result;e?(n.push(!0===t?e.value.uriToken:e.value.oid),e.continue()):i(n)},e.onerror=function(e){i(null,new Error("Error retrieving data from the cursor: "+e.target.errorCode))}},PersistentLexicon.prototype.registerUri=function(i,n){var r,e;i===this.defaultGraphUri?n(this.defaultGraphOid):((e=(r=this.db.transaction(["components"],"readwrite").objectStore("components")).index("value").get("_u:"+i)).onsuccess=function(e){var t,e=e.target.result;e?(e.counter++,t=e.id,(e=r.put(e)).onsuccess=function(e){n(t)},e.onerror=function(e){n(null,new Error("Error updating the URI data"+e.target.errorCode))}):((e=r.add({value:"_u:"+i,counter:0,uri:!0})).onsuccess=function(e){n(e.target.result)},e.onerror=function(e){n(null,new Error("Error inserting the URI data"+e.target.errorCode))})},e.onerror=function(e){n(null,new Error("Error retrieving the URI data"+e.target.errorCode))})},PersistentLexicon.prototype.resolveUri=function(e,t){e===this.defaultGraphUri?t(this.defaultGraphOid):((e=this.db.transaction(["components"]).objectStore("components").index("value").get("_u:"+e)).onsuccess=function(e){null!=e.target.result?t(e.target.result.id):t(-1)},e.onerror=function(e){t(null,new Error("Error retrieving uri data "+e.target.errorCode))})},PersistentLexicon.prototype.resolveUriCost=function(e,t){e===this.defaultGraphUri?t(0):((e=that.db.transaction(["components"]).objectStore("components").index("value").get("_u:"+e)).onsuccess=function(e){null!=e.target.result?t(e.target.result.cost):t(-1)},e.onerror=function(e){t(null,new Error("Error retrieving uri data "+e.target.errorCode))})},PersistentLexicon.prototype.registerBlank=function(t){var e=guid(),e=this.db.transaction(["components"],"readwrite").objectStore("components").add({value:"_b:"+e,counter:0,label:!0});e.onsuccess=function(e){t(e.target.result)},e.onerror=function(e){t(null,new Error("Error inserting the URI data"+e.target.errorCode))}},PersistentLexicon.prototype.resolveBlankCost=function(e,t){t(0)},PersistentLexicon.prototype.registerLiteral=function(i,n){var r=this.db.transaction(["components"],"readwrite").objectStore("components"),e=r.index("value").get("_l:"+i);e.onsuccess=function(e){var t,e=e.target.result;e?(e.counter++,t=e.id,(e=r.put(e)).onsuccess=function(e){n(t)},e.onerror=function(e){n(null,new Error("Error updating the literal data"+e.target.errorCode))}):((e=r.add({value:"_l:"+i,counter:0,literal:!0})).onsuccess=function(e){n(e.target.result)},e.onerror=function(e){n(null,new Error("Error inserting the literal data"+e.target.errorCode))})},e.onerror=function(e){n(null,new Error("Error retrieving the literal data"+e.target.errorCode))}},PersistentLexicon.prototype.resolveLiteral=function(e,t){e=that.db.transaction(["components"]).objectStore("components").index("value").get("_l:"+e);e.onsuccess=function(e){null!=e.target.result?t(e.target.result.id):t(-1)},e.onerror=function(e){t(null,new Error("Error retrieving literal data "+e.target.errorCode))}},PersistentLexicon.prototype.resolveLiteralCost=function(e,t){e=that.db.transaction(["components"]).objectStore("components").index("components").get(e);e.onsuccess=function(e){null!=e.target.result?t(e.target.result.cost):t(-1)},e.onerror=function(e){t(null,new Error("Error retrieving literal data "+e.target.errorCode))}},PersistentLexicon.prototype.parseLiteral=function(e){return o.prototype.parseLiteral(e)},PersistentLexicon.prototype.parseUri=function(e){return o.prototype.parseUri(e)},PersistentLexicon.prototype.retrieve=function(e,i){var n=this;e===this.defaultGraphOid?i({token:"uri",value:this.defaultGraphUri,prefix:null,suffix:null,defaultGraph:!0}):((e=n.db.transaction(["components"]).objectStore("components").get(e)).onsuccess=function(e){var t;null!=e.target.result?null!=e.target.result.label?(t="_:"+e.target.result.id,i({token:"blank",value:t})):null!=e.target.result.uri?i(n.parseUri(e.target.result.value.slice(3,e.target.result.value.length))):null!=e.target.result.literal?i(n.parseLiteral(e.target.result.value.slice(3,e.target.result.value.length))):(console.log(e.target.result),i(null,new Error("Unknown type of component "+e.target.result))):i(null,null)},e.onerror=function(e){i(null,new Error("Error searching in blanks data "+e.target.errorCode))})},PersistentLexicon.prototype.clear=function(e){this.defaultGraphOid=0,this.defaultGraphUri="https://github.com/antoniogarrote/rdfstore-js#default_graph",this.defaultGraphUriTerm={token:"uri",prefix:null,suffix:null,value:this.defaultGraphUri};function t(){null!=e&&e()}var i=this.db.transaction(["components"],"readwrite").objectStore("components").clear();i.onsuccess=t,i.onerror=t},PersistentLexicon.prototype.unregister=function(t,i,e){var n=this;r.seq(function(e){n._unregisterTerm(t.subject.token,i.subject,e)},function(e){n._unregisterTerm(t.predicate.token,i.predicate,e)},function(e){n._unregisterTerm(t.object.token,i.object,e)},function(e){null!=t.graph?n._unregisterTerm(t.graph.token,i.graph,e):e()})(function(){e(!0)})},PersistentLexicon.prototype._unregisterTerm=function(e,t,i){var n=this.db.transaction(["components","knownGraphs"],"readwrite");"uri"===e?t!=this.defaultGraphOid?n.objectStore("components").delete(t).onsuccess=void(n.objectStore("knownGraphs").delete(t).onsuccess=function(){i()}):i():n.objectStore("components").delete(t).onsuccess=function(){i()}},t.exports={PersistentLexicon:PersistentLexicon}},{"./btree":40,"./lexicon":44,"./utils":57}],48:[function(e,t,i){var s=e("./utils");(PersistentQuadBackend=function(e,t){var i=this;if(0!==arguments){for(var n in s.registerIndexedDB(i),this.indexMap={},this.indices=["S","P","O","G","SP","SO","SG","PO","PG","OG","SPO","SPG","SOG","POG","SPOG"],this.componentOrders={S:["subject","predicate","object","graph"],P:["predicate","subject","object","graph"],O:["object","subject","predicate","graph"],G:["graph","subject","predicate","object"],SP:["subject","predicate","object","graph"],SO:["subject","object","predicate","graph"],SG:["subject","graph","predicate","object"],PO:["predicate","object","subject","graph"],PG:["predicate","graph","subject","object"],OG:["object","graph","subject","predicate"],SPO:["subject","predicate","object","graph"],SPG:["subject","predicate","graph","object"],SOG:["subject","object","graph","predicate"],POG:["predicate","object","graph","subject"],SPOG:["subject","predicate","object","graph"]},this.componentOrdersMap={},this.componentOrders){var r=this.componentOrders[n].slice(0,n.length).sort().join(".");this.componentOrdersMap[r]=n}i.dbName=e.name||"rdfstorejs";var o=i.indexedDB.open(this.dbName+"_db",1);o.onerror=function(e){t(null,new Error("Error opening IndexedDB: "+e.target.errorCode))},o.onsuccess=function(e){i.db=e.target.result,t(i)},o.onupgradeneeded=function(e){var t=e.target.result.createObjectStore(i.dbName,{keyPath:"SPOG"});s.each(i.indices,function(e){"SPOG"!==e&&t.createIndex(e,e,{unique:!1})})}}}).prototype.index=function(t,i){var n=this,e=(s.each(this.indices,function(e){t[e]=n._genMinIndexKey(t,e)}),n.db.transaction([n.dbName],"readwrite"));e.oncomplete=function(e){},e.onerror=function(e){i(null,new Error(e.target.statusCode))},e.objectStore(n.dbName).add(t).onsuccess=function(e){i(!0)}},PersistentQuadBackend.prototype.range=function(e,t){var i=this.db.transaction([this.dbName]).objectStore(this.dbName),n=this._indexForPattern(e),r=this._genMinIndexKey(e,n),e=this._genMaxIndexKey(e,n),r=this.IDBKeyRange.bound(r,e,!1,!1),o=[],e="SPOG"===n?i:i.index(n);e.openCursor(r).onsuccess=function(e){e=e.target.result;e?(o.push(e.value),e.continue()):t(o)}},PersistentQuadBackend.prototype.search=function(e,t){var i=this.db.transaction([this.dbName]).objectStore(this.dbName),e=this._genMinIndexKey(e,"SPOG"),i=i.get(e);i.onerror=function(e){t(null,new Error(e.target.statusCode))},i.onsuccess=function(e){t(null!=e.target.result)}},PersistentQuadBackend.prototype.delete=function(e,t){e=this._genMinIndexKey(e,"SPOG"),e=this.db.transaction([this.dbName],"readwrite").objectStore(this.dbName).delete(e);e.onsuccess=function(){t(!0)},e.onerror=function(e){t(null,new Error(e.target.statusCode))}},PersistentQuadBackend.prototype._genMinIndexKey=function(t,e){e=this.componentOrders[e];return s.map(e,function(e){return"string"==typeof t[e]||null==t[e]?"0":t[e]}).join(".")},PersistentQuadBackend.prototype._genMaxIndexKey=function(e,t){for(var i=this.componentOrders[t],n=[],r=0;r<i.length;r++){var o=e[i[r]];n[r]="string"==typeof o?"z":o}return s.map(n,function(e){return""+e}).join(".")},PersistentQuadBackend.prototype._indexForPattern=function(e){var e=e.indexKey.sort().join("."),t=this.componentOrdersMap[e];if(null==t)throw new Error("Error, cannot find index for indexKey "+e);return t},PersistentQuadBackend.prototype.clear=function(e){var t=this.db.transaction([this.dbName],"readwrite").objectStore(this.dbName).clear();t.onsuccess=function(){e()},t.onerror=function(){e()}},t.exports.PersistentQuadBackend=PersistentQuadBackend},{"./utils":57}],49:[function(e,t,i){var r=e("./quad_index").QuadIndex,s=e("./utils");(QuadBackend=function(e,t){this.indexMap={},this.treeOrder=e.treeOrder,this.indices=e.index||QuadBackend.allIndices,this.componentOrders=QuadBackend.componentOrders;var n=this;s.eachSeries(this.indices,function(t,i){new r({order:n.treeOrder,componentOrder:n.componentOrders[t]},function(e){n.indexMap[t]=e,i()})},function(){t(n)})}).allIndices=["SPOG","GP","OGS","POG","GSP","OS"],QuadBackend.componentOrders={SPOG:["subject","predicate","object","graph"],GP:["graph","predicate","subject","object"],OGS:["object","graph","subject","predicate"],POG:["predicate","object","graph","subject"],GSP:["graph","subject","predicate","object"],OS:["object","subject","predicate","graph"]},QuadBackend.prototype._indexForPattern=function(e){for(var t=e.indexKey,i=0;i<QuadBackend.allIndices.length;i++)for(var n=QuadBackend.allIndices[i],r=QuadBackend.componentOrders[n],o=0;o<r.length&&!1!==s.include(t,r[o]);o++)if(o==t.length-1)return n;return"SPOG"},QuadBackend.prototype.index=function(i,e){var n=this;s.eachSeries(this.indices,function(e,t){n.indexMap[e].insert(i,function(){t()})},function(){e(!0)})},QuadBackend.prototype.range=function(e,t){var i=this._indexForPattern(e),i=this.indexMap[i];null!=i&&i.range(e,function(e){t(e)})},QuadBackend.prototype.search=function(e,t){var i=this.indexMap.SPOG;null!=i&&i.search(e,function(e){t(null!=e)})},QuadBackend.prototype.delete=function(i,e){var n=this;s.eachSeries(this.indices,function(e,t){n.indexMap[e].delete(i,function(){t()})},function(){e(!0)})},QuadBackend.prototype.clear=function(e){var n=this;s.eachSeries(this.indices,function(t,i){new r({order:n.treeOrder,componentOrder:n.componentOrders[t]},function(e){n.indexMap[t]=e,i()})},function(){e(!0)})},t.exports.QuadBackend=QuadBackend},{"./quad_index":50,"./utils":57}],50:[function(e,t,i){var n=e("./btree").Tree,r=e("./utils"),u=e("./utils");(NodeKey=function(e,t){this.subject=e.subject,this.predicate=e.predicate,this.object=e.object,this.graph=e.graph,this.order=t}).prototype.comparator=function(e){for(var t=0;t<this.order.length;t++){var i=this.order[t];if(null==e[i])return 0;if(this[i]<e[i])return-1;if(this[i]>e[i])return 1}return 0},Pattern=function(e){this.subject=e.subject,this.predicate=e.predicate,this.object=e.object,this.graph=e.graph,this.indexKey=[],this.keyComponents={};var t=[],i=[],n=this;r.forEach(["subject","predicate","object","graph"],function(e){"string"==typeof n[e]?(i.push(e),n.keyComponents[e]=null):(t.push(e),n.keyComponents[e]=n[e],n.indexKey.push(e))}),this.order=t.concat(i),this.key=new NodeKey(this.keyComponents,this.order)},(QuadIndex=function(e,t){0!=arguments&&(this.componentOrder=e.componentOrder,n.call(this,e.order,function(o){o.comparator=function(e,t){for(var i=0;i<o.componentOrder.length;i++){var n=o.componentOrder[i],r=e[n],n=t[n];if(r<n)return-1;if(n<r)return 1}return 0},o.rangeComparator=function(e,t){for(var i=0;i<o.componentOrder.length;i++){var n=o.componentOrder[i];if(null==t[n]||null==e[n])return 0;if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return 0},t(o)}))}).prototype=r.create(n.prototype,{constructor:n}),QuadIndex.prototype.insert=function(e,t){n.prototype.insert.call(this,e,null,function(e){t(e)})},QuadIndex.prototype.search=function(e,t){n.prototype.search.call(this,e,function(e){t(e)},!0)},QuadIndex.prototype.range=function(e,t){this._rangeTraverse(this,this.root,e,t)},QuadIndex.prototype._rangeTraverse=function(o,e,t,i){var s=t.key,a=[],l=[e];u.whilst(function(){return 0<l.length},function(t){for(var n=l.shift(),r=0;r<n.numberActives&&-1===o.rangeComparator(n.keys[r].key,s);)r++;if(!0===n.isLeaf){for(var e=r;e<n.numberActives&&0===o.rangeComparator(n.keys[e].key,s);)a.push(n.keys[e].key),e++;t()}else o._diskRead(n.children[r],function(e){l.push(e);var i=r;u.whilst(function(){return i<n.numberActives&&0===o.rangeComparator(n.keys[i].key,s)},function(t){a.push(n.keys[i].key),i++,o._diskRead(n.children[i],function(e){l.push(e),t()})},function(){t()})})},function(){i(a)})},t.exports={QuadIndex:QuadIndex,Pattern:Pattern,NodeKey:NodeKey}},{"./btree":40,"./utils":57}],51:[function(e,t,i){var n=e("./abstract_query_tree").AbstractQueryTree,s=e("./abstract_query_tree").NonSupportedSparqlFeatureError,c=e("./utils"),d=e("./quad_index"),f=e("./query_plan").QueryPlan,g=e("./query_filters").QueryFilters,y=e("./rdf_model"),r=e("./rdf_loader").RDFLoader,h=e("./graph_callbacks").CallbacksBackend,m=e("./utils"),l=e("./utils");function v(e,t,i){this.name="BindExpressionError",this.bind=t,this.error=i,this.message=e}v.prototype=new Error,v.constructor=v,(QueryEngine=function(e){0!=arguments.length&&(this.backend=e.backend,this.lexicon=e.lexicon,this.eventsOnBatchLoad=e.eventsOnBatchLoad||!1,this.defaultPrefixes={},this.abstractQueryTree=new n,this.rdfLoader=new r(e.communication),this.callbacksBackend=new h(this),this.customFns=e.customFns||{})}).prototype.setCustomFunctions=function(e){this.customFns=e},QueryEngine.prototype.registerNsInEnvironment=function(e,t){var i,n=[],r=(null!=e&&null!=e.prefixes&&(n=e.prefixes),{});for(i in this.defaultPrefixes)r[i]=this.defaultPrefixes[i];for(var o=0;o<n.length;o++){var s=n[o];"prefix"===s.token&&(r[s.prefix]=s.local)}t.namespaces=r,null!=e&&e.base&&"object"==typeof e.base?t.base=e.base.value:t.base=null},QueryEngine.prototype.applyModifier=function(e,t){if("DISTINCT"!=e)return t;for(var i={},n=[],r=0;r<t.length;r++){var o,s=t[r],a="";for(o in s){var l=s[o];null==l?a=a+o+"null":"literal"==l.token?(null!=l.value&&(a+=l.value),null!=l.lang&&(a+=l.lang),null!=l.type&&(a+=l.type)):a=l.value?a+o+l.value:a+o+l}null==i[a]&&(n.push(s),i[a]=!0)}return n},QueryEngine.prototype.applyLimitOffset=function(e,t,i){return null==t&&null==e?i:(null==e&&(e=0),t=null==t?i.length:e+t,i.slice(e,t))},QueryEngine.prototype.applySingleOrderBy=function(e,i,n,r,t){var o=[],s=this;m.eachSeries(e,function(e,t){g.collect(e.expression,[i],n,r,s,function(e){o.push(e[0].value),t()})},function(){t({binding:i,value:o})})},QueryEngine.prototype.applyOrderBy=function(i,e,n,r,o){var s=this,a=[];null!=i&&0<i.length?m.eachSeries(e,function(e,t){s.applySingleOrderBy(i,e,n,r,function(e){a.push(e),t()})},function(){a.sort(function(e,t){return s.compareFilteredBindings(e,t,i,r)});for(var e=[],t=0;t<a.length;t++)e.push(a[t].binding);o(e)}):o(e)},QueryEngine.prototype.compareFilteredBindings=function(e,t,i,n){for(var r=0;;){if(r==e.value.length)return 0;var o,s=i[r].direction;if(null!=e.value[r]||null!=t.value[r]){if(null==e.value[r])o={value:!1};else if(null==t.value[r])o={value:!0};else{if("blank"===e.value[r].token&&"blank"===t.value[r].token){r++;continue}if("blank"===e.value[r].token)o={value:!1};else if("blank"===t.value[r].token)o={value:!0};else if("uri"===e.value[r].token&&"uri"===t.value[r].token){if(1==g.runEqualityFunction(e.value[r],t.value[r],[],this,n).value){r++;continue}o=g.runTotalGtFunction(e.value[r],t.value[r],[])}else if("uri"===e.value[r].token)o={value:!1};else if("uri"===t.value[r].token)o={value:!0};else if("literal"===e.value[r].token&&"literal"===t.value[r].token&&null==e.value[r].type&&null==t.value[r].type){if(1==g.runEqualityFunction(e.value[r],t.value[r],[],this,n).value){r++;continue}o=g.runTotalGtFunction(e.value[r],t.value[r],[])}else if("literal"===e.value[r].token&&null==e.value[r].type)o={value:!1};else if("literal"===t.value[r].token&&null==t.value[r].type)o={value:!0};else{if(1==g.runEqualityFunction(e.value[r],t.value[r],[],this,n).value){r++;continue}o=g.runTotalGtFunction(e.value[r],t.value[r],[])}}return 1==o.value?"ASC"===s?1:-1:"ASC"===s?-1:1}r++}},QueryEngine.prototype.removeDefaultGraphBindings=function(e,t){for(var i=[],n={},r=0;r<t.named.length;r++)n[t.named[r].oid]=!0;for(r=0;r<t.implicit.length;r++)null==n[t.implicit[r].oid]&&i.push(t.implicit[r].oid);for(var o=[],r=0;r<e.length;r++){var s,a=e[r],l=!1;for(s in a){for(var u=0;u<n.length;u++)if(a[s]===n[u]){l=!0;break}if(l)break}l||o.push(a)}return o},QueryEngine.prototype.aggregateBindings=function(r,e,o,s,a){this.copyDenormalizedBindings(e,s.outCache,function(e){for(var t={},i=0;i<r.length;i++){var n=g.runAggregator(r[i],e,this,o,s);r[i].alias?t[r[i].alias.value]=n:t[r[i].value.value]=n}a(t)})},QueryEngine.prototype.projectBindings=function(e,t,i){if("*"===e[0].kind)return t;for(var n=[],r=0;r<t.length;r++){for(var o=t[r],s={},a=!0,l=0;l<e.length;l++)if("variable"==e[l].token&&"aliased"!=e[l].kind)s[e[l].value.value]=o[e[l].value.value];else if("variable"==e[l].token&&"aliased"==e[l].kind){var u=g.runFilter(e[l].expression,o,this,i,{blanks:{},outCache:{}});if(g.isEbvError(u)){a=!1;break}s[e[l].alias.value]=u}!0===a&&n.push(s)}return n},QueryEngine.prototype.resolveNsInEnvironment=function(e,t){return t.namespaces[e]},QueryEngine.prototype.normalizeTerm=function(e,t,i,n){var r,o;"uri"===e.token?null==(o=c.lexicalFormBaseUri(e,t))?n(null):i?this.lexicon.registerUri(o,n):this.lexicon.resolveUri(o,n):"literal"===e.token?(o=c.lexicalFormLiteral(e,t),i?this.lexicon.registerLiteral(o,n):this.lexicon.resolveLiteral(o,n)):"blank"===e.token?(r=e.value,null!=(o=t.blanks[r])?n(o):i?this.lexicon.registerBlank(function(e){t.blanks[r]=e,n(e)}):this.lexicon.resolveBlank(function(e){t.blanks[r]=e,n(e)})):"var"===e.token?n(e.value):n(null)},QueryEngine.prototype.normalizeDatasets=function(e,n,t){var r=this;m.eachSeries(e,function(t,i){t.value===r.lexicon.defaultGraphUri?(t.oid=r.lexicon.defaultGraphOid,i()):r.normalizeTerm(t,n,!1,function(e){null!=e&&(t.oid=e),i()})},function(){t(!0)})},QueryEngine.prototype.normalizeQuad=function(n,e,r,t){var i=null,o=null,s=null,a=null,l=this,u=!1;m.seq(function(t){var i;null==n.graph||n.graph.value===l.lexicon.defaultGraphUri?(a=0,t()):(i=c.lexicalFormBaseUri(n.graph,e),l.normalizeTerm(n.graph,e,r,function(e){null!=e?(a=e,!0===r&&"var"!=n.graph.token?l.lexicon.registerGraph(e,i,function(){t()}):t()):(u=!0,t())}))},function(t){!1===u?l.normalizeTerm(n.subject,e,r,function(e){null!=e?i=e:u=!0,t()}):t()},function(t){!1===u?l.normalizeTerm(n.predicate,e,r,function(e){null!=e?o=e:u=!0,t()}):t()},function(t){!1===u?l.normalizeTerm(n.object,e,r,function(e){null!=e?s=e:u=!0,t()}):t()})(function(){t(!0===u?null:{subject:i,predicate:o,object:s,graph:a})})},QueryEngine.prototype.denormalizeBindingsList=function(e,i,t){var n=this,r=[];m.eachSeries(e,function(e,t){n.denormalizeBindings(e,i,function(e){r.push(e),t()})},function(){t(r)})},QueryEngine.prototype.copyDenormalizedBindings=function(e,s,t){var a=this,i=[];m.eachSeries(e,function(r,e){var o={},t=l.keys(r);m.eachSeries(t,function(t,i){var e,n=r[t];null==n?(o[t]=null,i()):"object"==typeof n?(o[t]=n,i()):null!=(e=s[n])?(o[t]=e,i()):a.lexicon.retrieve(n,function(e){s[n]=e,o[t]=e,i()})},function(){i.push(o),e()})},function(){t(i)})},QueryEngine.prototype.denormalizeBindings=function(r,o,e){var t=l.keys(r),s=o.outCache,a=this;m.eachSeries(t,function(t,i){var n=r[t];null==n?(r[t]=null,i()):"object"==typeof n?i():null!=s[n]?(r[t]=s[n],i()):a.lexicon.retrieve(n,function(e){"blank"===(r[t]=e).token&&(o.blanks[e.value]=n),i()})},function(){e(r)})},QueryEngine.prototype.execute=function(e,i,t,n){e=c.normalizeUnicodeLiterals(e);var r,e=this.abstractQueryTree.parseQueryString(e);null==e?i(!1,"Error parsing query string"):"query"===e.token&&"update"==e.kind?(this.callbacksBackend.startGraphModification(),(r=this).executeUpdate(e,function(e,t){r.lexicon.updateAfterWrite&&r.lexicon.updateAfterWrite(),e?(r.callbacksBackend.cancelGraphModification(),i(e,t)):r.callbacksBackend.endGraphModification(function(){i(e,t)})})):"query"===e.token&&"query"==e.kind&&this.executeQuery(e,i,t,n)},QueryEngine.prototype.executeQuery=function(e,f,t,i){var n=e.prologue,e=e.units,g=this,m={blanks:{},outCache:{}},v=(this.registerNsInEnvironment(n,m),g.abstractQueryTree.parseExecutableUnit(e[0]));"select"===v.kind?this.executeSelect(v,m,t,i,function(e,t){null==e?"object"==typeof t&&!0===t.denorm?f(null,t.bindings):g.denormalizeBindingsList(t,m,function(e){f(null,e)}):f(e)}):"ask"===v.kind?(v.projection=[{token:"variable",kind:"*"}],this.executeSelect(v,m,t,i,function(e,t){null==e?0<t.length?f(null,!0):f(null,!1):f(e)})):"construct"===v.kind&&(v.projection=[{token:"variable",kind:"*"}],(g=this).executeSelect(v,m,t,i,function(e,t){null==e?g.denormalizeBindingsList(t,m,function(e){if(null!=e){for(var t=new y.Graph,i=(null==v.template&&(v.template={triplesContext:v.pattern}),1),n=[],r=0;r<e.length;r++){for(var o=e[r],s=0;s<n.length;s++)delete n[s].valuetmp;for(s=0;s<v.template.triplesContext.length;s++){for(var a=["subject","predicate","object"],l=v.template.triplesContext[s],u=0;u<a.length;u++){var c,d=a[u];"blank"!==l[d].token||l[d].valuetmp&&null!=l[d].valuetmp||(c="_:b"+i,i++,l[d].valuetmp=c,n.push(l[d]))}var h=y.buildRDFResource(l.subject,o,g,m),u=y.buildRDFResource(l.predicate,o,g,m),p=y.buildRDFResource(l.object,o,g,m);null!=h&&null!=u&&null!=p&&(h=new y.Triple(h,u,p),t.add(h))}}f(null,t)}else f(new Error("Error denormalizing bindings."))}):f(e)}))},QueryEngine.prototype.executeSelect=function(n,r,e,t,o){var s,a,l,u,c,d,h;"select"===n.kind||"ask"===n.kind||"construct"===n.kind||"modify"===n.kind?(s=n.projection,a=n.dataset,l=n.modifier,u=n.limit,c=n.offset,d=n.order,h=this,null==e&&null==t||(a.implicit=e||[],a.named=t||[]),null!=a.implicit&&0===a.implicit.length&&null!=a.named&&0===a.named.length&&a.implicit.push(this.lexicon.defaultGraphUriTerm),h.normalizeDatasets(a.implicit.concat(a.named),r,function(){try{h.executeSelectUnit(s,a,n.pattern,r,function(e){if(null!=e){if(null!=n.group&&""===n.group){for(var t=!1,i=0;i<n.projection.length;i++)if(null!=n.projection[i].expression&&"aggregate"===n.projection[i].expression.expressionType){t=!0;break}!0===t&&(n.group="singleGroup")}n.group&&""!=n.group?h.checkGroupSemantics(n.group,s)?h.groupSolution(e,n.group,a,r,function(e){var i=[];m.eachSeries(e,function(e,t){h.aggregateBindings(s,e,a,r,function(e){i.push(e),t()})},function(){o(null,{bindings:i,denorm:!0})})}):o(new Error("Incompatible Group and Projection variables")):h.applyOrderBy(d,e,a,r,function(e){e=h.projectBindings(s,e,a),e=h.applyModifier(l,e),e=h.applyLimitOffset(c,u,e),e=h.removeDefaultGraphBindings(e,a);o(null,e)})}else o(new Error("Error executing SELECT query."))})}catch(e){o(e)}})):o(new Error("Cannot execute "+n.kind+" query as a select query"))},QueryEngine.prototype.groupSolution=function(e,t,s,a,l){var u=[],c=[],d=!1,h=this;"singleGroup"===t?l([e]):m.eachSeries(e,function(r,e){var o=!0;m.eachSeries(t,function(t,i){var e,n=null;"var"===t.token?(n=t.value,0==d&&u.push(n),i()):"aliased_expression"===t.token?(n=t.alias.value,0==d&&u.push(n),"var"===t.expression.primaryexpression?r[t.alias.value]=r[t.expression.value.value]:(e=h.copyDenormalizedBindings([r],a.outCache),e=g.runFilter(t.expression,e[0],h,s,a),g.isEbvError(e)?o=!1:(null!=e.value&&(e.value=""+e.value),r[t.alias.value]=e)),i()):h.copyDenormalizedBindings([r],a.outCache,function(e){e=g.runFilter(t,e[0],h,a);g.isEbvError(e)?o=!1:(r["groupCondition"+env._i]=e,n="groupCondition"+env._i,0==d&&u.push(n)),i()})},function(){0==d&&(d=!0),!0===o&&c.push(r),e()})},function(){for(var e={},t=0;t<c.length;t++){for(var i=c[t],n="",r=0;r<u.length;r++){var o=i[u[r]];n+="object"==typeof o?o.value:o}null==e[n]?(n,e[n]=[i]):e[n].push(i)}var s,a=[];for(s in e)a.push(e[s]);l(a)})},QueryEngine.prototype.executeSelectUnit=function(e,t,i,n,r){if("BGP"===i.kind)this.executeAndBGP(e,t,i,n,r);else if("UNION"===i.kind)this.executeUNION(e,t,i.value,n,r);else if("JOIN"===i.kind)this.executeJOIN(e,t,i,n,r);else if("LEFT_JOIN"===i.kind)this.executeLEFT_JOIN(e,t,i,n,r);else if("FILTER"===i.kind){var o=this;this.executeSelectUnit(e,t,i.value,n,function(e){null!=e?g.checkFilters(i,e,!1,t,n,o,r):r([])})}else{if("EMPTY_PATTERN"!==i.kind)throw new s(i.kind);r([])}},QueryEngine.prototype.executeUNION=function(e,i,n,r,o){var s,a,l=n[0],u=n[1],c=null;if(2!=n.length)throw"SPARQL algebra UNION with more than two components";var d=this;m.seq(function(t){try{d.executeSelectUnit(e,i,l,r,function(e){s=e,t()})}catch(e){c=e,t()}},function(t){if(null==c)try{d.executeSelectUnit(e,i,u,r,function(e){a=e,t()})}catch(e){c=e,t()}else t()})(function(){var e;null!=c?o(c):(e=f.unionBindings(s,a),d.runBinds(n.binds,e,i,r,function(e,t){if(null!=e)throw new v("Error processing bind expressions",n.binds,e);g.checkFilters(n,t,!1,i,r,d,o)}))})},QueryEngine.prototype.executeAndBGP=function(e,i,n,r,o){var s=this;f.executeAndBGPsDPSize(n.value,i,this,r,function(e){null!=e?s.runBinds(n.binds,e,i,r,function(e,t){if(null!=e)throw new v("Error processing bind expressions",n.binds,e);g.checkFilters(n,t,!1,i,r,s,o)}):o(null)})},QueryEngine.prototype.executeLEFT_JOIN=function(e,n,r,o,l){var u,c,s,a,d,h,i=r.lvalue,p=r.rvalue;"EMPTY_PATTERN"===i.kind?this.executeSelectUnit(e,n,p,o,l):(s=c=u=null,a=this,m.seq(function(t){try{a.executeSelectUnit(e,n,i,o,function(e){u=e,t()})}catch(e){s=e,t()}},function(t){if(null!=s)t();else try{a.executeSelectUnit(e,n,p,o,function(e){c=e,t()})}catch(e){s=e,t()}})(function(){var i;null!=s?l(s):(i=f.leftOuterJoinBindings(u,c),a.runBinds(r.binds,i,n,o,function(e,t){if(null!=e)throw new v("Error processing bind expressions",r.binds,e);g.checkFilters(r,i,!0,n,o,a,function(e){if(1<u.length&&1<c.length){var t=[],i={};for(a in u[0])i[a]=!0;for(a in c[0])1!=i[a]&&t.push(a);d=[],h={};for(var n=0;n<e.length;n++)if(!0===e[n].__nullify__){for(var r=0;r<t.length;r++)e[n].bindings[t[r]]=null;var o=[],s=[];for(a in e[n].bindings)null!=e[n].bindings[a]&&(o.push(a+e[n].bindings[a]),o.sort(),s.push(o.join("")));if(null==h[o.join("")]){for(r=0;r<s.length;r++)h[s[r]]=!0;d.push(e[n].bindings)}}else{d.push(e[n]);var a,o=[],s=[];for(a in e[n])o.push(a+e[n][a]),o.sort(),h[o.join("")]=!0}l(d)}else l(e)})}))}))},QueryEngine.prototype.executeJOIN=function(e,r,o,s,a){var l=o.lvalue,u=o.rvalue,c=null,d=null,h=null,p=this;m.seq(function(t){try{p.executeSelectUnit(e,r,l,s,function(e){c=e,t()})}catch(e){h=e,t()}},function(t){if(null!=h)t();else try{p.executeSelectUnit(e,r,u,s,function(e){d=e,t()})}catch(e){h=e,t()}})(function(){var e=null;if(null!=h)a(h);else if(0===c.length||0===d.length)a([]);else{var t,i={},n=[];for(t in c[0])i[t]=!1;for(t in d[0])!1===i[t]&&n.push(t);e=0==n.length||p.abstractQueryTree.treeWithUnion(l)||p.abstractQueryTree.treeWithUnion(u)?f.joinBindings(c,d):f.joinBindings2(n,c,d),p.runBinds(o.binds,e,r,s,function(e,t){if(null!=e)throw new v("Error processing bind expressions",o.binds,e);g.checkFilters(o,t,!1,r,s,p,a)})}})},QueryEngine.prototype.rangeQuery=function(e,t,i){var n=this;n.normalizeQuad(e,t,!1,function(e){null!=e?n.backend.range(new d.Pattern(e),function(e){null==e||0==e.length?i([]):i(e)}):i(null)})},QueryEngine.prototype.executeUpdate=function(e,i){var t=e.prologue,n=e.units,r=this,o={blanks:{},outCache:{}};this.registerNsInEnvironment(t,o);for(var s=0;s<n.length;s++){var a=r.abstractQueryTree.parseExecutableUnit(n[s]);if("insertdata"===a.kind){var l=null;m.eachSeries(a.quads,function(e,t){null===l?r._executeQuadInsert(e,o,function(e){null!=e&&(l=e),t()}):t()},function(){null===l?i(null,!0):i(l)})}else if("deletedata"===a.kind){l=null;m.eachSeries(a.quads,function(e,t){null===l?r._executeQuadDelete(e,o,function(e){null!=e&&(l=e),t()}):t()},function(){null===l?i(null,!0):i(l)})}else if("modify"===a.kind)this._executeModifyQuery(a,o,i);else if("create"===a.kind)i(!0);else if("load"===a.kind){var u={uri:c.lexicalFormBaseUri(a.sourceGraph,o)},r=(null!=a.destinyGraph&&(u={uri:c.lexicalFormBaseUri(a.destinyGraph,o)}),this);this.rdfLoader.load(a.sourceGraph.value,u,function(e,t){e?i(new Error("error batch loading quads")):r.batchLoad(t,function(e){null!==e?i(null,e):i(new Error("Error batch loading quads"))})})}else{if("drop"!==a.kind&&"clear"!==a.kind)throw new Error("not supported execution unit");this._executeClearGraph(a.destinyGraph,o,i)}}},QueryEngine.prototype.batchLoad=function(e,t){var r=0,u={},c=this;this.eventsOnBatchLoad&&this.callbacksBackend.startGraphModification();m.eachSeries(e,function(a,n){var l={};m.eachSeries(["subject","predicate","object","graph"],function(e,t){var i,n,r,o,s;r=l,o=t,(i=a)[n=e].uri||"uri"===i[n].token?(s=i[n].uri||i[n].value,c.lexicon.registerUri(s,function(e){function t(){null!=i[n].uri&&(i[n]={token:"uri",value:i[n].uri},delete i[n].uri),r[n]=e,o()}"graph"===n?c.lexicon.registerGraph(e,s,function(){t()}):t()})):i[n].literal||"literal"===i[n].token?c.lexicon.registerLiteral(i[n].literal||i[n].value,function(e){null!=i[n].literal&&(i[n]=c.lexicon.parseLiteral(i[n].literal),delete i[n].literal),r[n]=e,o()}):null==(t=u[i[n].blank||i[n].value])?c.lexicon.registerBlank(function(e){u[i[n].blank||i[n].value]=e,null==i[n].token&&(i[n].token="blank",i[n].value=i[n].blank,delete i[n].blank),r[n]=e,o()}):(null==i[n].token&&(i[n].token="blank",i[n].value=i[n].blank,delete i[n].blank),r[n]=t,o())},function(){var t=a,i=(a=l,new d.NodeKey(a));c.backend.search(i,function(e){e?n():c.backend.index(i,function(e){e&&(c.eventsOnBatchLoad&&c.callbacksBackend.nextGraphModification(h.added,[t,a]),r+=1),n()})})})},function(){null!=c.lexicon.updateAfterWrite&&c.lexicon.updateAfterWrite();function e(){t(r)}c.eventsOnBatchLoad?c.callbacksBackend.endGraphModification(e()):e()})},QueryEngine.prototype._executeModifyQuery=function(c,d,e){var h=this,p=!0,o=new Error("Error executing modify query"),f=null,g=["subject","predicate","object","graph"];c.insert=null==c.insert?[]:c.insert,c.delete=null==c.delete?[]:c.delete,m.seq(function(i){var e=[],t=[];if(null!=c.with&&e.push(c.with),null!=c.using)for(var t=[],n=0;n<c.using.length;n++){var r=c.using[n];("named"===r.kind?t:e).push(r.uri)}c.dataset={},c.projection=[{token:"variable",kind:"*"}],h.executeSelect(c,d,e,t,function(e,t){if(e)return o=e,p=!1,i();h.denormalizeBindingsList(t,d,function(e){null!=e?f=e:(o=new Error("Error denormalizing bindings list"),p=!1),i()})})},function(e){var t=c.with;if(p){for(var i=[],n=0;n<c.delete.length;n++)for(var r=c.delete[n],o=0;o<f.length;o++){for(var s={},a=f[o],l=0;l<g.length;l++){var u=g[l];"graph"==u&&null==r[u]?s.graph=t:"var"===r[u].token?s[u]=a[r[u].value]:s[u]=r[u]}i.push(s)}m.eachSeries(i,function(e,t){h._executeQuadDelete(e,d,function(){t()})},function(){e()})}else e()},function(e){var t=c.with;if(p){for(var i=[],n=0;n<c.insert.length;n++)for(var r=c.insert[n],o=0;o<f.length;o++){for(var s={},a=f[o],l=0;l<g.length;l++){var u=g[l];"graph"==u&&null==r[u]?s.graph=t:"var"===r[u].token?s[u]=a[r[u].value]:s[u]=r[u]}i.push(s)}m.eachSeries(i,function(e,t){h._executeQuadInsert(e,d,function(){t()})},function(){e()})}else e()})(function(){e(p?null:o)})},QueryEngine.prototype._executeQuadInsert=function(n,e,t){var r,o=this,s=!1,i=null;m.seq(function(t){o.normalizeQuad(n,e,!0,function(e){null!=e?r=e:(s=!0,i="Error normalizing quad."),t()})},function(t){var i;!1===s?(i=new d.NodeKey(r),o.backend.search(i,function(e){!0===e?t():o.backend.index(i,function(){o.callbacksBackend.nextGraphModification(h.added,[n,r]),t()})})):t()})(function(){s?t(new Error(i)):t(null,!0)})},QueryEngine.prototype._executeQuadDelete=function(i,e,t){var n,r,o,s=this,a=!1;m.seq(function(t){s.normalizeQuad(i,e,!0,function(e){null!=e?n=e:(a=!0,r="Error normalizing quad."),t()})},function(e){!1===a?(o=new d.NodeKey(n),s.backend.delete(o,function(){e()})):e()},function(e){!1===a?s.lexicon.unregister(i,o,function(){s.callbacksBackend.nextGraphModification(h.deleted,[i,n]),e()}):e()})(function(){a?t(new Error(r)):t(null,!0)})},QueryEngine.prototype._executeClearGraph=function(e,t,i){var o=this;"default"===e?this.execute("DELETE { ?s ?p ?o } WHERE { ?s ?p ?o }",i):"named"===e?o.lexicon.registeredGraphs(!0,function(e){var r;null!=e?(r=!1,m.eachSeries(e,function(i,n){r?n():o.execute("DELETE { GRAPH <"+i+"> { ?s ?p ?o } } WHERE { GRAPH <"+i+"> { ?s ?p ?o } }",function(e,t){e?(r=e,n()):o.lexicon.resolveUri(i,function(e){-1!=e?o.lexicon.knownGraphs.delete(e,function(){n()}):(r="Cannot find graph "+i+" to clear it",n())})})},function(){i(!r)})):i(!1,"Error deleting named graphs")}):"all"===e?(o=this).execute("CLEAR DEFAULT",function(e,t){e?i(!1,t):o.execute("CLEAR NAMED",i)}):"uri"==e.token&&null!=(e=c.lexicalFormBaseUri(e,t))?(this.callbacksBackend.ongoingModification=!0,this.execute("DELETE { GRAPH <"+e+"> { ?s ?p ?o } } WHERE { GRAPH <"+e+"> { ?s ?p ?o } }",function(e){o.callbacksBackend.ongoingModification=!1,i(e)})):i(!1,"wrong graph URI")},QueryEngine.prototype.checkGroupSemantics=function(e,t){if("singleGroup"!==e){for(var i={},n=0;n<e.length;n++){var r=e[n];"var"===r.token?i[r.value]=!0:"aliased_expression"===r.token&&(i[r.alias.value]=!0)}for(n=0;n<t.length;n++){var o=t[n];if("var"===o.kind){if(null==i[o.value.value])return!1}else if("aliased"===o.kind&&o.expression&&"var"===o.expression.primaryexpression&&null==i[o.expression.value.value])return!1}}return!0},QueryEngine.prototype.runBinds=function(o,s,a,l,u){var c=this,d=s;null!=o&&0<o.length?c.copyDenormalizedBindings(s,l.outCache,function(e){for(var t=0;t<s.length;t++)for(var i=0;i<o.length;i++){var n=o[i],r=e[t],r=g.runFilter(n.expression,r,c,a,l);g.isEbvError(r)?u(r):d[t][n.as.value]=r}u(null,s)}):u(null,s)},QueryEngine.prototype.computeCosts=function(e,t,i){for(var n=0;n<e.length;n++)e[n]._cost=this.quadCost(e[n],t);i(e)},QueryEngine.prototype.quadCost=function(e,t){return 1},QueryEngine.prototype.registerDefaultNamespace=function(e,t){this.defaultPrefixes[e]=t},t.exports={QueryEngine:QueryEngine}},{"./abstract_query_tree":39,"./graph_callbacks":42,"./quad_index":50,"./query_filters":52,"./query_plan":53,"./rdf_loader":54,"./rdf_model":55,"./utils":57}],52:[function(e,t,i){var g=e("./utils"),d=g,h=e("./utils"),m=(QueryFilters={},"http://www.w3.org/2001/XMLSchema#");QueryFilters.checkFilters=function(e,o,t,i,n,s,r){var a=[],l=(e.filter&&"function"!=typeof e.filter&&(a=e.filter),[]);if(null==a||0===a.length||null!=e.length)return r(o);QueryFilters.preprocessExistentialFilters(a,o,s,i,n,function(e){h.eachSeries(e,function(e,r){QueryFilters.run(e.value,o,t,i,n,s,function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i];(null!=n.__nullify__?l:t).push(n)}o=t,r()})},function(){r(o.concat(l))})})},QueryFilters.preprocessExistentialFilters=function(e,r,l,u,c,t){var o=[];h.eachSeries(e,function(t,i){var e,s,n,a;"builtincall"!==t.value.expressionType||"exists"!==t.value.builtincall&&"notexists"!==t.value.builtincall?"conditionalor"===t.value.expressionType||"conditionaland"===t.value.expressionType?(e=d.map(t.value.operands,function(e){return{value:e}}),QueryFilters.preprocessExistentialFilters(e,r,l,u,c,function(e){t.value.operands=e.map(function(e){return e.value}),o.push(t),i()})):"multiplicativeexpression"===t.value.expressionType?(e=d.map(t.value.factors,function(e){return{value:e}}),QueryFilters.preprocessExistentialFilters(e,r,l,u,c,function(e){t.value.factors=e.map(function(e){return e.value}),o.push(t),i()})):"additiveexpression"===t.value.expressionType?(e=d.map(t.value.summands,function(e){return{value:e}}),QueryFilters.preprocessExistentialFilters(e,r,l,u,c,function(e){t.value.summands=e.map(function(e){return e.value}),o.push(t),i()})):"relationalexpression"===t.value.expressionType?(e=[{value:t.value.op1},{value:t.value.op2}],QueryFilters.preprocessExistentialFilters(e,r,l,u,c,function(e){t.value.op1=e[0].value,t.value.op2=e[1].value,o.push(t),i()})):("irireforfunction"===t.value.expressionType||"custom"===t.value.expressionType)&&null!=t.value.args?(e=d.map(t.value.args,function(e){return{value:e}}),QueryFilters.preprocessExistentialFilters(e,r,l,u,c,function(e){t.value.args=e.map(function(e){return e.value}),o.push(t),i()})):(o.push(t),i()):(s=t.value.builtincall,n=t.value.args,a={},l.copyDenormalizedBindings(r,c.outCache,function(e){h.eachSeries(e,function(r,o){var e=d.clone(n[0],!0),e=l.abstractQueryTree.parseSelect({pattern:e},r),e=l.abstractQueryTree.bind(e.pattern,r);l.executeSelectUnit([{kind:"*"}],u,e,c,function(e){var t,i=null,i="exists"===s?QueryFilters.ebvBoolean(0!==e.length):QueryFilters.ebvBoolean(0===e.length),n=[];for(t in r)n.push(JSON.stringify(r[t]));n=n.sort().join(""),a[n]=i,o()})},function(){t.value.origArgs=t.value.args,t.value.args=a,o.push(t),i()})}))},function(){t(o)})},QueryFilters.boundVars=function(e){if(null==e.expressionType)throw"Cannot find bound expressions in a no expression token";var t,i,n=e.expressionType;if("relationalexpression"==n)return t=e.op1,i=e.op2,QueryFilters.boundVars(t)+QueryFilters.boundVars(i);if("conditionalor"==n||"conditionaland"==n){for(var r=[],o=0;o<e.operands;o++)r=r.concat(QueryFilters.boundVars(e.operands[o]));return r}if("builtincall"==n){if(null==e.args)return[];for(var s=[],o=0;o<e.args.length;o++)s=s.concat(QueryFilters.boundVars(e.args[o]))}else if("multiplicativeexpression"==n)for(var s=QueryFilters.boundVars(e.factor),o=0;o<e.factors.length;o++)s=s.concat(QueryFilters.boundVars(e.factors[o].expression));else{if("additiveexpression"!=n)return"regex"==n?(s=QueryFilters.boundVars(e.expression1)).concat(QueryFilters.boundVars(e.expression2)):"unaryexpression"==n?QueryFilters.boundVars(e.expression):"atomic"==n?"var"==e.primaryexpression?[e.value]:[]:void 0;for(s=QueryFilters.boundVars(e.summand),o=0;o<e.summands.length;o++)s=s.concat(QueryFilters.boundVars(e.summands[o].expression))}return s},QueryFilters.run=function(r,o,s,a,l,u,c){u.copyDenormalizedBindings(o,l.outCache,function(e){for(var t=[],i=0;i<o.length;i++){var n=e[i],n=QueryFilters.runFilter(r,n,u,a,l),n=QueryFilters.ebv(n);!QueryFilters.isEbvError(n)&&!0===n?t.push(o[i]):s&&(n={__nullify__:!0,bindings:o[i]},t.push(n))}c(t)})},QueryFilters.collect=function(r,o,s,a,l,u){l.copyDenormalizedBindings(o,a.outCache,function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],n=QueryFilters.runFilter(r,n,l,s,a);t.push({binding:o[i],value:n})}return u(t)})},QueryFilters.runDistinct=function(e,t){},QueryFilters.runAggregator=function(e,t,i,n,r){if(null==t||0===t.length)return QueryFilters.ebvError();if("variable"===e.token&&"var"==e.kind)return t[0][e.value.value];if("variable"===e.token&&"aliased"===e.kind){if("atomic"===e.expression.expressionType&&"var"===e.expression.primaryexpression)return t[0][e.expression.value.value];if("aggregate"===e.expression.expressionType){if("max"===e.expression.aggregateType){for(var o=null,s=0;s<t.length;s++){var a=t[s],l=QueryFilters.runFilter(e.expression.expression,a,i,n,r);QueryFilters.isEbvError(l)||null!==o&&!0!==QueryFilters.runLtFunction(o,l).value||(o=l)}return null===o?QueryFilters.ebvError():o}if("min"===e.expression.aggregateType){for(var u=null,s=0;s<t.length;s++){a=t[s],l=QueryFilters.runFilter(e.expression.expression,a,i,n,r);QueryFilters.isEbvError(l)||null!==u&&!0!==QueryFilters.runGtFunction(u,l).value||(u=l)}return null===u?QueryFilters.ebvError():u}if("count"===e.expression.aggregateType){var c={},d=0;if("*"===e.expression.expression)if(null!=e.expression.distinct&&""!=e.expression.distinct)for(s=0;s<t.length;s++){a=t[s];null==c[f=g.hashTerm(a)]&&(c[f]=!0,d++)}else d=t.length;else for(s=0;s<t.length;s++){a=t[s],l=QueryFilters.runFilter(e.expression.expression,a,i,n,r);QueryFilters.isEbvError(l)||(null!=e.expression.distinct&&""!=e.expression.distinct?null==c[f=g.hashTerm(l)]&&(c[f]=!0,d++):d++)}return{token:"literal",type:m+"integer",value:""+d}}if("avg"===e.expression.aggregateType){for(var c={},h={token:"literal",type:m+"integer",value:"0"},d=0,s=0;s<t.length;s++){a=t[s],l=QueryFilters.runFilter(e.expression.expression,a,i,n,r);QueryFilters.isEbvError(l)||(null!=e.expression.distinct&&""!=e.expression.distinct?null==c[f=g.hashTerm(l)]&&(c[f]=!0,QueryFilters.isNumeric(l))&&(h=QueryFilters.runSumFunction(h,l),d++):QueryFilters.isNumeric(l)&&(h=QueryFilters.runSumFunction(h,l),d++))}var p=QueryFilters.runDivFunction(h,{token:"literal",type:m+"integer",value:""+d});return p.value=""+p.value,p}if("sum"!==e.expression.aggregateType)return l=QueryFilters.runFilter(aggregate.expression,t[0],n,{blanks:{},outCache:{}});for(c={},h={token:"literal",type:m+"integer",value:"0"},s=0;s<t.length;s++){var f,a=t[s],l=QueryFilters.runFilter(e.expression.expression,a,i,n,r);QueryFilters.isEbvError(l)||(null!=e.expression.distinct&&""!=e.expression.distinct?null==c[f=g.hashTerm(l)]&&(c[f]=!0,QueryFilters.isNumeric(l))&&(h=QueryFilters.runSumFunction(h,l)):QueryFilters.isNumeric(l)&&(h=QueryFilters.runSumFunction(h,l)))}return h.value=""+h.value,h}}},QueryFilters.runFilter=function(e,t,i,n,r){if(null==e.expressionType)throw"Cannot find bound expressions in a no expression token";var o,s,a=e.expressionType;if("relationalexpression"==a)return o=QueryFilters.runFilter(e.op1,t,i,n,r),s=QueryFilters.runFilter(e.op2,t,i,n,r),QueryFilters.runRelationalFilter(e,o,s,t,i,n,r);if("conditionalor"==a)return QueryFilters.runOrFunction(e,t,i,n,r);if("conditionaland"==a)return QueryFilters.runAndFunction(e,t,i,n,r);if("additiveexpression"==a)return QueryFilters.runAddition(e.summand,e.summands,t,i,n,r);if("builtincall"==a)return QueryFilters.runBuiltInCall(e.builtincall,e.args,t,i,n,r);if("multiplicativeexpression"==a)return QueryFilters.runMultiplication(e.factor,e.factors,t,i,n,r);if("unaryexpression"==a)return QueryFilters.runUnaryExpression(e.unaryexpression,e.expression,t,i,n,r);if("irireforfunction"==a)return QueryFilters.runIriRefOrFunction(e.iriref,e.args,t,i,n,r);if("regex"==a)return QueryFilters.runRegex(e.text,e.pattern,e.flags,t,i,n,r);if("custom"==a)return QueryFilters.runBuiltInCall(e.name,e.args,t,i,n,r);if("atomic"==a)return"var"==e.primaryexpression?t[e.value.value]:("object"!=typeof e.value||null!=e.value.type&&"object"==typeof e.value.type&&(e.value.type=g.lexicalFormBaseUri(e.value.type,r)),e.value);throw"Unknown filter expression type"},QueryFilters.isRDFTerm=function(e){return null!=e&&!!(e.token&&"literal"==e.token||e.token&&"uri"==e.token||e.token&&"blank"==e.token)},QueryFilters.RDFTermEquality=function(e,t,i,n){return"literal"===e.token&&"literal"===t.token?e.lang==t.lang&&e.type==t.type&&e.value==t.value||(null!=e.type&&null!=t.type||QueryFilters.isSimpleLiteral(e)&&null!=t.type||!(!QueryFilters.isSimpleLiteral(t)||null==e.type))&&QueryFilters.ebvError():"uri"===e.token&&"uri"===t.token?g.lexicalFormBaseUri(e,n)==g.lexicalFormBaseUri(t,n):"blank"===e.token&&"blank"===t.token&&e.value==t.value},QueryFilters.isInteger=function(e){return null!=e&&"literal"===e.token&&(e.type==m+"integer"||e.type==m+"decimal"||e.type==m+"double"||e.type==m+"nonPositiveInteger"||e.type==m+"negativeInteger"||e.type==m+"long"||e.type==m+"int"||e.type==m+"short"||e.type==m+"byte"||e.type==m+"nonNegativeInteger"||e.type==m+"unsignedLong"||e.type==m+"unsignedInt"||e.type==m+"unsignedShort"||e.type==m+"unsignedByte"||e.type==m+"positiveInteger")},QueryFilters.isFloat=function(e){return null!=e&&"literal"===e.token&&e.type==m+"float"},QueryFilters.isDecimal=function(e){return null!=e&&"literal"===e.token&&e.type==m+"decimal"},QueryFilters.isDouble=function(e){return null!=e&&"literal"===e.token&&e.type==m+"double"},QueryFilters.isNumeric=function(e){return null!=e&&"literal"===e.token&&(e.type==m+"integer"||e.type==m+"decimal"||e.type==m+"float"||e.type==m+"double"||e.type==m+"nonPositiveInteger"||e.type==m+"negativeInteger"||e.type==m+"long"||e.type==m+"int"||e.type==m+"short"||e.type==m+"byte"||e.type==m+"nonNegativeInteger"||e.type==m+"unsignedLong"||e.type==m+"unsignedInt"||e.type==m+"unsignedShort"||e.type==m+"unsignedByte"||e.type==m+"positiveInteger")},QueryFilters.isSimpleLiteral=function(e){return!(!e||"literal"!=e.token)&&null==e.type&&null==e.lang},QueryFilters.isXsdType=function(e,t){return!(!t||"literal"!=t.token)&&t.type==m+e},QueryFilters.ebv=function(e){var t;return null==e||QueryFilters.isEbvError(e)?QueryFilters.ebvError():e.token&&"literal"===e.token?e.type==m+"integer"||e.type==m+"decimal"||e.type==m+"double"||e.type==m+"nonPositiveInteger"||e.type==m+"negativeInteger"||e.type==m+"long"||e.type==m+"int"||e.type==m+"short"||e.type==m+"byte"||e.type==m+"nonNegativeInteger"||e.type==m+"unsignedLong"||e.type==m+"unsignedInt"||e.type==m+"unsignedShort"||e.type==m+"unsignedByte"||e.type==m+"positiveInteger"?(t=parseFloat(e.value),!isNaN(t)&&0!=parseFloat(e.value)):e.type===m+"boolean"?"true"===e.value||!0===e.value||"True"===e.value:e.type===m+"string"?""!=e.value:e.type===m+"dateTime"?null!=new Date(e.value):QueryFilters.isEbvError(e)?e:null==e.type?""!=e.value:QueryFilters.ebvError():!0===e.value},QueryFilters.effectiveBooleanValue=QueryFilters.ebv,QueryFilters.ebvTrue=function(){return{token:"literal",type:m+"boolean",value:!0}},QueryFilters.ebvFalse=function(){return{token:"literal",type:m+"boolean",value:!1}},QueryFilters.ebvError=function(){return{token:"literal",type:"https://github.com/antoniogarrote/js-tools/types#error",value:null}},QueryFilters.isEbvError=function(e){return"object"==typeof e&&null!=e&&"https://github.com/antoniogarrote/js-tools/types#error"===e.type},QueryFilters.ebvBoolean=function(e){return QueryFilters.isEbvError(e)?e:!0===e?QueryFilters.ebvTrue():QueryFilters.ebvFalse()},QueryFilters.runRelationalFilter=function(e,t,i,n,r,o,s){e=e.operator;if("="===e)return QueryFilters.runEqualityFunction(t,i,n,r,o,s);if("!="===e)return r=QueryFilters.runEqualityFunction(t,i,n,r,o,s),QueryFilters.isEbvError(r)||(r.value=!r.value),r;if("<"===e)return QueryFilters.runLtFunction(t,i,n);if(">"===e)return QueryFilters.runGtFunction(t,i,n);if("<="===e)return QueryFilters.runLtEqFunction(t,i,n);if(">="===e)return QueryFilters.runGtEqFunction(t,i,n);throw"Error applying relational filter, unknown operator"},QueryFilters.effectiveTypeValue=function(e){if("literal"!=e.token)throw console.log("not implemented yet"),console.log(e),"value not supported in operations yet";if(e.type==m+"integer")return parseInt(e.value);if(e.type==m+"decimal")return parseFloat(e.value);if(e.type==m+"float")return parseFloat(e.value);if(e.type==m+"double")return parseFloat(e.value);if(e.type==m+"nonPositiveInteger")return parseFloat(e.value);if(e.type==m+"negativeInteger")return parseInt(e.value);if(e.type==m+"long")return parseInt(e.value);if(e.type==m+"int")return parseInt(e.value);if(e.type==m+"short")return parseInt(e.value);if(e.type==m+"byte")return parseInt(e.value);if(e.type==m+"nonNegativeInteger")return parseInt(e.value);if(e.type==m+"unsignedLong")return parseInt(e.value);if(e.type==m+"unsignedInt")return parseInt(e.value);if(e.type==m+"unsignedShort")return parseInt(e.value);if(e.type==m+"unsignedByte")return parseInt(e.value);if(e.type==m+"positiveInteger")return parseInt(e.value);if(e.type!=m+"date"&&e.type!=m+"dateTime")return e.type==m+"boolean"?!0===e.value||"true"===e.value||"1"===e.value||1===e.value||!0===e.value||!1!==e.value&&"false"!==e.value&&"0"!==e.value&&0!==e.value&&!1!==e.value&&void 0:e.type==m+"string"?null===e.value||void 0===e.value?void 0:""+e.value:(e.type,e.value);try{return g.parseISO8601(e.value)}catch(e){return null}},QueryFilters.runOrFunction=function(e,t,i,n,r){for(var o=null,s=0;s<e.operands.length;s++){var a=QueryFilters.runFilter(e.operands[s],t,i,n,r);0==QueryFilters.isEbvError(a)&&(a=QueryFilters.ebv(a)),null==o?o=a:QueryFilters.isEbvError(a)?o=!QueryFilters.isEbvError(o)&&!0===o||QueryFilters.ebvError():!0===a?o=!0:QueryFilters.isEbvError(o)&&(o=QueryFilters.ebvError())}return QueryFilters.ebvBoolean(o)},QueryFilters.runAndFunction=function(e,t,i,n,r){for(var o=null,s=0;s<e.operands.length;s++){var a=QueryFilters.runFilter(e.operands[s],t,i,n,r);0==QueryFilters.isEbvError(a)&&(a=QueryFilters.ebv(a)),null==o?o=a:QueryFilters.isEbvError(a)?o=(QueryFilters.isEbvError(o)||!0===o)&&QueryFilters.ebvError():!0===a?QueryFilters.isEbvError(o)&&(o=QueryFilters.ebvError()):o=!1}return QueryFilters.ebvBoolean(o)},QueryFilters.runEqualityFunction=function(e,t,i,n,r,o){var s,a;return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():QueryFilters.isNumeric(e)&&QueryFilters.isNumeric(t)?(a=QueryFilters.effectiveTypeValue(e),s=QueryFilters.effectiveTypeValue(t),isNaN(a)||isNaN(s)?QueryFilters.ebvBoolean(QueryFilters.RDFTermEquality(e,t,n,o)):QueryFilters.ebvBoolean(a==s)):(QueryFilters.isSimpleLiteral(e)||QueryFilters.isXsdType("string",e))&&(QueryFilters.isSimpleLiteral(t)||QueryFilters.isXsdType("string",t))||QueryFilters.isXsdType("boolean",e)&&QueryFilters.isXsdType("boolean",t)?QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(e)==QueryFilters.effectiveTypeValue(t)):(QueryFilters.isXsdType("dateTime",e)||QueryFilters.isXsdType("date",e))&&(QueryFilters.isXsdType("dateTime",t)||QueryFilters.isXsdType("date",t))?QueryFilters.isXsdType("dateTime",e)&&QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("date",e)&&QueryFilters.isXsdType("dateTime",t)?QueryFilters.ebvFalse():null!=(a=g.compareDateComponents(e.value,t.value))?0==a?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError():QueryFilters.isRDFTerm(e)&&QueryFilters.isRDFTerm(t)?QueryFilters.ebvBoolean(QueryFilters.RDFTermEquality(e,t,n,o)):QueryFilters.ebvFalse()},QueryFilters.runGtFunction=function(e,t,i){return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():QueryFilters.isNumeric(e)&&QueryFilters.isNumeric(t)||QueryFilters.isSimpleLiteral(e)&&QueryFilters.isSimpleLiteral(t)||QueryFilters.isXsdType("string",e)&&QueryFilters.isXsdType("string",t)||QueryFilters.isXsdType("boolean",e)&&QueryFilters.isXsdType("boolean",t)?QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(e)>QueryFilters.effectiveTypeValue(t)):!QueryFilters.isXsdType("dateTime",e)&&!QueryFilters.isXsdType("date",e)||!QueryFilters.isXsdType("dateTime",t)&&!QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("dateTime",e)&&QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("date",e)&&QueryFilters.isXsdType("dateTime",t)?QueryFilters.ebvFalse():null!=(e=g.compareDateComponents(e.value,t.value))?1==e?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()},QueryFilters.runTotalGtFunction=function(e,t){return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():QueryFilters.isNumeric(e)&&QueryFilters.isNumeric(t)||QueryFilters.isSimpleLiteral(e)&&QueryFilters.isSimpleLiteral(t)||QueryFilters.isXsdType("string",e)&&QueryFilters.isSimpleLiteral("string",t)||QueryFilters.isXsdType("boolean",e)&&QueryFilters.isSimpleLiteral("boolean",t)||QueryFilters.isXsdType("dateTime",e)&&QueryFilters.isSimpleLiteral("dateTime",t)?QueryFilters.runGtFunction(e,t,[]):e.token&&"uri"===e.token&&t.token&&"uri"===t.token?QueryFilters.ebvBoolean(e.value>t.value):e.token&&"literal"===e.token&&t.token&&"literal"===t.token?QueryFilters.ebvBoolean(""+e.value+e.type+e.lang>""+t.value+t.type+t.lang):e.token&&"blank"===e.token&&t.token&&"blank"===t.token||e.value&&t.value?QueryFilters.ebvBoolean(e.value>t.value):QueryFilters.ebvTrue()},QueryFilters.runLtFunction=function(e,t,i){return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():QueryFilters.isNumeric(e)&&QueryFilters.isNumeric(t)||QueryFilters.isSimpleLiteral(e)&&QueryFilters.isSimpleLiteral(t)||QueryFilters.isXsdType("string",e)&&QueryFilters.isXsdType("string",t)||QueryFilters.isXsdType("boolean",e)&&QueryFilters.isXsdType("boolean",t)?QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(e)<QueryFilters.effectiveTypeValue(t)):!QueryFilters.isXsdType("dateTime",e)&&!QueryFilters.isXsdType("date",e)||!QueryFilters.isXsdType("dateTime",t)&&!QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("dateTime",e)&&QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("date",e)&&QueryFilters.isXsdType("dateTime",t)?QueryFilters.ebvFalse():null!=(e=g.compareDateComponents(e.value,t.value))?-1==e?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()},QueryFilters.runGtEqFunction=function(e,t,i){return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():QueryFilters.isNumeric(e)&&QueryFilters.isNumeric(t)||QueryFilters.isSimpleLiteral(e)&&QueryFilters.isSimpleLiteral(t)||QueryFilters.isXsdType("string",e)&&QueryFilters.isXsdType("string",t)||QueryFilters.isXsdType("boolean",e)&&QueryFilters.isXsdType("boolean",t)?QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(e)>=QueryFilters.effectiveTypeValue(t)):!QueryFilters.isXsdType("dateTime",e)&&!QueryFilters.isXsdType("date",e)||!QueryFilters.isXsdType("dateTime",t)&&!QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("dateTime",e)&&QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("date",e)&&QueryFilters.isXsdType("dateTime",t)?QueryFilters.ebvFalse():null!=(e=g.compareDateComponents(e.value,t.value))?-1!=e?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()},QueryFilters.runLtEqFunction=function(e,t,i){return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():QueryFilters.isNumeric(e)&&QueryFilters.isNumeric(t)||QueryFilters.isSimpleLiteral(e)&&QueryFilters.isSimpleLiteral(t)||QueryFilters.isXsdType("string",e)&&QueryFilters.isXsdType("string",t)||QueryFilters.isXsdType("boolean",e)&&QueryFilters.isXsdType("boolean",t)?QueryFilters.ebvBoolean(QueryFilters.effectiveTypeValue(e)<=QueryFilters.effectiveTypeValue(t)):!QueryFilters.isXsdType("dateTime",e)&&!QueryFilters.isXsdType("date",e)||!QueryFilters.isXsdType("dateTime",t)&&!QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("dateTime",e)&&QueryFilters.isXsdType("date",t)||QueryFilters.isXsdType("date",e)&&QueryFilters.isXsdType("dateTime",t)?QueryFilters.ebvFalse():null!=(e=g.compareDateComponents(e.value,t.value))?1!=e?QueryFilters.ebvTrue():QueryFilters.ebvFalse():QueryFilters.ebvError()},QueryFilters.runAddition=function(e,t,i,n,r,o){e=QueryFilters.runFilter(e,i,n,r,o);if(QueryFilters.isEbvError(e))return QueryFilters.ebvError();var s=e;if(QueryFilters.isNumeric(e)){for(var a=0;a<t.length;a++){var l=QueryFilters.runFilter(t[a].expression,i,n,r,o);if(!QueryFilters.isNumeric(l))return QueryFilters.ebvFalse();"+"===t[a].operator?s=QueryFilters.runSumFunction(s,l):"-"===t[a].operator&&(s=QueryFilters.runSubFunction(s,l))}return s}return QueryFilters.ebvFalse()},QueryFilters.runSumFunction=function(e,t){var i;return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():(i=QueryFilters.effectiveTypeValue(e)+QueryFilters.effectiveTypeValue(t),QueryFilters.isDouble(e)||QueryFilters.isDouble(t)?{token:"literal",type:m+"double",value:i}:QueryFilters.isFloat(e)||QueryFilters.isFloat(t)?{token:"literal",type:m+"float",value:i}:QueryFilters.isDecimal(e)||QueryFilters.isDecimal(t)?{token:"literal",type:m+"decimal",value:i}:{token:"literal",type:m+"integer",value:i})},QueryFilters.runSubFunction=function(e,t){var i;return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():(i=QueryFilters.effectiveTypeValue(e)-QueryFilters.effectiveTypeValue(t),QueryFilters.isDouble(e)||QueryFilters.isDouble(t)?{token:"literal",type:m+"double",value:i}:QueryFilters.isFloat(e)||QueryFilters.isFloat(t)?{token:"literal",type:m+"float",value:i}:QueryFilters.isDecimal(e)||QueryFilters.isDecimal(t)?{token:"literal",type:m+"decimal",value:i}:{token:"literal",type:m+"integer",value:i})},QueryFilters.runMultiplication=function(e,t,i,n,r,o){var s=QueryFilters.runFilter(e,i,n,r,o);if(QueryFilters.isEbvError(s))return s;var a=s;if(QueryFilters.isNumeric(s)){for(var l=0;l<t.length;l++){var u=QueryFilters.runFilter(t[l].expression,i,n,r,o);if(QueryFilters.isEbvError(u))return s;if(!QueryFilters.isNumeric(u))return QueryFilters.ebvFalse();"*"===t[l].operator?a=QueryFilters.runMulFunction(a,u):"/"===t[l].operator&&(a=QueryFilters.runDivFunction(a,u))}return a}return QueryFilters.ebvFalse()},QueryFilters.runMulFunction=function(e,t){var i;return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():(i=QueryFilters.effectiveTypeValue(e)*QueryFilters.effectiveTypeValue(t),QueryFilters.isDouble(e)||QueryFilters.isDouble(t)?{token:"literal",type:m+"double",value:i}:QueryFilters.isFloat(e)||QueryFilters.isFloat(t)?{token:"literal",type:m+"float",value:i}:QueryFilters.isDecimal(e)||QueryFilters.isDecimal(t)?{token:"literal",type:m+"decimal",value:i}:{token:"literal",type:m+"integer",value:i})},QueryFilters.runDivFunction=function(e,t){var i;return QueryFilters.isEbvError(e)||QueryFilters.isEbvError(t)?QueryFilters.ebvError():(i=QueryFilters.effectiveTypeValue(e)/QueryFilters.effectiveTypeValue(t),QueryFilters.isDouble(e)||QueryFilters.isDouble(t)?{token:"literal",type:m+"double",value:i}:QueryFilters.isFloat(e)||QueryFilters.isFloat(t)?{token:"literal",type:m+"float",value:i}:QueryFilters.isDecimal(e)||QueryFilters.isDecimal(t)?{token:"literal",type:m+"decimal",value:i}:{token:"literal",type:m+"integer",value:i})},QueryFilters.runBuiltInCall=function(e,t,i,n,r,o){if("notexists"===e||"exists"===e){var s,a=[];for(s in i)a.push(JSON.stringify(i[s]));return t[a=a.sort().join("")]}for(var l,u,c=[],d=0;d<t.length;d++)if("var"===t[d].token)c.push(t[d]);else{var h=QueryFilters.runFilter(t[d],i,n,r,o);if(QueryFilters.isEbvError(h))return h;c.push(h)}if("str"===e)return"literal"===c[0].token?{token:"literal",type:null,value:""+c[0].value}:"uri"===c[0].token?{token:"literal",type:null,value:c[0].value}:QueryFilters.ebvFalse();if("lang"===e)return"literal"===c[0].token?null!=c[0].lang?{token:"literal",value:""+c[0].lang}:{token:"literal",value:""}:QueryFilters.ebvError();if("datatype"===e)return"literal"===c[0].token?null!=(l=c[0]).type?"string"==typeof l.type?{token:"uri",value:l.type,prefix:null,suffix:null}:l.type:null==l.lang?{token:"uri",value:"http://www.w3.org/2001/XMLSchema#string",prefix:null,suffix:null}:QueryFilters.ebvError():QueryFilters.ebvError();if("isliteral"===e)return"literal"===c[0].token?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if("isblank"===e)return"blank"===c[0].token?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if("isuri"===e||"isiri"===e)return"uri"===c[0].token?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if("sameterm"===e)return l=QueryFilters.RDFTermEquality(c[0],c[1],n,o),QueryFilters.isEbvError(l)&&(l=!1),QueryFilters.ebvBoolean(l);if("langmatches"===e)return l=c[1],"literal"===(u=c[0]).token&&"literal"===l.token?"*"===l.value&&""!=u.value?QueryFilters.ebvTrue():QueryFilters.ebvBoolean(0===u.value.toLowerCase().indexOf(l.value.toLowerCase())):QueryFilters.ebvError();if("bound"===e)return null==(u=c[0].value)?QueryFilters.ebvError():null!=i[u]?QueryFilters.ebvTrue():QueryFilters.ebvFalse();if(null!=n.customFns[e])return n.customFns[e](QueryFilters,c);throw"Builtin call "+e+" not implemented yet"},QueryFilters.runUnaryExpression=function(e,t,i,n,r,o){var s=QueryFilters.runFilter(t,i,n,r,o);if(QueryFilters.isEbvError(s))return s;if("!"===e)return t=QueryFilters.ebv(s),QueryFilters.isEbvError(t)?QueryFilters.ebvFalse():QueryFilters.ebvBoolean(t=!t);if("+"===e)return QueryFilters.isNumeric(s)?s:QueryFilters.ebvError();if("-"===e){if(QueryFilters.isNumeric(s)){var a,l={};for(a in s)l[a]=s[a];return l.value=-l.value,l}return QueryFilters.ebvError()}},QueryFilters.runRegex=function(e,t,i,n,r,o,s){if(null==e)return QueryFilters.ebvError();if(e=QueryFilters.runFilter(e,n,r,o,s),null==t)return QueryFilters.ebvError();if(t=QueryFilters.runFilter(t,n,r,o,s),null!=i&&(i=QueryFilters.runFilter(i,n,r,o,s)),null==t||"literal"!==t.token||null!=i&&"literal"!==i.token)return QueryFilters.ebvError();if(t=t.value,i=null==i?null:i.value,null!=e&&"var"==e.token){if(null==n[e.value])return QueryFilters.ebvError();e=n[e.value]}else{if(null==e||"literal"!==e.token)return QueryFilters.ebvError();if(null!=e.type&&!QueryFilters.isXsdType("string",e))return QueryFilters.ebvError();e=e.value}r=null==i?new RegExp(t):new RegExp(t,i.toLowerCase());return r.exec(e)?QueryFilters.ebvTrue():QueryFilters.ebvFalse()},QueryFilters.normalizeLiteralDatatype=function(e,t,i){return null==e.value.type||"object"!=typeof e.value.type||(e.value.type=g.lexicalFormBaseUri(e.value.type,i)),e},QueryFilters.runIriRefOrFunction=function(e,t,i,n,r,o){if(null==t)return e;for(var s=[],a=0;a<t.length;a++)s.push(QueryFilters.runFilter(t[a],i,n,r,o));var l,e=g.lexicalFormBaseUri(e,o);if(e==m+"integer"||e==m+"decimal"||e==m+"double"||e==m+"nonPositiveInteger"||e==m+"negativeInteger"||e==m+"long"||e==m+"int"||e==m+"short"||e==m+"byte"||e==m+"nonNegativeInteger"||e==m+"unsignedLong"||e==m+"unsignedInt"||e==m+"unsignedShort"||e==m+"unsignedByte"||e==m+"positiveInteger"){if("literal"!==(l=s[0]).token)return QueryFilters.ebvError();if((l=QueryFilters.normalizeLiteralDatatype(l,n,o)).type==m+"integer"||l.type==m+"decimal"||l.type==m+"double"||l.type==m+"nonPositiveInteger"||l.type==m+"negativeInteger"||l.type==m+"long"||l.type==m+"int"||l.type==m+"short"||l.type==m+"byte"||l.type==m+"nonNegativeInteger"||l.type==m+"unsignedLong"||l.type==m+"unsignedInt"||l.type==m+"unsignedShort"||l.type==m+"unsignedByte"||l.type==m+"positiveInteger")return l.type=e,l;if("http://www.w3.org/2001/XMLSchema#boolean"==l.type)return 1==QueryFilters.ebv(l)?(l.type=e,l.value=1):(l.type=e,l.value=0),l;if("http://www.w3.org/2001/XMLSchema#float"==l.type||"http://www.w3.org/2001/XMLSchema#double"==l.type)return l.type=e,l.value=parseInt(l.value),l;if("http://www.w3.org/2001/XMLSchema#string"!=l.type&&null!=l.type)return QueryFilters.ebvError();if(2<l.value.split(".").length)return QueryFilters.ebvError();if(2<l.value.split("-").length)return QueryFilters.ebvError();if(2<l.value.split("/").length)return QueryFilters.ebvError();if(2<l.value.split("+").length)return QueryFilters.ebvError();if(e==m+"decimal"&&(-1!=l.value.indexOf("e")||-1!=l.value.indexOf("E")))return QueryFilters.ebvError();if(!(e!=m+"int"&&e!=m+"integer"||-1==l.value.indexOf("e")&&-1==l.value.indexOf("E")&&-1==l.value.indexOf(".")))return QueryFilters.ebvError();try{return l.value=parseInt(parseFloat(l.value)),isNaN(l.value)?QueryFilters.ebvError():(l.type=e,l)}catch(e){return QueryFilters.ebvError()}}else{if(e==m+"boolean")return"literal"===(l=s[0]).token&&null==l.type?"true"===l.value||"1"===l.value?QueryFilters.ebvTrue():"false"===l.value||"0"===l.value?QueryFilters.ebvFalse():QueryFilters.ebvError():"literal"===l.token?QueryFilters.isEbvError(l)?l:QueryFilters.ebvBoolean(l):QueryFilters.ebvError();if(e==m+"string")return"literal"===(l=s[0]).token?(l=QueryFilters.normalizeLiteralDatatype(l,n,o)).type==m+"integer"||l.type==m+"decimal"||l.type==m+"double"||l.type==m+"nonPositiveInteger"||l.type==m+"negativeInteger"||l.type==m+"long"||l.type==m+"int"||l.type==m+"short"||l.type==m+"byte"||l.type==m+"nonNegativeInteger"||l.type==m+"unsignedLong"||l.type==m+"unsignedInt"||l.type==m+"unsignedShort"||l.type==m+"unsignedByte"||l.type==m+"positiveInteger"||l.type==m+"float"?(l.type=e,l.value=""+l.value,l):l.type==m+"string"?l:l.type==m+"boolean"?(QueryFilters.ebv(l)?(l.type=e,l.value="true"):(l.type=e,l.value="false"),l):l.type==m+"dateTime"||l.type==m+"date"?(l.type=e,"string"!=typeof l.value&&(l.value=g.iso8601(l.value)),l):null==l.type?(l.value=""+l.value,l.type=e,l):QueryFilters.ebvError():"uri"===l.token?{token:"literal",value:g.lexicalFormBaseUri(l,o),type:e,lang:null}:QueryFilters.ebvError();if(e==m+"dateTime"||e==m+"date"){if((l=s[0]).type==m+"dateTime"||l.type==m+"date")return l;if(l.type!=m+"string"&&null!=l.type)return QueryFilters.ebvError();try{return l.value=g.iso8601(g.parseISO8601(l.value)),l.type=e,l}catch(e){return QueryFilters.ebvError()}}else{if(e!=m+"float")return null!=n.customFns[e]?n.customFns[e](QueryFilters,s):QueryFilters.ebvError();if("literal"!==(l=s[0]).token)return QueryFilters.ebvError();if("http://www.w3.org/2001/XMLSchema#decimal"==(l=QueryFilters.normalizeLiteralDatatype(l,n,o)).type||"http://www.w3.org/2001/XMLSchema#int"==l.type)return l.type=e,l.value=parseFloat(l.value),l;if("http://www.w3.org/2001/XMLSchema#boolean"==l.type)return 1==QueryFilters.ebv(l)?(l.type=e,l.value=1):(l.type=e,l.value=0),l;if("http://www.w3.org/2001/XMLSchema#float"==l.type||"http://www.w3.org/2001/XMLSchema#double"==l.type)return l.type=e,l.value=parseFloat(l.value),l;if("http://www.w3.org/2001/XMLSchema#string"==l.type)try{return l.value=parseFloat(l.value),isNaN(l.value)?QueryFilters.ebvError():(l.type=e,l)}catch(e){return QueryFilters.ebvError()}else{if(null!=l.type)return QueryFilters.ebvError();if(2<l.value.split(".").length)return QueryFilters.ebvError();if(2<l.value.split("-").length)return QueryFilters.ebvError();if(2<l.value.split("/").length)return QueryFilters.ebvError();if(2<l.value.split("+").length)return QueryFilters.ebvError();try{return l.value=parseFloat(l.value),isNaN(l.value)?QueryFilters.ebvError():(l.type=e,l)}catch(e){return QueryFilters.ebvError()}}}}},t.exports={QueryFilters:QueryFilters}},{"./utils":57}],53:[function(e,t,i){var v=e("./utils"),c=e("./utils"),x={variablesInBGP:function(e){var t=e.variables;if(!t){var i,n=e.value||e,t=[];for(i in n)n[i]&&"var"===n[i].token?t.push(n[i].value):n[i]&&"blank"===n[i].token&&t.push("blank:"+n[i].value);e.variables=t}return t},connected:function(e,t){for(var i="/"+e.vars.join("/")+"/",n=0;n<t.vars.length;n++)if(-1!=i.indexOf("/"+t.vars[n]+"/"))return!0;return!1}};x.variablesIntersectionBGP=function(e,t){for(var i=x.variablesInBGP(e),n=x.variablesInBGP(t),r={},o=0;o<i.lenght;o++)r[i[o]]=1;for(o=0;o<n.length;o++){var s=r[n[o]]||0;s++,r[n[o]]=s}var a,l=[];for(a in r)2==r[a]&&l.push(r[a]);return l},x.executeAndBGPsGroups=function(e){for(var t={},i={},n=0,r=0;r<e.length;r++){var o,s=e[r],a={},l={},u=x.variablesInBGP(s),c={};for(o in i)!function(e,t){for(var i=0;i<e.length;i++){var n="/"+e[i]+"/";if(-1!=t.indexOf(n))return!0}return!1}(u,i[o])?(a[o]=t[o],l[o]=i[o]):c[o]=!0;if(0===v.size(c))a["g"+n]=[s],l["g"+n]="/"+u.join("/")+"/",n++;else{d=m=g=f=void 0;var d,h=a,p=l,f=[],g="",m="";for(d in c)g+=d,f=f.concat(t[d]),m+=i[d];m=m+u.join("/")+"/",f.push(s),h[g]=f,p[g]=m}t=a,i=l}return v.values(t)},x.intersectionSize=function(e,t){for(var i=t.i.split("_"),n=0;n<i.length;n++)if(""!=i[n]&&-1!=e.i.indexOf("_"+i[n]+"_"))return 1;return 0},x.createJoinTree=function(e,t){for(var i="/"+e.vars.join("/")+"/",n=e.vars.concat([]),r=[],o=0;o<t.vars.length;o++)-1!=i.indexOf("/"+t.vars[o]+"/")?0==t.vars[o].indexOf("_:")?r.push("blank:"+t.vars[o]):r.push(t.vars[o]):n.push(t.vars[o]);for(var s=t.i.split("_"),a=e.i.split("_"),l={},o=0;o<s.length;o++)""!=s[o]&&(l[s[o]]=!0);for(o=0;o<a.length;o++)""!=a[o]&&(l[a[o]]=!0);var u=v.keys(l);return{left:e,right:t,cost:e.cost+t.cost,i:"_"+u.sort().join("_")+"_",vars:n,join:r}},x.executeBushyTree=function(i,e,n,r,o){null==i.left?x.executeEmptyJoinBGP(i.right,e,n,r,o):null==i.right?x.executeEmptyJoinBGP(i.left,e,n,r,o):x.executeBushyTree(i.left,e,n,r,function(t){null!=t?x.executeBushyTree(i.right,e,n,r,function(e){o(null!=e?x.joinBindings2(i.join,t,e):null)}):o(null)})},x.executeAndBGPsDPSize=function(e,n,r,o,t){var e=x.executeAndBGPsGroups(e),w=[];c.eachSeries(e,function(e,b){r.computeCosts(e,o,function(e){var t={},i={},n={},r=1,o=null,s={};n[1]=[];for(var a=0;a<e.length;a++){var l,u=[];for(l in delete e[a].variables,e[a])"_cost"==l||"var"!==e[a][l].token&&"blank"!==e[a][l].token||u.push(e[a][l].value);i["_"+a+"_"]={left:e[a],right:null,cost:e[a]._cost,i:"_"+a+"_",vars:u};var c={left:e[a],right:null,cost:e[a]._cost,i:"_"+a+"_",vars:u};t["_"+a+"_"]=c,delete e[a]._cost,s["_"+a+"_"]=!0,n[1].push("_"+a+"_"),(null==o||o.cost>c.cost)&&(o=c)}for(var d=2;d<=e.length;d++)for(var h=1;h<d;h++)for(var p=n[""+h]||[],f=n[""+(d-h)]||[],a=0;a<p.length;a++)for(var g,m,v,y=0;y<f.length;y++)p[a]!==f[y]&&(g=i[p[a]],m=i[f[y]],0==x.intersectionSize(g,m)&&x.connected(g,m))&&(r=d,g=t[g.i],m=t[m.i],s[(g=x.createJoinTree(g,m)).i]||(s[g.i]=!0,m=g.cost+1,null!=t[g.i]&&(m=t[g.i].cost),(v=n[d]||[]).push(g.i),i[g.i]=g,n[d]=v,m>g.cost&&(r===d&&(o=g),t[g.i]=g)));w.push(o),b()})},function(){var i=null;c.eachSeries(w,function(e,t){x.executeBushyTree(e,n,r,o,function(e){e?(i=null==i?e:x.crossProductBindings(i,e),t()):t("Error executing bushy tree")})},function(e){e?t(null,e):t(i)})})},x.executeEmptyJoinBGP=function(e,t,i,n,r){return x.executeBGPDatasets(e,t,i,n,r)},x.executeBGPDatasets=function(r,e,o,s,t){var a,l,u={};null==r.graph?(l=[],c.eachSeries(e.implicit,function(e,t){null==u[e.oid]?(u[e.oid]=!0,r.graph=e,o.rangeQuery(r,s,function(e){e=x.buildBindingsFromRange(e,r),l.push(e),t()})):t()},function(){var e=x.unionManyBindings(l);t(e)})):"var"===r.graph.token?(a=r.graph.value,l=[],c.eachSeries(e.named,function(i,n){null==u[i.oid]&&(u[i.oid]=!0,r.graph=i,null!=l)?o.rangeQuery(r,s,function(e){if(null!=e){e=x.buildBindingsFromRange(e,r);for(var t=0;t<e.length;t++)e[t][a]=i.oid;l.push(e)}else l=null;n()}):n()},function(){var e;null==l?t(null):(e=x.unionManyBindings(l),t(e))})):o.rangeQuery(r,s,function(e){null!=e?(e=x.buildBindingsFromRange(e,r),t(e)):t(null)})},x.buildBindingsFromRange=function(e,t){x.variablesInBGP(t);var i=t.value||t,n={};for(s in i)i[s]&&"var"===i[s].token?n[s]=i[s].value:i[s]&&"blank"===i[s].token&&(n[s]="blank:"+i[s].value);var r=[];if(null!=e)for(var o=0;o<e.length;o++){var s,a={},l=e[o],u=!1;for(s in n){var c=l[s];if(null!=a[n[s]]&&a[n[s]]!==c){u=!0;break}a[n[s]]=c}u||r.push(a)}return r},x.areCompatibleBindings=function(e,t){for(var i in e)if(null!=t[i]&&t[i]!=e[i])return!1;return!0},x.mergeBindings=function(e,t){var i,n={};for(i in e)n[i]=e[i];for(i in t)n[i]=t[i];return n},x.joinBindings2=function(e,t,i){for(var n,r,o={},s=[],a=0;a<t.length;a++)for(var l=t[a],u=o,c=0;c<e.length;c++)n=l[e[c]],c==e.length-1?((r=u[n]||[]).push(l),u[n]=r):(r=u[n]||{},u[n]=r,u=r);for(a=0;a<i.length;a++){l=i[a],u=o;for(c=0;c<e.length;c++)if(null!=u[n=l[e[c]]])if(c==e.length-1)for(var d=0;d<u[n].length;d++)s.push(x.mergeBindings(u[n][d],l));else u=u[n]}return s},x.joinBindings=function(e,t){for(var i=[],n=0;n<e.length;n++)for(var r=e[n],o=0;o<t.length;o++){var s=t[o];x.areCompatibleBindings(r,s)&&i.push(x.mergeBindings(r,s))}return i},x.augmentMissingBindings=function(e,t){for(var i in t)null==e[i]&&(e[i]=null);return e},x.leftOuterJoinBindings=function(e,t){for(var i=[],n=0;n<e.length;n++){for(var r=e[n],o=!1,s=0;s<t.length;s++){var a=t[s];x.areCompatibleBindings(r,a)&&(o=!0,i.push(x.mergeBindings(r,a)))}!1===o&&(x.augmentMissingBindings(r,a),i.push(r))}return i},x.crossProductBindings=function(e,t){for(var i=[],n=0;n<e.length;n++)for(var r=e[n],o=0;o<t.length;o++){var s=t[o];i.push(x.mergeBindings(r,s))}return i},x.unionBindings=function(e,t){return e.concat(t)},x.unionManyBindings=function(e){for(var t=[],i=0;i<e.length;i++)var n=e[i],t=x.unionBindings(t,n);return t},t.exports={QueryPlan:x}},{"./utils":57}],54:[function(e,t,i){function n(e){if(this.precedences=["text/turtle","text/n3","application/ld+json","application/json"],this.parsers={"text/turtle":o.parser,"text/n3":o.parser,"application/ld+json":s.parser,"application/json":s.parser},void 0!==RDFXMLParser&&(this.precedences.push("application/rdf+xml"),this.parsers["application/rdf+xml"]=RDFXMLParser.parser),null!=e)for(var t in e.parsers)this.parsers[t]=e.parsers[t];if(e&&null!=e.precedences)for(var t in this.precedences=e.precedences,e.parsers)a.include(this.precedences,t)||this.precedences.push(t);this.acceptHeaderValue="";for(var i=0;i<this.precedences.length;i++)this.acceptHeaderValue=0!=i?this.acceptHeaderValue+","+this.precedences[i]:this.acceptHeaderValue+this.precedences[i]}var r=e("./network_transport").NetworkTransport,o=e("./rvn3_parser").RVN3Parser,s=e("./jsonld_parser").JSONLDParser,a=e("./utils");n.prototype.registerParser=function(e,t){this.parsers[e]=t,this.precedences.push(e)},n.prototype.unregisterParser=function(e){delete this.parsers[e];for(var t=[],i=0;i<this.precedences.length;i++)this.precedences[i]!=e&&t.push(this.precedences[i]);this.precedences=t},n.prototype.setAcceptHeaderPrecedence=function(e){this.precedences=e},n.prototype.load=function(s,a,l){var u=this;r.load(s,this.acceptHeaderValue,function(e,t){if(e)l(e);else{var i=t.headers["Content-Type"]||t.headers["content-type"],n=t.data;if(null!=i){for(var r in i=i.split(";")[0],u.parsers)if(-1!=r.indexOf("/")){var o=r.split("/");if("*"===o[1]){if(-1!=i.indexOf(o[0]))return u.tryToParse(u.parsers[r],a,n,{documentURI:s},l)}else{if(-1!=i.indexOf(r))return u.tryToParse(u.parsers[r],a,n,{documentURI:s},l);if(-1!=i.indexOf(o[1]))return u.tryToParse(u.parsers[r],a,n,{documentURI:s},l)}}else if(-1!=i.indexOf(r))return u.tryToParse(u.parsers[r],a,n,{documentURI:s},l);l(new Error("Unknown media type : "+i))}else l(new Error("Uknown media type"))}})},n.prototype.loadFromFile=function(i,n,r,o){try{var s=this;e("fs").readFile(r.split("file:/")[1],function(e,t){e?o(e):(t=t.toString("utf8"),s.tryToParse(i,n,t,{documentURI:r},o))})}catch(e){o(e)}},n.prototype.tryToParse=function(e,t,i,n,r){try{"string"==typeof i&&(i=a.normalizeUnicodeLiterals(i)),e.parse(i,t,n,r)}catch(e){console.log(e.message),console.log(e.stack),r(e)}},t.exports={RDFLoader:n}},{"./jsonld_parser":43,"./network_transport":45,"./rvn3_parser":56,"./utils":57,fs:5}],55:[function(e,t,i){var n=e("./utils"),r=e("./query_filters").QueryFilters;(RDFModel={defaultContext:{rdf:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",rdfs:"http://www.w3.org/2000/01/rdf-schema#",owl:"http://www.w3.org/2002/07/owl#",xsd:"http://www.w3.org/2001/XMLSchema#",dcterms:"http://purl.org/dc/terms/",foaf:"http://xmlns.com/foaf/0.1/",cal:"http://www.w3.org/2002/12/cal/ical#",vcard:"http://www.w3.org/2006/vcard/ns# ",geo:"http://www.w3.org/2003/01/geo/wgs84_pos#",cc:"http://creativecommons.org/ns#",sioc:"http://rdfs.org/sioc/ns#",doap:"http://usefulinc.com/ns/doap#",com:"http://purl.org/commerce#",ps:"http://purl.org/payswarm#",gr:"http://purl.org/goodrelations/v1#",sig:"http://purl.org/signature#",ccard:"http://purl.org/commerce/creditcard#",ldp:"http://www.w3.org/ns/ldp#"},UrisMap:function(){this.defaultNs="",this.interfaceProperties=["get","remove","set","setDefault","addAll","resolve","shrink"]}}).UrisMap.prototype.values=function(){var e,t={};for(e in this)n.include(this.interfaceProperties,e)||"function"==typeof this[e]||"defaultNs"===e||"interfaceProperties"===e||(t[e]=this[e]);return t},RDFModel.UrisMap.prototype.get=function(e){if(-1!=e.indexOf(" "))throw"Prefix must not contain any whitespaces";return this[e]},RDFModel.UrisMap.prototype.remove=function(e){if(-1!=e.indexOf(" "))throw"Prefix must not contain any whitespaces";return delete this[e],null},RDFModel.UrisMap.prototype.set=function(e,t){if(-1!=e.indexOf(" "))throw"Prefix must not contain any whitespaces";this[e]=t},RDFModel.UrisMap.prototype.setDefault=function(e){this.defaultNs=e},RDFModel.UrisMap.prototype.addAll=function(e,t){for(var i in e)n.include(this.interfaceProperties,i)||null!=this[i]&&!0!==t||(this[i]=e[i]);return this},RDFModel.UrisMap.prototype.resolve=function(e){var e=e.split(":"),t=e[0],e=e[1];return""===t?null==this.defaultNs?null:this.defaultNs+e:null!=this[t]?this[t]+e:null},RDFModel.UrisMap.prototype.shrink=function(e){for(var t in this){var i=this[t];if(0===e.indexOf(i))if(""!==i&&"defaultNs"!=t)return t+":"+e.split(i)[1]}return e},RDFModel.Profile=function(){this.prefixes=new RDFModel.UrisMap,this.terms=new RDFModel.UrisMap},RDFModel.Profile.prototype.importProfile=function(e,t){this.prefixes.addAll(e.prefixes,t),this.terms.addAll(e.terms,t)},RDFModel.Profile.prototype.resolve=function(e){return-1!=e.indexOf(":")?this.prefixes.resolve(e):null!=this.terms[e]?this.terms.resolve(e):null},RDFModel.Profile.prototype.setDefaultPrefix=function(e){this.prefixes.setDefault(e)},RDFModel.Profile.prototype.setDefaultVocabulary=function(e){this.terms.setDefault(e)},RDFModel.Profile.prototype.setPrefix=function(e,t){this.prefixes.set(e,t)},RDFModel.Profile.prototype.setTerm=function(e,t){this.terms.set(e,t)},RDFModel.RDFEnvironment=function(){RDFModel.Profile.call(this),this.blankNodeCounter=0;var e,n=this;for(e in this.filters={s:function(t){return function(e){return e.subject.equals(t)}},p:function(t){return function(e){return e.predicate.equals(t)}},o:function(t){return function(e){return e.object.equals(t)}},sp:function(t,i){return function(e){return e.subject.equals(t)&&e.predicate.equals(i)}},so:function(t,i){return function(e){return e.subject.equals(t)&&e.object.equals(i)}},po:function(t,i){return function(e){return e.predicate.equals(t)&&e.object.equals(i)}},spo:function(t,i,n){return function(e){return e.subject.equals(t)&&e.predicate.equals(i)&&e.object.equals(n)}},describes:function(t){return function(e){return e.subject.equals(t)||e.object.equals(t)}},type:function(t){var i=n.resolve("rdf:type");return function(e){return e.predicate.equals(i)&&e.object.equals(t)}}},RDFModel.defaultContext)this.prefixes.set(e,RDFModel.defaultContext[e])},RDFModel.RDFEnvironment.prototype=n.create(RDFModel.Profile.prototype,{constructor:RDFModel.RDFEnvironment}),RDFModel.RDFEnvironment.prototype.createBlankNode=function(){var e=new RDFModel.BlankNode(this.blankNodeCounter);return this.blankNodeCounter++,e},RDFModel.RDFEnvironment.prototype.createNamedNode=function(e){var t=this.resolve(e);return null!=t?new RDFModel.NamedNode(t):new RDFModel.NamedNode(e)},RDFModel.RDFEnvironment.prototype.createLiteral=function(e,t,i){return null!=i?new RDFModel.Literal(e,t,i.toString()):new RDFModel.Literal(e,t,i)},RDFModel.RDFEnvironment.prototype.createTriple=function(e,t,i){return new RDFModel.Triple(e,t,i)},RDFModel.RDFEnvironment.prototype.createGraph=function(e){var t=new RDFModel.Graph;if(null!=e)for(var i=0;i<e.length;i++)t.add(e[i]);return t},RDFModel.RDFEnvironment.prototype.createAction=function(t,i){return function(e){return t(e)?i(e):e}},RDFModel.RDFEnvironment.prototype.createProfile=function(e){return!0===e?new RDFModel.RDFEnvironment.Profile:((e=new RDFModel.RDFEnvironment.Profile).importProfile(this),e)},RDFModel.RDFEnvironment.prototype.createTermMap=function(e){if(!0===e)return new RDFModel.UrisMap;var t,i=this.terms.values(),n=new RDFModel.UrisMap;for(t in i)n[t]=i[t];return n},RDFModel.RDFEnvironment.prototype.createPrefixMap=function(e){if(!0===e)return new RDFModel.UrisMap;var t,i=this.prefixes.values(),n=new RDFModel.UrisMap;for(t in i)n[t]=i[t];return n},RDFModel.RDFNode=function(e){this.interfaceName=e,this.attributes=["interfaceName","nominalValue"]},RDFModel.RDFNode.prototype.equals=function(e){if(null==e.interfaceName)return this.valueOf()==e;for(var t in this.attributes){t=this.attributes[t];if(this[t]!=e[t])return!1}return!0},RDFModel.BlankNode=function(e){RDFModel.RDFNode.call(this,"BlankNode"),this.nominalValue="_:"+e,this.bnodeId=e},RDFModel.BlankNode.prototype=n.create(RDFModel.RDFNode.prototype,{constructor:RDFModel.BlankNode}),RDFModel.BlankNode.prototype.toString=function(){return this.nominalValue},RDFModel.BlankNode.prototype.toNT=function(){return this.nominalValue},RDFModel.BlankNode.prototype.valueOf=function(){return this.nominalValue},RDFModel.Literal=function(e,t,i){RDFModel.RDFNode.call(this,"Literal"),this.nominalValue=e,null!=t?this.language=t:null!=i&&(this.datatype=i)},RDFModel.Literal.prototype=n.create(RDFModel.RDFNode.prototype,{constructor:RDFModel.Literal}),RDFModel.Literal.prototype.toString=function(){var e='"'+this.nominalValue+'"';return null!=this.language?e=e+"@"+this.language:null==this.datatype&&!this.type||(e=e+"^^<"+(this.datatype||this.type)+">"),e},RDFModel.Literal.prototype.toNT=function(){return this.toString()},RDFModel.Literal.prototype.valueOf=function(){return r.effectiveTypeValue({token:"literal",type:this.type||this.datatype,value:this.nominalValue,language:this.language})},RDFModel.NamedNode=function(e){RDFModel.RDFNode.call(this,"NamedNode"),null!=e.value?this.nominalValue=e.value:this.nominalValue=e},RDFModel.NamedNode.prototype=n.create(RDFModel.RDFNode.prototype,{constructor:RDFModel.NamedNode}),RDFModel.NamedNode.prototype.toString=function(){return this.nominalValue},RDFModel.NamedNode.prototype.toNT=function(){return"<"+this.toString()+">"},RDFModel.NamedNode.prototype.valueOf=function(){return this.nominalValue},RDFModel.Triple=function(e,t,i){this.subject=e,this.predicate=t,this.object=i},RDFModel.Triple.prototype.equals=function(e){return this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)},RDFModel.Triple.prototype.toString=function(){return this.subject.toNT()+" "+this.predicate.toNT()+" "+this.object.toNT()+" . \r\n"},RDFModel.Graph=function(){this.triples=[],this.duplicates={},this.actions=[],this.length=0},RDFModel.Graph.prototype.add=function(e){for(var t=0;t<this.actions.length;t++)e=this.actions[t](e);var i=e.subject.toString()+e.predicate.toString()+e.object.toString();return this.duplicates[i]||(this.duplicates[i]=!0,this.triples.push(e)),this.length=this.triples.length,this},RDFModel.Graph.prototype.addAction=function(e,t){if(this.actions.push(e),1==t)for(var i=0;i<this.triples.length;i++)this.triples[i]=e(this.triples[i]);return this},RDFModel.Graph.prototype.addAll=function(e){for(var t=e.toArray(),i=0;i<t.length;i++)this.add(t[i]);return this.length=this.triples.length,this},RDFModel.Graph.prototype.remove=function(e){for(var t=null,i=0;i<this.triples.length;i++)if(this.triples[i].equals(e)){var n=e.subject.toString()+e.predicate.toString()+e.object.toString();delete this.duplicates[n],t=i;break}return null!=t&&this.triples.splice(t,1),this.length=this.triples.length,this},RDFModel.Graph.prototype.toArray=function(){return this.triples},RDFModel.Graph.prototype.some=function(e){for(var t=0;t<this.triples.length;t++)if(!0===e(this.triples[t],this))return!0;return!1},RDFModel.Graph.prototype.every=function(e){for(var t=0;t<this.triples.length;t++)if(!1===e(this.triples[t],this))return!1;return!0},RDFModel.Graph.prototype.filter=function(e){for(var t=new RDFModel.Graph,i=0;i<this.triples.length;i++)!0===e(this.triples[i],this)&&t.add(this.triples[i]);return t},RDFModel.Graph.prototype.forEach=function(e){for(var t=0;t<this.triples.length;t++)e(this.triples[t],this)},RDFModel.Graph.prototype.merge=function(e){for(var t=new RDFModel.Graph,i=0;i<this.triples.length;i++)t.add(this.triples[i]);return t},RDFModel.Graph.prototype.match=function(e,t,i,n){for(var r=new RDFModel.Graph,o=0,s=0;s<this.triples.length;s++){var a=this.triples[s];if((null==e||a.subject.equals(e))&&(null==t||a.predicate.equals(t))&&(null==i||a.object.equals(i))){if(!(null==n||o<n))return r;o++,r.add(a)}}return r},RDFModel.Graph.prototype.removeMatches=function(e,t,i){for(var n=[],r=0;r<this.triples.length;r++){var o=this.triples[r];null!=e&&!o.subject.equals(e)||null!=t&&!o.predicate.equals(t)||null!=i&&!o.object.equals(i)||n.push(o)}for(r=0;r<n.length;r++)this.remove(n[r]);return this},RDFModel.Graph.prototype.toNT=function(){var t="";return this.forEach(function(e){t+=e.toString()}),t},RDFModel.buildRDFResource=function(e,t,i,n){return"blank"===e.token?RDFModel.buildBlankNode(e,t,i,n):"literal"===e.token?RDFModel.buildLiteral(e,t,i,n):"uri"===e.token?RDFModel.buildNamedNode(e,t,i,n):"var"===e.token&&null!=(e=t[e.value])?RDFModel.buildRDFResource(e,t,i,n):null},RDFModel.buildBlankNode=function(e,t,i,n){return null!=e.valuetmp&&(e.value=e.valuetmp),0===e.value.indexOf("_:")&&(e.value=e.value.split("_:")[1]),new RDFModel.BlankNode(e.value)},RDFModel.buildLiteral=function(e,t,i,n){return new RDFModel.Literal(e.value,e.lang,e.type)},RDFModel.buildNamedNode=function(e,t,i,n){return null!=e.value||null!=e.prefix&&(i=i.resolveNsInEnvironment(e.prefix,n),e.value=i+e.suffix),new RDFModel.NamedNode(e)},RDFModel.rdf=new RDFModel.RDFEnvironment,t.exports=RDFModel},{"./query_filters":52,"./utils":57}],56:[function(e,t,i){var o=e("n3").Parser,e={};function s(e){switch(e[0]){case'"':var t;return 0<e.indexOf("^^")?{literal:(t=e.split("^^"))[0]+"^^<"+t[1]+">"}:{literal:e};case"_":return{blank:e.replace("b","")};default:return{token:"uri",value:e,prefix:null,suffix:null}}}e.parser={async:!0,parse:function(e,i,t,n){n||(n=t,t=i,i=null),i&&"string"==typeof i&&(i={token:"uri",value:i,prefix:null,suffix:null}),t&&t.baseURI&&(t.documentIRI=t.baseURI);var r=[];new o(t).parse(e,function(e,t){e?n(e):t?r.push({subject:s(t.subject),predicate:s(t.predicate),object:s(t.object),graph:i}):n(!1,r)})},resetBlankNodeIds:function(){o._resetBlankNodeIds()}},t.exports={RVN3Parser:e}},{n3:28}],57:[function(_dereq_,module,exports){!function(process){var slowNextTick=void 0!==process&&process.nextTick?process.nextTick:"undefined"!=typeof window&&window.setImmediate?window.setImmediate:function(e){setTimeout(e,0)},spin=0,yieldFrequency=100,nextTick=function(e){++spin<yieldFrequency?e():(spin=0,slowNextTick(e))},hashTerm=function(t){try{var e;return null==t?"":"uri"===t.token?"u"+t.value:"blank"===t.token?"b"+t.value:"literal"===t.token?(e="l"+t.value,e=(e+=t.type||"")+(t.lang||"")):void 0}catch(e){if("object"!=typeof t)return t;var i="";for(p in t)i=i+p+t[p];return i}},lexicalFormBaseUri=function(e,t){var i,n,r,o=null;return t=t||{},null===(o=null==e.value?(i=e.prefix,n=e.suffix,null!=(r=t.namespaces[i])?r+n:i+":"+n):e.value)?null:-1==o.indexOf(":")?(t.base||"")+o:o},reject=(parseISO8601=function(e){return Date.parse(e)},Date.prototype.toISOString||!function(){function e(e){return e<10?"0"+e:e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}(),iso8601=function(e){return e.toISOString()},compareDateComponents=function(e,t){e=parseISO8601(e),t=parseISO8601(t);return e==t?0:e<t?-1:1},lexicalFormLiteral=function(e,t){var i,n,r,o=e.value,s=e.lang,a=e.type;return null!=o&&null!=a&&"string"!=typeof a?(null==(i=a.value)&&(n=a.prefix,r=a.suffix,t=t.namespaces[n],e.type=t+r,i=t+r),-1!=i.indexOf("hexBinary")?'"'+e.value.toLowerCase()+'"^^<'+i+">":'"'+e.value+'"^^<'+i+">"):null==s&&null==a?'"'+o+'"':null==a?'"'+o+'"@'+s:-1!=a.indexOf("hexBinary")?'"'+e.value.toLowerCase()+'"^^<'+a+">":'"'+e.value+'"^^<'+a+">"},normalizeUnicodeLiterals=function(string){for(var escapedUnicode=string.match(/\\u[0-9abcdefABCDEF]{4,4}/g)||[],dups={},i=0;i<escapedUnicode.length;i++)null==dups[escapedUnicode[i]]&&(dups[escapedUnicode[i]]=!0,string=string.replace(new RegExp("\\"+escapedUnicode[i],"g"),eval("'"+escapedUnicode[i]+"'")));return string},registerIndexedDB=function(e){var t,i;"undefined"==typeof window&&void 0!==process&&!1===process.browser?(i=_dereq_("sqlite3"),t=_dereq_("indexeddb-js"),i=new i.Database(":memory:"),t=t.makeScope("sqlite3",i),e.indexedDB=t.indexedDB,e.IDBKeyRange=t.IDBKeyRange):((i="undefined"==typeof window?self:window).indexedDB=i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,i.IDBKeyRange=i.IDBKeyRange||i.webkitIDBKeyRange||i.msIDBKeyRange,i.indexedDB?(e.indexedDB=i.indexedDB,e.IDBKeyRange=i.IDBKeyRange):console.log("The browser does not support IndexDB."))},guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},hashTerm=function(t){try{var e;return null==t?"":"uri"===t.token?"u"+t.value:"blank"===t.token?"b"+t.value:"literal"===t.token?(e="l"+t.value,e=(e+=t.type||"")+(t.lang||"")):void 0}catch(e){if("object"!=typeof t)return t;var i="";for(p in t)i=i+p+t[p];return i}},function(e,t){for(var i=[],n=0;n<e.length;n++)t(e[n])&&i.push(e[n]);return i}),include=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1},each=function(e,t){if(e.forEach)e.forEach(t);else for(var i=0;i<e.length;i++)t(e[i])},map=function(e,t){if(e.map)return e.map(t);for(var i=[],n=0;n<e.length;n++)i[n]=t(e[n]);return i},keys=function(e){var t,i=[];for(t in e)i.push(t);return i},values=function(e){var t,i=[];for(t in e)i.push(e[t]);return i},size=function(e){if(e.length)return e.length;var t,i=0;for(t in e)i++;return i},isObject=(clone=function(e){return JSON.parse(JSON.stringify(e))},function(e){var t=typeof e;return"function"==t||e&&"object"==t||!1}),create=function(){function i(){}return function(e){var t;return isObject(e)&&(i.prototype=e,t=new i,i.prototype=null),t||void 0}}(),whilst=function(t,i,n){t()?i(function(e){if(e)return n(e);whilst(t,i,n)}):n()},eachSeries=function(t,e,i){if(i=i||function(){},!t.length)return i();function n(){e(t[r],function(e){e?(i(e),i=function(){}):(r+=1)>=t.length?i():nextTick(n)})}var r=0;n()},eachParallel=function(t,e,i){if(i=i||function(){},!t.length)return i();function n(e){if(e)throw r=!0,new Error(e);r||++o===t.length&&i()}for(var r=!1,o=0,s=0;s<t.length;s++)!function(e,t,i,n){nextTick(function(){try{n(e[t],function(){i()})}catch(e){i(e)}})}(t,s,n,e)},reduce=function(e,n,t,i){eachSeries(e,function(e,i){t(n,e,function(e,t){n=t,i(e)})},function(e){i(e,n)})},seq=function(){var t=arguments;return function(){var n=this,e=Array.prototype.slice.call(arguments),i=e.pop();reduce(t,e,function(e,t,i){t.apply(n,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);i(e,t)}]))},function(e,t){i.apply(n,[e].concat(t))})}},isWorker=function(){return(void 0===process||!0===process.browser)&&"undefined"==typeof window};module.exports={isWorker:isWorker,nextTick:nextTick,hasTerm:hashTerm,lexicalFormBaseUri:lexicalFormBaseUri,parseISO8601:parseISO8601,compareDateComponents:compareDateComponents,iso8601:iso8601,normalizeUnicodeLiterals:normalizeUnicodeLiterals,lexicalFormLiteral:lexicalFormLiteral,registerIndexedDB:registerIndexedDB,guid:guid,hashTerm:hashTerm,keys:keys,values:values,size:size,map:map,each:each,forEach:each,include:include,reject:reject,remove:reject,clone:clone,create:create,whilst:whilst,eachSeries:eachSeries,eachParallel:eachParallel,seq:seq,yieldFrequency:function(e){yieldFrequency=e}}}.call(this,_dereq_("2ionoC"))},{"2ionoC":10}]},{},[41])(41)});var TabulatorRDFXMLParser=function(){function o(e){var p={ns:{RDF:"http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFS:"http://www.w3.org/2000/01/rdf-schema#"},nodeType:{ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12}};this.frameFactory=function(e,t,i){return{NODE:1,ARC:2,parent:t,parser:e,store:e.store,element:i,lastChild:0,base:null,lang:null,node:null,nodeType:null,listIndex:1,rdfid:null,datatype:null,collection:!1,terminateFrame:function(){this.collection&&this.node.close()},addSymbol:function(e,t){t=f(t,this.base),this.node=this.store.sym(t),this.nodeType=e},loadTriple:function(){var e;this.parent.parent.collection?this.parent.parent.node.append(this.node):this.store.add(this.parent.parent.node,this.parent.node,this.node,this.parser.why),null!=this.parent.rdfid&&(e=this.store.sym(f("#"+this.parent.rdfid,this.base)),this.store.add(e,this.store.sym(p.ns.RDF+"type"),this.store.sym(p.ns.RDF+"Statement"),this.parser.why),this.store.add(e,this.store.sym(p.ns.RDF+"subject"),this.parent.parent.node,this.parser.why),this.store.add(e,this.store.sym(p.ns.RDF+"predicate"),this.parent.node,this.parser.why),this.store.add(e,this.store.sym(p.ns.RDF+"object"),this.node,this.parser.why))},isTripleToLoad:function(){return null!=this.parent&&null!=this.parent.parent&&this.nodeType==this.NODE&&this.parent.nodeType==this.ARC&&this.parent.parent.nodeType==this.NODE},addNode:function(e){this.addSymbol(this.NODE,e),this.isTripleToLoad()&&this.loadTriple()},addCollection:function(){this.nodeType=this.NODE,this.node=this.store.collection(),this.collection=!0,this.isTripleToLoad()&&this.loadTriple()},addCollectionArc:function(){this.nodeType=this.ARC},addBNode:function(e){null!=e?null!=this.parser.bnodes[e]?this.node=this.parser.bnodes[e]:this.node=this.parser.bnodes[e]=this.store.bnode():this.node=this.store.bnode(),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()},addArc:function(e){e==p.ns.RDF+"li"&&(e=p.ns.RDF+"_"+this.parent.listIndex++),this.addSymbol(this.ARC,e)},addLiteral:function(e){this.parent.datatype?this.node=this.store.literal(e,"",this.store.sym(this.parent.datatype)):this.node=this.store.literal(e,this.lang),this.nodeType=this.NODE,this.isTripleToLoad()&&this.loadTriple()}}},this.getAttributeNodeNS=function(e,t,i){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,i);else for(var r,o=e.attributes,s=0;s<o.length;++s)if((r=o[s]).namespaceURI==t&&(r.prefix?r.prefix+":"+i:i)==r.nodeName){n=r;break}return n},this.store=e,this.bnodes={},this.why=null,this.reify=!1,this.parse=function(e,t,i){var n=e.childNodes;if(this.cleanParser(),e.nodeType==p.nodeType.DOCUMENT){for(var r=0;r<n.length;r++)if(n[r].nodeType==p.nodeType.ELEMENT){var o=n[r];break}}else{if(e.nodeType!=p.nodeType.ELEMENT)throw new Error("RDFParser: can't find root in "+t+". Halting. ");o=e}this.why=i;e=this.frameFactory(this);return this.base=t,e.base=t,e.lang="",this.parseDOM(this.buildFrame(e,o)),!0},this.parseDOM=function(e){function t(e){var t="";return e.namespaceURI&&(t+=e.namespaceURI),e.localName?t+=e.localName:e.nodeName&&(0<=e.nodeName.indexOf(":")?t+=e.nodeName.split(":")[1]:t+=e.nodeName),t}for(var i=!0;e.parent;){var n=e.element,r=n.attributes;if(n.nodeType==p.nodeType.TEXT||n.nodeType==p.nodeType.CDATA_SECTION)e.addLiteral(n.nodeValue);else if(t(n)!=p.ns.RDF+"RDF")if(e.parent&&e.parent.collection&&(e.addCollectionArc(),(e=this.buildFrame(e,e.element)).parent.element=null),e.parent&&e.parent.nodeType&&e.parent.nodeType!=e.ARC){e.addArc(t(n)),this.reify&&(u=this.getAttributeNodeNS(n,p.ns.RDF,"ID"))&&(e.rdfid=u.nodeValue,n.removeAttributeNode(u));var o=this.getAttributeNodeNS(n,p.ns.RDF,"parseType"),s=this.getAttributeNodeNS(n,p.ns.RDF,"datatype");if(s&&(e.datatype=s.nodeValue,n.removeAttributeNode(s)),o&&("Literal"==(s=o.nodeValue)?(e.datatype=p.ns.RDF+"XMLLiteral",(e=this.buildFrame(e)).addLiteral(n),i=!1):"Resource"==s?((e=this.buildFrame(e,e.element)).parent.element=null,e.addBNode()):"Collection"==s&&((e=this.buildFrame(e,e.element)).parent.element=null,e.addCollection()),n.removeAttributeNode(o)),0!=r.length){s=this.getAttributeNodeNS(n,p.ns.RDF,"resource"),l=this.getAttributeNodeNS(n,p.ns.RDF,"nodeID");e=this.buildFrame(e),s?(e.addNode(s.nodeValue),n.removeAttributeNode(s)):l?(e.addBNode(l.nodeValue),n.removeAttributeNode(l)):e.addBNode();for(c=r.length-1;0<=c;c--){var a=this.buildFrame(e);a.addArc(t(r[c])),t(r[c])==p.ns.RDF+"type"?this.buildFrame(a).addNode(r[c].nodeValue):this.buildFrame(a).addLiteral(r[c].nodeValue)}}else 0==n.childNodes.length&&this.buildFrame(e).addLiteral("")}else{var l,o=this.getAttributeNodeNS(n,p.ns.RDF,"about"),u=this.getAttributeNodeNS(n,p.ns.RDF,"ID");if(o&&u)throw new Error("RDFParser: "+n.nodeName+" has both rdf:id and rdf:about. Halting. Only one of these properties may be specified on a node.");null==o&&u?(e.addNode("#"+u.nodeValue),n.removeAttributeNode(u)):null==o&&null==u?(l=this.getAttributeNodeNS(n,p.ns.RDF,"nodeID"))?(e.addBNode(l.nodeValue),n.removeAttributeNode(l)):e.addBNode():(e.addNode(o.nodeValue),n.removeAttributeNode(o));s=this.getAttributeNodeNS(n,p.ns.RDF,"type");null!=(s=p.ns.RDF+"Description"!=t(n)?{nodeValue:t(n)}:s)&&(this.store.add(e.node,this.store.sym(p.ns.RDF+"type"),this.store.sym(f(s.nodeValue,e.base)),this.why),s.nodeName)&&n.removeAttributeNode(s);for(var c=r.length-1;0<=c;c--)this.store.add(e.node,this.store.sym(t(r[c])),this.store.literal(r[c].nodeValue,e.lang),this.why)}for(n=e.element;e.parent;){for(var d=e;null==n;)n=(e=e.parent).element;var h=n.childNodes[e.lastChild];if(null!=h&&i){if((h.nodeType==p.nodeType.ELEMENT||h.nodeType==p.nodeType.TEXT||h.nodeType==p.nodeType.CDATA_SECTION)&&(h.nodeType!=p.nodeType.TEXT&&h.nodeType!=p.nodeType.CDATA_SECTION||1==n.childNodes.length)){e.lastChild++,e=this.buildFrame(d,n.childNodes[e.lastChild-1]);break}e.lastChild++}else{if(e.terminateFrame(),!(e=e.parent))break;n=e.element,i=!0}}}},this.cleanParser=function(){this.bnodes={},this.why=null},this.buildFrame=function(e,t){var i=this.frameFactory(this,e,t);if(e&&(i.base=e.base,i.lang=e.lang),null!=t&&t.nodeType!=p.nodeType.TEXT&&t.nodeType!=p.nodeType.CDATA_SECTION){var n=t.attributes,e=t.getAttributeNode("xml:base"),e=(null!=e&&(i.base=e.nodeValue,t.removeAttribute("xml:base")),t.getAttributeNode("xml:lang"));null!=e&&(i.lang=e.nodeValue,t.removeAttribute("xml:lang"));for(var r,o=n.length-1;0<=o;o--)"xml"==n[o].nodeName.substr(0,3)&&("xmlns:"==n[o].name.slice(0,6)&&(r=n[o].nodeValue,this.base&&(r=f(r,this.base)),this.store.setPrefixForURI(n[o].name.slice(6),r)),t.removeAttributeNode(n[o]))}return i}}function s(n){this.statements=[],this.namespaces={},this.add=function(e,t,i){this.statements.push({subject:e,predicate:t,object:i,graph:n})},this.sym=function(e){return{token:"uri",value:e}},this.literal=function(e,t,i){return e='"'+(e=(e=(e=e.replace(/\\/g,"\\\\")).replace(/\"/g,'\\"')).replace(/\n/g,"\\n"))+'"',i&&(e=e+"^^"+i),{literal:e=t?e+"@"+t:e}};var t=0;this.bnode=function(e){return{blank:e=e||"_:bnid"+t++}},this.setPrefixForURI=function(e,t){if(this.namespaces[e]||t!=t)throw"Can't redefine prefix "+e;this.namespaces[e]=t}}var f=function(e,t){var i=t.indexOf("#");if(0<i&&(t=t.slice(0,i)),0==e.length)return t;if(0==e.indexOf("#"))return t+e;if(0<=e.indexOf(":"))return e;i=t.indexOf(":");if(""==t)return e;if(i<0)throw"Invalid Base URI";var n,r=t.slice(0,i+1);if(0==e.indexOf("//"))return r+e;if(t.indexOf("//",i)==i+1){if((n=t.indexOf("/",i+3))<0)return 0<t.length-i-3?t+"/"+e:r+e}else if((n=t.indexOf("/",i+1))<0)return 0<t.length-i-1?t+"/"+e:r+e;if(0==e.indexOf("/"))return t.slice(0,n)+e;var o=t.slice(n),i=o.lastIndexOf("/");if(i<0)return r+e;for(0<=i&&i<o.length-1&&(o=o.slice(0,i+1)),o+=e;o.match(/[^\/]*\/\.\.\//);)o=o.replace(/[^\/]*\/\.\.\//,"");return o=(o=o.replace(/\.\//g,"")).replace(/\/\.$/,"/"),t.slice(0,n)+o};return{parse:function(e,t){var i,n,r=e,e=("string"!=typeof(n=e)&&"[object String]"!==Object.prototype.toString.call(n)||(n=e,"undefined"!=typeof module?i=(i=require("jsdom")).jsdom(n,i.level(2,"core"),{}):window.DOMParser?i=(new DOMParser).parseFromString(n,"text/xml"):window.ActiveXObject&&((i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(n)),r=i),new s(t));return new o(e).parse(r,"http://nobase"),e.statements}}}(),RDFXMLParser={parser:{}},SPARQL_TRIPLE=(RDFXMLParser.parser.parse=function(e,t,i,n){n||(n=i,i=t,t=null),t&&"string"==typeof t&&(t={token:"uri",value:t,prefix:null,suffix:null}),i&&i.baseURI&&(i.documentIRI=i.baseURI);try{n(!1,TabulatorRDFXMLParser.parse(e,t))}catch(e){n(e)}},window.RDFE||(window.RDFE={}),RDFE.Utils={},RDFE.Utils.createTitle=function(e){return e&&(e=e.replace(/_/g," ")).replace(/^\s*/,"").replace(/^[a-z]|[^\sA-Z][A-Z]/g,function(e,t){return 0==t?e.toUpperCase():e.substr(0,1)+" "+e.substr(1).toUpperCase()})},RDFE.Utils.escapeXml=function(e){return e.replace(/[<>&'"]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})},RDFE.Utils.trim=function(e,t){if(e){for(t=t||" ";e.substring(0,1)==t;)e=e.substring(1,e.length);for(;e.substring(e.length-1,e.length)==t;)e=e.substring(0,e.length-1)}return e},RDFE.Utils.namingSchemaLabel=function(e,t,i,n){t=t[e][!0===i?1:0];return!0===n?t.toLowerCase():t},RDFE.Utils.uriParams=function(){var e={},t=location.search;if(t=(t=1<t.length?t.substring(1):t)||(t=location.hash).substring(t.indexOf("?")+1))for(var i=t.split("&"),n=0;n<i.length;n++){var r,o,s=i[n];s&&(-1==(o=s.indexOf("="))?e[decodeURIComponent(s)]="":(r=s.substring(0,o),s=s.substring(o+1),r=decodeURIComponent(r),s=decodeURIComponent(s.replace(/\+/g," ")),o=!1,(o=r.match(/(.*)\[\]$/))?(r=o[1])in e?e[r].push(s):e[r]=[s]:e[r]=s))}return e},RDFE.Utils.uri2name=function(e){if(e){var t=e.lastIndexOf("#");if(0<=(t=(t<0||-1!==["this","me","i"].indexOf(e.substring(t+1,e.length)))&&(t=e.lastIndexOf("/"))+1===e.length?(e=e.substring(0,e.length-1)).lastIndexOf("/"):t))return e.substring(t+1,e.length);if(0<=(t=e.lastIndexOf(":")))return e.substring(t+1,e.length)}return e},RDFE.Utils.uriAbbreviate=function(e,t){var i,n,r,o;return!e||!t||e.length<=t?e:(i="",n="...",(r=RDFE.Utils.uri2name(e)).length>t-3?r:((e=e.substring(0,e.length-r.length)).match(/http:\/\/.*/)?(e=e.substring((i="http://").length,e.length)).length<=3?n=e:i+=e.substring(0,t-3-i.length-r.length):0<(o=e.indexOf(":"))?o===e.length-1?(i=e,n=""):(i=e.substring(0,o+1),(e=e.substring(i.length,e.length)).length<=3?n=e:i+=e.substring(0,t-3-i.length-r.length)):i+=e.substring(0,t-3-i.length-r.length),i+n+r))},RDFE.Utils.strAbbreviate=function(e,t){if(e&&t){if(e.length<=t||e.length<="...".length+2)return e;t<"...".length+2&&(t="...".length+2);var i=e.substring(0,Math.ceil((t-3)/2));return i+"..."+e.substr(-(t-i.length-"...".length))}return e},RDFE.Utils.getLabel=function(e,t){return e&&e[t]?e[t]:t},RDFE.Utils.getUrl=function(e){e=RDFE.Utils.splitUrl(e);return e.protocol+"//"+e.host+e.path},RDFE.Utils.getUrlBase=function(e){e=RDFE.Utils.splitUrl(e);return e.protocol+"//"+e.host},RDFE.Utils.getProtocol=function(e){return RDFE.Utils.splitUrl(e).protocol},RDFE.Utils.splitUrl=function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol,host:t.host,hostname:t.hostname,path:t.pathname,port:t.port,search:t.search}},RDFE.Utils.resolveStorageLocations=function(s,a){var l=[];!function n(r){var o,e,t,i;r>=s.length?a(l):(o=s[r].uri,(e=s[r].sparqlEndpoint)?((t=new RDFE.IO.Folder(e)).ioType="sparql",t.sparqlEndpoint=e,(i=new RDFE.IO.File(o)).parent=t,i.ioType="sparql",i.sparqlEndpoint=e,t.children.push(i),l.push(t),n(r+1)):RDFE.IO.openUrl(o,{checkForFiles:!0},function(e){l.push(e),n(r+1)},function(e,t){var i=new RDFE.IO.File(o);i.errorMessage=e,i.httpStatus=t,l.push(i),n(r+1)}))}(0)},RDFE.Utils.extractDomain=function(e){e=-1<e.indexOf("://")?e.split("/")[2]:e.split("/")[0];return e=e.split(":")[0]},window.RDFE||(window.RDFE={}),RDFE.Validate={},RDFE.Validate.error=function(e,t){return $.notify({message:t},{type:"danger"}),setTimeout(function(){e.focus()},1),!1},RDFE.Validate.integer=function(e,t){return!!/^[0-9]+$/.test(t)||RDFE.Validate.error(e,"Invalid integer value: "+t)},RDFE.Validate.float=function(e,t){return!!/^[-+]?([0-9]*\.)?[0-9]+([eE][-+]?[0-9]+)?$/.test(t)||RDFE.Validate.error(e,"Invalid float value: "+t)},RDFE.Validate.date=function(e,t){return!!/^((?:19|20)[0-9][0-9])[- /.](0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])$/.test(t)||RDFE.Validate.error(e,"Invalid date value: "+t)},RDFE.Validate.time=function(e,t){return!!/^([01]?[0-9]|[2][0-3])(:[0-5][0-9])?$/.test(t)||RDFE.Validate.error(e,"Invalid time value: "+t)},RDFE.Validate.dateTime=function(e,t){return!!/^((?:19|20)[0-9][0-9])[- /.](0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])( ([01]?[0-9]|[2][0-3])(:[0-5][0-9])?)?$/.test(t)||RDFE.Validate.error(e,"Invalid date value: "+t)},RDFE.Validate.mail=function(e,t){return 0==t.length||40<t.length?RDFE.Validate.error(e,"E-mail address cannot be empty or longer then 40 chars"):!!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)||RDFE.Validate.error(e,"Invalid E-mail address: "+t)},RDFE.Validate.URL=function(e,t){return!!/^(ftp|http|https):(\/\/)?(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(t)||RDFE.Validate.error(e,"Invalid URL address: "+t)},RDFE.Validate.URI=function(e,t){return!(!/^([a-z0-9+.-]+):(\/\/)?(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(t)&&!/^acct:([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t))||RDFE.Validate.error(e,"Invalid URI address: "+t)},RDFE.Validate.WebID=function(e,t){return"foaf:Agent"==t||!!/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(t)||!!/^acct:([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-:])+)+\.?([a-zA-Z0-9]{0,4})+$/.test(t)||!!/^acct:([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(t)||RDFE.Validate.error(e,"Invalid URI address: "+t)},RDFE.Validate.check=function(e,t,i){return i=i||[],0==(t=RDFE.Utils.trim(t)).length&&-1!==i.indexOf("canEmpty")||(-1!==i.indexOf("integer")?RDFE.Validate.integer(e,t):-1!==i.indexOf("float")?RDFE.Validate.float(e,t):-1!==i.indexOf("date")?RDFE.Validate.date(e,t):-1!==i.indexOf("time")?RDFE.Validate.time(e,t):-1!==i.indexOf("dateTime")?RDFE.Validate.dateTime(e,t):-1!==i.indexOf("mail")?RDFE.Validate.mail(e,t):-1!==i.indexOf("URL")?RDFE.Validate.URL(e,t):-1!==i.indexOf("URI")?RDFE.Validate.URI(e,t):-1!==i.indexOf("WebID")?RDFE.Validate.WebID(e,t):0!=t.length||RDFE.Validate.error(e,"Field cannot be empty"))},rdfstore.Store.prototype.curiToUri=function(e){return this.rdf.resolve(e)},rdfstore.Store.prototype.parseLiteral=function(e){var t=e.lastIndexOf("@");return-1!=t&&'"'===e[t-1]&&null!=e.substring(t,e.length).match(/^@[a-zA-Z\-]+$/g)?{token:"literal",value:e.substring(1,t-1),lang:e.substring(t+1,e.length)}:-1!=(t=e.lastIndexOf("^^"))&&'"'===e[t-1]&&"<"===e[t+2]&&">"===e[e.length-1]?{token:"literal",value:e.substring(1,t-1),type:e.substring(t+3,e.length-1)}:{token:"literal",value:e.substring(1,e.length-1)}},rdfstore.Store.prototype.termToNode=function(e){return"literal"==e.token?this.rdf.createLiteral(e.value,e.lang,e.type):(e.token,this.rdf.createNamedNode(e.value))},rdfstore.Store.prototype.rdf.api.RDFNode.prototype.localeCompare=function(e,t,i){return this.toString().localeCompare(e.toString(),t,i)},rdfstore.Store.prototype.loadTurtle=function(o,s,a,l,u){var c=this,e=N3.Parser(),d=[],h=[],p=function(e){switch(e[0]){case'"':var t;return 0<e.indexOf("^^")?{literal:(t=e.split("^^"))[0]+"^^<"+t[1]+">"}:{literal:e};case"_":return{blank:e.replace("b","")};default:return{token:"uri",value:e,prefix:null,suffix:null}}};e.parse(o,function(e,t,i){if(e){if(e.message.startsWith("Undefined prefix")&&l){var n=e.message.indexOf('"'),n=(r=e.message.substring(n+1)).indexOf('"'),r=r.substring(0,n-1);if(l[r])return o="@prefix "+r+": <"+l[r]+"> ."+o,c.loadTurtle(o,s,a,l,u)}u&&u(e)}else if(null===t)try{c.insert(c.rdf.createGraph(d),s,function(e){if(e)u&&u(e);else if(h.length)try{c.insert(c.rdf.createGraph(h),s,function(e){e?u&&u(e):u&&u(null)})}catch(e){u&&u(e)}else u&&u(null)})}catch(e){u&&u(e)}else n=t,("BlankNode"===(t=c.rdf.createTriple(p(n.subject),p(n.predicate),p(n.object))).subject.interfaceName||"BlankNode"===t.object.interfaceName?h:d).push(t)})},RDFModel.Graph.prototype.toNTBeatify=function(t){var e,i="",n={},r=(this.forEach(function(e){i+=e.toNTBeatify(t,n)}),"");for(e in n)r=r+"@prefix "+e+": <"+n[e]+">. \r\n";return r+"\r\n"+i},RDFModel.NamedNode.prototype.toNTBeatify=function(e,t){var i,n=this.toString();for(i in e){var r=e[i];if(0<r.length&&n.startsWith(r))return t[i]=r,n.replace(r,i+":")}return"<"+n+">"},RDFModel.BlankNode.prototype.toNTBeatify=function(){return this.toNT()},RDFModel.Literal.prototype.toNTBeatify=function(){return this.toNT()},RDFModel.Triple.prototype.toNTBeatify=function(e,t){var i=this.subject.toNTBeatify(e,t),n=this.predicate.toNTBeatify(e,t);return i+" "+(n="rdf:type"===n?"a":n)+" "+this.object.toNTBeatify(e,t)+" . \r\n"},String.prototype.format=function(){var i=arguments;return this.replace(/{(\d+)}/g,function(e,t){return void 0!==i[t]?i[t]:e})},!function(p){window.RDFE||(window.RDFE={}),RDFE.IO={},p.ajaxSetup({cache:!1}),RDFE.IO.createIO=function(e,t){var i="http",n={};if("string"==typeof e?(i=e,n=t):"object"==typeof e&&(n=e).type&&(i=n.type),"sparql"===i)return new RDFE.IO.SPARQL(n);if("gsp"===i)return new RDFE.IO.GSP(n);if("ldp"===i||"webdav"===i||"dav"===i)return new RDFE.IO.LDP(n);if("http"===i)return new RDFE.IO.HTTP(n);throw"Unsupport IO type: "+i};function f(e,t){return p.extend({},t,e)}function l(e,t,i){e.clear(t,i=i||n)}var g,m,v,e,n=function(){};function t(){}RDFE.IO.Base=(t.inherit=function(e){function t(){}return t.prototype=this.prototype,e.prototype=new t,(e.prototype.constructor=e).super=this,e},t.prototype.baseExec=function(r,o){var s=this,e=(p(document).ajaxError(o.ajaxError),p(document).ajaxSuccess(o.ajaxSuccess),r.headers=r.headers||{},o.noWebIDTLS||(r.headers["WebID-TLS"]="true"),o.username&&(r.headers.Authorization="Basic "+btoa(o.username+":"+o.password),r=p.extend({withCredentials:!0},r)),o.authFunction&&RDFE.Utils.getUrlBase(r.url)===RDFE.Utils.getUrlBase(window.location.href)&&(r.headers["X-Requested-With"]="XMLHttpRequest"),r=p.extend({crossDomain:!0,cache:!0},r),s.options.ioTimeout&&(r=p.extend({timeout:s.options.ioTimeout},r)),p.jStorage.get("rdfe:settings",{}));e.userID&&(r.headers["On-Behalf-Of"]=e.userID),RDFE.Utils.getProtocol(r.url)!==document.location.protocol&&"https:"===document.location.protocol?o&&o.error&&o.error({httpCode:"",message:"Mixed Content Error: This request has been blocked; the content must be served over HTTPS"}):p.ajax(r).done(function(e,t,i){o&&o.success&&o.success(e,t,i)}).fail(function(e,t,i){if(o&&o.error){var n={httpCode:e.status,message:e.statusText};if(this.crossDomain&&"error"===n.message&&0===e.status)n.message="CORS Error: "+("sparql"!==s.type?r.url:"The document")+" failed to load - this could be related to missing CORS settings on the server.";else{if((400===e.status&&"sparql"===s.type||401===e.status||403===e.status)&&o.authFunction)return void o.authFunction(r.url,function(e){o.username=e.username,o.password=e.password,s.baseExec(r,o)},function(){n="Error: "+e.status+" - "+e.statusText+("sparql"!==s.type?" ("+r.url+")":""),o.error(n,i,t,e)});"timeout"===t&&(n={httpCode:t,message:"Timeout Error: Failed to load "+("sparql"!==s.type?r.url:"document")})}o.error(n,i,t,e)}})},t.prototype.acceptParameter=function(e){return(e&&e.accept?e:this.options).accept},t.prototype.rerieveLoadCallback=function(e,t,i,n,r){e?t.error&&t.error(e):t.__success&&t.__success(i,n,r)},t),RDFE.IO.SPARQL=(e=RDFE.IO.Base.inherit(function(e){this.constructor.super.call(this);var t={sparqlEndpoint:window.location.protocol+"//"+window.location.host+"/sparql"};this.options=p.extend({},t,e),this.options.sparqlEndpoint&&0!==this.options.sparqlEndpoint.length||(this.options.sparqlEndpoint=t.sparqlEndpoint)}),g="<{0}> <{1}> {2}",m="INSERT DATA { GRAPH <{0}> { {1} } }",v="DELETE DATA { GRAPH <{0}> { {1} } }",e.prototype.retrieve=function(e,t,i){t=f(t,this.options),i&&(t.ajaxError=null,t.ajaxSuccess=null),this.exec("CONSTRUCT { ?s ?p ?o } WHERE { GRAPH <{0}> {?s ?p ?o } }".format(e),t)},e.prototype.retrieveToStore=function(e,r,o,s){var a=this;(s=f(s,a.options)).__success=s.success,s.success=function(t,i,n){l(r,o,function(){r.load("text/turtle",t,o,function(e){a.rerieveLoadCallback(e,s,t,i,n)})})},a.retrieve(e,s,!0)},e.prototype.insert=function(e,t,i,n,r){r=f(r,this.options),this.exec(m.format(e,g.format(t,i,n)),r)},e.prototype.insertFromStore=function(l,e,t,u){var c=this;u=f(u,c.options),e.graph(t,function(e,a){e?u.error&&u.error(a):(a=a.toArray(),u.__success=u.success,u.success=function(e,t){function o(e){if(e<a.length){for(var t="",i=" \n",n=e;n<e+s&&n<a.length;n++){var r=[n];t+=i+g.format(r.subject,r.predicate,r.object.toNT()),i=" .\n"}t||o(e+s),t=m.format(l,t),u.success=function(){o(e+s)},c.exec(t,p.extend({method:"POST"},u))}else u.success=u.__success,u.__success=null,u.success&&u.success()}var s=u.chunkSize||400;o(0)},c.clear(l,u))})},e.prototype.insertFromPatch=function(a,l,u){function c(e){if(e<l.length){for(var t="",i=e;i<e+h&&i<l.length;i++){var n="",r="\n",o=l[i].triples;if(o.length){for(var s=0;s<o.length;s++)n+=r+g.format(o[s].subject,o[s].predicate,o[s].object.toNT()),r=" .\n";t+=" \n"+(n=("added"===l[i].event?m:v).format(a,n))}}t||c(e+h),u.success=function(){c(e+h)},d.exec(t,p.extend({method:"POST"},u))}else u.success=u.__success,u.__success=null,u.success&&u.success()}var d=this,h=(u=f(u,d.options)).chunkSize||400;u.__success=u.success,u.success=null,c(0)},e.prototype.delete=function(e,t,i,n,r){r=f(r,this.options),this.exec(v.format(e,g.format(t,i,n)),r)},e.prototype.clear=function(e,t,i){t=f(t,this.options),i&&(t.ajaxError=null,t.ajaxSuccess=null),this.exec("CLEAR GRAPH <{0}>".format(e),t)},e.prototype.exec=function(e,t){e={url:t.sparqlEndpoint,type:t.method||"GET",data:{query:e,format:t.format},dataType:"text"};return this.baseExec(e,t)},e),RDFE.IO.GSP=((e=RDFE.IO.Base.inherit(function(e){console.log("GSP");this.constructor.super.call(this);var t={contentType:"application/octet-stream",processData:!1,gspEndpoint:window.location.protocol+"//"+window.location.host+"/sparql-graph-crud"};this.options=p.extend({},t,e),this.options.gspEndpoint&&0!==this.options.gspEndpoint.length||(this.options.gspEndpoint=t.gspEndpoint)})).prototype.retrieve=function(e,t,i){t=f(t,this.options),i&&(t.ajaxError=null,t.ajaxSuccess=null),this.exec("GET",e,null,t)},e.prototype.retrieveToStore=function(e,r,o,s){var a=this;(s=f(s,a.options)).__success=s.success,s.success=function(t,i,n){l(r,o,function(){r.loadTurtle(t,o,e,null,function(e){a.rerieveLoadCallback(e,s,t,i,n)})})},this.retrieve(e,s,!0)},e.prototype.insert=function(e,t,i){i=f(i,this.options),this.exec("PUT",e,t,i)},e.prototype.insertFromStore=function(n,e,t,r){var o=this;r=f(r,o.options),e.graph(t,function(e,i){e?r.error&&r.error(e):(r.__success=r.success,r.success=function(e,t){r.success=r.__success,o.insert(n,i.toNT(),r)},o.clear(n,r,!0))})},e.prototype.update=function(e,t,i){i=f(i,this.options),this.exec("POST",e,t,i)},e.prototype.delete=function(e,t,i){t=f(t,this.options),i&&(t.ajaxError=null,t.ajaxSuccess=null),this.exec("DELETE",e,null,t)},e.prototype.clear=e.prototype.delete,e.prototype.exec=function(e,t,i,n){t={url:n.gspEndpoint+"?graph="+encodeURIComponent(t),type:e,contentType:n.contentType,processData:n.processData,data:i,dataType:"text"};return this.baseExec(t,n)},e),RDFE.IO.LDP=((e=RDFE.IO.Base.inherit(function(e){this.constructor.super.call(this);this.options=p.extend({},{dataType:"text"},e)})).prototype.retrieve=function(e,t,i){t=f(t,this.options),i&&(t.ajaxError=null,t.ajaxSuccess=null);i={};"webdav"!=this.type&&(i={Accept:"text/turtle, */*;q=0.1"}),this.exec("GET",e,i,null,t)},e.prototype.retrieveToStore=function(e,r,o,s){var a=this;(s=f(s,a.options)).__success=s.success,s.success=function(t,i,n){l(r,o,function(){r.load("text/turtle",t,o,function(e){a.rerieveLoadCallback(e,s,t,i,n)})})},a.retrieve(e,s,!0)},e.prototype.insert=function(e,t,i){var n;i=f(i,this.options),"webdav"!==this.type&&(n={"Content-Type":"text/turtle"}),this.exec("PUT",e,n,t,i)},e.prototype.insertFromStore=function(i,n,e,r){var o=this;r=f(r,o.options),n.graph(e,function(e,t){e?r.error&&r.error(e):(e=t.toNTBeatify(n.rdf.prefixes),t.toNT(),o.insert(i,e,r))})},e.prototype.insertFromPatch=function(a,l,u){function c(e){if(e<l.length){for(var t="",i=e;i<e+h&&i<l.length;i++){var n="",r="\n",o=l[i].triples;if(o.length){for(var s=0;s<o.length;s++)n+=r+"<{0}> <{1}> {2}".format(o[s].subject,o[s].predicate,o[s].object.toNT()),r=" .\n";t+=" \n"+(n=("added"===l[i].event?"INSERT DATA { {0} }":"DELETE DATA { {0} }").format(n))}}t||c(e+h),u.success=function(){c(e+h)},d.exec("PATCH",a,{"Content-Type":"application/sparql-update"},t,u)}else u.success=u.__success,u.__success=null,u.success&&u.success()}var d=this,h=(u=f(u,d.options)).chunkSize||400;u.__success=u.success,u.success=null,c(0)},e.prototype.update=function(e,t,i,n,r,o){o=f(o,this.options);t="INSERT DATA {GRAPH <{0}> { <{1}> <{2}> {3} . }}".format(t,i,n,r);this.exec("PATCH",e,{"Content-Type":"application/sparql-update"},t,o)},e.prototype.delete=function(e,t){t=f(t,this.options),this.exec("DELETE",e,null,null,t)},e.prototype.clear=e.prototype.delete,e.prototype.exec=function(e,t,i,n,r){t={url:t,type:e,headers:i,contentType:r.contentType||"text/turtle",processData:!1,data:n,dataType:r.dataType};return this.baseExec(t,r)},e),RDFE.IO.HTTP=((e=RDFE.IO.Base.inherit(function(e){this.constructor.super.call(this);var t={dataType:"text",httpTemplate:"{0}",httpProxyTemplate:document.location.protocol+"//"+document.location.host+"/proxy?url={0}&output-format=turtle&force=rdf"};this.options=p.extend({},t,e),this.options.httpTemplate&&0!==this.options.httpTemplate.length||(this.options.httpTemplate=t.httpTemplate),this.options.httpProxyTemplate&&0!==this.options.httpProxyTemplate.length||(this.options.httpProxyTemplate=t.httpProxyTemplate)})).prototype.retrieve=function(e,t){var e=t.proxy?this.options.httpProxyTemplate.format(encodeURIComponent(e)):this.options.httpTemplate.format(e),i=(i=this.acceptParameter())||"text/turtle; q=1, text/n3; q=0.9, application/ld+json; q=0.7, application/rdf+xml; q=0.6";return this.baseExec({url:e,type:"GET",dataType:"text",beforeSend:function(e){e.setRequestHeader("Accept",i)}},t)},e.prototype.retrieveToStore=function(e,r,o,t){var s,a=this,e=(t.__success=t.success,t.success=(s=t,function(t,i,n){var e=(n.getResponseHeader("content-type")||"").split(";")[0];r.load(e,t,o,function(e){a.rerieveLoadCallback(e,s,t,i,n)})}),t.proxy?a.options.httpProxyTemplate.format(encodeURIComponent(e)):a.options.httpTemplate.format(e)),i=(i=a.acceptParameter())||"text/turtle; q=1, text/n3; q=0.9, application/ld+json; q=0.7, application/rdf+xml; q=0.6";return a.baseExec({url:e,type:"GET",dataType:"text",beforeSend:function(e){e.setRequestHeader("Accept",i)}},t)},e)}(jQuery),!function(h){function e(e){this.url=e||"",e&&(this.path=decodeURIComponent(RDFE.Utils.splitUrl(e).path),this.host=RDFE.Utils.splitUrl(e).host,this.name=this.path.match(/([^\/]+)\/?$/),this.name&&1<this.name.length?this.name=this.name[1]:this.name=this.url),this.options={}}var a,t;function r(e,t){function i(e,t){for(var i=[],n=e.getElementsByTagName("*"),r=0;r<n.length;r++)n[r].localName!==t&&n[r].baseName!==t||i.push(n[r]);return i}function n(e,t){return(e=i(e,t)).length?h(e[0]).text():null}for(var r=RDFE.Utils.getUrlBase(e),o=[],s=!1,a=i(t,"response"),l=0;l<a.length;l++){var u=null,c=a[l],d=i(c,"href");d.length&&((d=r+h(d[0]).text())!==e?(c=i(c,"propstat")).length&&(c=i(c[0],"prop")).length&&(i(c[0],"collection").length?u=new RDFE.IO.WebDavFolder(d):(u=new RDFE.IO.File(d),(d=n(c[0],"getcontentlength"))&&(u.size=parseInt(h(d[0]).text())),u.dirty=!1,u.ioType="dav"),(d=n(c[0],"creationdate"))&&(u.creationDate=new Date(d)),(d=n(c[0],"getlastmodified"))&&(u.modificationDate=new Date(d)),(d=n(c[0],"virtpermissions"))&&(u.permissions=d),(d=n(c[0],"virtowneruid"))&&(u.uid=d),(d=n(c[0],"virtownergid"))&&(u.gid=d),(d=n(c[0],"getcontenttype"))&&(u.contentType=d),o.push(u)):s=!0)}return 0!==o.length||s?o:null}function c(r,o,s,a){r.registerDefaultNamespace("rdfs","http://www.w3.org/2000/01/rdf-schema#"),r.registerDefaultNamespace("posix","http://www.w3.org/ns/posix/stat#"),r.registerDefaultNamespace("ldp","http://www.w3.org/ns/ldp#");function l(e){for(var t=0;t<u.length;t++)if(u[t].url==e)return 1}var u=[];r.execute(" select distinct ?s ?mtime ?contains   from <urn:default>    where {            ?s a ?t .            FILTER(str(?t) = 'http://www.w3.org/ns/posix/stat#Directory' || str(?t) = 'http://www.w3.org/ns/ldp#Container' || str(?t) = 'http://www.w3.org/ns/ldp#BasicContainer') .            optional { ?s posix:mtime ?mtime }            optional { ?s ldp:contains ?contains }          }  order by asc(?s)",function(e,t){if(e)a("Failed to query LDP the container at "+o+".");else{for(var i,n=0;n<t.length;n++)t[n].contains||((i=t[n].s.value).startsWith("http")||(i=o+i),l(i))||i!=o&&(i=new RDFE.IO.LDPFolder(i),t[n].mtime&&(i.modificationDate=new Date(1e3*t[n].mtime.value)),u.push(i));r.execute(" select distinct ?s ?size ?mtime    from <urn:default>    where {            ?s a ?t .           FILTER (str(?t) = 'http://www.w3.org/ns/posix/stat#File' || str(?t) = 'http://www.w3.org/2000/01/rdf-schema#Resource' || str(?t) = 'http://www.w3.org/ns/ldp#Resource') .            FILTER (str(?t) != 'http://www.w3.org/ns/posix/stat#Directory' && str(?t) != 'http://www.w3.org/ns/ldp#Container' && str(?t) != 'http://www.w3.org/ns/ldp#BasicContainer') .            optional { ?s posix:size ?size . } .            optional { ?s posix:mtime ?mtime . }          }  order by asc(?s)",function(e,t){if(e)a("Failed to query LDP the container at "+o+".");else{for(var i=0;i<t.length;i++){var n=t[i].s.value;n.startsWith("http")||(n=o+n),l(n)||(n=new RDFE.IO.File(n),t[i].mtime&&(n.modificationDate=new Date(1e3*t[i].mtime.value)),t[i].size&&(n.size=t[i].size.value),n.dirty=!1,n.ioType="ldp",u.push(n))}s(u)}})}})}window.RDFE||(window.RDFE={}),RDFE.IO||(RDFE.IO={}),RDFE.IO.Resource=(e.inherit=function(e){function t(){}return t.prototype=this.prototype,e.prototype=new t,(e.prototype.constructor=e).super=this,e.inherit=this.inherit,e},e.prototype.isFolder=function(){return"folder"===this.type},e.prototype.isFile=function(){return"file"===this.type},e.prototype.getOption=function(e){return this.options[e]||(this.parent?this.parent.getOption(e):void 0)},e.prototype.standardAjaxHeaders=function(e){var t=this.getOption("username");return e=e||{},t&&(e.Authorization="Basic "+btoa(t+":"+this.getOption("password"))),e},e),RDFE.IO.File=RDFE.IO.Resource.inherit(function(e,t){this.constructor.super.call(this,e),this.type="file",this.dirty=!0;this.options=h.extend({},{},t)}),RDFE.IO.Folder=((t=RDFE.IO.Resource.inherit(function(e,t){RDFE.IO.Resource.call(this,e),this.type="folder",this.dirty=!0,this.rootUrl=this.url,this.children=[];this.options=h.extend({},{},t)})).prototype.update=function(e,t,i){var n=this,r=e,o=t,s=i;"function"==typeof r&&(s=o,o=r,r=!1),r||this.dirty?this.listDir(function(){h(n.children).each(function(){this.rootUrl=n.rootUrl,this.parent=n}),n.dirty=!1,o&&o(n)},function(e,t){401!==t&&403!==t||!n.options.authFunction?s&&s(n,e,t):n.options.authFunction(n.url,function(e){n.options.username=e.username,n.options.password=e.password,n.update(r,o,s)},function(){s&&s(n,e,t)})}):o(n)},t.prototype.listDir=function(e){e()},a={sort:"name",foldersFirst:!0,sortOrder:"asc"},t.prototype.getChildren=function(e){for(var i=h.extend({},a,e),t=[],n=[],r=0;r<this.children.length;r++)"folder"!==i.type&&"file"===this.children[r].type||"file"!==i.type&&!i.foldersFirst?t.push(this.children[r]):"file"!==i.type&&n.push(this.children[r]);function o(e,t){return s?e[i.sort]>t[i.sort]:e[i.sort]<t[i.sort]}var s="desc"===i.sortOrder.toLowerCase();return i.sort&&(t.sort(o),n.sort(o)),h.merge(n,t)},t),RDFE.IO.WebDavFolder=((t=RDFE.IO.Folder.inherit(function(e,t){this.constructor.super.call(this,e);this.ioType="webdav",this.options=h.extend({},{},t)})).prototype.listDir=function(t,i){var n=this,e=this.standardAjaxHeaders();e.Depth=1,h.ajax({url:this.url,method:"PROPFIND",contentType:"text/xml",data:'<?xml version="1.0" encoding="utf-8" ?><propfind xmlns="DAV:">  <prop>    <creationdate />    <getlastmodified />    <href />    <resourcetype />    <getcontentlength />    <getcontenttype />    <virtpermissions xmlns="http://www.openlinksw.com/virtuoso/webdav/1.0/" />    <virtowneruid xmlns="http://www.openlinksw.com/virtuoso/webdav/1.0/" />    <virtownergid xmlns="http://www.openlinksw.com/virtuoso/webdav/1.0/" />  </prop></propfind>',dataType:"xml",headers:e}).done(function(e){n.children=r(n.url,e),n.children?t():i('Failed to parse WebDAV result for "'+n.url+'".',200)}).fail(function(e){i(RDFE.IO.ajaxFailMessage(e,'Failed to list WebDAV folder for "{0}"',n.url),e.status)})},t),RDFE.IO.LDPFolder=((t=RDFE.IO.Folder.inherit(function(e,t){this.constructor.super.call(this,e),this.ioType="ldp";this.options=h.extend({},{},t)})).prototype.listDir=function(a,l){var u=this;h.ajax({url:u.url,headers:u.standardAjaxHeaders({Accept:"text/turtle"})}).done(function(i,e,t){var n=!1,r=t.getResponseHeader("Link");if(r)for(var o=r.split(","),s=0;s<o.length;s++)if(0<=o[s].replace(/ /g,"").toLowerCase().indexOf('rel="type"')&&0<=o[s].indexOf("http://www.w3.org/ns/ldp#BasicContainer")){n=!0;break}n?t.getResponseHeader("Content-Type").indexOf("turtle")<0?l("The LDP container at "+u.url+" does not return Turtle content."):rdfstore.create(function(e,t){t.load("text/turtle",i,"urn:default",function(){c(t,u.url,function(e){u.children=e,a&&a()},l)})}):l("Only LDP Basic containers are supported at the moment.")}).fail(function(e){l&&l(RDFE.IO.ajaxFailMessage(e,'Failed to fetch turtle content from "{0}"',u.url),e.status)})},t),RDFE.IO.openUrl=function(o,e,t,i){var s=t,a=i,l=e,r=("function"==typeof e&&(a=s,s=l,l=void 0),new RDFE.IO.LDPFolder(o,l));r.update(function(){s(r)},function(e,t,i){var n;401===i||403===i?a(t,i):(n=new RDFE.IO.WebDavFolder(o,r.options)).update(function(){s(n)},function(r,e,t){l&&l.checkForFiles?h.ajax({url:o,headers:r.standardAjaxHeaders()}).done(function(e,t,i){var n=new RDFE.IO.File(o,r.options);n.content=e,n.contentType=i.getResponseHeader("Content-Type"),n.size=parseInt(i.getResponseHeader("Content-Length")),n.dirty=!1,n.ioType="http",s(n)}).fail(function(e){a&&a(RDFE.IO.ajaxFailMessage(e,'Failed to get "{0}"',o),e.status)}):a&&a(e,t)})})},RDFE.IO.ajaxFailMessage=function(e,t,i){return"error"===e.statusText&&RDFE.Utils.extractDomain(i)!==window.location.hostname?t.format(i)+" - this could be related to missing CORS settings on the server.":t.format(i)+". "+e.status+" - "+(e.responseText||e.statusText)}}(jQuery),window.RDFE||(window.RDFE={}),RDFE.Config=function(e,t,n){var i,r=this;this.options=RDFE.Config.defaults,e&&$.ajax({url:e,type:"GET",dataType:"json",success:(i=t,function(e){var t=RDFE.Utils.uriParams();r.options=$.extend(r.options,e),r.options.ontology=$.extend(RDFE.Config.defaults.ontology,e.ontology),"EAV"!==t.uiMode&&"SPO"!==t.uiMode||(r.options.namingSchema=t.uiMode),r.options.labelProps&&0!=r.options.labelProps.length||(r.options.labelProps=RDFE.Config.defaults.labelProps),i&&i(r)}),error:function(e,t,i){console.error("config load =>",i),n&&n()}})},RDFE.Config.defaults={ontology:{proxy:!1,nonTTLProxy:!0,fresnelLenses:!0,fresnelFormats:!0,fresnelGroups:!0,forceLoad:!1,preloadOnly:!1},bookmarks:[],actions:["new","open","save","saveAs","bookmarks","entities","triples"],labelProps:["http://www.w3.org/2004/02/skos/core#prefLabel","http://www.w3.org/2000/01/rdf-schema#"],sparqlEndpoint:window.location.protocol+"//"+window.location.host+"/sparql",gspEndpoint:window.location.protocol+"//"+window.location.host+"/sparql-graph-crud",prefixes:{},entityUriTmpl:"{DOC-URI}#{NAME}",autoInverseOfHandling:!1,entityTypesFiler:null,defaultView:"statements",namingSchema:"EAV",EAV:{spo:["Statement","Statements"],s:["Entity","Entities"],p:["Attribute","Attributes"],o:["Value","Values"]},SPO:{spo:["Triple","Triples"],s:["Subject","Subjects"],p:["Predicate","Predicates"],o:["Object","Objects"]},useEntityEditor:!1,maxLabelLength:0,pageSettings:{pageNo:1,pageSize:10}},window.RDFE||(window.RDFE={}),RDFE.RdfNode=function(e,t,i,n){this.type=e,this.value=t,this.datatype=i,this.language=n},RDFE.RdfNode.prototype.toStoreNode=function(e){return"uri"==this.type?e.rdf.createNamedNode(this.value):e.rdf.createLiteral(this.value,this.language,this.datatype)},RDFE.RdfNode.prototype.toString=function(){return this.value},RDFE.RdfNode.fromStoreNode=function(e){if("string"==typeof e)return new RDFE.RdfNode("uri",e);if("number"==typeof e)return new RDFE.RdfNode("literal",e);if(e instanceof RDFE.RdfNode)return e;if(e.token)return new RDFE.RdfNode(e.token,e.value,e.type,e.lang);if(e.interfaceName){var t;if("NamedNode"===e.interfaceName)t="uri";else{if("Literal"!==e.interfaceName)throw"Blank nodes cannot be converted into RDFE.RdfNode values.";t="literal"}return new RDFE.RdfNode(t,e.nominalValue,e.datatype,e.language)}if(e.uri)return new RDFE.RdfNode("uri",e.uri);throw"Unsupported node type for RDFE.RdfNode conversion."},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0==this.indexOf(e)}),window.RDFE||(window.RDFE={}),RDFE.prefixes={},RDFE.prefixes.adms="http://www.w3.org/ns/adms#",RDFE.prefixes.annotation="http://www.w3.org/2000/10/annotation-ns#",RDFE.prefixes.atom="http://atomowl.org/ontologies/atomrdf#",RDFE.prefixes.bibo="http://purl.org/ontology/bibo/",RDFE.prefixes.book="http://purl.org/NET/book/vocab#",RDFE.prefixes.cc="http://web.resource.org/cc/",RDFE.prefixes.cert="http://www.w3.org/ns/auth/cert#",RDFE.prefixes.dataview="http://www.w3.org/2003/g/data-view#",RDFE.prefixes.dbpedia="http://dbpedia.org/resource/",RDFE.prefixes.dc="http://purl.org/dc/elements/1.1/",RDFE.prefixes.dcam="http://purl.org/dc/dcam/",RDFE.prefixes.dcterms="http://purl.org/dc/terms/",RDFE.prefixes.dctype="http://purl.org/dc/dcmitype/",RDFE.prefixes.doap="http://usefulinc.com/ns/doap#",RDFE.prefixes.foaf="http://xmlns.com/foaf/0.1/",RDFE.prefixes.fresnel="http://www.w3.org/2004/09/fresnel#",RDFE.prefixes.geo="http://www.w3.org/2003/01/geo/wgs84_pos#",RDFE.prefixes.gr="http://purl.org/goodrelations/v1#",RDFE.prefixes.gso="http://www.w3.org/ns/adms#",RDFE.prefixes.ibis="http://purl.org/ibis#",RDFE.prefixes.ical="http://www.w3.org/2002/12/cal/icaltzd#",RDFE.prefixes.like="http://ontologi.es/like#",RDFE.prefixes.mo="http://purl.org/ontology/mo/",RDFE.prefixes.owl="http://www.w3.org/2002/07/owl#",RDFE.prefixes.rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#",RDFE.prefixes.rdfs="http://www.w3.org/2000/01/rdf-schema#",RDFE.prefixes.rev="http://purl.org/stuff/rev#",RDFE.prefixes.rss="http://purl.org/rss/1.0/",RDFE.prefixes.schema="http://schema.org/",RDFE.prefixes.scot="http://scot-project.org/scot/ns",RDFE.prefixes.sioc="http://rdfs.org/sioc/ns#",RDFE.prefixes.sioct="http://rdfs.org/sioc/types#",RDFE.prefixes.skos="http://www.w3.org/2004/02/skos/core#",RDFE.prefixes.vcard="http://www.w3.org/2006/vcard/ns#",RDFE.prefixes.void="http://rdfs.org/ns/void#",RDFE.prefixes.vs="http://www.w3.org/2003/06/sw-vocab-status/ns#",RDFE.prefixes.wot="http://xmlns.com/wot/0.1/",RDFE.prefixes.wdrs="http://www.w3.org/2007/05/powder-s#",RDFE.prefixes.ws="http://www.w3.org/ns/pim/space#",RDFE.prefixes.xhtml="http://www.w3.org/1999/xhtml",RDFE.prefixes.xsd="http://www.w3.org/2001/XMLSchema#",RDFE.coalesce=function(){for(var e=0;e<arguments.length;e++)if(null!=arguments[e])return arguments[e]},RDFE.uriPrefix=function(e){var t=Math.max(e.lastIndexOf(":"),e.lastIndexOf("/"),e.lastIndexOf("#"));return-1!=t&&t==e.lastIndexOf(":")?e.substring(0,t):null},RDFE.uriLabel=function(e){var t=Math.max(e.lastIndexOf(":"),e.lastIndexOf("/"),e.lastIndexOf("#"));return-1==t?e:t!=e.length-1?e.substring(t+1):null},RDFE.isUriPrefix=function(e){return-1==Math.max(e.lastIndexOf(":"),e.lastIndexOf("/"),e.lastIndexOf("#"))},RDFE.uriOntology=function(e){var t;return e&&-1!=(t=Math.max(e.lastIndexOf(":"),e.lastIndexOf("/"),e.lastIndexOf("#")))?e.substring(0,t+1):null},RDFE.isBlankNode=function(e){return _.isString(e)?!!e.match(/^\_\:*/):!(!_.isObject(e)||!e.URI)&&RDFE.isBlankNode(e.URI)},RDFE.ontologyByPrefix=function(t,i){var e=location.protocol+"//prefix.cc/{0}.file.json".format(t);return $.ajax({url:e,type:"GET",async:!!i}).done(function(e){RDFE.prefixes[t]=e[t],i&&i(e[t])}),RDFE.prefixes[t]},RDFE.prefixByOntology=function(o,s){o=RDFE.Utils.trim(o,"#");var e="https://lov.linkeddata.es/dataset/lov/api/v2/vocabulary/autocomplete?q="+encodeURIComponent(o);$.ajax({url:e,type:"GET",dataType:"json",async:!!s}).done(function(e){for(var t=e.results,i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.uri.length;r++)if(RDFE.Utils.trim(n.uri[r],"#")===o)return void(s&&s(n.prefix[r]))})},RDFE.schema2ontology_range=function(e){var t=e;return"http://schema.org/Boolean"===e||"http://schema.org/Date"===e?t="http://www.w3.org/2001/XMLSchema#boolean":"http://schema.org/DateTime"===e||"http://schema.org/Time"===e?t="http://www.w3.org/2001/XMLSchema#datetime":"http://schema.org/Number"===e?t="http://www.w3.org/2001/XMLSchema#decimal":"http://schema.org/Float"===e?t="http://www.w3.org/2001/XMLSchema#float":"http://schema.org/Integer"===e?t="http://www.w3.org/2001/XMLSchema#integer":"http://schema.org/Text"!==e&&"http://schema.org/URL"!==e||(t="http://www.w3.org/2001/XMLSchema#string"),t},RDFE.OntologyManager=function(e){this.config=e||{},this.options=$.extend(RDFE.Config.defaults.ontology,this.config.ontology),this.reset(),this.prefixes=$.extend({},RDFE.prefixes,this.config.prefixes)},RDFE.OntologyManager.prototype.init=function(e){var r=this,e=(this.reset(),$.extend({},e)),o=r.options.preloadOntologies||[],s=function(i,e){var n,t;i<o.length?(n=o[i],t={success:(t=function(e,t){return function(){$(r).trigger(t,[r,n]),s(i+1,e)}})(e,"loadingFinished"),error:t(e,"loadingFailed")},$(r).trigger("loading",[r,n]),r.parseOntologyFile(n,t)):e.success&&e.success()};s(0,e)},RDFE.OntologyManager.prototype.reset=function(e){this.ontologies={},this.ontologyClasses={},this.ontologyProperties={},this.individuals={},this.fresnelLenses={}},RDFE.OntologyManager.prototype.prefixByOntology=function(e){for(var t in this.prefixes)if(this.prefixes[t]===e)return t;return null},RDFE.OntologyManager.prototype.uriDenormalize=function(e){var t=RDFE.uriPrefix(e);return t&&(this.prefixes[t]||RDFE.ontologyByPrefix(t),this.prefixes[t])?this.prefixes[t]+e.substring(t.length+1):e},RDFE.OntologyManager.prototype.uriNormalize=function(e,t){var i=RDFE.uriOntology(e);if(i)for(var n in this.prefixes)if(this.prefixes[n]==i)return n+":"+e.substring(i.length);return t},RDFE.OntologyManager.prototype.ontologiesAsArray=function(){return _.values(this.ontologies)},RDFE.OntologyManager.prototype.ontologyByURI=function(e,t){var i=this.ontologies[e];return i||!0!==t||(i=new RDFE.Ontology(this,e),this.ontologies[e]=i),i},RDFE.OntologyManager.prototype.ontologyByPrefix=function(e){return this.ontologies[this.prefixes[e]]},RDFE.OntologyManager.prototype.ontologyRemove=function(e){var t=this.ontologyByURI(e);if(t){delete this.ontologies[e];for(var i=t.classesAsArray(),n=0;n<i.length;n++)this.ontologyClassRemove(i[n].URI);for(var r=t.allProperties(),n=0;n<r.length;n++)this.ontologyPropertyRemove(r[n].URI);$(this).trigger("changed",[this])}},RDFE.OntologyManager.prototype.ontologyClassRemove=function(e){delete this.ontologyClasses[e]},RDFE.OntologyManager.prototype.ontologyPropertyRemove=function(e){delete this.ontologyProperties[e]},RDFE.OntologyManager.prototype.ontologyClassByURI=function(e,t){var i=this.ontologyClasses[e];return i||!0!==t||(this.ontologyClasses[e]=i=new RDFE.OntologyClass(this,e),i.ontology=this.ontologyByURI(RDFE.uriOntology(e),!0),i.ontology.classes[e]=i),i},RDFE.OntologyManager.prototype.ontologyPropertyByURI=function(e,t){var i=this.ontologyProperties[e];return i||!0!==t||(i=new RDFE.OntologyProperty(this,e),(this.ontologyProperties[e]=i).ontology=this.ontologyByURI(RDFE.uriOntology(e),!0),i.ontology.properties[e]=i),i},RDFE.OntologyManager.prototype.individualByURI=function(e){return this.individuals[e]},RDFE.OntologyManager.prototype.suportedContentTypes=function(e){return!!this.suportedTurtleTypes(e)||!!this.suportedRDFTypes(e)||!!this.suportedJSONTypes(e)},RDFE.OntologyManager.prototype.suportedTurtleTypes=function(e){return-1!=e.indexOf("text/turtle")||-1!=e.indexOf("application/turtle")||-1!=e.indexOf("application/x-turtle")||-1!=e.indexOf("application/trig")||-1!=e.indexOf("application/n-triples")||-1!=e.indexOf("application/n-quads")||-1!=e.indexOf("text/n3")},RDFE.OntologyManager.prototype.suportedRDFTypes=function(e){return-1!=e.indexOf("application/rdf+xml")||-1!=e.indexOf("text/rdf")},RDFE.OntologyManager.prototype.suportedJSONTypes=function(e){return-1!=e.indexOf("application/ld+json")||-1!=e.indexOf("application/json")},RDFE.OntologyManager.prototype.load=function(r,o){var s=this,e=o.ioType||"http",a=RDFE.Utils.getProtocol(r),t={},l=(s.options.nonTTLProxyUrl&&(t.httpProxyTemplate=s.options.nonTTLProxyUrl[document.location.protocol]),RDFE.IO.createIO(e,t)),t=(l.type=e,o.__success=o.success,o.success=function(e,t,i){if(("http:"===a||"https:"===a)&&s.options.nonTTLProxy&&s.options.proxy!==s.options.nonTTLProxy){var n=(i.getResponseHeader("content-type")||"").split(";")[0];if(!s.suportedContentTypes(n))return void l.retrieve(r,$.extend({proxy:s.options.nonTTLProxy},o))}o.__success&&o.__success(e,t,i)},o.__error=o.error,o.error=function(e,t,i,n){404===n.status||"http:"!==a&&"https:"!==a||!s.options.nonTTLProxy||s.options.proxy===s.options.nonTTLProxy?o.__error&&o.__error(e,t,i,n):(o.error=o.__error,l.retrieve(r,$.extend({proxy:s.options.nonTTLProxy},o)))},o=$.extend({noWebIDTLS:!0},o),a!==document.location.protocol&&"https:"===document.location.protocol||s.options.proxy);l.retrieve(r,$.extend({proxy:t},o))},RDFE.OntologyManager.prototype.parseOntologyFile=function(e,l){var d=this,u=RDFE.Utils.getProtocol(e),h={},p={},f={},g={},c={},m={};function v(e){return N3.Util.isBlank(e)?null:d.ontologyClassByURI(e,!0)}function y(e){return N3.Util.isBlank(e)?null:d.ontologyPropertyByURI(e,!0)}function b(e){return m[e]=m[e]||new RDFE.FresnelLens(d,e)}var w=function(e,t){var i;(i=(i=(i=d.ontologyProperties[e])||((i=(i=d.ontologyClasses[e])||d.ontologies[e])||d.individuals[e]))||m[e])?i.label=i.label||t:h[e]=t},x=function(e,t){var i;(i=(i=(i=d.ontologyProperties[e])||((i=(i=d.ontologyClasses[e])||d.ontologies[e])||d.individuals[e]))||m[e])?i.comment=i.comment||t:p[e]=t};function k(e){for(var t=[],i=e;i;)var n=c[i],i=n?(n.first&&t.push(n.first),n.rest):null;return t}var C=function(e){var t,i,n,r,o=e.subject,s=e.predicate,e=e.object;if("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===s){switch(e){case"http://www.w3.org/2002/07/owl#ObjectProperty":case"http://www.w3.org/2002/07/owl#DatatypeProperty":case"http://www.w3.org/1999/02/22-rdf-syntax-ns#Property":y(o);break;case"http://www.w3.org/2000/01/rdf-schema#Class":case"http://www.w3.org/2002/07/owl#Class":v(o);break;case"http://www.w3.org/2002/07/owl#Restriction":f[o]=f[o]||{};break;case"http://www.openlinksw.com/ontology/oplowl#AggregateRestriction":f[o]=f[o]||{},f[o].isAggregate=!0;break;case"http://www.openlinksw.com/ontology/oplowl#UniqueIdRestriction":f[o]=f[o]||{},f[o].isUniqueId=!0;break;case"http://www.w3.org/2004/09/fresnel#Lens":b(o)}a=o;var a=d.individuals[a]=d.individuals[a]||new RDFE.OntologyIndividual(d,a),l=v(e);(a.type=l).individuals[o]=a}else"http://www.w3.org/2000/01/rdf-schema#label"===s?w(o,N3.Util.getLiteralValue(e)):"http://www.w3.org/2000/01/rdf-schema#comment"===s?x(o,N3.Util.getLiteralValue(e)):"http://www.w3.org/2000/01/rdf-schema#subClassOf"===s?(i=v(o),N3.Util.isBlank(e)?(n=g[o]=g[o]||[]).push(e):(t=v(e),i.subClassOf.push(t),t.superClassOf.push(i))):"http://www.w3.org/2000/01/rdf-schema#subPropertyOf"===s?(t=y(e),(i=y(o)).subPropertyOf.push(t),t.superPropertyOf.push(i)):"http://www.w3.org/2000/01/rdf-schema#domain"===s||"http://schema.org/domainIncludes"===s?(r=y(o),N3.Util.isBlank(e)?r.domain.push(e):r.domain.push(v(e))):"http://www.w3.org/2000/01/rdf-schema#range"===s?(r=y(o)).range.push(e):"http://schema.org/rangeIncludes"===s?(r=y(o),n=RDFE.schema2ontology_range(e),r.range.push(n)):"http://www.w3.org/2002/07/owl#onProperty"===s?((n=f[o]=f[o]||{}).onProperty=n.onProperty||[]).push(e):"http://www.w3.org/2002/07/owl#cardinality"===s||"http://www.w3.org/2002/07/owl#maxCardinality"===s||"http://www.w3.org/2002/07/owl#minCardinality"===s||"http://www.openlinksw.com/ontology/oplowl#hasCustomLabel"===s||"http://www.openlinksw.com/ontology/oplowl#hasCustomComment"===s?(n=f[o]=f[o]||{})[RDFE.uriLabel(s)]=N3.Util.getLiteralValue(e):"http://www.w3.org/1999/02/22-rdf-syntax-ns#first"===s||"http://www.w3.org/1999/02/22-rdf-syntax-ns#rest"===s?"http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"!==e&&((r=c[o]=c[o]||{})[RDFE.uriLabel(s)]=e):"http://www.w3.org/2002/07/owl#unionOf"===s?c[o]={rest:e}:"http://www.w3.org/2004/09/fresnel#showProperties"!==s&&"http://www.w3.org/2004/09/fresnel#hideProperties"!==s&&"http://www.w3.org/2004/09/fresnel#classLensDomain"!==s||(b(o)[RDFE.uriLabel(s)]=e)},E=function(){for(var e in d.ontologyClasses){var t=d.ontologyClasses[e],i=(t.label=t.label||h[e],t.comment=t.comment||p[e],delete h[e],delete p[e],g[e]);if(i){for(var n=0;n<i.length;n++){for(var r=f[i[n]],o=_.clone(r),s=0;s<r.onProperty.length;s++)t.restrictions[r.onProperty[s]]=o;delete o.onProperty}delete g[e]}}for(var e in d.ontologyProperties){(c=d.ontologyProperties[e]).label=c.label||h[e],c.comment=c.comment||p[e],delete h[e],delete p[e];var a=_.clone(c.range);c.range=[];for(n=0;n<a.length;n++)N3.Util.isBlank(a[n])?c.range=_.union(c.range,k(a[n])):c.range.push(a[n]);var l=_.clone(c.domain);c.domain=[];for(n=0;n<l.length;n++)!l[n].URI&&N3.Util.isBlank(l[n])?c.domain=_.union(c.domain,k(l[n])):c.domain.push(l[n])}for(e in m)(c=m[e]).label=c.label||h[e],c.comment=c.comment||p[e],delete h[e],delete p[e],c.showProperties=k(c.showProperties),c.hideProperties=k(c.hideProperties),(d.fresnelLenses[e]=c).classLensDomain&&(v(c.classLensDomain).fresnelLens=c);for(e in d.ontologies){var u=d.ontologies[e];u.label=u.label||h[e]||h[e.substring(0,e.length-1)],u.comment=u.comment||p[e]||p[e.substring(0,e.length-1)],delete h[e],delete p[e]}for(e in d.individuals){var c;(c=d.individuals[e]).label=c.label||h[e],c.comment=c.comment||p[e],delete h[e],delete p[e]}$(d).trigger("changed",[d])},t={ioType:l.ioType,success:function(e,t,i){function n(e,a){try{var t=JSON.parse(e);jsonld.normalize(t,{},function(e,t){if(e)a.error&&a.error({message:"JSON-LD parse error. "+e.message});else{function i(e){return"blank node"===e.type||"IRI"===e.type?e.value:"literal"===e.type?'"'+e.value+'"':void 0}for(var n in t)for(var r=t[n],o=0;o<r.length;o++){var s={subject:i(r[o].subject),predicate:i(r[o].predicate),object:i(r[o].object)};C(s)}E(),a.success&&a.success()}})}catch(e){a.error&&a.error({message:"JSON parse error. "+e.message})}}var r,o,s,i=(i.getResponseHeader("content-type")||"").split(";")[0];if(d.suportedTurtleTypes(i="text/plain"===i&&"http:"!==u&&"https:"!==u?"text/turtle":i))a=null,-1!=i.indexOf("text/n3")&&(a={format:"text/n3"}),r=e,a=a,o=l,N3.Parser(a).parse(r,function(e,t){e?o.error&&o.error({message:"TTL parse error. "+e.message}):t?C(t):(E(),o.success&&o.success())});else if(d.suportedRDFTypes(i))s=l,RDFXMLParser.parser.parse(e,{},function(e,t){if(e)s.error&&s.error({message:"RDF parse error. "+e.message});else{for(var i=0;i<t.length;i++){var n={subject:t[i].subject.value,predicate:t[i].predicate.value,object:t[i].object.value||t[i].object.literal};C(n)}E(),s.success&&s.success()}});else{if(d.suportedJSONTypes(i))return n(e,l);var a="Only Turtle files can be parsed in the ontology manager.";console.error(a),l.error&&l.error({message:a})}},error:l.error};e.startsWith(RDFE.Utils.getUrlBase(e))||(e=RDFE.Utils.getUrl(e)),d.load(e,t)},RDFE.OntologyManager.prototype.findFresnelLens=function(e){e=this.ontologyClasses[e];return e?e.getFresnelLens():null},RDFE.OntologyManager.prototype.ontologyDetermine=function(e){var t=RDFE.uriPrefix(e),i=t?(i=this.ontologyByPrefix(t))?i.URI:RDFE.ontologyByPrefix(t):RDFE.uriOntology(e);return i},RDFE.OntologyManager.prototype.allOntologies=function(){return _.values(this.ontologies)},RDFE.OntologyManager.prototype.allClasses=function(){return _.values(this.ontologyClasses)},RDFE.OntologyManager.prototype.allProperties=function(e){var t,i=[];for(t in this.ontologyProperties){var n=this.ontologyProperties[t];e&&!n.domain.indexOf(e)||i.push(n)}return i},RDFE.OntologyManager.prototype.typesToLabel=function(e,i){var n=this;return _.uniq(_.map(e,function(e){var t=n.ontologyClassByURI(e),t=t?t.label:RDFE.Utils.uri2name(e);return i?'<a href="'+e+'">'+t+"</a>":t})).join(", ")},RDFE.Ontology=function(e,t,i,n){var r=this;if(i&&e.prefixes[i]===t)return null;r.options=$.extend({},n),r.URI=t,r.classes={},r.properties={},r.manager=e,(r.manager.ontologies[t]=r).prefix=i||e.prefixByOntology(t),r.prefix||RDFE.prefixByOntology(t,function(e){e&&!r.manager.prefixes[e]&&(r.manager.prefixes[e]=t,r.prefix=e,r.manager.prefixes[e]=t),$(r.manager).trigger("changed",[r.manager])})},RDFE.Ontology.prototype.classesAsArray=function(){return _.values(this.classes)},RDFE.Ontology.prototype.classesLength=function(){return this.classesAsArray().length},RDFE.Ontology.prototype.ontologyClassByURI=function(e){return this.classes[e]},RDFE.Ontology.prototype.propertyByURI=function(e){return this.properties[e]},RDFE.Ontology.prototype.propertiesLength=function(){return _.values(this.properties).length},RDFE.Ontology.prototype.allProperties=function(e){var t,i=[];for(t in this.properties){var n=this.properties[t];e&&!n.domain.indexOf(e)||i.push(n)}return i},RDFE.OntologyClass=function(e,t){this.URI=t,this.curi=e.uriNormalize(t),this.name=RDFE.Utils.uri2name(t),this.subClassOf=[],this.superClassOf=[],this.disjointWith=[],this.properties={},this.individuals={},this.restrictions={},this.manager=e},RDFE.OntologyClass.prototype.propertiesAsArray=function(){var e,t=[];for(e in this.properties)t.push(this.properties[e]);return t},RDFE.OntologyClass.prototype.maxCardinalityForProperty=function(e,t){var i=this.restrictions[e],n=null;if(i&&(n=i.cardinality||i.maxCardinality))return n;i=this.manager.ontologyPropertyByURI(e);if(i)for(var r=i.getSuperProperties(),o=0;o<r.length;o++){var s=this.restrictions[r[o].URI];if(s&&(n=s.cardinality||s.maxCardinality))return n}for(o=0;o<this.subClassOf.length;o++){var a=this.subClassOf[o];if($.inArray(a.URI,t)<0){if((t=t||[]).push(a.URI),n=a.maxCardinalityForProperty(e,t))return n}else console.log("CAUTION: Found sub-class loop in ",t)}return null},RDFE.OntologyClass.prototype.isAggregateProperty=function(e,t){var i=this.restrictions[e];if(i&&i.isAggregate)return!0;for(var n=0;n<this.subClassOf.length;n++){var r=this.subClassOf[n];if($.inArray(r.URI,t)<0){if((t=t||[]).push(r.URI),r.isAggregateProperty(e,t))return!0}else console.log("CAUTION: Found sub-class loop in ",t)}return!1},RDFE.OntologyClass.prototype.getSubClasses=function(e,t,i){if(t=t||[],t=_.union(t,this.superClassOf),!1!==e){(i=i||[]).push(this.URI);for(var n=0;n<this.superClassOf.length;n++){var r=this.superClassOf[n];$.inArray(r.URI,i)<0&&r.getSubClasses(e,t,i)}}return t},RDFE.OntologyClass.prototype.getSuperClasses=function(e,t,i){if(t=t||[],t=_.union(t,this.subClassOf),!1!==e){(i=i||[]).push(this.URI);for(var n=0;n<this.subClassOf.length;n++){var r=this.subClassOf[n];$.inArray(r.URI,i)<0&&r.getSuperClasses(e,t,i)}}return t},RDFE.OntologyClass.prototype.getUniqueRestrictions=function(){var e=[];if(this.restrictions)for(var t in this.restrictions)!0===this.restrictions[t].isUniqueId&&e.push(this.manager.ontologyPropertyByURI(t));return e},RDFE.OntologyClass.prototype.getIndividuals=function(e){var t=this.individuals;if(e)for(var i=this.getSubClasses(!0),n=0;n<i.length;n++)t=_.union(t,i[n].individuals);return t},RDFE.OntologyClass.prototype.getFresnelLens=function(){var e=this.fresnelLens;if(!e)for(var t=this.getSuperClasses(!0),i=0;i<t.length;i++)if(e=t[i].fresnelLens)return e;return e},RDFE.OntologyProperty=function(e,t){this.URI=t,this.curi=e.uriNormalize(t),this.name=RDFE.Utils.uri2name(t),this.subPropertyOf=[],this.superPropertyOf=[],this.domain=[],this.range=[],this.manager=e,this.manager.ontologyProperties[t]=this},RDFE.OntologyProperty.prototype.hasDomain=function(e){if(this.domain)for(var t=0;t<this.domain.length;t++)if(e==this.domain[t])return!0;return!1},RDFE.OntologyProperty.prototype.getRange=function(e){var t=this.range;if(!_.isEmpty(t))return t;for(var i=0;i<this.subPropertyOf.length;i++){var n=this.subPropertyOf[i];if($.inArray(n.URI,e)<0){if((e=e||[]).push(n.URI),t=n.getRange(e),!_.isEmpty(t))return t}else console.log("CAUTION: Found sub-property loop in ",e)}},RDFE.OntologyProperty.prototype.getSuperProperties=function(e,t,i){if(t=t||[],t=_.union(t,this.subPropertyOf),!1!==e){(i=i||[]).push(this.URI);for(var n=0;n<this.subPropertyOf.length;n++){var r=this.subPropertyOf[n];$.inArray(r.URI,i)<0&&r.getSuperProperties(e,t,i)}}return t},RDFE.OntologyIndividual=function(e,t,i){this.URI=t,this.curi=e.uriNormalize(t),this.name=RDFE.Utils.uri2name(t),this.manager=e,this.manager.individuals[t]=this},RDFE.FresnelLens=function(e,t){this.URI=t,this.manager=e,this.showProperties=[],this.hideProperties=[]},window.RDFE||(window.RDFE={}),"<{0}> <{1}> {2}"),SPARQL_INSERT="INSERT DATA { GRAPH <{0}> { {1} } }",SPARQL_DELETE="DELETE DATA { GRAPH <{0}> { {1} } }";RDFE.Document=function(e,i){var n=this;n.ontologyManager=e.ontologyManager,n.config=e.config,n.documentTree=e.documentTree,n.graph="urn:graph:default",n.dirty=!1,n.clearLog(),rdfstore.create(function(e,t){e||(n.store=t,n.store.registerDefaultNamespace("skos","http://www.w3.org/2004/02/skos/core#"),n.store.subscribe(null,null,null,n.graph,function(e,t){n.updateLog(e,t)}),i&&i(n))})},RDFE.Document.prototype.setChanged=function(e){this.dirty=e,this.dirty&&$(this).trigger("changed",this),$(this).trigger("docChanged",this)},RDFE.Document.prototype.clearLog=function(e,t){this.saveLog=[],this.editLog=[],this.editLogIndex=0,this.editLogEnabled=!0,this.undoIsDisabled(),this.redoIsDisabled()},RDFE.Document.prototype.updateLog=function(e,t){var i=this;!i.editLogEnabled||"added"!==e&&"deleted"!==e||(i.editLog.length=i.editLogIndex,16<=i.editLog.length&&(i.editLog=i.editLog.slice(-15)),i.editLog.push({event:e,triples:t}),i.editLogIndex=i.editLog.length),i.undoIsDisabled(),i.redoIsDisabled(),"sparql"!==i.io.type&&"ldp"!==i.io.type||i.saveLog.push({event:e,triples:t})},RDFE.Document.prototype.importLog=function(i,n){var r=this,o="urn:graph:log";r.store.clear(o,function(e,t){e&&fail||r.store.load(i,n,o,function(e,t){e&&fail||r.store.graph(o,function(e,t){e||r.updateLog("added",t.triples),r.store.clear(o,function(){})})})})},RDFE.Document.prototype.undoIsDisabled=function(){this.undoDisabled=this.editLogIndex&&this.editLogIndex<=this.editLog.length},RDFE.Document.prototype.undoLog=function(i,n){var r=this;if(!r.undoIsDisabled()){var e=r.editLog[r.editLogIndex-1];if(r.editLogIndex--,e.triples.length){for(var t="",o=" \n",s=0;s<e.triples.length;s++)t+=o+SPARQL_TRIPLE.format(e.triples[s].subject,e.triples[s].predicate,e.triples[s].object.toNT()),o=" .\n";t=("added"===e.event?SPARQL_DELETE:SPARQL_INSERT).format(r.graph,t),r.editLogEnabled=!1,r.store.execute(t,function(e,t){r.editLogEnabled=!0,r.setChanged(!1),!e&&i?i(t):e&&n&&n(e)})}}},RDFE.Document.prototype.redoIsDisabled=function(){this.redoDisabled=this.editLog.length&&this.editLogIndex<this.editLog.length},RDFE.Document.prototype.redoLog=function(i,n){var r=this;if(!r.redoIsDisabled()){var e=r.editLog[r.editLogIndex];if(r.editLogIndex++,e.triples.length){for(var t="",o=" \n",s=0;s<e.triples.length;s++)t+=o+SPARQL_TRIPLE.format(e.triples[s].subject,e.triples[s].predicate,e.triples[s].object.toNT()),o=" .\n";t=("added"===e.event?SPARQL_INSERT:SPARQL_DELETE).format(r.graph,t),r.editLogEnabled=!1,r.store.execute(t,function(e,t){r.editLogEnabled=!0,r.setChanged(!1),!e&&i?i(t):e&&n&&n(e)})}}},RDFE.Document.prototype.load=function(n,r,o,e){function t(e,t,i){s.url=n,s.io=r,s.clearLog(),s.setChanged(!1),e.length&&s.documentTree.addRecentDoc(s.url,s.io.type),s.srcParams={length:e.length,md5:$.md5(e)},o&&o()}var s=this;s.url=null;s.store.clear(function(){r.retrieveToStore(n,s.store,s.graph,{success:t,error:e})})},RDFE.Document.prototype.verifyData=function(i){if(!this.config.options.validateEmptyNodes)return i&&i(),!0;var e="select * from <"+this.graph+"> where {{ <> ?p ?o } union { ?s2 ?p2 <> }}";this.store.execute(e,function(e,t){return e?(i&&i(e),!1):0<t.length?(i&&i(new Error("The document is not valid. It contains empty URI nodes.")),!1):(i&&i(),!0)})},RDFE.Document.prototype.save=function(t,i,n,r){var o=this;t?(i.insertFromStore||((i=RDFE.IO.createIO("webdav",i.options)).type="webdav"),o.verifyData(function(e){e?r&&r(e):(e=function(){o.url=t,o.io=i,o.clearLog(),o.saveLog=[],o.setChanged(!1),o.documentTree.addRecentDoc(o.url,o.io.type),i.retrieve(o.url,{success:function(e,t,i){o.srcParams={length:e.length,md5:$.md5(e)}},error:function(){o.srcParams=null}}),n&&n()},o.url&&o.url===t&&i.insertFromPatch&&("sparql"===o.io.type||"ldp"===o.io.type)&&o.io.type==i.type?(o.saveLog.length||n(),i.insertFromPatch(t,o.saveLog,{success:e,error:r})):i.insertFromStore(t,o.store,o.graph,{success:e,error:r}))})):r&&r("No document loaded")},RDFE.Document.prototype.new=function(t,i){var n=this;n.url=null,n.io=null,n.srcParams=null,n.signature=null,n.clearLog(),n.store.clear(n.graph,function(e){e?i&&i(e):(n.setChanged(!1),t&&t())})},RDFE.Document.prototype.import=function(e,t,r,o){var s=this;"function"==typeof t&&(o=r,r=t,t=null),"application/ld+json"===t?s.importJSON(e,r,o):"application/rdf+xml"===t?s.importRDF(e,r,o):"text/turtle"===t?s.importTurtle(e,r,o):s.importTurtle(e,r,function(n){s.importJSON(e,r,function(i){s.importRDF(e,r,function(e){var t=new Error;t.name="SyntaxError",t.message="Checked with following parsers:<br /> <b>TTL</b>: "+RDFE.Utils.escapeXml(n.message)+"<br /><b>JSON-LD</b>: "+RDFE.Utils.escapeXml(i.message)+"<br /><b>RDF</b>: "+RDFE.Utils.escapeXml(e.message),o(t)})})})},RDFE.Document.prototype.importTurtle=function(r,o,s){var a=this;a.store.load("text/turtle",r,a.graph,function(e,t){if(e){if(e.message.startsWith("Undefined prefix")){var i=e.message.indexOf('"'),i=(n=e.message.substring(i+1)).indexOf('"'),n=n.substring(0,i-1),i=a.ontologyManager.prefixes[n];if(i)return r="@prefix {0}: <{1}> .".format(n,i)+r,a.importTurtle(r,o,s)}s&&s(e)}else o&&(a.importLog("text/turtle",r),o(t))})},RDFE.Document.prototype.importJSON=function(i,n,r){var o=this;o.store.load("application/ld+json",i,o.graph,function(e,t){!e&&n?(o.importLog("application/ld+json",i),n(t)):e&&r&&r(e)})},RDFE.Document.prototype.importRDF=function(i,n,r){var o=this;try{$.parseXML(i),o.store.load("application/rdf+xml",i,o.graph,function(e,t){!e&&n?(o.importLog("application/rdf+xml",i),n(t)):e&&r&&r(e)})}catch(e){r({message:"RDF syntax error!"})}},RDFE.Document.prototype.deleteBySubject=function(e,i,n){var t,r=this;r.config.options.autoInverseOfHandling?(t="construct { <{1}> ?p ?o } from <{0}> where { <{1}> ?p ?o. } ".format(r.graph,e),r.store.execute(t,function(e,t){e?n&&n(e):r.deleteTriples(t.triples,i,n)})):(t="with <{0}> delete { <{1}> ?p ?o } where { <{1}> ?p ?o }".format(r.graph,e),r.store.execute(t,function(e,t){!e&&i?i():e&&n&&n(e)}))},RDFE.Document.prototype.deleteByPredicate=function(e,i,n){var t,r=this;r.config.options.autoInverseOfHandling?(t="construct { ?s <{1}> ?o} from <{0}> where { ?s <{1}> ?o . } ".format(r.graph,e),r.store.execute(t,function(e,t){e?n&&n(e):r.deleteTriples(t.triples,i,n)})):(t="with <{0}> delete { ?s <{1}> ?o} where { ?s <{1}> ?o . }".format(r.graph,e),r.store.execute(t,function(e,t){!e&&i?i():e&&n&&n(e)}))},RDFE.Document.prototype.deleteByObjectIRI=function(e,i,n){var t,r=this;r.config.options.autoInverseOfHandling?(t="construct { ?s ?p <{1}> } from <{0}> where { ?s ?p <{1}> . } ".format(r.graph,e),r.store.execute(t,function(e,t){e?n&&n(e):r.deleteTriples(t.triples,i,n)})):(t="with <{0}> delete { ?s ?p <{1}> } where { ?s ?p <{1}> . }".format(r.graph,e),r.store.execute(t,function(e,t){!e&&i?i():e&&n&&n(e)}))},RDFE.Document.prototype.deleteByObject=function(e,i,n){var r=this,e="Literal"===e.interfaceName?'construct { ?s ?p ?o } from <{0}> where { ?s ?p ?o. FILTER (str(?o) = "{1}"). } '.format(r.graph,"http://www.w3.org/2001/XMLSchema#dateTime"==e.datatype?new Date(e.nominalValue).toString():e.nominalValue):"construct { ?s ?p <{1}> } from <{0}> where { ?s ?p <{1}> . } ".format(r.graph,e.toString());r.store.execute(e,function(e,t){e?n&&n(e):r.deleteTriples(t.triples,i,n)})},RDFE.Document.prototype.deleteEntity=function(e,t,i){var n=this;e?n.deleteBySubject(e,function(){n.deleteByObjectIRI(e,t,i)},i):i&&i("Need Entity URI for deletion.")},RDFE.Document.prototype.deleteEntities=function(e,t,i){var n;(n=0)<e.length?this.deleteEntity(e[n],function(){delUri(n+1)},i):t()},RDFE.Document.prototype.deletePredicate=function(e,t,i){e?this.deleteByPredicate(e,t,i):i&&i("Need Predicate URI for deletion.")},RDFE.Document.prototype.deleteObject=function(e,t,i){e?this.deleteByObject(e,t,i):i&&i("Need object for deletion.")},RDFE.Document.prototype.checkTriple=function(i,n,r){this.store.node(i.subject.nominalValue,this.graph,function(e,t){e?r&&r(!1):n&&(e=t.match(null,i.predicate,i.object),n(0<e.triples.length))})},RDFE.Document.prototype.addTriples=function(e,i,n,r){var o=this,s=_.isArray(e)?e:[e];_.isEmpty(s)?i&&i():o.store.insert(o.store.rdf.createGraph(s),o.graph,function(e,t){e?n&&n():!0!==o.config.options.autoInverseOfHandling||r||(e=o.inverseTriples(s),_.isEmpty(e))?(o.setChanged(!0),i&&i()):o.addTriples(e,i,n,!0)})},RDFE.Document.prototype.addTriple=RDFE.Document.prototype.addTriples,RDFE.Document.prototype.deleteTriples=function(e,i,n,r){var o=this,s=_.isArray(e)?e:[e];_.isEmpty(s)?i&&i():o.store.delete(o.store.rdf.createGraph(s),o.graph,function(e,t){e?n&&n(e):(o.setChanged(!0),!0!==o.config.options.autoInverseOfHandling||r||(e=o.inverseTriples(s),_.isEmpty(e))?(o.setChanged(!0),i&&i()):o.deleteTriples(e,i,n,!0))})},RDFE.Document.prototype.deleteTriple=RDFE.Document.prototype.deleteTriples,RDFE.Document.prototype.updateTriple=function(e,t,i,n){var r=this;r.deleteTriple(e,function(){r.addTriple(t,function(){r.setChanged(!0),i&&i()},function(){n&&n("Adding new triple failed")})},function(){n&&n("Deleting triple failed")})},RDFE.Document.prototype.inverseTriple=function(e){var t=null,i=e.subject,n=e.object;return t="NamedNode"==i.interfaceName&&"NamedNode"==n.interfaceName&&(e=e.predicate,e=this.ontologyManager.ontologyPropertyByURI(e.nominalValue))&&(e=e.inverseOf)?this.store.rdf.createTriple(this.store.rdf.createNamedNode(n.nominalValue),this.store.rdf.createNamedNode(e.URI),this.store.rdf.createNamedNode(i.nominalValue)):t},RDFE.Document.prototype.inverseTriples=function(e){for(var t=[],i=0,n=e.length;i<n;i++){var r=this.inverseTriple(e[i]);r&&t.push(r)}return t},RDFE.Document.prototype.getEntityLabel=function(e,t,i){function r(i,n){n>=i.length?s(RDFE.Utils.uri2name(e),!1):o.store.execute("select ?l from <"+o.graph+"> where { <"+e+"> <"+i[n]+"> ?l . }",function(e,t){!e&&0<t.length&&0<t[0].l.value.length?s(t[0].l.value,!0):r(i,n+1)})}var o=this,n=t,s=i;"function"==typeof t&&(s=t,n=void 0);r(n||o.config.options.labelProps,0)},RDFE.Document.prototype.getEntity=function(s,a){var l=this;l.store.node(s,l.graph,function(e,t){var i={uri:s,label:RDFE.Utils.uri2name(s),types:[],properties:{}};if(!e){for(var n=t.triples,r=0;r<n.length;r++){var o=n[r].predicate.nominalValue;(i.properties[o]=i.properties[o]||[]).push(RDFE.RdfNode.fromStoreNode(n[r].object)),"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==o&&i.types.push(n[r].object.nominalValue)}for(r=0;r<l.config.options.labelProps.length;r++)if(i.properties[l.config.options.labelProps[r]]){i.label=i.properties[l.config.options.labelProps[r]][0].toString();break}}a(i)})},RDFE.Document.prototype.listProperties=function(r){this.store.execute("select distinct ?p from <"+this.graph+"> where { ?s ?p ?o }",function(e,t){var i=[];if(!e)for(var n=0;n<t.length;n++)i.push(t[n].p.value);r(i)})},RDFE.Document.prototype.listEntities=function(e,s,a){var l=this,t=("string"==typeof e&&(e=[e]),"select ?s ?p ?o from <{0}> where { ?s ?p ?o . ".format(l.graph));if(0<e.length){t+="?s a ?t . filter(";for(var i=0;i<e.length;i++)0<i&&(t+=" || "),t+='(str(?t) = "{0}")'.format(e[i]);t+=") . "}l.store.execute(t+="}",function(e,t){var i={};if(e)a&&a(e);else{for(var n=0;n<t.length;n++){var r=t[n].s.value,o=t[n].p.value,r=(i[r]||(i[r]={uri:r,types:[]}),i[r]);"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==o?r.types.push(t[n].o.value):0<=_.indexOf(l.config.options.labelProps,o)&&(r[o]=t[n].o.value)}for(i=_.values(i),n=0;n<i.length;n++)i[n].label=l.getEntityLabel(i[n])}s(i)})},RDFE.Document.prototype.itemsByRange=function(e){if(e){for(var t=0;t<e.length;t++){var i=this.ontologyManager.ontologyClassByURI(e[t]);if(i){for(var n=n||[],r=_.values(i.getIndividuals()),o=0;o<r.length;o++){var s=RDFE.RdfNode.fromStoreNode(r[o].URI);s.label=r[o].curi||r[o].URI,n.push(s)}this.listEntities(e[t],function(e){for(var t=0;t<e.length;t++){var i=RDFE.RdfNode.fromStoreNode(e[t].uri);i.label=e[t].label||e[t].uri,n.push(i)}})}}return n}},RDFE.Document.prototype.buildEntityUri=function(e){var n=this.config.options.entityUriTmpl,e=e||"entity",r=(0<=(n=(n=n&&0!=n.length?n:"urn:entities:{NAME}").replace("{DOC-URI}",this.url||"urn:entities:")).indexOf("{NAME}")?n=n.replace("{NAME}",encodeURIComponent(e)):("#"!=n[n.length-1]&&"/"!=n[n.length-1]&&":"!=n[n.length-1]&&(n+="#"),n+=encodeURIComponent(e)),n),t=this,o=function(i){t.store.node(r,t.graph,function(e,t){console.log(e,t),!e&&t.length&&(r=n+i,o(i+1))})};return o(1),r},RDFE.Document.prototype.addEntity=function(e,t,i,n,r){for(var o=this,s=(e&&0!=e.length||(e=o.buildEntityUri(t)),[o.store.rdf.createTriple(o.store.rdf.createNamedNode(e),o.store.rdf.createNamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),o.store.rdf.createNamedNode(i))]),a=(t&&0<t.length&&(a=o.ontologyManager.uriDenormalize(o.config.options.labelProps[0]),s.push(o.store.rdf.createTriple(o.store.rdf.createNamedNode(e),o.store.rdf.createNamedNode(a),o.store.rdf.createLiteral(t)))),o.ontologyManager.ontologyClassByURI(i)),l=a?a.getUniqueRestrictions():[],u=0;u<l.length;u++){var c=l[u],d=o.getUniqueValue(e,c);d&&s.push(o.store.rdf.createTriple(o.store.rdf.createNamedNode(e),o.store.rdf.createNamedNode(c.URI),o.store.rdf.createLiteral(d.toString(),null,c.range)))}o.addTriples(s,function(){n&&n({uri:e,label:t})},function(){r&&r()})},RDFE.Document.prototype.listSubjects=function(s,a){var l=this;l.store.graph(l.graph,function(e,t){if(e)a&&a(e);else{for(var i={},n=t.toArray(),r=0;r<n.length;r+=1){var o=n[r].subject.toString();i[o]||(i[o]=l.newSubject(o)),i[o].items.push(n[r])}i=_.values(i),s(i)}})},RDFE.Document.prototype.getSubject=function(o,s,a){var l=this;l.store.graph(l.graph,function(e,t){if(e)a&&a(e);else{for(var i=l.newSubject(o),n=t.toArray(),r=0;r<n.length;r+=1)n[r].subject.toString()===o&&i.items.push(n[r]);s&&s(i)}})},RDFE.Document.prototype.newSubject=function(e){return{uri:e,items:[]}},RDFE.Document.prototype.listPredicates=function(s,a){var l=this;l.store.graph(l.graph,function(e,t){if(e)a&&a(e);else{for(var i={},n=t.toArray(),r=0;r<n.length;r+=1){var o=n[r].predicate.toString();i[o]||(i[o]=l.newPredicate(o)),i[o].items.push(n[r])}i=_.values(i),s(i)}})},RDFE.Document.prototype.getPredicate=function(o,s,a){var l=this;l.store.graph(l.graph,function(e,t){if(e)a&&a(e);else{for(var i=l.newPredicate(o),n=t.toArray(),r=0;r<n.length;r+=1)n[r].predicate.toString()===o&&i.items.push(n[r]);s&&s(i)}})},RDFE.Document.prototype.newPredicate=function(e){return{uri:e,items:[]}},RDFE.Document.prototype.listObjects=function(a,l){var u=this;u.store.graph(u.graph,function(e,t){if(e)l&&l(e);else{for(var i={},n=t.toArray(),r=0;r<n.length;r+=1){var o=n[r].object,s=u.formatObjectID(o);i[s]||(i[s]=u.newObject(o)),i[s].items.push(n[r])}i=_.values(i),a(i)}})},RDFE.Document.prototype.getObject=function(o,s,a){var l=this;l.store.graph(l.graph,function(e,t){if(e)a&&a(e);else{for(var i=l.newObject(o),n=t.toArray(),r=0;r<n.length;r+=1)l.formatObjectID(n[r].object)===i.id&&i.items.push(n[r]);s&&s(i)}})},RDFE.Document.prototype.newObject=function(e){return"string"==typeof e&&(e=new RDFE.RdfNode("literal",e)),{id:this.formatObjectID(e),label:this.formatObjectLabel(e),type:this.formatObjectType(e),object:e,items:[]}},RDFE.Document.prototype.formatObjectID=function(e){var t;return"Literal"==e.interfaceName?(t="http://www.w3.org/2001/XMLSchema#dateTime"==e.datatype?new Date(e.nominalValue).toString():e.nominalValue,(e.datatype||"literal")+" - "+t):e.toString()},RDFE.Document.prototype.formatObjectLabel=function(e){return"Literal"===e.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==e.datatype?new Date(e.nominalValue).toString():e.nominalValue:e.toString()},RDFE.Document.prototype.formatObjectType=function(e){return"Literal"===e.interfaceName?e.datatype||"http://www.w3.org/2000/01/rdf-schema#Literal":"IRI"},RDFE.Document.prototype.getEntityLabel=function(e){for(var t=0;t<this.config.options.labelProps.length;t++)if(e[this.config.options.labelProps[t]])return e[this.config.options.labelProps[t]];return RDFE.Utils.uri2name(e.uri)},RDFE.Document.prototype.getUniqueValue=function(){var t=["http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#string"],o=["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#byte","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#unsignedByte","http://www.w3.org/2001/XMLSchema#positiveInteger"];return function(i,n){var r,e=n.range;return-1!==t.indexOf(e)?r=i:-1!==o.indexOf(e)&&(r=1,e="select (MAX(?v) as ?mv) from <{0}> where {?s <{1}> ?v}".format(this.graph,n.URI),this.store.execute(e,function(e,t){e?console.log("Failed to determine unique value for ",i," and ",n.URI,t):0!==t.length&&(r=parseInt(RDFE.coalesce(t[0].mv.value,0)),isNaN(r)&&(r=0),r++)})),r}}(),RDFE.Document.prototype.checkForSignature=function(i){var n=this,e=(n.store.registerDefaultNamespace("rdfs","http://www.w3.org/2000/01/rdf-schema#"),n.store.registerDefaultNamespace("cert","http://www.w3.org/ns/auth/cert#"),n.store.registerDefaultNamespace("oplcert","http://www.openlinksw.com/schemas/cert#"),"SELECT ?signatureDocURI        FROM <{0}>        WHERE {                <{1}> oplcert:hasSignature ?signatureDocURI .              }".format(n.graph,n.url));n.store.execute(e,function(e,t){!e&&t.length?n.signature=t[0].signatureDocURI.value:n.signature=null,i&&i(n.signature)})},!function(e,t){"function"==typeof define&&define.amd?define("sifter",t):"object"==typeof exports?module.exports=t():e.Sifter=t()}(this,function(){function e(e,t){this.items=e,this.settings=t||{diacritics:!0}}e.prototype.tokenize=function(e){if(!(e=a(String(e||"").toLowerCase()))||!e.length)return[];for(var t,i,n=[],r=e.split(/ +/),o=0,s=r.length;o<s;o++){if(t=l(r[o]),this.settings.diacritics)for(i in u)u.hasOwnProperty(i)&&(t=t.replace(new RegExp(i,"g"),u[i]));n.push({string:r[o],regex:new RegExp(t,"i")})}return n},e.prototype.iterator=function(e,t){var i=s(e)?Array.prototype.forEach||function(e){for(var t=0,i=this.length;t<i;t++)e(this[t],t,this)}:function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t,this)};i.apply(e,[t])},e.prototype.getScoreFunction=function(e,t){function r(e,t){var i;return!e||-1===(i=(e=String(e||"")).search(t.regex))?0:(t=t.string.length/e.length,0===i&&(t+=.5),t)}var o,s=(e=this.prepareSearch(e,t)).tokens,a=e.options.fields,l=s.length,u=e.options.nesting,c=(o=a.length)?1===o?function(e,t){return r(f(t,a[0],u),e)}:function(e,t){for(var i=0,n=0;i<o;i++)n+=r(f(t,a[i],u),e);return n/o}:function(){return 0};return l?1===l?function(e){return c(s[0],e)}:"and"===e.options.conjunction?function(e){for(var t,i=0,n=0;i<l;i++){if((t=c(s[i],e))<=0)return 0;n+=t}return n/l}:function(e){for(var t=0,i=0;t<l;t++)i+=c(s[t],e);return i/l}:function(){return 0}},e.prototype.getSortFunction=function(e,i){var t,n,r,o,s,a,l,u=this,c=!(e=u.prepareSearch(e,i)).query&&i.sort_empty||i.sort,d=function(e,t){return"$score"===e?t.score:f(u.items[t.id],e,i.nesting)},h=[];if(c)for(t=0,n=c.length;t<n;t++)!e.query&&"$score"===c[t].field||h.push(c[t]);if(e.query){for(l=!0,t=0,n=h.length;t<n;t++)if("$score"===h[t].field){l=!1;break}l&&h.unshift({field:"$score",direction:"desc"})}else for(t=0,n=h.length;t<n;t++)if("$score"===h[t].field){h.splice(t,1);break}for(a=[],t=0,n=h.length;t<n;t++)a.push("desc"===h[t].direction?-1:1);return(o=h.length)?1===o?(r=h[0].field,s=a[0],function(e,t){return s*p(d(r,e),d(r,t))}):function(e,t){for(var i,n=0;n<o;n++)if(i=h[n].field,i=a[n]*p(d(i,e),d(i,t)))return i;return 0}:null},e.prototype.prepareSearch=function(e,t){var i,n,r;return"object"==typeof e?e:(i=(t=o({},t)).fields,n=t.sort,r=t.sort_empty,i&&!s(i)&&(t.fields=[i]),n&&!s(n)&&(t.sort=[n]),r&&!s(r)&&(t.sort_empty=[r]),{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]})},e.prototype.search=function(e,i){var n,r,o=this.prepareSearch(e,i);return i=o.options,e=o.query,r=i.score||this.getScoreFunction(o),e.length?this.iterator(this.items,function(e,t){n=r(e),(!1===i.filter||0<n)&&o.items.push({score:n,id:t})}):this.iterator(this.items,function(e,t){o.items.push({score:1,id:t})}),(e=this.getSortFunction(o,i))&&o.items.sort(e),o.total=o.items.length,"number"==typeof i.limit&&(o.items=o.items.slice(0,i.limit)),o};var p=function(e,t){return"number"==typeof e&&"number"==typeof t?t<e?1:e<t?-1:0:(e=i(String(e||"")),(t=i(String(t||"")))<e?1:e<t?-1:0)},o=function(e,t){for(var i,n,r=1,o=arguments.length;r<o;r++)if(n=arguments[r])for(i in n)n.hasOwnProperty(i)&&(e[i]=n[i]);return e},f=function(e,t,i){if(e&&t){if(!i)return e[t];for(var n=t.split(".");n.length&&(e=e[n.shift()]););return e}},a=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")},l=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||"undefined"!=typeof $&&$.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u={a:"[aḀḁĂăÂâǍǎȺⱥȦȧẠạÄäÀàÁáĀāÃãÅåąĄÃąĄ]",b:"[b␢βΒB฿𐌁ᛒ]",c:"[cĆćĈĉČčĊċC̄c̄ÇçḈḉȻȼƇƈɕᴄＣｃ]",d:"[dĎďḊḋḐḑḌḍḒḓḎḏĐđD̦d̦ƉɖƊɗƋƌᵭᶁᶑȡᴅＤｄð]",e:"[eÉéÈèÊêḘḙĚěĔĕẼẽḚḛẺẻĖėËëĒēȨȩĘęᶒɆɇȄȅẾếỀềỄễỂểḜḝḖḗḔḕȆȇẸẹỆệⱸᴇＥｅɘǝƏƐε]",f:"[fƑƒḞḟ]",g:"[gɢ₲ǤǥĜĝĞğĢģƓɠĠġ]",h:"[hĤĥĦħḨḩẖẖḤḥḢḣɦʰǶƕ]",i:"[iÍíÌìĬĭÎîǏǐÏïḮḯĨĩĮįĪīỈỉȈȉȊȋỊịḬḭƗɨɨ̆ᵻᶖİiIıɪＩｉ]",j:"[jȷĴĵɈɉʝɟʲ]",k:"[kƘƙꝀꝁḰḱǨǩḲḳḴḵκϰ₭]",l:"[lŁłĽľĻļĹĺḶḷḸḹḼḽḺḻĿŀȽƚⱠⱡⱢɫɬᶅɭȴʟＬｌ]",n:"[nŃńǸǹŇňÑñṄṅŅņṆṇṊṋṈṉN̈n̈ƝɲȠƞᵰᶇɳȵɴＮｎŊŋ]",o:"[oØøÖöÓóÒòÔôǑǒŐőŎŏȮȯỌọƟɵƠơỎỏŌōÕõǪǫȌȍՕօ]",p:"[pṔṕṖṗⱣᵽƤƥᵱ]",q:"[qꝖꝗʠɊɋꝘꝙq̃]",r:"[rŔŕɌɍŘřŖŗṘṙȐȑȒȓṚṛⱤɽ]",s:"[sŚśṠṡṢṣꞨꞩŜŝŠšŞşȘșS̈s̈]",t:"[tŤťṪṫŢţṬṭƮʈȚțṰṱṮṯƬƭ]",u:"[uŬŭɄʉỤụÜüÚúÙùÛûǓǔŰűŬŭƯưỦủŪūŨũŲųȔȕ∪]",v:"[vṼṽṾṿƲʋꝞꝟⱱʋ]",w:"[wẂẃẀẁŴŵẄẅẆẇẈẉ]",x:"[xẌẍẊẋχ]",y:"[yÝýỲỳŶŷŸÿỸỹẎẏỴỵɎɏƳƴ]",z:"[zŹźẐẑŽžŻżẒẓẔẕƵƶ]"},i=function(){var e,t,i,n,r="",o={};for(i in u)if(u.hasOwnProperty(i))for(r+=n=u[i].substring(2,u[i].length-1),e=0,t=n.length;e<t;e++)o[n.charAt(e)]=i;var s=new RegExp("["+r+"]","g");return function(e){return e.replace(s,function(e){return o[e]}).toLowerCase()}}();return e}),!function(e,t){"function"==typeof define&&define.amd?define("microplugin",t):"object"==typeof exports?module.exports=t():e.MicroPlugin=t()}(this,function(){var e={mixin:function(n){n.plugins={},n.prototype.initializePlugins=function(e){var t,i,n,r=[];if(this.plugins={names:[],settings:{},requested:{},loaded:{}},o.isArray(e))for(t=0,i=e.length;t<i;t++)"string"==typeof e[t]?r.push(e[t]):(this.plugins.settings[e[t].name]=e[t].options,r.push(e[t].name));else if(e)for(n in e)e.hasOwnProperty(n)&&(this.plugins.settings[n]=e[n],r.push(n));for(;r.length;)this.require(r.shift())},n.prototype.loadPlugin=function(e){var t=this.plugins,i=n.plugins[e];if(!n.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');t.requested[e]=!0,t.loaded[e]=i.fn.apply(this,[this.plugins.settings[e]||{}]),t.names.push(e)},n.prototype.require=function(e){var t=this.plugins;if(!this.plugins.loaded.hasOwnProperty(e)){if(t.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');this.loadPlugin(e)}return t.loaded[e]},n.define=function(e,t){n.plugins[e]={name:e,fn:t}}}},o={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}};return e}),!function(e,t){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("sifter"),require("microplugin")):e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}(this,function(C,c,e){"use strict";function n(){}C.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;var e=this.parentNode;e.replaceChild(this.firstChild,this),e.normalize()}).end()};function l(e){return void 0!==e}function E(e){return null==e?null:"boolean"==typeof e?e?"1":"0":e+""}function a(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function i(t,i,e){var n,r=t.trigger,o={};for(n in t.trigger=function(){var e=arguments[0];if(-1===i.indexOf(e))return r.apply(t,arguments);o[e]=arguments},e.apply(t,[]),t.trigger=r,o)o.hasOwnProperty(n)&&r.apply(t,o[n])}function u(e){var t,i,n={};return"selectionStart"in e?(n.start=e.selectionStart,n.length=e.selectionEnd-n.start):document.selection&&(e.focus(),t=document.selection.createRange(),i=document.selection.createRange().text.length,t.moveStart("character",-e.value.length),n.start=t.text.length-i,n.length=i),n}function g(o){function e(e,t){var i,n,r;t=t||{},(e=e||window.event||{}).metaKey||e.altKey||!t.force&&!1===o.data("grow")||(t=o.val(),e.type&&"keydown"===e.type.toLowerCase()&&(i=48<=(r=e.keyCode)&&r<=57||65<=r&&r<=90||96<=r&&r<=111||186<=r&&r<=222||32===r,46===r||8===r?(n=u(o[0])).length?t=t.substring(0,n.start)+t.substring(n.start+n.length):8===r&&n.start?t=t.substring(0,n.start-1)+t.substring(n.start+1):46===r&&void 0!==n.start&&(t=t.substring(0,n.start)+t.substring(n.start+1)):i&&(r=e.shiftKey,n=String.fromCharCode(e.keyCode),t+=n=r?n.toUpperCase():n.toLowerCase())),i=o.attr("placeholder"),e=o,(n=((r=t=!t&&i?i:t)?(h.$testInput||(h.$testInput=C("<span />").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).appendTo("body")),h.$testInput.text(r),d(e,h.$testInput,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]),h.$testInput.width()):0)+4)===s)||(s=n,o.width(n),o.triggerHandler("resize"))}var s=null;o.on("keydown keyup update blur",e),e()}n.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){var i=arguments.length;return 0===i?delete this._events:1===i?delete this._events[e]:(this._events=this._events||{},void(e in this._events!=!1&&this._events[e].splice(this._events[e].indexOf(t),1)))},trigger:function(e){if(this._events=this._events||{},e in this._events!=!1)for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},n.mixin=function(e){for(var t=["on","off","trigger"],i=0;i<t.length;i++)e.prototype[t[i]]=n.prototype[t[i]]};var t,m=/Mac/.test(navigator.userAgent),v=m?91:17,y=m?18:17,b=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("input").validity,r={before:function(e,t,i){var n=e[t];e[t]=function(){return i.apply(e,arguments),n.apply(e,arguments)}},after:function(t,e,i){var n=t[e];t[e]=function(){var e=n.apply(t,arguments);return i.apply(t,arguments),e}}},d=function(e,t,i){var n,r,o={};if(i)for(n=0,r=i.length;n<r;n++)o[i[n]]=e.css(i[n]);else o=e.css();t.css(o)},h=function(e,t){var i,n,r,o,s,a=this,l=e[0],u=(l.selectize=a,window.getComputedStyle&&window.getComputedStyle(l,null));if(u=(u?u.getPropertyValue("direction"):l.currentStyle&&l.currentStyle.direction)||e.parents("[dir]:first").attr("dir")||"",C.extend(a,{order:0,settings:t,$input:e,tabIndex:e.attr("tabindex")||"",tagType:"select"===l.tagName.toLowerCase()?1:2,rtl:/rtl/i.test(u),eventNS:".selectize"+ ++h.count,highlightedValue:null,isBlurring:!1,isOpen:!1,isDisabled:!1,isRequired:e.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===t.loadThrottle?a.onSearchChange:(r=a.onSearchChange,o=t.loadThrottle,function(){var e=this,t=arguments;window.clearTimeout(s),s=window.setTimeout(function(){r.apply(e,t)},o)})}),a.sifter=new c(this.options,{diacritics:t.diacritics}),a.settings.options){for(i=0,n=a.settings.options.length;i<n;i++)a.registerOption(a.settings.options[i]);delete a.settings.options}if(a.settings.optgroups){for(i=0,n=a.settings.optgroups.length;i<n;i++)a.registerOptionGroup(a.settings.optgroups[i]);delete a.settings.optgroups}a.settings.mode=a.settings.mode||(1===a.settings.maxItems?"single":"multi"),"boolean"!=typeof a.settings.hideSelected&&(a.settings.hideSelected="multi"===a.settings.mode),a.initializePlugins(a.settings.plugins),a.setupCallbacks(),a.setupTemplates(),a.setup()};return n.mixin(h),void 0!==e?e.mixin(h):(e="Dependency MicroPlugin is missing",t=(t={explanation:'Make sure you either: (1) are using the "standalone" version of Selectize, or (2) require MicroPlugin before you load Selectize.'})||{},console.error("Selectize: "+e),t.explanation&&(console.group&&console.group(),console.error(t.explanation),console.group)&&console.groupEnd()),C.extend(h.prototype,{setup:function(){var i,e,n,t=this,r=t.settings,o=t.eventNS,s=C(window),a=C(document),l=t.$input,u=t.settings.mode,c=l.attr("class")||"",d=C("<div>").addClass(r.wrapperClass).addClass(c).addClass(u),h=C("<div>").addClass(r.inputClass).addClass("items").appendTo(d),p=C('<input type="text" autocomplete="off" />').appendTo(h).attr("tabindex",l.is(":disabled")?"-1":t.tabIndex),f=C(r.dropdownParent||d),u=C("<div>").addClass(r.dropdownClass).addClass(u).hide().appendTo(f),f=C("<div>").addClass(r.dropdownContentClass).appendTo(u);(e=l.attr("id"))&&(p.attr("id",e+"-selectized"),C("label[for='"+e+"']").attr("for",e+"-selectized")),t.settings.copyClassesToDropdown&&u.addClass(c),d.css({width:l[0].style.width}),t.plugins.names.length&&(e="plugin-"+t.plugins.names.join(" plugin-"),d.addClass(e),u.addClass(e)),(null===r.maxItems||1<r.maxItems)&&1===t.tagType&&l.attr("multiple","multiple"),t.settings.placeholder&&p.attr("placeholder",r.placeholder),!t.settings.splitOn&&t.settings.delimiter&&(c=t.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),t.settings.splitOn=new RegExp("\\s*"+c+"+\\s*")),l.attr("autocorrect")&&p.attr("autocorrect",l.attr("autocorrect")),l.attr("autocapitalize")&&p.attr("autocapitalize",l.attr("autocapitalize")),p[0].type=l[0].type,t.$wrapper=d,t.$control=h,t.$control_input=p,t.$dropdown=u,t.$dropdown_content=f,u.on("mouseenter mousedown click","[data-disabled]>[data-selectable]",function(e){e.stopImmediatePropagation()}),u.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)}),u.on("mousedown click","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)}),e="mousedown",c="*:not(input)",n=function(){return t.onItemSelect.apply(t,arguments)},(i=h).on(e,c,function(e){for(var t=e.target;t&&t.parentNode!==i[0];)t=t.parentNode;return e.currentTarget=t,n.apply(this,[e])}),g(p),h.on({mousedown:function(){return t.onMouseDown.apply(t,arguments)},click:function(){return t.onClick.apply(t,arguments)}}),p.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){return t.ignoreBlur=!1,t.onFocus.apply(t,arguments)},paste:function(){return t.onPaste.apply(t,arguments)}}),a.on("keydown"+o,function(e){t.isCmdDown=e[m?"metaKey":"ctrlKey"],t.isCtrlDown=e[m?"altKey":"ctrlKey"],t.isShiftDown=e.shiftKey}),a.on("keyup"+o,function(e){e.keyCode===y&&(t.isCtrlDown=!1),16===e.keyCode&&(t.isShiftDown=!1),e.keyCode===v&&(t.isCmdDown=!1)}),a.on("mousedown"+o,function(e){if(t.isFocused){if(e.target===t.$dropdown[0]||e.target.parentNode===t.$dropdown[0])return!1;t.$control.has(e.target).length||e.target===t.$control[0]||t.blur(e.target)}}),s.on(["scroll"+o,"resize"+o].join(" "),function(){t.isOpen&&t.positionDropdown.apply(t,arguments)}),s.on("mousemove"+o,function(){t.ignoreHover=!1}),this.revertSettings={$children:l.children().detach(),tabindex:l.attr("tabindex")},l.attr("tabindex",-1).hide().after(t.$wrapper),C.isArray(r.items)&&(t.setValue(r.items),delete r.items),b&&l.on("invalid"+o,function(e){e.preventDefault(),t.isInvalid=!0,t.refreshState()}),t.updateOriginalInput(),t.refreshItems(),t.refreshState(),t.updatePlaceholder(),t.isSetup=!0,l.is(":disabled")&&t.disable(),t.on("change",this.onChange),l.data("selectize",t),l.addClass("selectized"),t.trigger("initialize"),!0===r.preload&&t.onSearchChange("")},setupTemplates:function(){var i=this.settings.labelField,n=this.settings.optgroupLabelField;this.settings.render=C.extend({},{optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[n])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[i])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[i])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}},this.settings.render)},setupCallbacks:function(){var e,t,i={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in i)i.hasOwnProperty(e)&&(t=this.settings[i[e]])&&this.on(e,t)},onClick:function(e){this.isFocused&&this.isOpen||(this.focus(),e.preventDefault())},onMouseDown:function(e){var t=this,i=e.isDefaultPrevented();C(e.target);if(t.isFocused){if(e.target!==t.$control_input[0])return"single"===t.settings.mode?t.isOpen?t.close():t.open():i||t.setActiveItem(null),!1}else i||window.setTimeout(function(){t.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(e){var r=this;r.isFull()||r.isInputHidden||r.isLocked?e.preventDefault():r.settings.splitOn&&setTimeout(function(){var e=r.$control_input.val();if(e.match(r.settings.splitOn))for(var t=C.trim(e).split(r.settings.splitOn),i=0,n=t.length;i<n;i++)r.createItem(t[i])},0)},onKeyPress:function(e){var t;return this.isLocked?e&&e.preventDefault():(t=String.fromCharCode(e.keyCode||e.which),this.settings.create&&"multi"===this.settings.mode&&t===this.settings.delimiter?(this.createItem(),e.preventDefault(),!1):void 0)},onKeyDown:function(e){e.target,this.$control_input[0];var t,i=this;if(i.isLocked)9!==e.keyCode&&e.preventDefault();else{switch(e.keyCode){case 65:if(i.isCmdDown)return void i.selectAll();break;case 27:return void(i.isOpen&&(e.preventDefault(),e.stopPropagation(),i.close()));case 78:if(!e.ctrlKey||e.altKey)break;case 40:return!i.isOpen&&i.hasOptions?i.open():i.$activeOption&&(i.ignoreHover=!0,(t=i.getAdjacentOption(i.$activeOption,1)).length)&&i.setActiveOption(t,!0,!0),void e.preventDefault();case 80:if(!e.ctrlKey||e.altKey)break;case 38:return i.$activeOption&&(i.ignoreHover=!0,(t=i.getAdjacentOption(i.$activeOption,-1)).length)&&i.setActiveOption(t,!0,!0),void e.preventDefault();case 13:return void(i.isOpen&&i.$activeOption&&(i.onOptionSelect({currentTarget:i.$activeOption}),e.preventDefault()));case 37:return void i.advanceSelection(-1,e);case 39:return void i.advanceSelection(1,e);case 9:return i.settings.selectOnTab&&i.isOpen&&i.$activeOption&&(i.onOptionSelect({currentTarget:i.$activeOption}),i.isFull()||e.preventDefault()),void(i.settings.create&&i.createItem()&&e.preventDefault());case 8:case 46:return void i.deleteSelection(e)}!i.isFull()&&!i.isInputHidden||(m?e.metaKey:e.ctrlKey)||e.preventDefault()}},onKeyUp:function(e){if(this.isLocked)return e&&e.preventDefault();e=this.$control_input.val()||"";this.lastValue!==e&&(this.lastValue=e,this.onSearchChange(e),this.refreshOptions(),this.trigger("type",e))},onSearchChange:function(t){var i=this,n=i.settings.load;n&&!i.loadedSearches.hasOwnProperty(t)&&(i.loadedSearches[t]=!0,i.load(function(e){n.apply(i,[t,e])}))},onFocus:function(e){var t=this,i=t.isFocused;if(t.isDisabled)return t.blur(),e&&e.preventDefault(),!1;t.ignoreFocus||(t.isFocused=!0,"focus"===t.settings.preload&&t.onSearchChange(""),i||t.trigger("focus"),t.$activeItems.length||(t.showInput(),t.setActiveItem(null),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState())},onBlur:function(e,t){var i,n=this;n.isFocused&&(n.isFocused=!1,n.ignoreFocus||(n.ignoreBlur||document.activeElement!==n.$dropdown_content[0]?(i=function(){n.close(),n.setTextboxValue(""),n.setActiveItem(null),n.setActiveOption(null),n.setCaret(n.items.length),n.refreshState(),t&&t.focus&&t.focus(),n.isBlurring=!1,n.ignoreFocus=!1,n.trigger("blur")},n.isBlurring=!0,n.ignoreFocus=!0,n.settings.create&&n.settings.createOnBlur?n.createItem(null,!1,i):i()):(n.ignoreBlur=!0,n.onFocus(e))))},onOptionHover:function(e){this.ignoreHover||this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(e){var t,i=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),(t=C(e.currentTarget)).hasClass("create")?i.createItem(null,function(){i.settings.closeAfterSelect&&i.close()}):void 0!==(t=t.attr("data-value"))&&(i.lastQuery=null,i.setTextboxValue(""),i.addItem(t),i.settings.closeAfterSelect?i.close():!i.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&i.setActiveOption(i.getOption(t)))},onItemSelect:function(e){this.isLocked||"multi"===this.settings.mode&&(e.preventDefault(),this.setActiveItem(e.currentTarget,e))},load:function(e){var t=this,i=t.$wrapper.addClass(t.settings.loadingClass);t.loading++,e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0),e&&e.length&&(t.addOption(e),t.refreshOptions(t.isFocused&&!t.isInputHidden)),t.loading||i.removeClass(t.settings.loadingClass),t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input;t.val()!==e&&(t.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return 1===this.tagType&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e,t){i(this,t?[]:["change"],function(){this.clear(t),this.addItems(e,t)})},setActiveItem:function(e,t){var i,n,r,o,s,a,l=this;if("single"!==l.settings.mode)if((e=C(e)).length){if("mousedown"===(i=t&&t.type.toLowerCase())&&l.isShiftDown&&l.$activeItems.length){for(a=l.$control.children(".active:last"),a=Array.prototype.indexOf.apply(l.$control[0].childNodes,[a[0]]),(r=Array.prototype.indexOf.apply(l.$control[0].childNodes,[e[0]]))<a&&(s=a,a=r,r=s),n=a;n<=r;n++)o=l.$control[0].childNodes[n],-1===l.$activeItems.indexOf(o)&&(C(o).addClass("active"),l.$activeItems.push(o));t.preventDefault()}else"mousedown"===i&&l.isCtrlDown||"keydown"===i&&this.isShiftDown?e.hasClass("active")?(s=l.$activeItems.indexOf(e[0]),l.$activeItems.splice(s,1),e.removeClass("active")):l.$activeItems.push(e.addClass("active")[0]):(C(l.$activeItems).removeClass("active"),l.$activeItems=[e.addClass("active")[0]]);l.hideInput(),this.isFocused||l.focus()}else C(l.$activeItems).removeClass("active"),l.$activeItems=[],l.isFocused&&l.showInput()},setActiveOption:function(e,t,i){var n,r,o,s,a=this;a.$activeOption&&a.$activeOption.removeClass("active"),a.$activeOption=null,(e=C(e)).length&&(a.$activeOption=e.addClass("active"),!t&&l(t)||(e=a.$dropdown_content.height(),n=a.$activeOption.outerHeight(!0),t=a.$dropdown_content.scrollTop()||0,s=(o=r=a.$activeOption.offset().top-a.$dropdown_content.offset().top+t)-e+n,e+t<r+n?a.$dropdown_content.stop().animate({scrollTop:s},i?a.settings.scrollDuration:0):r<t&&a.$dropdown_content.stop().animate({scrollTop:o},i?a.settings.scrollDuration:0)))},selectAll:function(){"single"!==this.settings.mode&&(this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.$activeItems.length&&(this.hideInput(),this.close()),this.focus())},hideInput:function(){this.setTextboxValue(""),this.$control_input.css({opacity:0,position:"absolute",left:this.rtl?1e4:-1e4}),this.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),window.setTimeout(function(){e.ignoreFocus=!1,e.onFocus()},0))},blur:function(e){this.$control_input[0].blur(),this.onBlur(null,e)},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,t=e.sortField;return{fields:e.searchField,conjunction:e.searchConjunction,sort:t="string"==typeof t?[{field:t}]:t,nesting:e.nesting}},search:function(e){var t,i,n,r=this.settings,o=this.getSearchOptions();if(r.score&&"function"!=typeof(n=this.settings.score.apply(this,[e])))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==this.lastQuery?(this.lastQuery=e,i=this.sifter.search(e,C.extend(o,{score:n})),this.currentResults=i):i=C.extend(!0,{},this.currentResults),r.hideSelected)for(t=i.items.length-1;0<=t;t--)-1!==this.items.indexOf(E(i.items[t].id))&&i.items.splice(t,1);return i},refreshOptions:function(e){void 0===e&&(e=!0);var t,i,n,r,o,s,a,l,u,c,d,h,p,f,g,m,v=this,y=C.trim(v.$control_input.val()),b=v.search(y),w=v.$dropdown_content,x=v.$activeOption&&E(v.$activeOption.attr("data-value")),_=b.items.length;for("number"==typeof v.settings.maxOptions&&(_=Math.min(_,v.settings.maxOptions)),r={},o=[],t=0;t<_;t++)for(s=v.options[b.items[t].id],a=v.render("option",s),l=s[v.settings.optgroupField]||"",i=0,n=(u=C.isArray(l)?l:[l])&&u.length;i<n;i++)l=u[i],v.optgroups.hasOwnProperty(l)||(l=""),r.hasOwnProperty(l)||(r[l]=document.createDocumentFragment(),o.push(l)),r[l].appendChild(a);for(this.settings.lockOptgroupOrder&&o.sort(function(e,t){return(v.optgroups[e].$order||0)-(v.optgroups[t].$order||0)}),c=document.createDocumentFragment(),t=0,_=o.length;t<_;t++)v.optgroups.hasOwnProperty(l=o[t])&&r[l].childNodes.length?((d=document.createDocumentFragment()).appendChild(v.render("optgroup_header",v.optgroups[l])),d.appendChild(r[l]),c.appendChild(v.render("optgroup",C.extend({},v.optgroups[l],{html:(g=d,m=void 0,(m=document.createElement("div")).appendChild(g.cloneNode(!0)),m.innerHTML),dom:d})))):c.appendChild(r[l]);if(w.html(c),v.settings.highlight&&(w.removeHighlight(),b.query.length)&&b.tokens.length)for(t=0,_=b.tokens.length;t<_;t++)!function(e,t){var s,a;if("string"!=typeof t||t.length)s="string"==typeof t?new RegExp(t,"i"):t,a=function(e){var t=0;if(3===e.nodeType){var i,n,r=e.data.search(s);0<=r&&0<e.data.length&&(n=e.data.match(s),(i=document.createElement("span")).className="highlight",(r=e.splitText(r)).splitText(n[0].length),n=r.cloneNode(!0),i.appendChild(n),r.parentNode.replaceChild(i,r),t=1)}else if(1===e.nodeType&&e.childNodes&&!/(script|style)/i.test(e.tagName)&&("highlight"!==e.className||"SPAN"!==e.tagName))for(var o=0;o<e.childNodes.length;++o)o+=a(e.childNodes[o]);return t},e.each(function(){a(this)})}(w,b.tokens[t].regex);if(!v.settings.hideSelected)for(t=0,_=v.items.length;t<_;t++)v.getOption(v.items[t]).addClass("selected");(h=v.canCreate(y))&&(w.prepend(v.render("option_create",{input:y})),f=C(w[0].childNodes[0])),v.hasOptions=0<b.items.length||h,v.hasOptions?(0<b.items.length?((y=x&&v.getOption(x))&&y.length?p=y:"single"===v.settings.mode&&v.items.length&&(p=v.getOption(v.items[0])),p&&p.length||(p=f&&!v.settings.addPrecedence?v.getAdjacentOption(f,1):w.find("[data-selectable]:first"))):p=f,v.setActiveOption(p),e&&!v.isOpen&&v.open()):(v.setActiveOption(null),e&&v.isOpen&&v.close())},addOption:function(e){var t,i,n;if(C.isArray(e))for(t=0,i=e.length;t<i;t++)this.addOption(e[t]);else(n=this.registerOption(e))&&(this.userOptions[n]=!0,this.lastQuery=null,this.trigger("option_add",n,e))},registerOption:function(e){var t=E(e[this.settings.valueField]);return null!=t&&!this.options.hasOwnProperty(t)&&(e.$order=e.$order||++this.order,this.options[t]=e,t)},registerOptionGroup:function(e){var t=E(e[this.settings.optgroupValueField]);return!!t&&(e.$order=e.$order||++this.order,this.optgroups[t]=e,t)},addOptionGroup:function(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)},removeOptionGroup:function(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.renderCache={},this.trigger("optgroup_remove",e))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(e,t){var i,n,r,o=this;if(e=E(e),i=E(t[o.settings.valueField]),null!==e&&o.options.hasOwnProperty(e)){if("string"!=typeof i)throw new Error("Value must be set in option data");r=o.options[e].$order,i!==e&&(delete o.options[e],-1!==(n=o.items.indexOf(e)))&&o.items.splice(n,1,i),t.$order=t.$order||r,o.options[i]=t,n=o.renderCache.item,r=o.renderCache.option,n&&(delete n[e],delete n[i]),r&&(delete r[e],delete r[i]),-1!==o.items.indexOf(i)&&(n=o.getItem(e),r=C(o.render("item",t)),n.hasClass("active")&&r.addClass("active"),n.replaceWith(r)),o.lastQuery=null,o.isOpen&&o.refreshOptions(!1)}},removeOption:function(e,t){e=E(e);var i=this.renderCache.item,n=this.renderCache.option;i&&delete i[e],n&&delete n[e],delete this.userOptions[e],delete this.options[e],this.lastQuery=null,this.trigger("option_remove",e),this.removeItem(e,t)},clearOptions:function(){var i=this,n=(i.loadedSearches={},i.userOptions={},i.renderCache={},i.options);C.each(i.options,function(e,t){-1==i.items.indexOf(e)&&delete n[e]}),i.options=i.sifter.items=n,i.lastQuery=null,i.trigger("option_clear")},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,t){var i=this.$dropdown.find("[data-selectable]"),e=i.index(e)+t;return 0<=e&&e<i.length?i.eq(e):C()},getElementWithValue:function(e,t){if(null!=(e=E(e)))for(var i=0,n=t.length;i<n;i++)if(t[i].getAttribute("data-value")===e)return C(t[i]);return C()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(e,t){this.buffer=document.createDocumentFragment();for(var i=this.$control[0].childNodes,n=0;n<i.length;n++)this.buffer.appendChild(i[n]);for(var r=C.isArray(e)?e:[e],n=0,o=r.length;n<o;n++)this.isPending=n<o-1,this.addItem(r[n],t);e=this.$control[0];e.insertBefore(this.buffer,e.firstChild),this.buffer=null},addItem:function(o,s){i(this,s?[]:["change"],function(){var e,t,i,n=this,r=n.settings.mode;o=E(o),-1!==n.items.indexOf(o)?"single"===r&&n.close():n.options.hasOwnProperty(o)&&("single"===r&&n.clear(s),"multi"===r&&n.isFull()||(e=C(n.render("item",n.options[o])),i=n.isFull(),n.items.splice(n.caretPos,0,o),n.insertAtCaret(e),n.isPending&&(i||!n.isFull())||n.refreshState(),n.isSetup&&(i=n.$dropdown_content.find("[data-selectable]"),n.isPending||(t=n.getOption(o),t=n.getAdjacentOption(t,1).attr("data-value"),n.refreshOptions(n.isFocused&&"single"!==r),t&&n.setActiveOption(n.getOption(t))),!i.length||n.isFull()?n.close():n.isPending||n.positionDropdown(),n.updatePlaceholder(),n.trigger("item_add",o,e),n.isPending||n.updateOriginalInput({silent:s}))))})},removeItem:function(e,t){var i,n,r=this,o=e instanceof C?e:r.getItem(e);e=E(o.attr("data-value")),-1!==(i=r.items.indexOf(e))&&(o.remove(),o.hasClass("active")&&(n=r.$activeItems.indexOf(o[0]),r.$activeItems.splice(n,1)),r.items.splice(i,1),r.lastQuery=null,!r.settings.persist&&r.userOptions.hasOwnProperty(e)&&r.removeOption(e,t),i<r.caretPos&&r.setCaret(r.caretPos-1),r.refreshState(),r.updatePlaceholder(),r.updateOriginalInput({silent:t}),r.positionDropdown(),r.trigger("item_remove",e,o))},createItem:function(e,i){var n=this,r=n.caretPos,o=(e=e||C.trim(n.$control_input.val()||""),arguments[arguments.length-1]);if("function"!=typeof o&&(o=function(){}),"boolean"!=typeof i&&(i=!0),!n.canCreate(e))return o(),!1;n.lock();var t,s,a="function"==typeof n.settings.create?this.settings.create:function(e){var t={};return t[n.settings.labelField]=e,t[n.settings.valueField]=e,t},l=(s=!(t=function(e){var t;return n.unlock(),!e||"object"!=typeof e||"string"!=typeof(t=E(e[n.settings.valueField]))?o():(n.setTextboxValue(""),n.addOption(e),n.setCaret(r),n.addItem(t),n.refreshOptions(i&&"single"!==n.settings.mode),void o(e))}),function(){s||(s=!0,t.apply(this,arguments))}),a=a.apply(this,[e,l]);return void 0!==a&&l(a),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){this.refreshValidityState(),this.refreshClasses()},refreshValidityState:function(){if(!this.isRequired)return!1;var e=!this.items.length;this.isInvalid=e,this.$control_input.prop("required",e),this.$input.prop("required",!e)},refreshClasses:function(){var e=this,t=e.isFull(),i=e.isLocked;e.$wrapper.toggleClass("rtl",e.rtl),e.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("required",e.isRequired).toggleClass("invalid",e.isInvalid).toggleClass("locked",i).toggleClass("full",t).toggleClass("not-full",!t).toggleClass("input-active",e.isFocused&&!e.isInputHidden).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!C.isEmptyObject(e.options)).toggleClass("has-items",0<e.items.length),e.$control_input.data("grow",!t&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(e){var t,i,n,r,o=this;if(e=e||{},1===o.tagType){for(n=[],t=0,i=o.items.length;t<i;t++)r=o.options[o.items[t]][o.settings.labelField]||"",n.push('<option value="'+a(o.items[t])+'" selected="selected">'+a(r)+"</option>");n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),o.$input.html(n.join(""))}else o.$input.val(o.getValue()),o.$input.attr("value",o.$input.val());o.isSetup&&!e.silent&&o.trigger("change",o.$input.val())},updatePlaceholder:function(){var e;this.settings.placeholder&&(e=this.$control_input,this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder),e.triggerHandler("update",{force:!0}))},open:function(){var e=this;e.isLocked||e.isOpen||"multi"===e.settings.mode&&e.isFull()||(e.focus(),e.isOpen=!0,e.refreshState(),e.$dropdown.css({visibility:"hidden",display:"block"}),e.positionDropdown(),e.$dropdown.css({visibility:"visible"}),e.trigger("dropdown_open",e.$dropdown))},close:function(){var e=this,t=e.isOpen;"single"===e.settings.mode&&e.items.length&&(e.hideInput(),e.isBlurring||e.$control_input.blur()),e.isOpen=!1,e.$dropdown.hide(),e.setActiveOption(null),e.refreshState(),t&&e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control,t="body"===this.settings.dropdownParent?e.offset():e.position();t.top+=e.outerHeight(!0),this.$dropdown.css({width:e[0].getBoundingClientRect().width,top:t.top,left:t.left})},clear:function(e){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.lastQuery=null,t.setCaret(0),t.setActiveItem(null),t.updatePlaceholder(),t.updateOriginalInput({silent:e}),t.refreshState(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(e){var t=Math.min(this.caretPos,this.items.length),e=e[0],i=this.buffer||this.$control[0];0===t?i.insertBefore(e,i.firstChild):i.insertBefore(e,i.childNodes[t]),this.setCaret(t+1)},deleteSelection:function(e){var t,i,n,r,o,s=this,a=e&&8===e.keyCode?-1:1,l=u(s.$control_input[0]);if(s.$activeOption&&!s.settings.hideSelected&&(r=s.getAdjacentOption(s.$activeOption,-1).attr("data-value")),n=[],s.$activeItems.length){for(o=s.$control.children(".active:"+(0<a?"last":"first")),o=s.$control.children(":not(input)").index(o),0<a&&o++,t=0,i=s.$activeItems.length;t<i;t++)n.push(C(s.$activeItems[t]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(s.isFocused||"single"===s.settings.mode)&&s.items.length&&(a<0&&0===l.start&&0===l.length?n.push(s.items[s.caretPos-1]):0<a&&l.start===s.$control_input.val().length&&n.push(s.items[s.caretPos]));if(!n.length||"function"==typeof s.settings.onDelete&&!1===s.settings.onDelete.apply(s,[n]))return!1;for(void 0!==o&&s.setCaret(o);n.length;)s.removeItem(n.pop());return s.showInput(),s.positionDropdown(),s.refreshOptions(!0),r&&(e=s.getOption(r)).length&&s.setActiveOption(e),!0},advanceSelection:function(e,t){var i,n,r,o=this;0!==e&&(o.rtl&&(e*=-1),i=0<e?"last":"first",r=u(o.$control_input[0]),o.isFocused&&!o.isInputHidden?(n=o.$control_input.val().length,(e<0?0!==r.start||0!==r.length:r.start!==n)||n||o.advanceCaret(e,t)):(r=o.$control.children(".active:"+i)).length&&(n=o.$control.children(":not(input)").index(r),o.setActiveItem(null),o.setCaret(0<e?n+1:n)))},advanceCaret:function(e,t){var i;0!==e&&(this.isShiftDown?(i=this.$control_input[0<e?"next":"prev"]()).length&&(this.hideInput(),this.setActiveItem(i),t)&&t.preventDefault():this.setCaret(this.caretPos+e))},setCaret:function(e){if(e="single"===this.settings.mode?this.items.length:Math.max(0,Math.min(this.items.length,e)),!this.isPending)for(var t,i=this.$control.children(":not(input)"),n=0,r=i.length;n<r;n++)t=C(i[n]).detach(),n<e?this.$control_input.before(t):this.$control.append(t);this.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){this.$input.prop("disabled",!0),this.$control_input.prop("disabled",!0).prop("tabindex",-1),this.isDisabled=!0,this.lock()},enable:function(){this.$input.prop("disabled",!1),this.$control_input.prop("disabled",!1).prop("tabindex",this.tabIndex),this.isDisabled=!1,this.unlock()},destroy:function(){var e=this,t=e.eventNS,i=e.revertSettings;e.trigger("destroy"),e.off(),e.$wrapper.remove(),e.$dropdown.remove(),e.$input.html("").append(i.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:i.tabindex}).show(),e.$control_input.removeData("grow"),e.$input.removeData("selectize"),0==--h.count&&h.$testInput&&(h.$testInput.remove(),h.$testInput=void 0),C(window).off(t),C(document).off(t),C(document.body).off(t),delete e.$input[0].selectize},render:function(e,t){var i,n,r="",o=!1,s=this;return(o="option"!==e&&"item"!==e?o:!!(i=E(t[s.settings.valueField])))&&(l(s.renderCache[e])||(s.renderCache[e]={}),s.renderCache[e].hasOwnProperty(i))?s.renderCache[e][i]:(r=C(s.settings.render[e].apply(this,[t,a])),"option"===e||"option_create"===e?t[s.settings.disabledField]||r.attr("data-selectable",""):"optgroup"===e&&(n=t[s.settings.optgroupValueField]||"",r.attr("data-group",n),t[s.settings.disabledField])&&r.attr("data-disabled",""),"option"!==e&&"item"!==e||r.attr("data-value",i||""),o&&(s.renderCache[e][i]=r[0]),r[0])},clearCache:function(e){void 0===e?this.renderCache={}:delete this.renderCache[e]},canCreate:function(e){var t;return!!this.settings.create&&(t=this.settings.createFilter,e.length)&&("function"!=typeof t||t.apply(this,[e]))&&("string"!=typeof t||new RegExp(t).test(e))&&(!(t instanceof RegExp)||t.test(e))}}),h.count=0,h.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},C.fn.selectize=function(u){function c(e,r){function t(e,t){e=C(e);var i,n=E(e.val());(n||m.allowEmptyOption)&&(l.hasOwnProperty(n)?t&&((i=l[n][x])?C.isArray(i)?i.push(t):l[n][x]=[i,t]:l[n][x]=t):((i=u(e)||{})[y]=i[y]||e.text(),i[b]=i[b]||n,i[w]=i[w]||e.prop("disabled"),i[x]=i[x]||t,l[n]=i,a.push(i),e.is(":selected")&&r.items.push(n)))}var i,n,o,s,a=r.options,l={},u=function(e){e=v&&e.attr(v);return"string"==typeof e&&e.length?JSON.parse(e):null};for(r.maxItems=e.attr("multiple")?null:1,i=0,n=(s=e.children()).length;i<n;i++)if("optgroup"===(o=s[i].tagName.toLowerCase())){f=p=h=d=c=void 0;var c,d,h,p,f,g=s[i];for((h=(g=C(g)).attr("label"))&&((p=u(g)||{})[_]=h,p[k]=h,p[w]=g.prop("disabled"),r.optgroups.push(p)),c=0,d=(f=C("option",g)).length;c<d;c++)t(f[c],h)}else"option"===o&&t(s[i])}var d=C.fn.selectize.defaults,m=C.extend({},d,u),v=m.dataAttr,y=m.labelField,b=m.valueField,w=m.disabledField,x=m.optgroupField,_=m.optgroupLabelField,k=m.optgroupValueField;return this.each(function(){if(!this.selectize){var e=C(this),t=this.tagName.toLowerCase(),i=e.attr("placeholder")||e.attr("data-placeholder"),i={placeholder:i=i||m.allowEmptyOption?i:e.children('option[value=""]').text(),options:[],optgroups:[],items:[]};if("select"===t)c(e,i);else{var n,r,o,s,t=e,a=i,l=t.attr(v);if(l)for(a.options=JSON.parse(l),n=0,r=a.options.length;n<r;n++)a.items.push(a.options[n][b]);else{l=C.trim(t.val()||"");if(m.allowEmptyOption||l.length){for(n=0,r=(o=l.split(m.delimiter)).length;n<r;n++)(s={})[y]=o[n],s[b]=o[n],a.options.push(s);a.items=o}}}new h(e,C.extend(!0,{},d,i,u))}})},C.fn.selectize.defaults=h.defaults,C.fn.selectize.support={validity:b},h.define("drag_drop",function(e){if(!C.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');var n,t,i,r;"multi"===this.settings.mode&&((n=this).lock=(t=n.lock,function(){var e=n.$control.data("sortable");return e&&e.disable(),t.apply(n,arguments)}),n.unlock=(i=n.unlock,function(){var e=n.$control.data("sortable");return e&&e.enable(),i.apply(n,arguments)}),n.setup=(r=n.setup,function(){r.apply(this,arguments);var i=n.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:n.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var e=n.$activeItems?n.$activeItems.slice():null,t=[];i.children("[data-value]").each(function(){t.push(C(this).attr("data-value"))}),n.setValue(t),n.setActiveItem(e)}})}))}),h.define("dropdown_header",function(e){var t,i=this;e=C.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'"><div class="'+e.titleRowClass+'"><span class="'+e.labelClass+'">'+e.title+'</span><a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a></div></div>'}},e),i.setup=(t=i.setup,function(){t.apply(i,arguments),i.$dropdown_header=C(e.html(e)),i.$dropdown.prepend(i.$dropdown_header)})}),h.define("optgroup_columns",function(s){function e(){var e,t,i,n,r=C("[data-group]",a.$dropdown_content),o=r.length;if(o&&a.$dropdown_content.width()){if(s.equalizeHeight){for(e=t=0;e<o;e++)t=Math.max(t,r.eq(e).height());r.css({height:t})}s.equalizeWidth&&(n=a.$dropdown_content.innerWidth()-l(),i=Math.round(n/o),r.css({width:i}),1<o)&&(n=n-i*(o-1),r.eq(o-1).css({width:n}))}}var n,a=this,l=(s=C.extend({equalizeWidth:!0,equalizeHeight:!0},s),this.getAdjacentOption=function(e,t){var i=e.closest("[data-group]").find("[data-selectable]"),e=i.index(e)+t;return 0<=e&&e<i.length?i.eq(e):C()},this.onKeyDown=(n=a.onKeyDown,function(e){var t,i;if(!this.isOpen||37!==e.keyCode&&39!==e.keyCode)return n.apply(this,arguments);a.ignoreHover=!0,t=(i=this.$activeOption.closest("[data-group]")).find("[data-selectable]").index(this.$activeOption),(i=(e=(i=37===e.keyCode?i.prev("[data-group]"):i.next("[data-group]")).find("[data-selectable]")).eq(Math.min(e.length-1,t))).length&&this.setActiveOption(i)}),function(){var e,t=l.width,i=document;return void 0===t&&((e=i.createElement("div")).innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,i.body.appendChild(e),t=l.width=e.offsetWidth-e.clientWidth,i.body.removeChild(e)),t});(s.equalizeHeight||s.equalizeWidth)&&(r.after(this,"positionDropdown",e),r.after(this,"refreshOptions",e))}),h.define("remove_button",function(e){e=C.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e),("single"===this.settings.mode?function(r,t){t.className="remove-single";var i,o=r,s='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+a(t.title)+'">'+t.label+"</a>";r.setup=(i=o.setup,function(){var e,n;t.append&&(e=C(o.$input.context).attr("id"),C("#"+e),n=o.settings.render.item,o.settings.render.item=function(e){return t=n.apply(r,arguments),i=s,C("<span>").append(t).append(i);var t,i}),i.apply(r,arguments),r.$control.on("click","."+t.className,function(e){e.preventDefault(),o.isLocked||o.clear()})})}:function(o,e){var t,i=o,s='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+a(e.title)+'">'+e.label+"</a>";o.setup=(t=i.setup,function(){var r;e.append&&(r=i.settings.render.item,i.settings.render.item=function(e){return t=r.apply(o,arguments),i=s,n=t.search(/(<\/[^>]+>\s*)$/),t.substring(0,n)+i+t.substring(n);var t,i,n}),t.apply(o,arguments),o.$control.on("click","."+e.className,function(e){e.preventDefault(),i.isLocked||(e=C(e.currentTarget).parent(),i.setActiveItem(e),i.deleteSelection()&&i.setCaret(i.items.length))})})})(this,e)}),h.define("restore_on_backspace",function(i){var n,e=this;i.text=i.text||function(e){return e[this.settings.labelField]},this.onKeyDown=(n=e.onKeyDown,function(e){var t;if(!(8===e.keyCode&&""===this.$control_input.val()&&!this.$activeItems.length&&0<=(t=this.caretPos-1)&&t<this.items.length))return n.apply(this,arguments);t=this.options[this.items[t]],this.deleteSelection(e)&&(this.setTextboxValue(i.text.apply(this,[t])),this.refreshOptions(!0)),e.preventDefault()})}),h}),!function(e){var s,a,n,r=(a="undefined"!=typeof exports&&"undefined"!=typeof require?(s=e._||require("underscore"),e.Backbone||require("backbone")):(s=e._,e.Backbone)).View.extend({events:{submit:function(e){this.trigger("submit",e)}},initialize:function(e){var t=this,i=(e=this.options=s.extend({submitButton:!1},e),this.schema=e.schema?s.result(e,"schema"):(n=e.model)&&n.schema?s.result(n,"schema"):t.schema?s.result(t,"schema"):{}),n=(s.extend(this,s.pick(e,"model","data","idPrefix","templateData")),this.constructor),t=(this.template=e.template||this.template||n.template,this.Fieldset=e.Fieldset||this.Fieldset||n.Fieldset,this.Field=e.Field||this.Field||n.Field,this.NestedField=e.NestedField||this.NestedField||n.NestedField,this.selectedFields=e.fields||s.keys(i)),r=this.fields={},e=(s.each(t,function(e){var t=i[e];r[e]=this.createField(e,t)},this),e.fieldsets||s.result(this,"fieldsets")||s.result(this.model,"fieldsets")||[t]);this.fieldsets=[];s.each(e,function(e){this.fieldsets.push(this.createFieldset(e))},this)},createFieldset:function(e){e={schema:e,fields:this.fields,legend:e.legend||null};return new this.Fieldset(e)},createField:function(e,t){t={form:this,key:e,schema:t,idPrefix:this.idPrefix},this.model?t.model=this.model:this.data?t.value=this.data[e]:t.value=void 0,e=new this.Field(t);return this.listenTo(e.editor,"all",this.handleEditorEvent),e},handleEditorEvent:function(e,t){var i,n=t.key+":"+e;switch(this.trigger.call(this,n,this,t,Array.prototype.slice.call(arguments,2)),e){case"change":this.trigger("change",this);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":this.hasFocus&&(i=this,setTimeout(function(){s.find(i.fields,function(e){return e.editor.hasFocus})||i.trigger("blur",i)},0))}},templateData:function(){return{submitButton:this.options.submitButton}},render:function(){var n=this,r=this.fields,o=a.$,e=o(o.trim(this.template(s.result(this,"templateData"))));return e.find("[data-editors]").add(e).each(function(e,t){var i=o(t),t=i.attr("data-editors");s.isUndefined(t)||(t="*"==t?n.selectedFields||s.keys(r):t.split(","),s.each(t,function(e){e=r[e];i.append(e.editor.render().el)}))}),e.find("[data-fields]").add(e).each(function(e,t){var i=o(t),t=i.attr("data-fields");s.isUndefined(t)||(t="*"==t?n.selectedFields||s.keys(r):t.split(","),s.each(t,function(e){e=r[e];i.append(e.render().el)}))}),e.find("[data-fieldsets]").add(e).each(function(e,t){var i=o(t),t=i.attr("data-fieldsets");s.isUndefined(t)||s.each(n.fieldsets,function(e){i.append(e.render().el)})}),this.setElement(e),e.addClass(this.className),this.attributes&&e.attr(this.attributes),this},validate:function(e){var n=this.fields,t=this.model,r={};return e=e||{},s.each(n,function(e){var t=e.validate();t&&(r[e.key]=t)}),!e.skipModelValidate&&t&&t.validate&&(e=t.validate(this.getValue()))&&((t=s.isObject(e)&&!s.isArray(e))||(r._others=r._others||[],r._others.push(e)),t)&&s.each(e,function(e,t){var i;n[t]&&!r[t]?(n[t].setError(e),r[t]=e):(r._others=r._others||[],(i={})[t]=e,r._others.push(i))}),s.isEmpty(r)?null:r},commit:function(e){var i,t={skipModelValidate:!(e=e||{}).validate},t=this.validate(t);return t||(t=s.extend({error:function(e,t){i=t}},e),this.model.set(this.getValue(),t),i)||void 0},getValue:function(e){var t;return e?this.fields[e].getValue():(t={},s.each(this.fields,function(e){t[e.key]=e.getValue()}),t)},setValue:function(e,t){var i,n={};for(i in"string"==typeof e?n[e]=t:n=e,this.schema)void 0!==n[i]&&this.fields[i].setValue(n[i])},getEditor:function(e){var t=this.fields[e];if(t)return t.editor;throw new Error("Field not found: "+e)},focus:function(){var e;this.hasFocus||(e=this.fieldsets[0].getFieldAt(0))&&e.editor.focus()},blur:function(){var e;this.hasFocus&&(e=s.find(this.fields,function(e){return e.editor.hasFocus}))&&e.editor.blur()},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),a.View.prototype.trigger.apply(this,arguments)},remove:function(){return s.each(this.fieldsets,function(e){e.remove()}),s.each(this.fields,function(e){e.remove()}),a.View.prototype.remove.apply(this,arguments)}},{editors:{}});r.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},r.template=s.template('    <form>     <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit"><%= submitButton %></button>      <% } %>    </form>  ',null,r.templateSettings),r.validators=((n={}).errMessages={required:"Required",regexp:"Invalid",number:"Must be a number",range:s.template("Must be a number between <%= min %> and <%= max %>",null,r.templateSettings),email:"Invalid email address",url:"Invalid URL",match:s.template('Must match field "<%= field %>"',null,r.templateSettings)},n.required=function(i){return i=s.extend({type:"required",message:this.errMessages.required},i),function(e){i.value=e;var t={type:i.type,message:s.isFunction(i.message)?i.message(i):i.message};if(null==e||!1===e||""===e||""===$.trim(e))return t}},n.regexp=function(i){if(i.regexp)return i=s.extend({type:"regexp",match:!0,message:this.errMessages.regexp},i),function(e){i.value=e;var t={type:i.type,message:s.isFunction(i.message)?i.message(i):i.message};if(null!=e&&""!==e)return"string"==typeof i.regexp&&(i.regexp=new RegExp(i.regexp,i.flags)),(i.match?!i.regexp.test(e):i.regexp.test(e))?t:void 0};throw new Error('Missing required "regexp" option for "regexp" validator')},n.number=function(e){return e=s.extend({type:"number",message:this.errMessages.number,regexp:/^[-+]?([0-9]*.[0-9]+|[0-9]+)$/},e),n.regexp(e)},n.range=function(i){return i=s.extend({type:"range",message:this.errMessages.range,numberMessage:this.errMessages.number,min:0,max:100},i),function(e){i.value=e;var t={type:i.type,message:s.isFunction(i.message)?i.message(i):i.message};if(null!=e&&""!==e)return n.number({message:i.numberMessage})(e)||((e=parseFloat(i.value))<i.min||e>i.max?t:void 0)}},n.email=function(e){return e=s.extend({type:"email",message:this.errMessages.email,regexp:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i},e),n.regexp(e)},n.url=function(e){return e=s.extend({type:"url",message:this.errMessages.url,regexp:/^((http|https):\/\/)?(([A-Z0-9][A-Z0-9_\-]*)(\.[A-Z0-9][A-Z0-9_\-]*)+)(:(\d+))?\/?/i},e),n.regexp(e)},n.match=function(n){if(n.field)return n=s.extend({type:"match",message:this.errMessages.match},n),function(e,t){n.value=e;var i={type:n.type,message:s.isFunction(n.message)?n.message(n):n.message};return null!=e&&""!==e&&e!==t[n.field]?i:void 0};throw new Error('Missing required "field" options for "match" validator')},n),r.Fieldset=a.View.extend({initialize:function(e){var t=this.schema=this.createSchema((e=e||{}).schema);this.fields=s.pick(e.fields,t.fields),this.template=e.template||t.template||this.template||this.constructor.template},createSchema:function(e){return(e=s.isArray(e)?{fields:e}:e).legend=e.legend||null,e},getFieldAt:function(e){e=this.schema.fields[e];return this.fields[e]},templateData:function(){return this.schema},render:function(){this.schema;var n=this.fields,r=a.$,e=r(r.trim(this.template(s.result(this,"templateData"))));return e.find("[data-fields]").add(e).each(function(e,t){var i=r(t),t=i.attr("data-fields");s.isUndefined(t)||s.each(n,function(e){i.append(e.render().el)})}),this.setElement(e),this},remove:function(){s.each(this.fields,function(e){e.remove()}),a.View.prototype.remove.call(this)}},{template:s.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  ",null,r.templateSettings)}),r.Field=a.View.extend({initialize:function(e){s.extend(this,s.pick(e=e||{},"form","key","model","value","idPrefix"));var t=this.schema=this.createSchema(e.schema);this.template=e.template||t.template||this.template||this.constructor.template,this.errorClassName=e.errorClassName||t.errorClassName||this.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(e){return s.isString(e)&&(e={type:e}),(e=s.extend({type:"Text",title:this.createTitle()},e)).type=s.isString(e.type)?r.editors[e.type]:e.type,e},createEditor:function(){var e=s.extend(s.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()});return new this.schema.type(e)},createEditorId:function(){var e=this.idPrefix,t=(t=this.key).replace(/\./g,"_");return s.isString(e)||s.isNumber(e)?e+t:!s.isNull(e)&&this.model?this.model.cid+"_"+t:t},createTitle:function(){var e=this.key;return e=(e=e.replace(/([A-Z])/g," $1")).replace(/^./,function(e){return e.toUpperCase()})},templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,titleHTML:e.titleHTML,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var e,t=this.schema,n=this.editor,r=a.$;return!0===this.editor.noField?this.setElement(n.render().el):(e=r(r.trim(this.template(s.result(this,"templateData")))),t.fieldClass&&e.addClass(t.fieldClass),t.fieldAttrs&&e.attr(t.fieldAttrs),e.find("[data-editor]").add(e).each(function(e,t){var t=r(t),i=t.attr("data-editor");s.isUndefined(i)||t.append(n.render().el)}),this.setElement(e),this)},disable:function(){s.isFunction(this.editor.disable)?this.editor.disable():($input=($input=this.editor.$el).is("input")?$input:$input.find("input")).attr("disabled",!0)},enable:function(){s.isFunction(this.editor.enable)?this.editor.enable():($input=($input=this.editor.$el).is("input")?$input:$input.find("input")).attr("disabled",!1)},validate:function(){var e=this.editor.validate();return e?this.setError(e.message):this.clearError(),e},setError:function(e){this.editor.hasNestedForm||(this.$el.addClass(this.errorClassName),this.$("[data-error]").last().html(e))},clearError:function(){this.$el.removeClass(this.errorClassName),this.$("[data-error]").empty()},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),a.View.prototype.remove.call(this)}},{template:s.template('    <div>      <label for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div>        <span data-editor></span>        <div data-error></div>        <div><%= help %></div>      </div>    </div>  ',null,r.templateSettings),errorClassName:"error"}),r.NestedField=r.Field.extend({template:s.template('    <div>      <label for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div>        <span data-editor></span>        <div class="error-text" data-error></div>        <div class="error-help"><%= help %></div>      </div>    </div>  ',null,r.templateSettings)}),r.Editor=r.editors.Base=a.View.extend({defaultValue:null,hasFocus:!1,initialize:function(e){if((e=e||{}).model){if(!e.key)throw new Error("Missing option: 'key'");this.model=e.model,this.value=this.model.get(e.key)}else void 0!==e.value&&(this.value=e.value);void 0===this.value&&(this.value=this.defaultValue),s.extend(this,s.pick(e,"key","form"));var t=this.schema=e.schema||{};this.validators=e.validators||t.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),t.editorClass&&this.$el.addClass(t.editorClass),t.editorAttrs&&this.$el.attr(t.editorAttrs)},getName:function(){return(this.key||"").replace(/\./g,"_")},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(e){var i=this.validate();return i||(this.listenTo(this.model,"invalid",function(e,t){i=t}),this.model.set(this.key,this.getValue(),e),i)||void 0},validate:function(){this.$el;var t=null,i=this.getValue(),n=this.form?this.form.getValue():{},e=this.validators,r=this.getValidator;return e&&s.every(e,function(e){return!(t=r(e)(i,n))}),t},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),a.View.prototype.trigger.apply(this,arguments)},getValidator:function(e){var t=r.validators;if(s.isRegExp(e))return t.regexp({regexp:e});if(s.isString(e)){if(t[e])return t[e]();throw new Error('Validator "'+e+'" not found')}if(s.isFunction(e))return e;if(s.isObject(e)&&e.type)return t[e.type](e);throw new Error("Invalid validator: "+e)}}),r.editors.Text=r.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(e){var t=this;setTimeout(function(){t.determineChange()},0)},select:function(e){this.trigger("select",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e);var e=this.schema,t="text";e&&e.editorAttrs&&e.editorAttrs.type&&(t=e.editorAttrs.type),e&&e.dataType&&(t=e.dataType),this.$el.attr("type",t)},render:function(){return this.setValue(this.value),this},determineChange:function(e){var t=this.$el.val();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.value=e,this.$el.val(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),r.editors.TextArea=r.editors.Text.extend({tagName:"textarea",initialize:function(e){r.editors.Base.prototype.initialize.call(this,e)}}),r.editors.Password=r.editors.Text.extend({initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")}}),r.editors.Number=r.editors.Text.extend({defaultValue:0,events:s.extend({},r.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(e){r.editors.Text.prototype.initialize.call(this,e);e=this.schema;this.$el.attr("type","number"),e&&e.editorAttrs&&e.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(e){function t(){setTimeout(function(){n.determineChange()},0)}var i,n=this;0===e.charCode||(i=this.$el.val(),null!=e.charCode&&(i+=String.fromCharCode(e.charCode)),/^[0-9]*\.?[0-9]*?$/.test(i))?t():e.preventDefault()},getValue:function(){var e=this.$el.val();return""===e?null:parseFloat(e,10)},setValue:function(e){e=s.isNumber(e)?e:s.isString(e)&&""!==e?parseFloat(e,10):null,s.isNaN(e)&&(e=null),this.value=e,r.editors.Text.prototype.setValue.call(this,e)}}),r.editors.Hidden=r.editors.Text.extend({defaultValue:"",noField:!0,initialize:function(e){r.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),r.editors.Checkbox=r.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(e){e?this.$el.prop("checked",!0):this.$el.prop("checked",!1),this.value=!!e},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),r.editors.Select=r.editors.Base.extend({tagName:"select",previousValue:"",events:{keyup:"determineChange",keypress:function(e){var t=this;setTimeout(function(){t.determineChange()},0)},change:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){if(r.editors.Base.prototype.initialize.call(this,e),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},render:function(){return this.setOptions(this.schema.options),this},setOptions:function(t){var e,i=this;t instanceof a.Collection?0<(e=t).length?this.renderOptions(t):e.fetch({success:function(e){i.renderOptions(t)}}):s.isFunction(t)?t(function(e){i.renderOptions(e)},i):this.renderOptions(t)},renderOptions:function(e){var t=this.$el,e=this._getOptionsHtml(e);t.html(e),this.setValue(this.value)},_getOptionsHtml:function(e){var t,e=s.isString(e)?e:s.isArray(e)?this._arrayToHtml(e):e instanceof a.Collection?this._collectionToHtml(e):s.isFunction(e)?(e(function(e){t=e},this),this._getOptionsHtml(t)):this._objectToHtml(e);return e},determineChange:function(e){var t=this.getValue();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.$el.val()},setValue:function(e){this.value=e,this.$el.val(e)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},_collectionToHtml:function(e){var t=[];return e.each(function(e){t.push({val:e.id,label:e.toString()})}),this._arrayToHtml(t)},_objectToHtml:function(e){var t,i=[];for(t in e)e.hasOwnProperty(t)&&i.push({val:t,label:e[t]});return this._arrayToHtml(i)},_arrayToHtml:function(e){var i=$();return s.each(e,function(e){var t;i=s.isObject(e)?e.group?(t=$("<optgroup>").attr("label",e.group).html(this._getOptionsHtml(e.options)),i.add(t)):(t=e.val||0===e.val?e.val:"",i.add($("<option>").val(t).text(e.label))):i.add($("<option>").text(e))},this),i}}),r.editors.Radio=r.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("input[type=radio]:focus")[0]||e.trigger("blur",e)},0))}},getTemplate:function(){return this.schema.template||this.constructor.template},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(e){this.value=e,this.$("input[type=radio]").val([e])},focus:function(){var e;this.hasFocus||((e=this.$("input[type=radio]:checked"))[0]?e:this.$("input[type=radio]").first()).focus()},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(e){var t=this.getTemplate(),i=this.getName(),n=this.id;return t({items:s.map(e,function(e,t){t={name:i,id:n+"-"+t};return s.isObject(e)?(t.value=e.val||0===e.val?e.val:"",t.label=e.label,t.labelHTML=e.labelHTML):(t.value=e,t.label=e),t})})}},{template:s.template('    <% _.each(items, function(item) { %>      <li>        <input type="radio" name="<%= item.name %>" value="<%- item.value %>" id="<%= item.id %>" />        <label for="<%= item.id %>"><% if (item.labelHTML){ %><%= item.labelHTML %><% }else{ %><%- item.label %><% } %></label>      </li>    <% }); %>  ',null,r.templateSettings)}),r.editors.Checkboxes=r.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("input[type=checkbox]:focus")[0]||e.trigger("blur",e)},0))}},getValue:function(){var e=[],t=this;return this.$("input[type=checkbox]:checked").each(function(){e.push(t.$(this).val())}),e},setValue:function(e){s.isArray(e)||(e=[e]),this.value=e,this.$("input[type=checkbox]").val(e)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(e){var r=$(),o=this;return s.each(e,function(e,t){var i,n=$("<li>");s.isObject(e)?e.group?(i=o.id,o.id+="-"+o.groupNumber++,n=(n=$('<fieldset class="group">').append($("<legend>").text(e.group))).append(o._arrayToHtml(e.options)),o.id=i,close=!1):(i=e.val||0===e.val?e.val:"",n.append($('<input type="checkbox" name="'+o.getName()+'" id="'+o.id+"-"+t+'" />').val(i)),e.labelHTML?n.append($('<label for="'+o.id+"-"+t+'" />').html(e.labelHTML)):n.append($('<label for="'+o.id+"-"+t+'" />').text(e.label))):(n.append($('<input type="checkbox" name="'+o.getName()+'" id="'+o.id+"-"+t+'" />').val(e)),n.append($('<label for="'+o.id+"-"+t+'" />').text(e))),r=r.add(n)}),r}}),r.editors.Object=r.editors.Base.extend({hasNestedForm:!0,initialize:function(e){if(this.value={},r.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var e=this.form.constructor;return this.nestedForm=new e({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:e.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),a.View.prototype.remove.call(this)},validate:function(){var e=s.extend({},r.editors.Base.prototype.validate.call(this),this.nestedForm.validate());return!s.isEmpty(e)&&e},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var e=s.toArray(arguments);(e[1]=this).trigger.apply(this,e)},this)}}),r.editors.NestedModel=r.editors.Object.extend({initialize:function(e){if(r.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var e=this.form.constructor,t=this.value||{},i=(this.key,this.schema.model),i=t.constructor===i?t:new i(t);return this.nestedForm=new e({model:i,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var e=this.nestedForm.commit();return e?(this.$el.addClass("error"),e):r.editors.Object.prototype.commit.call(this)}}),r.editors.Date=r.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0))}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e=e||{});var t=r.editors.Date,i=new Date;this.options=s.extend({monthNames:t.monthNames,showMonthNames:t.showMonthNames},e),this.schema=s.extend({yearStart:i.getFullYear()-100,yearEnd:i.getFullYear()},e.schema||{}),this.value&&!s.isDate(this.value)&&(this.value=new Date(this.value)),this.value||((t=new Date).setSeconds(0),t.setMilliseconds(0),this.value=t),this.template=e.template||this.constructor.template},render:function(){var t=this.options,e=this.schema,i=a.$,n=s.map(s.range(1,32),function(e){return'<option value="'+e+'">'+e+"</option>"}),r=s.map(s.range(0,12),function(e){return'<option value="'+e+'">'+(t.showMonthNames?t.monthNames[e]:e+1)+"</option>"}),e=e.yearStart<e.yearEnd?s.range(e.yearStart,e.yearEnd+1):s.range(e.yearStart,e.yearEnd-1,-1),e=s.map(e,function(e){return'<option value="'+e+'">'+e+"</option>"}),n=i(i.trim(this.template({dates:n.join(""),months:r.join(""),years:e.join("")})));return this.$date=n.find('[data-type="date"]'),this.$month=n.find('[data-type="month"]'),this.$year=n.find('[data-type="year"]'),this.$hidden=i('<input type="hidden" name="'+this.key+'" />'),n.append(this.$hidden),this.setValue(this.value),this.setElement(n),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.$year.val(),t=this.$month.val(),i=this.$date.val();return e&&t&&i?new Date(e,t,i):null},setValue:function(e){this.value=e,this.$date.val(e.getDate()),this.$month.val(e.getMonth()),this.$year.val(e.getFullYear()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();s.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)}},{template:s.template('    <div>      <select data-type="date"><%= dates %></select>      <select data-type="month"><%= months %></select>      <select data-type="year"><%= years %></select>    </div>  ',null,r.templateSettings),showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),r.editors.DateTime=r.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0))}},initialize:function(e){r.editors.Base.prototype.initialize.call(this,e=e||{}),this.options=s.extend({DateEditor:r.editors.DateTime.DateEditor},e),this.schema=s.extend({minsInterval:15},e.schema||{}),this.dateEditor=new this.options.DateEditor(e),this.value=this.dateEditor.value,this.template=e.template||this.constructor.template},render:function(){function t(e){return e<10?"0"+e:e}var e=this.schema,i=a.$,n=s.map(s.range(0,24),function(e){return'<option value="'+e+'">'+t(e)+"</option>"}),e=s.map(s.range(0,60,e.minsInterval),function(e){return'<option value="'+e+'">'+t(e)+"</option>"}),i=i(i.trim(this.template({hours:n.join(),mins:e.join()})));return i.find("[data-date]").append(this.dateEditor.render().el),this.$hour=i.find('select[data-type="hour"]'),this.$min=i.find('select[data-type="min"]'),this.$hidden=i.find('input[type="hidden"]'),this.setValue(this.value),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.dateEditor.getValue(),t=this.$hour.val(),i=this.$min.val();return e&&t&&i?(e.setHours(t),e.setMinutes(i),e):null},setValue:function(e){s.isDate(e)||(e=new Date(e)),this.value=e,this.dateEditor.setValue(e),this.$hour.val(e.getHours()),this.$min.val(e.getMinutes()),this.updateHidden()},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();s.isDate(e)&&(e=e.toISOString()),this.$hidden.val(e)},remove:function(){this.dateEditor.remove(),r.editors.Base.prototype.remove.call(this)}},{template:s.template('    <div class="bbf-datetime">      <div class="bbf-date-container" data-date></div>      <select data-type="hour"><%= hours %></select>      :      <select data-type="min"><%= mins %></select>    </div>  ',null,r.templateSettings),DateEditor:r.editors.Date}),r.VERSION="0.14.0",a.Form=r,"undefined"!=typeof module&&(module.exports=r)}(window||global||this),!function(o){"use strict";function r(e,t){this.options=o.extend({},o.fn.editableform.defaults,t),this.$div=o(e),this.options.scope||(this.options.scope=this)}r.prototype={constructor:r,initInput:function(){this.input=this.options.input,this.value=this.input.str2value(this.options.value),this.input.prerender()},initTemplate:function(){this.$form=o(o.fn.editableform.template)},initButtons:function(){var e=this.$form.find(".editable-buttons");e.append(o.fn.editableform.buttons),"bottom"===this.options.showbuttons&&e.addClass("editable-buttons-bottom")},render:function(){this.$loading=o(o.fn.editableform.loading),this.$div.empty().append(this.$loading),this.initTemplate(),this.options.showbuttons?this.initButtons():this.$form.find(".editable-buttons").remove(),this.showLoading(),this.isSaving=!1,this.$div.triggerHandler("rendering"),this.initInput(),this.$form.find("div.editable-input").append(this.input.$tpl),this.$div.append(this.$form),o.when(this.input.render()).then(o.proxy(function(){var e;this.options.showbuttons||this.input.autosubmit(),this.$form.find(".editable-cancel").click(o.proxy(this.cancel,this)),this.input.error?(this.error(this.input.error),this.$form.find(".editable-submit").attr("disabled",!0),this.input.$input.attr("disabled",!0),this.$form.submit(function(e){e.preventDefault()})):(this.error(!1),this.input.$input.removeAttr("disabled"),this.$form.find(".editable-submit").removeAttr("disabled"),e=null===this.value||void 0===this.value||""===this.value?this.options.defaultValue:this.value,this.input.value2input(e),this.$form.submit(o.proxy(this.submit,this))),this.$div.triggerHandler("rendered"),this.showForm(),this.input.postrender&&this.input.postrender()},this))},cancel:function(){this.$div.triggerHandler("cancel")},showLoading:function(){var e,t;this.$form?(e=this.$form.outerWidth(),t=this.$form.outerHeight(),e&&this.$loading.width(e),t&&this.$loading.height(t),this.$form.hide()):(e=this.$loading.parent().width())&&this.$loading.width(e),this.$loading.show()},showForm:function(e){this.$loading.hide(),this.$form.show(),!1!==e&&this.input.activate(),this.$div.triggerHandler("show")},error:function(e){var t=this.$form.find(".control-group"),i=this.$form.find(".editable-error-block");if(!1===e)t.removeClass(o.fn.editableform.errorGroupClass),i.removeClass(o.fn.editableform.errorBlockClass).empty().hide();else{if(e){for(var n=(""+e).split("\n"),r=0;r<n.length;r++)n[r]=o("<div>").text(n[r]).html();e=n.join("<br>")}t.addClass(o.fn.editableform.errorGroupClass),i.addClass(o.fn.editableform.errorBlockClass).html(e).show()}},submit:function(e){e.stopPropagation(),e.preventDefault();var i,n=this.input.input2value(),e=this.validate(n);if("object"===o.type(e)&&void 0!==e.newValue){if(n=e.newValue,this.input.value2input(n),"string"==typeof e.msg)return this.error(e.msg),void this.showForm()}else if(e)return this.error(e),void this.showForm();this.options.savenochange||this.input.value2str(n)!==this.input.value2str(this.value)?(i=this.input.value2submit(n),this.isSaving=!0,o.when(this.save(i)).done(o.proxy(function(e){this.isSaving=!1;var t="function"==typeof this.options.success?this.options.success.call(this.options.scope,e,n):null;!1===t?(this.error(!1),this.showForm(!1)):"string"==typeof t?(this.error(t),this.showForm()):(t&&"object"==typeof t&&t.hasOwnProperty("newValue")&&(n=t.newValue),this.error(!1),this.value=n,this.$div.triggerHandler("save",{newValue:n,submitValue:i,response:e}))},this)).fail(o.proxy(function(e){this.isSaving=!1,e="function"==typeof this.options.error?this.options.error.call(this.options.scope,e,n):"string"==typeof e?e:e.responseText||e.statusText||"Unknown error!",this.error(e),this.showForm()},this))):this.$div.triggerHandler("nochange")},save:function(e){this.options.pk=o.fn.editableutils.tryParseJson(this.options.pk,!0);var t="function"==typeof this.options.pk?this.options.pk.call(this.options.scope):this.options.pk;if(!!("function"==typeof this.options.url||this.options.url&&("always"===this.options.send||"auto"===this.options.send&&null!=t)))return this.showLoading(),e={name:this.options.name||"",value:e,pk:t},"function"==typeof this.options.params?e=this.options.params.call(this.options.scope,e):(this.options.params=o.fn.editableutils.tryParseJson(this.options.params,!0),o.extend(e,this.options.params)),"function"==typeof this.options.url?this.options.url.call(this.options.scope,e):o.ajax(o.extend({url:this.options.url,data:e,type:"POST"},this.options.ajaxOptions))},validate:function(e){if(void 0===e&&(e=this.value),"function"==typeof this.options.validate)return this.options.validate.call(this.options.scope,e)},option:function(e,t){e in this.options&&(this.options[e]=t),"value"===e&&this.setValue(t)},setValue:function(e,t){this.value=t?this.input.str2value(e):e,this.$form&&this.$form.is(":visible")&&this.input.value2input(this.value)}},o.fn.editableform=function(i){var n=arguments;return this.each(function(){var e=o(this),t=e.data("editableform");t||e.data("editableform",t=new r(this,"object"==typeof i&&i)),"string"==typeof i&&t[i].apply(t,Array.prototype.slice.call(n,1))})},o.fn.editableform.Constructor=r,o.fn.editableform.defaults={type:"text",url:null,params:null,name:null,pk:null,value:null,defaultValue:null,send:"auto",validate:null,success:null,error:null,ajaxOptions:null,showbuttons:!0,scope:null,savenochange:!1},o.fn.editableform.template='<form class="form-inline editableform"><div class="control-group"><div><div class="editable-input"></div><div class="editable-buttons"></div></div><div class="editable-error-block"></div></div></form>',o.fn.editableform.loading='<div class="editableform-loading"></div>',o.fn.editableform.buttons='<button type="submit" class="editable-submit">ok</button><button type="button" class="editable-cancel">cancel</button>',o.fn.editableform.errorGroupClass=null,o.fn.editableform.errorBlockClass="editable-error",o.fn.editableform.engine="jquery"}(window.jQuery),!function(l){"use strict";l.fn.editableutils={inherit:function(e,t){function i(){}i.prototype=t.prototype,e.prototype=new i,(e.prototype.constructor=e).superclass=t.prototype},setCursorPosition:function(e,t){e.setSelectionRange?e.setSelectionRange(t,t):e.createTextRange&&((e=e.createTextRange()).collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select())},tryParseJson:function(e,t){if("string"==typeof e&&e.length&&e.match(/^[\{\[].*[\}\]]$/))if(t)try{e=new Function("return "+e)()}catch(e){}finally{return e}else e=new Function("return "+e)();return e},sliceObj:function(e,t,i){var n,r,o={};if(l.isArray(t)&&t.length)for(var s=0;s<t.length;s++)n=t[s],e.hasOwnProperty(n)&&(o[n]=e[n]),!0!==i&&(r=n.toLowerCase(),e.hasOwnProperty(r))&&(o[n]=e[r]);return o},getConfigData:function(e){var i={};return l.each(e.data(),function(e,t){"object"==typeof t&&(!t||"object"!=typeof t||t.constructor!==Object&&t.constructor!==Array)||(i[e]=t)}),i},objectKeys:function(e){if(Object.keys)return Object.keys(e);if(e!==Object(e))throw new TypeError("Object.keys called on a non-object");var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i},escape:function(e){return l("<div>").text(e).html()},itemsByValue:function(n,e,r){var t,o,s,a;return e&&null!==n?("function"!=typeof r&&(t=r||"value",r=function(e){return e[t]}),o=l.isArray(n),s=[],a=this,l.each(e,function(e,t){var i;t.children?s=s.concat(a.itemsByValue(n,t.children,r)):o?l.grep(n,function(e){return e==(t&&"object"==typeof t?r(t):t)}).length&&s.push(t):(i=t&&"object"==typeof t?r(t):t,n==i&&s.push(t))}),s):[]},createInput:function(e){var t,i=e.type;return"date"===i&&("inline"===e.mode?l.fn.editabletypes.datefield?i="datefield":l.fn.editabletypes.dateuifield&&(i="dateuifield"):l.fn.editabletypes.date?i="date":l.fn.editabletypes.dateui&&(i="dateui"),"date"!==i||l.fn.editabletypes.date||(i="combodate")),"wysihtml5"!==(i="datetime"===i&&"inline"===e.mode?"datetimefield":i)||l.fn.editabletypes[i]||(i="textarea"),"function"==typeof l.fn.editabletypes[i]?new(t=l.fn.editabletypes[i])(this.sliceObj(e,this.objectKeys(t.defaults))):(l.error("Unknown type: "+i),!1)},supportsTransitions:function(){var e=(document.body||document.documentElement).style,t=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof e[i="transition"])return!0;for(var i=i.charAt(0).toUpperCase()+i.substr(1),n=0;n<t.length;n++)if("string"==typeof e[t[n]+i])return!0;return!1}}}(window.jQuery),!function(a){"use strict";function l(e,t){this.init(e,t)}function u(e,t){this.init(e,t)}l.prototype={containerName:null,containerDataName:null,innerCss:null,containerClass:"editable-container editable-popup",defaults:{},init:function(e,t){this.$element=a(e),this.options=a.extend({},a.fn.editableContainer.defaults,t),this.splitOptions(),this.formOptions.scope=this.$element[0],this.initContainer(),this.delayedHide=!1,this.$element.on("destroyed",a.proxy(function(){this.destroy()},this)),a(document).data("editable-handlers-attached")||(a(document).on("keyup.editable",function(e){27===e.which&&a(".editable-open").editableContainer("hide")}),a(document).on("click.editable",function(e){var t,i=a(e.target),n=[".editable-container",".ui-datepicker-header",".datepicker",".modal-backdrop",".bootstrap-wysihtml5-insert-image-modal",".bootstrap-wysihtml5-insert-link-modal"];if(!a(".select2-drop-mask").is(":visible")&&a.contains(document.documentElement,e.target)&&!i.is(document)){for(t=0;t<n.length;t++)if(i.is(n[t])||i.parents(n[t]).length)return;l.prototype.closeOthers(e.target)}}),a(document).data("editable-handlers-attached",!0))},splitOptions:function(){if(this.containerOptions={},this.formOptions={},!a.fn[this.containerName])throw new Error(this.containerName+" not found. Have you included corresponding js file?");for(var e in this.options)e in this.defaults?this.containerOptions[e]=this.options[e]:this.formOptions[e]=this.options[e]},tip:function(){return this.container()?this.container().$tip:null},container:function(){var e;return e=this.containerDataName&&(e=this.$element.data(this.containerDataName))?e:this.$element.data(this.containerName)},call:function(){this.$element[this.containerName].apply(this.$element,arguments)},initContainer:function(){this.call(this.containerOptions)},renderForm:function(){this.$form.editableform(this.formOptions).on({save:a.proxy(this.save,this),nochange:a.proxy(function(){this.hide("nochange")},this),cancel:a.proxy(function(){this.hide("cancel")},this),show:a.proxy(function(){this.delayedHide?(this.hide(this.delayedHide.reason),this.delayedHide=!1):this.setPosition()},this),rendering:a.proxy(this.setPosition,this),resize:a.proxy(this.setPosition,this),rendered:a.proxy(function(){this.$element.triggerHandler("shown",a(this.options.scope).data("editable"))},this)}).editableform("render")},show:function(e){this.$element.addClass("editable-open"),!1!==e&&this.closeOthers(this.$element[0]),this.innerShow(),this.tip().addClass(this.containerClass),this.$form,this.$form=a("<div>"),(this.tip().is(this.innerCss)?this.tip():this.tip().find(this.innerCss)).append(this.$form),this.renderForm()},hide:function(e){this.tip()&&this.tip().is(":visible")&&this.$element.hasClass("editable-open")&&(this.$form.data("editableform").isSaving?this.delayedHide={reason:e}:(this.delayedHide=!1,this.$element.removeClass("editable-open"),this.innerHide(),this.$element.triggerHandler("hidden",e||"manual")))},innerShow:function(){},innerHide:function(){},toggle:function(e){this.container()&&this.tip()&&this.tip().is(":visible")?this.hide():this.show(e)},setPosition:function(){},save:function(e,t){this.$element.triggerHandler("save",t),this.hide("save")},option:function(e,t){this.options[e]=t,e in this.containerOptions?(this.containerOptions[e]=t,this.setContainerOption(e,t)):(this.formOptions[e]=t,this.$form&&this.$form.editableform("option",e,t))},setContainerOption:function(e,t){this.call("option",e,t)},destroy:function(){this.hide(),this.innerDestroy(),this.$element.off("destroyed"),this.$element.removeData("editableContainer")},innerDestroy:function(){},closeOthers:function(n){a(".editable-open").each(function(e,t){var i;t===n||a(t).find(n).length||(i=(t=a(t)).data("editableContainer"))&&("cancel"===i.options.onblur?t.data("editableContainer").hide("onblur"):"submit"===i.options.onblur&&t.data("editableContainer").tip().find("form").submit())})},activate:function(){this.tip&&this.tip().is(":visible")&&this.$form&&this.$form.data("editableform").input.activate()}},a.fn.editableContainer=function(o){var s=arguments;return this.each(function(){var e=a(this),t="editableContainer",i=e.data(t),n="object"==typeof o&&o,r="inline"===n.mode?u:l;i||e.data(t,i=new r(this,n)),"string"==typeof o&&i[o].apply(i,Array.prototype.slice.call(s,1))})},a.fn.editableContainer.Popup=l,a.fn.editableContainer.Inline=u,a.fn.editableContainer.defaults={value:null,placement:"top",autohide:!0,onblur:"cancel",anim:!1,mode:"popup"},jQuery.event.special.destroyed={remove:function(e){e.handler&&e.handler()}}}(window.jQuery),!function(e){"use strict";e.extend(e.fn.editableContainer.Inline.prototype,e.fn.editableContainer.Popup.prototype,{containerName:"editableform",innerCss:".editable-inline",containerClass:"editable-container editable-inline",initContainer:function(){this.$tip=e("<span></span>"),this.options.anim||(this.options.anim=0)},splitOptions:function(){this.containerOptions={},this.formOptions=this.options},tip:function(){return this.$tip},innerShow:function(){this.$element.hide(),this.tip().insertAfter(this.$element).show()},innerHide:function(){this.$tip.hide(this.options.anim,e.proxy(function(){this.$element.show(),this.innerDestroy()},this))},innerDestroy:function(){this.tip()&&this.tip().empty().remove()}})}(window.jQuery),!function(c){"use strict";function d(e,t){this.$element=c(e),this.options=c.extend({},c.fn.editable.defaults,t,c.fn.editableutils.getConfigData(this.$element)),this.options.selector?this.initLive():this.init(),this.options.highlight&&!c.fn.editableutils.supportsTransitions()&&(this.options.highlight=!1)}d.prototype={constructor:d,init:function(){var e,t=!1;if(this.options.name=this.options.name||this.$element.attr("id"),this.options.scope=this.$element[0],this.input=c.fn.editableutils.createInput(this.options),this.input){switch(void 0===this.options.value||null===this.options.value?(this.value=this.input.html2value(c.trim(this.$element.html())),t=!0):(this.options.value=c.fn.editableutils.tryParseJson(this.options.value,!0),"string"==typeof this.options.value?this.value=this.input.str2value(this.options.value):this.value=this.options.value),this.$element.addClass("editable"),"textarea"===this.input.type&&this.$element.addClass("editable-pre-wrapped"),"manual"!==this.options.toggle?(this.$element.addClass("editable-click"),this.$element.on(this.options.toggle+".editable",c.proxy(function(e){this.options.disabled||e.preventDefault(),"mouseenter"===this.options.toggle?this.show():(e="click"!==this.options.toggle,this.toggle(e))},this))):this.$element.attr("tabindex",-1),"function"==typeof this.options.display&&(this.options.autotext="always"),this.options.autotext){case"always":e=!0;break;case"auto":e=!c.trim(this.$element.text()).length&&null!==this.value&&void 0!==this.value&&!t;break;default:e=!1}c.when(!e||this.render()).then(c.proxy(function(){this.options.disabled?this.disable():this.enable(),this.$element.triggerHandler("init",this)},this))}},initLive:function(){var e=this.options.selector;this.options.selector=!1,this.options.autotext="never",this.$element.on(this.options.toggle+".editable",e,c.proxy(function(e){var t=c(e.target);t.data("editable")||(t.hasClass(this.options.emptyclass)&&t.empty(),t.editable(this.options).trigger(e))},this))},render:function(e){if(!1!==this.options.display)return this.input.value2htmlFinal?this.input.value2html(this.value,this.$element[0],this.options.display,e):"function"==typeof this.options.display?this.options.display.call(this.$element[0],this.value,e):this.input.value2html(this.value,this.$element[0])},enable:function(){this.options.disabled=!1,this.$element.removeClass("editable-disabled"),this.handleEmpty(this.isEmpty),"manual"!==this.options.toggle&&"-1"===this.$element.attr("tabindex")&&this.$element.removeAttr("tabindex")},disable:function(){this.options.disabled=!0,this.hide(),this.$element.addClass("editable-disabled"),this.handleEmpty(this.isEmpty),this.$element.attr("tabindex",-1)},toggleDisabled:function(){this.options.disabled?this.enable():this.disable()},option:function(e,t){if(e&&"object"==typeof e)c.each(e,c.proxy(function(e,t){this.option(c.trim(e),t)},this));else{if(this.options[e]=t,"disabled"===e)return t?this.disable():this.enable();"value"===e&&this.setValue(t),this.container&&this.container.option(e,t),this.input.option&&this.input.option(e,t)}},handleEmpty:function(e){!1!==this.options.display&&(void 0!==e?this.isEmpty=e:"function"==typeof this.input.isEmpty?this.isEmpty=this.input.isEmpty(this.$element):this.isEmpty=""===c.trim(this.$element.html()),this.options.disabled?this.isEmpty&&(this.$element.empty(),this.options.emptyclass)&&this.$element.removeClass(this.options.emptyclass):this.isEmpty?(this.$element.html(this.options.emptytext),this.options.emptyclass&&this.$element.addClass(this.options.emptyclass)):this.options.emptyclass&&this.$element.removeClass(this.options.emptyclass))},show:function(e){if(!this.options.disabled){if(this.container){if(this.container.tip().is(":visible"))return}else{var t=c.extend({},this.options,{value:this.value,input:this.input});this.$element.editableContainer(t),this.$element.on("save.internal",c.proxy(this.save,this)),this.container=this.$element.data("editableContainer")}this.container.show(e)}},hide:function(){this.container&&this.container.hide()},toggle:function(e){this.container&&this.container.tip().is(":visible")?this.hide():this.show(e)},save:function(e,t){var i,n;this.options.unsavedclass&&("function"==typeof this.options.url||!1===this.options.display||void 0!==t.response||this.options.savenochange&&this.input.value2str(this.value)!==this.input.value2str(t.newValue)?this.$element.removeClass(this.options.unsavedclass):this.$element.addClass(this.options.unsavedclass)),this.options.highlight&&(i=this.$element,n=i.css("background-color"),i.css("background-color",this.options.highlight),setTimeout(function(){"transparent"===n&&(n=""),i.css("background-color",n),i.addClass("editable-bg-transition"),setTimeout(function(){i.removeClass("editable-bg-transition")},1700)},10)),this.setValue(t.newValue,!1,t.response)},validate:function(){if("function"==typeof this.options.validate)return this.options.validate.call(this,this.value)},setValue:function(e,t,i){this.value=t?this.input.str2value(e):e,this.container&&this.container.option("value",this.value),c.when(this.render(i)).then(c.proxy(function(){this.handleEmpty()},this))},activate:function(){this.container&&this.container.activate()},destroy:function(){this.disable(),this.container&&this.container.destroy(),this.input.destroy(),"manual"!==this.options.toggle&&(this.$element.removeClass("editable-click"),this.$element.off(this.options.toggle+".editable")),this.$element.off("save.internal"),this.$element.removeClass("editable editable-open editable-disabled"),this.$element.removeData("editable")}},c.fn.editable=function(n){var i={},r=arguments,o="editable";switch(n){case"validate":return this.each(function(){var e,t=c(this).data(o);t&&(e=t.validate())&&(i[t.options.name]=e)}),i;case"getValue":return 2===arguments.length&&!0===arguments[1]?i=this.eq(0).data(o).value:this.each(function(){var e=c(this).data(o);e&&void 0!==e.value&&null!==e.value&&(i[e.options.name]=e.input.value2submit(e.value))}),i;case"submit":var e,t,s,a=arguments[1]||{},l=this,u=this.editable("validate");return c.isEmptyObject(u)?(s={},1===l.length?(t={name:(e=l.data("editable")).options.name||"",value:e.input.value2submit(e.value),pk:"function"==typeof e.options.pk?e.options.pk.call(e.options.scope):e.options.pk},"function"==typeof e.options.params?t=e.options.params.call(e.options.scope,t):(e.options.params=c.fn.editableutils.tryParseJson(e.options.params,!0),c.extend(t,e.options.params)),s={url:e.options.url,data:t,type:"POST"},a.success=a.success||e.options.success,a.error=a.error||e.options.error):(t=this.editable("getValue"),s={url:a.url,data:t,type:"POST"}),s.success="function"==typeof a.success?function(e){a.success.call(l,e,a)}:c.noop,s.error="function"==typeof a.error?function(){a.error.apply(l,arguments)}:c.noop,a.ajaxOptions&&c.extend(s,a.ajaxOptions),a.data&&c.extend(s.data,a.data),c.ajax(s)):"function"==typeof a.error&&a.error.call(l,u),this}return this.each(function(){var e=c(this),t=e.data(o),i="object"==typeof n&&n;i&&i.selector?t=new d(this,i):(t||e.data(o,t=new d(this,i)),"string"==typeof n&&t[n].apply(t,Array.prototype.slice.call(r,1)))})},c.fn.editable.defaults={type:"text",disabled:!1,toggle:"click",emptytext:"Empty",autotext:"auto",value:null,display:null,emptyclass:"editable-empty",unsavedclass:"editable-unsaved",selector:null,highlight:"#FFFF80"}}(window.jQuery),!function(n){"use strict";n.fn.editabletypes={};function e(){}e.prototype={init:function(e,t,i){this.type=e,this.options=n.extend({},i,t)},prerender:function(){this.$tpl=n(this.options.tpl),this.$input=this.$tpl,this.$clear=null,this.error=null},render:function(){},value2html:function(e,t){n(t)[this.options.escape?"text":"html"](n.trim(e))},html2value:function(e){return n("<div>").html(e).text()},value2str:function(e){return e},str2value:function(e){return e},value2submit:function(e){return e},value2input:function(e){this.$input.val(e)},input2value:function(){return this.$input.val()},activate:function(){this.$input.is(":visible")&&this.$input.focus()},clear:function(){this.$input.val(null)},escape:function(e){return n("<div>").text(e).html()},autosubmit:function(){},destroy:function(){},setClass:function(){this.options.inputclass&&this.$input.addClass(this.options.inputclass)},setAttr:function(e){void 0!==this.options[e]&&null!==this.options[e]&&this.$input.attr(e,this.options[e])},option:function(e,t){this.options[e]=t}},e.defaults={tpl:"",inputclass:null,escape:!0,scope:null,showbuttons:!0},n.extend(n.fn.editabletypes,{abstractinput:e})}(window.jQuery),!function(a){"use strict";function e(e){}a.fn.editableutils.inherit(e,a.fn.editabletypes.abstractinput),a.extend(e.prototype,{render:function(){var e=a.Deferred();return this.error=null,this.onSourceReady(function(){this.renderList(),e.resolve()},function(){this.error=this.options.sourceError,e.resolve()}),e.promise()},html2value:function(e){return null},value2html:function(e,t,i,n){function r(){"function"==typeof i?i.call(t,e,this.sourceData,n):this.value2htmlFinal(e,t),o.resolve()}var o=a.Deferred();return null===e?r.call(this):this.onSourceReady(r,function(){o.resolve()}),o.promise()},onSourceReady:function(t,i){var e;if(a.isFunction(this.options.source)?(e=this.options.source.call(this.options.scope),this.sourceData=null):e=this.options.source,this.options.sourceCache&&a.isArray(this.sourceData))t.call(this);else{try{e=a.fn.editableutils.tryParseJson(e,!1)}catch(e){return void i.call(this)}if("string"==typeof e){if(this.options.sourceCache){var n,r=e;if(a(document).data(r)||a(document).data(r,{}),!1===(n=a(document).data(r)).loading&&n.sourceData)return this.sourceData=n.sourceData,this.doPrepend(),void t.call(this);if(!0===n.loading)return n.callbacks.push(a.proxy(function(){this.sourceData=n.sourceData,this.doPrepend(),t.call(this)},this)),void n.err_callbacks.push(a.proxy(i,this));n.loading=!0,n.callbacks=[],n.err_callbacks=[]}r=a.extend({url:e,type:"get",cache:!1,dataType:"json",success:a.proxy(function(e){n&&(n.loading=!1),this.sourceData=this.makeArray(e),a.isArray(this.sourceData)?(n&&(n.sourceData=this.sourceData,a.each(n.callbacks,function(){this.call()})),this.doPrepend(),t.call(this)):(i.call(this),n&&a.each(n.err_callbacks,function(){this.call()}))},this),error:a.proxy(function(){i.call(this),n&&(n.loading=!1,a.each(n.err_callbacks,function(){this.call()}))},this)},this.options.sourceOptions);a.ajax(r)}else this.sourceData=this.makeArray(e),(a.isArray(this.sourceData)?(this.doPrepend(),t):i).call(this)}},doPrepend:function(){null!==this.options.prepend&&void 0!==this.options.prepend&&(a.isArray(this.prependData)||(a.isFunction(this.options.prepend)&&(this.options.prepend=this.options.prepend.call(this.options.scope)),this.options.prepend=a.fn.editableutils.tryParseJson(this.options.prepend,!0),"string"==typeof this.options.prepend&&(this.options.prepend={"":this.options.prepend}),this.prependData=this.makeArray(this.options.prepend)),a.isArray(this.prependData))&&a.isArray(this.sourceData)&&(this.sourceData=this.prependData.concat(this.sourceData))},renderList:function(){},value2htmlFinal:function(e,t){},makeArray:function(e){var i,n,t,r=[];if(!e||"string"==typeof e)return null;if(a.isArray(e))for(var o=function(e,t){if(n={value:e,text:t},2<=i++)return!1},s=0;s<e.length;s++)"object"==typeof(t=e[s])?(i=0,a.each(t,o),1===i?r.push(n):1<i&&(t.children&&(t.children=this.makeArray(t.children)),r.push(t))):r.push({value:t,text:t});else a.each(e,function(e,t){r.push({value:e,text:t})});return r},option:function(e,t){this.options[e]=t,"source"===e&&(this.sourceData=null),"prepend"===e&&(this.prependData=null)}}),e.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{source:null,prepend:!1,sourceError:"Error when loading list",sourceCache:!0,sourceOptions:null}),a.fn.editabletypes.list=e}(window.jQuery),!function(i){"use strict";function t(e){this.init("text",e,t.defaults)}i.fn.editableutils.inherit(t,i.fn.editabletypes.abstractinput),i.extend(t.prototype,{render:function(){this.renderClear(),this.setClass(),this.setAttr("placeholder")},activate:function(){this.$input.is(":visible")&&(this.$input.focus(),this.$input.is("input,textarea")&&!this.$input.is('[type="checkbox"],[type="range"]')&&i.fn.editableutils.setCursorPosition(this.$input.get(0),this.$input.val().length),this.toggleClear)&&this.toggleClear()},renderClear:function(){this.options.clear&&(this.$clear=i('<span class="editable-clear-x"></span>'),this.$input.after(this.$clear).css("padding-right",24).keyup(i.proxy(function(e){var t;~i.inArray(e.keyCode,[40,38,9,13,27])||(clearTimeout(this.t),(t=this).t=setTimeout(function(){t.toggleClear(e)},100))},this)).parent().css("position","relative"),this.$clear.click(i.proxy(this.clear,this)))},postrender:function(){},toggleClear:function(e){var t,i;this.$clear&&(t=this.$input.val().length,i=this.$clear.is(":visible"),t&&!i&&this.$clear.show(),!t)&&i&&this.$clear.hide()},clear:function(){this.$clear.hide(),this.$input.val("").focus()}}),t.defaults=i.extend({},i.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',placeholder:null,clear:!0}),i.fn.editabletypes.text=t}(window.jQuery),!function(t){"use strict";function i(e){this.init("textarea",e,i.defaults)}t.fn.editableutils.inherit(i,t.fn.editabletypes.abstractinput),t.extend(i.prototype,{render:function(){this.setClass(),this.setAttr("placeholder"),this.setAttr("rows"),this.$input.keydown(function(e){e.ctrlKey&&13===e.which&&t(this).closest("form").submit()})},activate:function(){t.fn.editabletypes.text.prototype.activate.call(this)}}),i.defaults=t.extend({},t.fn.editabletypes.abstractinput.defaults,{tpl:"<textarea></textarea>",inputclass:"input-large",placeholder:null,rows:7}),t.fn.editabletypes.textarea=i}(window.jQuery),!function(s){"use strict";function t(e){this.init("select",e,t.defaults)}s.fn.editableutils.inherit(t,s.fn.editabletypes.list),s.extend(t.prototype,{renderList:function(){this.$input.empty();var r=this.options.escape,o=function(e,t){if(s.isArray(t))for(var i=0;i<t.length;i++){var n={};t[i].children?(n.label=t[i].text,e.append(o(s("<optgroup>",n),t[i].children))):(n.value=t[i].value,t[i].disabled&&(n.disabled=!0),(n=s("<option>",n))[r?"text":"html"](t[i].text),e.append(n))}return e};o(this.$input,this.sourceData),this.setClass(),this.$input.on("keydown.editable",function(e){13===e.which&&s(this).closest("form").submit()})},value2htmlFinal:function(e,t){var i="",e=s.fn.editableutils.itemsByValue(e,this.sourceData);e.length&&(i=e[0].text),s.fn.editabletypes.abstractinput.prototype.value2html.call(this,i,t)},autosubmit:function(){this.$input.off("keydown.editable").on("change.editable",function(){s(this).closest("form").submit()})}}),t.defaults=s.extend({},s.fn.editabletypes.list.defaults,{tpl:"<select></select>"}),s.fn.editabletypes.select=t}(window.jQuery),!function(r){"use strict";function t(e){this.init("checklist",e,t.defaults)}r.fn.editableutils.inherit(t,r.fn.editabletypes.list),r.extend(t.prototype,{renderList:function(){if(this.$tpl.empty(),r.isArray(this.sourceData)){for(var e=0;e<this.sourceData.length;e++){var t=r("<label>").append(r("<input>",{type:"checkbox",value:this.sourceData[e].value})),i=r("<span>");i[this.options.escape?"text":"html"](" "+this.sourceData[e].text),t.append(i),r("<div>").append(t).appendTo(this.$tpl)}this.$input=this.$tpl.find('input[type="checkbox"]'),this.setClass()}},value2str:function(e){return r.isArray(e)?e.sort().join(r.trim(this.options.separator)):""},str2value:function(e){var t;return"string"==typeof e&&e.length?(t=new RegExp("\\s*"+r.trim(this.options.separator)+"\\s*"),e.split(t)):r.isArray(e)?e:[e]},value2input:function(n){this.$input.prop("checked",!1),r.isArray(n)&&n.length&&this.$input.each(function(e,t){var i=r(t);r.each(n,function(e,t){i.val()==t&&i.prop("checked",!0)})})},input2value:function(){var i=[];return this.$input.filter(":checked").each(function(e,t){i.push(r(t).val())}),i},value2htmlFinal:function(e,t){var i=[],e=r.fn.editableutils.itemsByValue(e,this.sourceData),n=this.options.escape;e.length?(r.each(e,function(e,t){t=n?r.fn.editableutils.escape(t.text):t.text;i.push(t)}),r(t).html(i.join("<br>"))):r(t).empty()},activate:function(){this.$input.first().focus()},autosubmit:function(){this.$input.on("keydown",function(e){13===e.which&&r(this).closest("form").submit()})}}),t.defaults=r.extend({},r.fn.editabletypes.list.defaults,{tpl:'<div class="editable-checklist"></div>',inputclass:null,separator:","}),r.fn.editabletypes.checklist=t}(window.jQuery),!function(i){"use strict";function t(e){this.init("password",e,t.defaults)}i.fn.editableutils.inherit(t,i.fn.editabletypes.text),i.extend(t.prototype,{value2html:function(e,t){e?i(t).text("[hidden]"):i(t).empty()},html2value:function(e){return null}}),t.defaults=i.extend({},i.fn.editabletypes.text.defaults,{tpl:'<input type="password">'}),i.fn.editabletypes.password=t}(window.jQuery),!function(e){"use strict";function t(e){this.init("email",e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.text),t.defaults=e.extend({},e.fn.editabletypes.text.defaults,{tpl:'<input type="email">'}),e.fn.editabletypes.email=t}(window.jQuery),!function(e){"use strict";function t(e){this.init("url",e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.text),t.defaults=e.extend({},e.fn.editabletypes.text.defaults,{tpl:'<input type="url">'}),e.fn.editabletypes.url=t}(window.jQuery),!function(e){"use strict";function t(e){this.init("tel",e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.text),t.defaults=e.extend({},e.fn.editabletypes.text.defaults,{tpl:'<input type="tel">'}),e.fn.editabletypes.tel=t}(window.jQuery),!function(e){"use strict";function t(e){this.init("number",e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.text),e.extend(t.prototype,{render:function(){t.superclass.render.call(this),this.setAttr("min"),this.setAttr("max"),this.setAttr("step")},postrender:function(){this.$clear&&this.$clear.css({right:24})}}),t.defaults=e.extend({},e.fn.editabletypes.text.defaults,{tpl:'<input type="number">',inputclass:"input-mini",min:null,max:null,step:null}),e.fn.editabletypes.number=t}(window.jQuery),!function(e){"use strict";function t(e){this.init("range",e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.number),e.extend(t.prototype,{render:function(){this.$input=this.$tpl.filter("input"),this.setClass(),this.setAttr("min"),this.setAttr("max"),this.setAttr("step"),this.$input.on("input",function(){e(this).siblings("output").text(e(this).val())})},activate:function(){this.$input.focus()}}),t.defaults=e.extend({},e.fn.editabletypes.number.defaults,{tpl:'<input type="range"><output style="width: 30px; display: inline-block"></output>',inputclass:"input-medium"}),e.fn.editabletypes.range=t}(window.jQuery),!function(e){"use strict";function t(e){this.init("time",e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.abstractinput),e.extend(t.prototype,{render:function(){this.setClass()}}),t.defaults=e.extend({},e.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="time">'}),e.fn.editabletypes.time=t}(window.jQuery),!function(o){"use strict";function s(e){var t,i;this.init("select2",e,s.defaults),e.select2=e.select2||{},this.sourceData=null,e.placeholder&&(e.select2.placeholder=e.placeholder),!e.select2.tags&&e.source&&(t=e.source,"string"==typeof(t=o.isFunction(e.source)?e.source.call(e.scope):t)?(e.select2.ajax=e.select2.ajax||{},e.select2.ajax.dataType||(e.select2.ajax.dataType="json"),e.select2.ajax.data||(e.select2.ajax.data=function(e){return{query:e}}),e.select2.ajax.processResults||(e.select2.ajax.processResults=function(e){return{results:e}}),e.select2.ajax.url=t):(this.sourceData=this.convertSource(t),e.select2.data=this.sourceData)),this.options.select2=o.extend({},s.defaults.select2,e.select2),this.isMultiple=this.options.select2.tags||this.options.select2.multiple,this.isRemote="ajax"in this.options.select2,this.idFunc=this.options.select2.id,"function"!=typeof this.idFunc&&(i=this.idFunc||"id",this.idFunc=function(e){return e[i]}),this.formatSelection=this.options.select2.formatSelection,"function"!=typeof this.formatSelection&&(this.formatSelection=function(e){return e.text})}o.fn.editableutils.inherit(s,o.fn.editabletypes.abstractinput),o.extend(s.prototype,{render:function(){this.setClass(),this.isRemote&&this.$input.on("select2-loaded",o.proxy(function(e){this.sourceData=e.items.results},this)),this.isMultiple&&this.$input.on("change",function(){o(this).closest("form").parent().triggerHandler("resize")})},value2html:function(e,t){var i,n="",r=this;this.options.select2.tags?i=e:this.sourceData&&(i=o.fn.editableutils.itemsByValue(e,this.sourceData,this.idFunc)),o.isArray(i)?(n=[],o.each(i,function(e,t){n.push(t&&"object"==typeof t?r.formatSelection(t):t)})):i&&(n=r.formatSelection(i)),n=o.isArray(n)?n.join(this.options.viewseparator):n,s.superclass.value2html.call(this,n,t)},html2value:function(e){return this.options.select2.tags?this.str2value(e,this.options.viewseparator):null},value2input:function(e){var t,i;o.isArray(e)&&(e=e.join(this.getSeparator())),this.$input.data("select2")?this.$input.val(e).trigger("change",!0):(this.$input.val(e),this.$input.select2(this.options.select2)),!this.isRemote||this.isMultiple||this.options.select2.initSelection||(t=this.options.select2.id,i=this.options.select2.formatSelection,t)||i||(t=o(this.options.scope)).data("editable").isEmpty||(i={id:e,text:t.text()},this.$input.select2("data",i))},input2value:function(){return this.$input.select2("val")},str2value:function(e,t){if("string"!=typeof e||!this.isMultiple)return e;var i,n,r;if(t=t||this.getSeparator(),null===e||e.length<1)return null;for(n=0,r=(i=e.split(t)).length;n<r;n+=1)i[n]=o.trim(i[n]);return i},autosubmit:function(){this.$input.on("change",function(e,t){t||o(this).closest("form").submit()})},getSeparator:function(){return this.options.select2.separator||o.fn.select2.defaults.separator},convertSource:function(e){if(o.isArray(e)&&e.length&&void 0!==e[0].value)for(var t=0;t<e.length;t++)void 0!==e[t].value&&(e[t].id=e[t].value,delete e[t].value);return e},destroy:function(){this.$input.data("select2")&&this.$input.select2("destroy")}}),s.defaults=o.extend({},o.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="hidden">',select2:null,placeholder:null,source:null,viewseparator:", "}),o.fn.editabletypes.select2=s}(window.jQuery),!function(s){function r(e,t){this.$element=s(e),this.$element.is("input")?(this.options=s.extend({},s.fn.combodate.defaults,t,this.$element.data()),this.init()):s.error("Combodate should be applied to INPUT element")}r.prototype={constructor:r,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]},this.$widget=s('<span class="combodate"></span>').html(this.getTemplate()),this.initCombos(),this.$widget.on("change","select",s.proxy(function(e){this.$element.val(this.getValue()).change(),this.options.smartDays&&(s(e.target).is(".month")||s(e.target).is(".year"))&&this.fillCombo("day")},this)),this.$widget.find("select").css("width","auto"),this.$element.hide().after(this.$widget),this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var n=this.options.template;return s.each(this.map,function(e,t){t=t[0];var i=new RegExp(t+"+"),t=1<t.length?t.substring(1,2):t;n=n.replace(i,"{"+t+"}")}),n=n.replace(/ /g,"&nbsp;"),s.each(this.map,function(e,t){t=1<(t=t[0]).length?t.substring(1,2):t;n=n.replace("{"+t+"}",'<select class="'+e+'"></select>')}),n},initCombos:function(){for(var e in this.map){var t=this.$widget.find("."+e);this["$"+e]=t.length?t:null,this.fillCombo(e)}},fillCombo:function(e){var t=this["$"+e];if(t){var i=this["fill"+e.charAt(0).toUpperCase()+e.slice(1)](),e=t.val();t.empty();for(var n=0;n<i.length;n++)t.append('<option value="'+i[n][0]+'">'+i[n][1]+"</option>");t.val(e)}},fillCommon:function(e){var t,i=[];return"name"===this.options.firstItem?(t=(t="function"==typeof(t=moment.relativeTime||moment.langData()._relativeTime)[e]?t[e](1,!0,e,!1):t[e]).split(" ").reverse()[0],i.push(["",t])):"empty"===this.options.firstItem&&i.push(["",""]),i},fillDay:function(){var e,t,i,n,r=this.fillCommon("d"),o=-1!==this.options.template.indexOf("DD"),s=31;for(this.options.smartDays&&this.$month&&this.$year&&(i=parseInt(this.$month.val(),10),n=parseInt(this.$year.val(),10),isNaN(i)||isNaN(n)||(s=moment([n,i]).daysInMonth())),t=1;t<=s;t++)e=o?this.leadZero(t):t,r.push([t,e]);return r},fillMonth:function(){for(var e,t=this.fillCommon("M"),i=-1!==this.options.template.indexOf("MMMM"),n=-1!==this.options.template.indexOf("MMM"),r=-1!==this.options.template.indexOf("MM"),o=0;o<=11;o++)e=i?moment().date(1).month(o).format("MMMM"):n?moment().date(1).month(o).format("MMM"):r?this.leadZero(o+1):o+1,t.push([o,e]);return t},fillYear:function(){for(var e,t=[],i=-1!==this.options.template.indexOf("YYYY"),n=this.options.maxYear;n>=this.options.minYear;n--)e=i?n:(n+"").substring(2),t[this.options.yearDescending?"push":"unshift"]([n,e]);return t=this.fillCommon("y").concat(t)},fillHour:function(){for(var e,t=this.fillCommon("h"),i=-1!==this.options.template.indexOf("h"),n=(this.options.template.indexOf("H"),-1!==this.options.template.toLowerCase().indexOf("hh")),r=i?12:23,o=i?1:0;o<=r;o++)e=n?this.leadZero(o):o,t.push([o,e]);return t},fillMinute:function(){for(var e,t=this.fillCommon("m"),i=-1!==this.options.template.indexOf("mm"),n=0;n<=59;n+=this.options.minuteStep)e=i?this.leadZero(n):n,t.push([n,e]);return t},fillSecond:function(){for(var e,t=this.fillCommon("s"),i=-1!==this.options.template.indexOf("ss"),n=0;n<=59;n+=this.options.secondStep)e=i?this.leadZero(n):n,t.push([n,e]);return t},fillAmpm:function(){var e=-1!==this.options.template.indexOf("a");this.options.template.indexOf("A");return[["am",e?"am":"AM"],["pm",e?"pm":"PM"]]},getValue:function(e){var t,n={},r=this,o=!1;return s.each(this.map,function(e,t){var i;if("ampm"!==e)return i="day"===e?1:0,n[e]=r["$"+e]?parseInt(r["$"+e].val(),10):i,isNaN(n[e])?!(o=!0):void 0}),o?"":(this.$ampm&&(n.hour=12===n.hour?"am"===this.$ampm.val()?0:12:"am"===this.$ampm.val()?n.hour:n.hour+12),t=moment([n.year,n.month,n.day,n.hour,n.minute,n.second]),this.highlight(t),null===(e=void 0===e?this.options.format:e)?t.isValid()?t:null:t.isValid()?t.format(e):"")},setValue:function(e){var i,n,r;function o(e,n){var r={};return e.children("option").each(function(e,t){var i,t=s(t).attr("value");""!==t&&(i=Math.abs(t-n),void 0===r.distance||i<r.distance)&&(r={value:t,distance:i})}),r.value}e&&(i="string"==typeof e?moment(e,this.options.format):moment(e),n=this,r={},i.isValid())&&(s.each(this.map,function(e,t){"ampm"!==e&&(r[e]=i[t[1]]())}),this.$ampm&&(12<=r.hour?(r.ampm="pm",12<r.hour&&(r.hour-=12)):(r.ampm="am",0===r.hour&&(r.hour=12))),s.each(r,function(e,t){n["$"+e]&&("minute"===e&&1<n.options.minuteStep&&n.options.roundTime&&(t=o(n["$"+e],t)),"second"===e&&1<n.options.secondStep&&n.options.roundTime&&(t=o(n["$"+e],t)),n["$"+e].val(t))}),this.options.smartDays&&this.fillCombo("day"),this.$element.val(i.format(this.options.format)).change())},highlight:function(e){e.isValid()?this.options.errorClass?this.$widget.removeClass(this.options.errorClass):this.$widget.find("select").css("border-color",this.borderColor):this.options.errorClass?this.$widget.addClass(this.options.errorClass):(this.borderColor||(this.borderColor=this.$widget.find("select").css("border-color")),this.$widget.find("select").css("border-color","red"))},leadZero:function(e){return e<=9?"0"+e:e},destroy:function(){this.$widget.remove(),this.$element.removeData("combodate").show()}},s.fn.combodate=function(i){var e,n=Array.apply(null,arguments);return n.shift(),"getValue"===i&&this.length&&(e=this.eq(0).data("combodate"))?e.getValue.apply(e,n):this.each(function(){var e=s(this),t=e.data("combodate");t||e.data("combodate",t=new r(this,"object"==typeof i&&i)),"string"==typeof i&&"function"==typeof t[i]&&t[i].apply(t,n)})},s.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:(new Date).getFullYear(),yearDescending:!0,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null,roundTime:!0,smartDays:!1}}(window.jQuery),!function(t){"use strict";function i(e){this.init("combodate",e,i.defaults),this.options.viewformat||(this.options.viewformat=this.options.format),e.combodate=t.fn.editableutils.tryParseJson(e.combodate,!0),this.options.combodate=t.extend({},i.defaults.combodate,e.combodate,{format:this.options.format,template:this.options.template})}t.fn.editableutils.inherit(i,t.fn.editabletypes.abstractinput),t.extend(i.prototype,{render:function(){this.$input.combodate(this.options.combodate),"bs3"===t.fn.editableform.engine&&this.$input.siblings().find("select").addClass("form-control"),this.options.inputclass&&this.$input.siblings().find("select").addClass(this.options.inputclass)},value2html:function(e,t){e=e?e.format(this.options.viewformat):"";i.superclass.value2html.call(this,e,t)},html2value:function(e){return e?moment(e,this.options.viewformat):null},value2str:function(e){return e?e.format(this.options.format):""},str2value:function(e){return e?moment(e,this.options.format):null},value2submit:function(e){return this.value2str(e)},value2input:function(e){this.$input.combodate("setValue",e)},input2value:function(){return this.$input.combodate("getValue",null)},activate:function(){this.$input.siblings(".combodate").find("select").eq(0).focus()},autosubmit:function(){}}),i.defaults=t.extend({},t.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',inputclass:null,format:"YYYY-MM-DD",viewformat:null,template:"D / MMM / YYYY",combodate:null}),t.fn.editabletypes.combodate=i}(window.jQuery),!function(s){"use strict";var a=s.fn.editableform.Constructor.prototype.initInput;s.extend(s.fn.editableform.Constructor.prototype,{initTemplate:function(){this.$form=s(s.fn.editableform.template),this.$form.find(".control-group").addClass("form-group"),this.$form.find(".editable-error-block").addClass("help-block")},initInput:function(){a.apply(this);for(var e=null===this.input.options.inputclass||!1===this.input.options.inputclass,t="input-sm",i="text,select,textarea,password,email,url,tel,number,range,time,typeaheadjs".split(","),n=(~s.inArray(this.input.type,i)&&(this.input.$input.addClass("form-control"),e)&&(this.input.options.inputclass=t,this.input.$input.addClass(t)),this.$form.find(".editable-buttons")),r=e?[t]:this.input.options.inputclass.split(" "),o=0;o<r.length;o++)"input-lg"===r[o].toLowerCase()&&n.find("button").removeClass("btn-sm").addClass("btn-lg")}}),s.fn.editableform.buttons='<button type="submit" class="btn btn-primary btn-sm editable-submit"><i class="glyphicon glyphicon-ok"></i></button><button type="button" class="btn btn-default btn-sm editable-cancel"><i class="glyphicon glyphicon-remove"></i></button>',s.fn.editableform.errorGroupClass="has-error",s.fn.editableform.errorBlockClass=null,s.fn.editableform.engine="bs3"}(window.jQuery),!function(t){"use strict";t.extend(t.fn.editableContainer.Popup.prototype,{containerName:"popover",containerDataName:"bs.popover",innerCss:".popover-content",defaults:t.fn.popover.Constructor.DEFAULTS,initContainer:function(){var e;t.extend(this.containerOptions,{trigger:"manual",selector:!1,content:" ",template:this.defaults.template}),this.$element.data("template")&&(e=this.$element.data("template"),this.$element.removeData("template")),this.call(this.containerOptions),e&&this.$element.data("template",e)},innerShow:function(){this.call("show")},innerHide:function(){this.call("hide")},innerDestroy:function(){this.call("destroy")},setContainerOption:function(e,t){this.container().options[e]=t},setPosition:function(){!function(){var e,t,i,n=this.tip(),r="function"==typeof this.options.placement?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,o=/\s?auto?\s?/i,s=o.test(r),o=(s&&(r=r.replace(o,"")||"top"),this.getPosition()),a=n[0].offsetWidth,l=n[0].offsetHeight,u=(s&&(s=this.$element.parent(),e=r,t=document.documentElement.scrollTop||document.body.scrollTop,i="body"==this.options.container?window.innerWidth:s.outerWidth(),u="body"==this.options.container?window.innerHeight:s.outerHeight(),s="body"==this.options.container?0:s.offset().left,r="bottom"==r&&o.top+o.height+l-t>u?"top":"top"==r&&o.top-t-l<0?"bottom":"right"==r&&o.right+a>i?"left":"left"==r&&o.left-a<s?"right":r,n.removeClass(e).addClass(r)),this.getCalculatedOffset(r,o,a,l));this.applyPlacement(u,r)}.call(this.container())}})}(window.jQuery),!function(m){function v(){return new Date(Date.UTC.apply(Date,arguments))}function y(e,t){this._process_options(t),this.element=m(e),this.isInline=!1,this.isInput=this.element.is("input"),this.component=!!this.element.is(".date")&&this.element.find(".add-on, .btn"),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.picker=m(w.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&(this.picker.addClass("datepicker-rtl"),this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today").attr("colspan",function(e,t){return parseInt(t)+1}),this._allow_update=!1,this.setStartDate(this.o.startDate),this.setEndDate(this.o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()}function l(e,t){this.element=m(e),this.inputs=m.map(t.inputs,function(e){return e.jquery?e[0]:e}),delete t.inputs,m(this.inputs).datepicker(t).bind("changeDate",m.proxy(this.dateUpdated,this)),this.pickers=m.map(this.inputs,function(e){return m(e).data("datepicker")}),this.updateDates()}y.prototype={constructor:y,_process_options:function(e){this._o=m.extend({},this._o,e);var t=this.o=m.extend({},this._o),e=t.language;switch(b[e]||(e=e.split("-")[0],b[e])||(e=u.language),t.language=e,t.startView){case 2:case"decade":t.startView=2;break;case 1:case"year":t.startView=1;break;default:t.startView=0}switch(t.minViewMode){case 1:case"months":t.minViewMode=1;break;case 2:case"years":t.minViewMode=2;break;default:t.minViewMode=0}t.startView=Math.max(t.startView,t.minViewMode),t.weekStart%=7,t.weekEnd=(t.weekStart+6)%7;e=w.parseFormat(t.format);t.startDate!==-1/0&&(t.startDate=w.parseDate(t.startDate,e,t.language)),t.endDate!==1/0&&(t.endDate=w.parseDate(t.endDate,e,t.language)),t.daysOfWeekDisabled=t.daysOfWeekDisabled||[],m.isArray(t.daysOfWeekDisabled)||(t.daysOfWeekDisabled=t.daysOfWeekDisabled.split(/[,\s]*/)),t.daysOfWeekDisabled=m.map(t.daysOfWeekDisabled,function(e){return parseInt(e,10)})},_events:[],_secondaryEvents:[],_applyEvents:function(e){for(var t,i,n=0;n<e.length;n++)t=e[n][0],i=e[n][1],t.on(i)},_unapplyEvents:function(e){for(var t,i,n=0;n<e.length;n++)t=e[n][0],i=e[n][1],t.off(i)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:m.proxy(this.show,this),keyup:m.proxy(this.update,this),keydown:m.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:m.proxy(this.show,this),keyup:m.proxy(this.update,this),keydown:m.proxy(this.keydown,this)}],[this.component,{click:m.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:m.proxy(this.show,this)}]],this._secondaryEvents=[[this.picker,{click:m.proxy(this.click,this)}],[m(window),{resize:m.proxy(this.place,this)}],[m(document),{mousedown:m.proxy(function(e){this.element.is(e.target)||this.element.find(e.target).size()||this.picker.is(e.target)||this.picker.find(e.target).size()||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(e,t){var i=t||this.date,t=new Date(i.getTime()+6e4*i.getTimezoneOffset());this.element.trigger({type:e,date:t,format:m.proxy(function(e){e=e||this.o.format;return w.formatDate(i,e,this.o.language)},this)})},show:function(e){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.height=(this.component||this.element).outerHeight(),this.place(),this._attachSecondaryEvents(),e&&e.preventDefault(),this._trigger("show")},hide:function(e){this.isInline||this.picker.is(":visible")&&(this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"))},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},getDate:function(){var e=this.getUTCDate();return new Date(e.getTime()+6e4*e.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(e){this.setUTCDate(new Date(e.getTime()-6e4*e.getTimezoneOffset()))},setUTCDate:function(e){this.date=e,this.setValue()},setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e):this.component&&this.element.find("input").val(e)},getFormattedDate:function(e){return void 0===e&&(e=this.o.format),w.formatDate(this.date,e,this.o.language)},setStartDate:function(e){this._process_options({startDate:e}),this.update(),this.updateNavArrows()},setEndDate:function(e){this._process_options({endDate:e}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this._process_options({daysOfWeekDisabled:e}),this.update(),this.updateNavArrows()},place:function(){var e,t,i;this.isInline||(e=parseInt(this.element.parents().filter(function(){return"auto"!=m(this).css("z-index")}).first().css("z-index"))+10,t=(this.component?this.component.parent():this.element).offset(),i=(this.component||this.element).outerHeight(!0),this.picker.css({top:t.top+i,left:t.left,zIndex:e}))},_allow_update:!0,update:function(){var e,t;this._allow_update&&(t=!1,arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(e=arguments[0],t=!0):(e=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),delete this.element.data().date),this.date=w.parseDate(e,this.o.format,this.o.language),t&&this.setValue(),this.date<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.date>this.o.endDate?this.viewDate=new Date(this.o.endDate):this.viewDate=new Date(this.date),this.fill())},fillDow:function(){var e,t=this.o.weekStart,i="<tr>";for(this.o.calendarWeeks&&(i+=e='<th class="cw">&nbsp;</th>',this.picker.find(".datepicker-days thead tr:first-child").prepend(e));t<this.o.weekStart+7;)i+='<th class="dow">'+b[this.o.language].daysMin[t++%7]+"</th>";i+="</tr>",this.picker.find(".datepicker-days thead").append(i)},fillMonths:function(){for(var e="",t=0;t<12;)e+='<span class="month">'+b[this.o.language].monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").html(e)},setRange:function(e){e&&e.length?this.range=m.map(e,function(e){return e.valueOf()}):delete this.range,this.fill()},getClassNames:function(e){var t=[],i=this.viewDate.getUTCFullYear(),n=this.viewDate.getUTCMonth(),r=this.date.valueOf(),o=new Date;return e.getUTCFullYear()<i||e.getUTCFullYear()==i&&e.getUTCMonth()<n?t.push("old"):(e.getUTCFullYear()>i||e.getUTCFullYear()==i&&e.getUTCMonth()>n)&&t.push("new"),this.o.todayHighlight&&e.getUTCFullYear()==o.getFullYear()&&e.getUTCMonth()==o.getMonth()&&e.getUTCDate()==o.getDate()&&t.push("today"),r&&e.valueOf()==r&&t.push("active"),(e.valueOf()<this.o.startDate||e.valueOf()>this.o.endDate||-1!==m.inArray(e.getUTCDay(),this.o.daysOfWeekDisabled))&&t.push("disabled"),this.range&&(e>this.range[0]&&e<this.range[this.range.length-1]&&t.push("range"),-1!=m.inArray(e.valueOf(),this.range))&&t.push("selected"),t},fill:function(){for(var e,t=new Date(this.viewDate),i=t.getUTCFullYear(),t=t.getUTCMonth(),n=this.o.startDate!==-1/0?this.o.startDate.getUTCFullYear():-1/0,r=this.o.startDate!==-1/0?this.o.startDate.getUTCMonth():-1/0,o=this.o.endDate!==1/0?this.o.endDate.getUTCFullYear():1/0,s=this.o.endDate!==1/0?this.o.endDate.getUTCMonth():1/0,a=(this.date&&this.date.valueOf(),this.picker.find(".datepicker-days thead th.datepicker-switch").text(b[this.o.language].months[t]+" "+i),this.picker.find("tfoot th.today").text(b[this.o.language].today).toggle(!1!==this.o.todayBtn),this.picker.find("tfoot th.clear").text(b[this.o.language].clear).toggle(!1!==this.o.clearBtn),this.updateNavArrows(),this.fillMonths(),v(i,t-1,28,0,0,0,0)),t=w.getDaysInMonth(a.getUTCFullYear(),a.getUTCMonth()),l=(a.setUTCDate(t),a.setUTCDate(t-(a.getUTCDay()-this.o.weekStart+7)%7),new Date(a)),u=(l.setUTCDate(l.getUTCDate()+42),l=l.valueOf(),[]);a.valueOf()<l;){a.getUTCDay()==this.o.weekStart&&(u.push("<tr>"),this.o.calendarWeeks)&&(c=new Date(+a+(this.o.weekStart-a.getUTCDay()-7)%7*864e5),c=new Date(+c+(11-c.getUTCDay())%7*864e5),d=new Date(+(d=v(c.getUTCFullYear(),0,1))+(11-d.getUTCDay())%7*864e5),u.push('<td class="cw">'+((c-d)/864e5/7+1)+"</td>")),(c=this.getClassNames(a)).push("day");var c,d=this.o.beforeShowDay(a);void 0===d?d={}:"boolean"==typeof d?d={enabled:d}:"string"==typeof d&&(d={classes:d}),!1===d.enabled&&c.push("disabled"),d.classes&&(c=c.concat(d.classes.split(/\s+/))),d.tooltip&&(e=d.tooltip),c=m.unique(c),u.push('<td class="'+c.join(" ")+'"'+(e?' title="'+e+'"':"")+">"+a.getUTCDate()+"</td>"),a.getUTCDay()==this.o.weekEnd&&u.push("</tr>"),a.setUTCDate(a.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(u.join(""));var h=this.date&&this.date.getUTCFullYear(),t=this.picker.find(".datepicker-months").find("th:eq(1)").text(i).end().find("span").removeClass("active"),r=(h&&h==i&&t.eq(this.date.getUTCMonth()).addClass("active"),(i<n||o<i)&&t.addClass("disabled"),i==n&&t.slice(0,r).addClass("disabled"),i==o&&t.slice(s+1).addClass("disabled"),u="",i=10*parseInt(i/10,10),this.picker.find(".datepicker-years").find("th:eq(1)").text(i+"-"+(i+9)).end().find("td"));--i;for(var p=-1;p<11;p++)u+='<span class="year'+(-1==p?" old":10==p?" new":"")+(h==i?" active":"")+(i<n||o<i?" disabled":"")+'">'+i+"</span>",i+=1;r.html(u)},updateNavArrows:function(){if(this._allow_update){var e=new Date(this.viewDate),t=e.getUTCFullYear(),i=e.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-1/0&&t<=this.o.startDate.getUTCFullYear()&&i<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==1/0&&t>=this.o.endDate.getUTCFullYear()&&i>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-1/0&&t<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==1/0&&t>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}}},click:function(e){e.preventDefault();var t,i,n,r,o=m(e.target).closest("span, td, th");if(1==o.length)switch(o[0].nodeName.toLowerCase()){case"th":switch(o[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var s=w.modes[this.viewMode].navStep*("prev"==o[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,s);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,s)}this.fill();break;case"today":var a=v((a=new Date).getFullYear(),a.getMonth(),a.getDate(),0,0,0),l=(this.showMode(-2),"linked"==this.o.todayBtn?null:"view");this._setDate(a,l);break;case"clear":this.isInput?t=this.element:this.component&&(t=this.element.find("input")),t&&t.val("").change(),this._trigger("changeDate"),this.update(),this.o.autoclose&&this.hide()}break;case"span":o.is(".disabled")||(this.viewDate.setUTCDate(1),o.is(".month")?(i=1,r=o.parent().find("span").index(o),n=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(r),this._trigger("changeMonth",this.viewDate),1===this.o.minViewMode&&this._setDate(v(n,r,i,0,0,0,0))):(n=parseInt(o.text(),10)||0,i=1,r=0,this.viewDate.setUTCFullYear(n),this._trigger("changeYear",this.viewDate),2===this.o.minViewMode&&this._setDate(v(n,r,i,0,0,0,0))),this.showMode(-1),this.fill());break;case"td":o.is(".day")&&!o.is(".disabled")&&(i=parseInt(o.text(),10)||1,n=this.viewDate.getUTCFullYear(),r=this.viewDate.getUTCMonth(),o.is(".old")?0===r?(r=11,--n):--r:o.is(".new")&&(11==r?(r=0,n+=1):r+=1),this._setDate(v(n,r,i,0,0,0,0)))}},_setDate:function(e,t){var i;t&&"date"!=t||(this.date=new Date(e)),t&&"view"!=t||(this.viewDate=new Date(e)),this.fill(),this.setValue(),this._trigger("changeDate"),this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&(i.change(),!this.o.autoclose||t&&"date"!=t||this.hide())},moveMonth:function(e,t){if(!t)return e;var i,n,r=new Date(e.valueOf()),o=r.getUTCDate(),s=r.getUTCMonth(),a=Math.abs(t);if(t=0<t?1:-1,1==a)n=-1==t?function(){return r.getUTCMonth()==s}:function(){return r.getUTCMonth()!=i},i=s+t,r.setUTCMonth(i),(i<0||11<i)&&(i=(i+12)%12);else{for(var l=0;l<a;l++)r=this.moveMonth(r,t);i=r.getUTCMonth(),r.setUTCDate(o),n=function(){return i!=r.getUTCMonth()}}for(;n();)r.setUTCDate(--o),r.setUTCMonth(i);return r},moveYear:function(e,t){return this.moveMonth(e,12*t)},dateWithinRange:function(e){return e>=this.o.startDate&&e<=this.o.endDate},keydown:function(e){if(this.picker.is(":not(:visible)"))27==e.keyCode&&this.show();else{var t,i,n,r,o=!1;switch(e.keyCode){case 27:this.hide(),e.preventDefault();break;case 37:case 39:this.o.keyboardNavigation&&(t=37==e.keyCode?-1:1,e.ctrlKey?(i=this.moveYear(this.date,t),n=this.moveYear(this.viewDate,t)):e.shiftKey?(i=this.moveMonth(this.date,t),n=this.moveMonth(this.viewDate,t)):((i=new Date(this.date)).setUTCDate(this.date.getUTCDate()+t),(n=new Date(this.viewDate)).setUTCDate(this.viewDate.getUTCDate()+t)),this.dateWithinRange(i))&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),e.preventDefault(),o=!0);break;case 38:case 40:this.o.keyboardNavigation&&(t=38==e.keyCode?-1:1,e.ctrlKey?(i=this.moveYear(this.date,t),n=this.moveYear(this.viewDate,t)):e.shiftKey?(i=this.moveMonth(this.date,t),n=this.moveMonth(this.viewDate,t)):((i=new Date(this.date)).setUTCDate(this.date.getUTCDate()+7*t),(n=new Date(this.viewDate)).setUTCDate(this.viewDate.getUTCDate()+7*t)),this.dateWithinRange(i))&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),e.preventDefault(),o=!0);break;case 13:this.hide(),e.preventDefault();break;case 9:this.hide()}o&&(this._trigger("changeDate"),this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r)&&r.change()}},showMode:function(e){e&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(">div").hide().filter(".datepicker-"+w.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};l.prototype={updateDates:function(){this.dates=m.map(this.pickers,function(e){return e.date}),this.updateRanges()},updateRanges:function(){var i=m.map(this.dates,function(e){return e.valueOf()});m.each(this.pickers,function(e,t){t.setRange(i)})},dateUpdated:function(e){var t=m(e.target).data("datepicker").getUTCDate(),i=m.inArray(e.target,this.inputs),n=this.inputs.length;if(-1!=i){if(t<this.dates[i])for(;0<=i&&t<this.dates[i];)this.pickers[i--].setUTCDate(t);else if(t>this.dates[i])for(;i<n&&t>this.dates[i];)this.pickers[i++].setUTCDate(t);this.updateDates()}},remove:function(){m.map(this.pickers,function(e){e.remove()}),delete this.element.data().datepicker}};var e=m.fn.datepicker,i=m.fn.datepicker=function(o){var s,a=Array.apply(null,arguments);return a.shift(),this.each(function(){var e,t,i=m(this),n=i.data("datepicker"),r="object"==typeof o&&o;if(n||(t=function(e,t){var i,n=m(e).data(),r={},o=new RegExp("^"+t.toLowerCase()+"([A-Z])"),t=new RegExp("^"+t.toLowerCase());for(i in n)t.test(i)&&(r[i.replace(o,function(e,t){return t.toLowerCase()})]=n[i]);return r}(this,"date"),e=function(e){var i,n={};if(b[e]||(e=e.split("-")[0],b[e]))return i=b[e],m.each(c,function(e,t){t in i&&(n[t]=i[t])}),n}(m.extend({},u,t,r).language),e=m.extend({},u,e,t,r),i.is(".input-daterange")||e.inputs?(t={inputs:e.inputs||i.find("input").toArray()},i.data("datepicker",n=new l(this,m.extend(e,t)))):i.data("datepicker",n=new y(this,e))),"string"==typeof o&&"function"==typeof n[o]&&void 0!==(s=n[o].apply(n,a)))return!1}),void 0!==s?s:this},u=m.fn.datepicker.defaults={autoclose:!1,beforeShowDay:m.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:1/0,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,rtl:!1,startDate:-1/0,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},c=m.fn.datepicker.locale_opts=["format","rtl","weekStart"],b=(m.fn.datepicker.Constructor=y,m.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}}),w={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},getDaysInMonth:function(e,t){return[31,w.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(e){var t=e.replace(this.validParts,"\0").split("\0"),e=e.match(this.validParts);if(t&&t.length&&e&&0!==e.length)return{separators:t,parts:e};throw new Error("Invalid date format.")},parseDate:function(e,t,i){if(!(e instanceof Date)){if("string"==typeof t&&(t=w.parseFormat(t)),/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(e)){var n,r=/([\-+]\d+)([dmwy])/,o=e.match(/([\-+]\d+)([dmwy])/g);e=new Date;for(var s=0;s<o.length;s++)switch(u=r.exec(o[s]),n=parseInt(u[1]),u[2]){case"d":e.setUTCDate(e.getUTCDate()+n);break;case"m":e=y.prototype.moveMonth.call(y.prototype,e,n);break;case"w":e.setUTCDate(e.getUTCDate()+7*n);break;case"y":e=y.prototype.moveYear.call(y.prototype,e,n)}return v(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),0,0,0)}var a,l,u,o=e&&e.match(this.nonpunctuation)||[],e=new Date,c={},d=["yyyy","yy","M","MM","m","mm","d","dd"],h={yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){for(--t;t<0;)t+=12;for(e.setUTCMonth(t%=12);e.getUTCMonth()!=t;)e.setUTCDate(e.getUTCDate()-1);return e},d:function(e,t){return e.setUTCDate(t)}},p=(h.M=h.MM=h.mm=h.m,h.dd=h.d,e=v(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),t.parts.slice());if(o.length!=p.length&&(p=m(p).filter(function(e,t){return-1!==m.inArray(t,d)}).toArray()),o.length==p.length){for(var s=0,f=p.length;s<f;s++){if(a=parseInt(o[s],10),u=p[s],isNaN(a))switch(u){case"MM":l=m(b[i].months).filter(function(){var e=this.slice(0,o[s].length);return e==o[s].slice(0,e.length)}),a=m.inArray(l[0],b[i].months)+1;break;case"M":l=m(b[i].monthsShort).filter(function(){var e=this.slice(0,o[s].length);return e==o[s].slice(0,e.length)}),a=m.inArray(l[0],b[i].monthsShort)+1}c[u]=a}for(var g,s=0;s<d.length;s++)(g=d[s])in c&&!isNaN(c[g])&&h[g](e,c[g])}}return e},formatDate:function(e,t,i){"string"==typeof t&&(t=w.parseFormat(t));for(var n={d:e.getUTCDate(),D:b[i].daysShort[e.getUTCDay()],DD:b[i].days[e.getUTCDay()],m:e.getUTCMonth()+1,M:b[i].monthsShort[e.getUTCMonth()],MM:b[i].months[e.getUTCMonth()],yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear()},e=(n.dd=(n.d<10?"0":"")+n.d,n.mm=(n.m<10?"0":"")+n.m,[]),r=m.extend([],t.separators),o=0,s=t.parts.length;o<=s;o++)r.length&&e.push(r.shift()),e.push(n[t.parts[o]]);return e.join("")},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="datepicker-switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};w.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+w.headTemplate+"<tbody></tbody>"+w.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+w.headTemplate+w.contTemplate+w.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+w.headTemplate+w.contTemplate+w.footTemplate+"</table></div></div>",m.fn.datepicker.DPGlobal=w,m.fn.datepicker.noConflict=function(){return m.fn.datepicker=e,this},m(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(e){var t=m(this);t.data("datepicker")||(e.preventDefault(),i.call(t,"show"))}),m(function(){i.call(m('[data-provide="datepicker-inline"]'))})}(window.jQuery),!function(i){"use strict";i.fn.bdatepicker=i.fn.datepicker.noConflict(),i.fn.datepicker||(i.fn.datepicker=i.fn.bdatepicker);function n(e){this.init("date",e,n.defaults),this.initPicker(e,n.defaults)}i.fn.editableutils.inherit(n,i.fn.editabletypes.abstractinput),i.extend(n.prototype,{initPicker:function(e,t){this.options.viewformat||(this.options.viewformat=this.options.format),e.datepicker=i.fn.editableutils.tryParseJson(e.datepicker,!0),this.options.datepicker=i.extend({},t.datepicker,e.datepicker,{format:this.options.viewformat}),this.options.datepicker.language=this.options.datepicker.language||"en",this.dpg=i.fn.bdatepicker.DPGlobal,this.parsedFormat=this.dpg.parseFormat(this.options.format),this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat)},render:function(){this.$input.bdatepicker(this.options.datepicker),this.options.clear&&(this.$clear=i('<a href="#"></a>').html(this.options.clear).click(i.proxy(function(e){e.preventDefault(),e.stopPropagation(),this.clear()},this)),this.$tpl.parent().append(i('<div class="editable-clear">').append(this.$clear)))},value2html:function(e,t){e=e?this.dpg.formatDate(e,this.parsedViewFormat,this.options.datepicker.language):"";n.superclass.value2html.call(this,e,t)},html2value:function(e){return this.parseDate(e,this.parsedViewFormat)},value2str:function(e){return e?this.dpg.formatDate(e,this.parsedFormat,this.options.datepicker.language):""},str2value:function(e){return this.parseDate(e,this.parsedFormat)},value2submit:function(e){return this.value2str(e)},value2input:function(e){this.$input.bdatepicker("update",e)},input2value:function(){return this.$input.data("datepicker").date},activate:function(){},clear:function(){this.$input.data("datepicker").date=null,this.$input.find(".active").removeClass("active"),this.options.showbuttons||this.$input.closest("form").submit()},autosubmit:function(){this.$input.on("mouseup",".day",function(e){var t;i(e.currentTarget).is(".old")||i(e.currentTarget).is(".new")||(t=i(this).closest("form"),setTimeout(function(){t.submit()},200))})},parseDate:function(e,t){var i=null;return i=e&&(i=this.dpg.parseDate(e,t,this.options.datepicker.language),"string"==typeof e)&&e!==this.dpg.formatDate(i,t,this.options.datepicker.language)?null:i}}),n.defaults=i.extend({},i.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd",viewformat:null,datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:!1},clear:"&times; clear"}),i.fn.editabletypes.date=n}(window.jQuery),!function(e){"use strict";function t(e){this.init("datefield",e,t.defaults),this.initPicker(e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.date),e.extend(t.prototype,{render:function(){this.$input=this.$tpl.find("input"),this.setClass(),this.setAttr("placeholder"),this.$tpl.bdatepicker(this.options.datepicker),this.$input.off("focus keydown"),this.$input.keyup(e.proxy(function(){this.$tpl.removeData("date"),this.$tpl.bdatepicker("update")},this))},value2input:function(e){this.$input.val(e?this.dpg.formatDate(e,this.parsedViewFormat,this.options.datepicker.language):""),this.$tpl.bdatepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){e.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}}),t.defaults=e.extend({},e.fn.editabletypes.date.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-small",datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:!0}}),e.fn.editabletypes.datefield=t}(window.jQuery),!function(i){"use strict";function n(e){this.init("datetime",e,n.defaults),this.initPicker(e,n.defaults)}i.fn.editableutils.inherit(n,i.fn.editabletypes.abstractinput),i.extend(n.prototype,{initPicker:function(e,t){this.options.viewformat||(this.options.viewformat=this.options.format),e.datetimepicker=i.fn.editableutils.tryParseJson(e.datetimepicker,!0),this.options.datetimepicker=i.extend({},t.datetimepicker,e.datetimepicker,{format:this.options.viewformat}),this.options.datetimepicker.language=this.options.datetimepicker.language||"en",this.dpg=i.fn.datetimepicker.DPGlobal,this.parsedFormat=this.dpg.parseFormat(this.options.format,this.options.formatType),this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat,this.options.formatType)},render:function(){this.$input.datetimepicker(this.options.datetimepicker),this.$input.on("changeMode",function(e){var t=i(this).closest("form").parent();setTimeout(function(){t.triggerHandler("resize")},0)}),this.options.clear&&(this.$clear=i('<a href="#"></a>').html(this.options.clear).click(i.proxy(function(e){e.preventDefault(),e.stopPropagation(),this.clear()},this)),this.$tpl.parent().append(i('<div class="editable-clear">').append(this.$clear)))},value2html:function(e,t){e=e?this.dpg.formatDate(this.toUTC(e),this.parsedViewFormat,this.options.datetimepicker.language,this.options.formatType):"";if(!t)return e;n.superclass.value2html.call(this,e,t)},html2value:function(e){e=this.parseDate(e,this.parsedViewFormat);return e?this.fromUTC(e):null},value2str:function(e){return e?this.dpg.formatDate(this.toUTC(e),this.parsedFormat,this.options.datetimepicker.language,this.options.formatType):""},str2value:function(e){e=this.parseDate(e,this.parsedFormat);return e?this.fromUTC(e):null},value2submit:function(e){return this.value2str(e)},value2input:function(e){e&&this.$input.data("datetimepicker").setDate(e)},input2value:function(){var e=this.$input.data("datetimepicker");return e.date?e.getDate():null},activate:function(){},clear:function(){this.$input.data("datetimepicker").date=null,this.$input.find(".active").removeClass("active"),this.options.showbuttons||this.$input.closest("form").submit()},autosubmit:function(){this.$input.on("mouseup",".minute",function(e){var t=i(this).closest("form");setTimeout(function(){t.submit()},200)})},toUTC:function(e){return e&&new Date(e.valueOf()-6e4*e.getTimezoneOffset())},fromUTC:function(e){return e&&new Date(e.valueOf()+6e4*e.getTimezoneOffset())},parseDate:function(e,t){var i=null;return i=e&&(i=this.dpg.parseDate(e,t,this.options.datetimepicker.language,this.options.formatType),"string"==typeof e)&&e!==this.dpg.formatDate(i,t,this.options.datetimepicker.language,this.options.formatType)?null:i}}),n.defaults=i.extend({},i.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd hh:ii",formatType:"standard",viewformat:null,datetimepicker:{todayHighlight:!1,autoclose:!1},clear:"&times; clear"}),i.fn.editabletypes.datetime=n}(window.jQuery),!function(e){"use strict";function t(e){this.init("datetimefield",e,t.defaults),this.initPicker(e,t.defaults)}e.fn.editableutils.inherit(t,e.fn.editabletypes.datetime),e.extend(t.prototype,{render:function(){this.$input=this.$tpl.find("input"),this.setClass(),this.setAttr("placeholder"),this.$tpl.datetimepicker(this.options.datetimepicker),this.$input.off("focus keydown"),this.$input.keyup(e.proxy(function(){this.$tpl.removeData("date"),this.$tpl.datetimepicker("update")},this))},value2input:function(e){this.$input.val(this.value2html(e)),this.$tpl.datetimepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){e.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}}),t.defaults=e.extend({},e.fn.editabletypes.datetime.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-medium",datetimepicker:{todayHighlight:!1,autoclose:!0}}),e.fn.editabletypes.datetimefield=t}(window.jQuery),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(C,s){function E(){return new Date(Date.UTC.apply(Date,arguments))}"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){(t=t===s?0:t)<0&&(t+=this.length),t<0&&(t=0);for(var i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1});function y(e,o){for(var t=this,i=(this.element=C(e),this.container=o.container||"body",this.language=o.language||this.element.data("date-language")||"en",this.language=this.language in T?this.language:this.language.split("-")[0],this.language=this.language in T?this.language:"en",this.isRTL=T[this.language].rtl||!1,this.formatType=o.formatType||this.element.data("format-type")||"standard",this.format=D.parseFormat(o.format||this.element.data("date-format")||T[this.language].format||D.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.fontAwesome=o.fontAwesome||this.element.data("font-awesome")||!1,this.bootcssVer=o.bootcssVer||(this.isInput?this.element.is(".form-control")?3:2:this.bootcssVer=this.element.is(".input-group")?3:2),this.component=!!this.element.is(".date")&&(3===this.bootcssVer?this.element.find(".input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-remove, .input-group-addon .glyphicon-calendar, .input-group-addon .fa-calendar, .input-group-addon .fa-clock-o"):this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar, .add-on .fa-calendar, .add-on .fa-clock-o")).parent(),this.componentReset=!!this.element.is(".date")&&(3===this.bootcssVer?this.element.find(".input-group-addon .glyphicon-remove, .input-group-addon .fa-times"):this.element.find(".add-on .icon-remove, .add-on .fa-times")).parent(),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=o.linkField||this.element.data("link-field")||!1,this.linkFormat=D.parseFormat(o.linkFormat||this.element.data("link-format")||D.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=o.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=o.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=o.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=o.initialDate||new Date,this.zIndex=o.zIndex||this.element.data("z-index")||s,this.title=void 0!==o.title&&o.title,this.timezone=o.timezone||function(){var e,t,i=(new Date).toString(),n=(null!=(t=i.split("(")[1])?t.slice(0,-1):0)||i.split(" ");if(n instanceof Array){for(var r=[],o=0,s=n.length;o<s;o++)(e=null!==(t=n[o].match(/\b[A-Z]+\b/)))&&t[0]&&r.push(e);n=r.pop()}return n}(),this.icons={leftArrow:this.fontAwesome?"fa-arrow-left":3===this.bootcssVer?"glyphicon-arrow-left":"icon-arrow-left",rightArrow:this.fontAwesome?"fa-arrow-right":3===this.bootcssVer?"glyphicon-arrow-right":"icon-arrow-right"},this.icontype=this.fontAwesome?"fa":"glyphicon",this._attachEvents(),this.clickedOutside=function(e){0===C(e.target).closest(".datetimepicker").length&&t.hide()},this.formatViewType="datetime","formatViewType"in o?this.formatViewType=o.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in o?this.minView=o.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=D.convertViewMode(this.minView),this.maxView=D.modes.length-1,"maxView"in o?this.maxView=o.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=D.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in o?this.wheelViewModeNavigation=o.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in o?this.wheelViewModeNavigationInverseDirection=o.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in o?this.wheelViewModeNavigationDelay=o.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in o?this.startViewMode=o.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=D.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in o?this.viewSelect=o.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=D.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in o?this.forceParse=o.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse")),3===this.bootcssVer?D.templateV3:D.template);-1!==i.indexOf("{iconType}");)i=i.replace("{iconType}",this.icontype);for(;-1!==i.indexOf("{leftArrow}");)i=i.replace("{leftArrow}",this.icons.leftArrow);for(;-1!==i.indexOf("{rightArrow}");)i=i.replace("{rightArrow}",this.icons.rightArrow);this.picker=C(i).appendTo(this.isInline?this.element:this.container).on({click:C.proxy(this.click,this),mousedown:C.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(C.fn.mousewheel?this.picker.on({mousewheel:C.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.isInline?this.picker.addClass("datetimepicker-inline"):this.picker.addClass("datetimepicker-dropdown-"+this.pickerPosition+" dropdown-menu"),this.isRTL&&(this.picker.addClass("datetimepicker-rtl"),e=3===this.bootcssVer?".prev span, .next span":".prev i, .next i",this.picker.find(e).toggleClass(this.icons.leftArrow+" "+this.icons.rightArrow)),C(document).on("mousedown touchend",this.clickedOutside),this.autoclose=!1,"autoclose"in o?this.autoclose=o.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in o?this.keyboardNavigation=o.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=o.todayBtn||this.element.data("date-today-btn")||!1,this.clearBtn=o.clearBtn||this.element.data("date-clear-btn")||!1,this.todayHighlight=o.todayHighlight||this.element.data("date-today-highlight")||!1,void(this.weekStart=0)!==o.weekStart?this.weekStart=o.weekStart:void 0!==this.element.data("date-weekstart")?this.weekStart=this.element.data("date-weekstart"):void 0!==T[this.language].weekStart&&(this.weekStart=T[this.language].weekStart),this.weekStart=this.weekStart%7,this.weekEnd=(this.weekStart+6)%7,this.onRenderDay=function(e){e=(o.onRenderDay||function(){return[]})(e);return["day"].concat((e="string"==typeof e?[e]:e)||[])},this.onRenderHour=function(e){e=(o.onRenderHour||function(){return[]})(e);return["hour"].concat((e="string"==typeof e?[e]:e)||[])},this.onRenderMinute=function(e){var t=(o.onRenderMinute||function(){return[]})(e),i=["minute"];return"string"==typeof t&&(t=[t]),e<this.startDate||e>this.endDate?i.push("disabled"):Math.floor(this.date.getUTCMinutes()/this.minuteStep)===Math.floor(e.getUTCMinutes()/this.minuteStep)&&i.push("active"),i.concat(t||[])},this.onRenderYear=function(e){var t=(o.onRenderYear||function(){return[]})(e),i=["year"],n=("string"==typeof t&&(t=[t]),this.date.getUTCFullYear()===e.getUTCFullYear()&&i.push("active"),e.getUTCFullYear()),r=this.endDate.getUTCFullYear();return(e<this.startDate||r<n)&&i.push("disabled"),i.concat(t||[])},this.onRenderMonth=function(e){e=(o.onRenderMonth||function(){return[]})(e);return["month"].concat((e="string"==typeof e?[e]:e)||[])},this.startDate=new Date(-8639968443048e3),this.endDate=new Date(8639968443048e3),this.datesDisabled=[],this.daysOfWeekDisabled=[],this.setStartDate(o.startDate||this.element.data("date-startdate")),this.setEndDate(o.endDate||this.element.data("date-enddate")),this.setDatesDisabled(o.datesDisabled||this.element.data("date-dates-disabled")),this.setDaysOfWeekDisabled(o.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.setMinutesDisabled(o.minutesDisabled||this.element.data("date-minute-disabled")),this.setHoursDisabled(o.hoursDisabled||this.element.data("date-hour-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.isInline&&this.show()}y.prototype={constructor:y,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{focus:C.proxy(this.show,this),keyup:C.proxy(this.update,this),keydown:C.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:C.proxy(this.show,this),keyup:C.proxy(this.update,this),keydown:C.proxy(this.keydown,this)}],[this.component,{click:C.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:C.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:C.proxy(this.show,this)}]];for(var e,t,i=0;i<this._events.length;i++)e=this._events[i][0],t=this._events[i][1],e.on(t)},_detachEvents:function(){for(var e,t,i=0;i<this._events.length;i++)e=this._events[i][0],t=this._events[i][1],e.off(t);this._events=[]},show:function(e){this.picker.show(),this.height=(this.component||this.element).outerHeight(),this.forceParse&&this.update(),this.place(),C(window).on("resize",C.proxy(this.place,this)),e&&(e.stopPropagation(),e.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(){!this.isVisible||this.isInline||(this.picker.hide(),C(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||C(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date}))},remove:function(){this._detachEvents(),C(document).off("mousedown",this.clickedOutside),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var e=this.getUTCDate();return null===e?null:new Date(e.getTime()+6e4*e.getTimezoneOffset())},getUTCDate:function(){return this.date},getInitialDate:function(){return this.initialDate},setInitialDate:function(e){this.initialDate=e},setDate:function(e){this.setUTCDate(new Date(e.getTime()-6e4*e.getTimezoneOffset()))},setUTCDate:function(e){e>=this.startDate&&e<=this.endDate?(this.date=e,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:e,startDate:this.startDate,endDate:this.endDate})},setFormat:function(e){var t;this.format=D.parseFormat(e,this.formatType),this.isInput?t=this.element:this.component&&(t=this.element.find("input")),t&&t.val()&&this.setValue()},setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e):(this.component&&this.element.find("input").val(e),this.element.data("date",e)),this.linkField&&C("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(e){return e=e||this.format,D.formatDate(this.date,e,this.language,this.formatType,this.timezone)},setStartDate:function(e){this.startDate=e||this.startDate,8639968443048e3!==this.startDate.valueOf()&&(this.startDate=D.parseDate(this.startDate,this.format,this.language,this.formatType,this.timezone)),this.update(),this.updateNavArrows()},setEndDate:function(e){this.endDate=e||this.endDate,8639968443048e3!==this.endDate.valueOf()&&(this.endDate=D.parseDate(this.endDate,this.format,this.language,this.formatType,this.timezone)),this.update(),this.updateNavArrows()},setDatesDisabled:function(e){this.datesDisabled=e||[],C.isArray(this.datesDisabled)||(this.datesDisabled=this.datesDisabled.split(/,\s*/));var t=this;this.datesDisabled=C.map(this.datesDisabled,function(e){return D.parseDate(e,t.format,t.language,t.formatType,t.timezone).toDateString()}),this.update(),this.updateNavArrows()},setTitle:function(e,t){return this.picker.find(e).find("th:eq(1)").text(!1===this.title?t:this.title)},setDaysOfWeekDisabled:function(e){this.daysOfWeekDisabled=e||[],C.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=C.map(this.daysOfWeekDisabled,function(e){return parseInt(e,10)}),this.update(),this.updateNavArrows()},setMinutesDisabled:function(e){this.minutesDisabled=e||[],C.isArray(this.minutesDisabled)||(this.minutesDisabled=this.minutesDisabled.split(/,\s*/)),this.minutesDisabled=C.map(this.minutesDisabled,function(e){return parseInt(e,10)}),this.update(),this.updateNavArrows()},setHoursDisabled:function(e){this.hoursDisabled=e||[],C.isArray(this.hoursDisabled)||(this.hoursDisabled=this.hoursDisabled.split(/,\s*/)),this.hoursDisabled=C.map(this.hoursDisabled,function(e){return parseInt(e,10)}),this.update(),this.updateNavArrows()},place:function(){var t,e,i,n,r;this.isInline||(this.zIndex||(t=0,C("div").each(function(){var e=parseInt(C(this).css("zIndex"),10);t<e&&(t=e)}),this.zIndex=t+10),n=(this.container instanceof C?this.container:C(this.container)).offset(),this.component?(i=(e=this.component.offset()).left,"bottom-left"!==this.pickerPosition&&"top-left"!==this.pickerPosition||(i+=this.component.outerWidth()-this.picker.outerWidth())):(i=(e=this.element.offset()).left,"bottom-left"!==this.pickerPosition&&"top-left"!==this.pickerPosition||(i+=this.element.outerWidth()-this.picker.outerWidth())),(r=document.body.clientWidth||window.innerWidth)<i+220&&(i=r-220),r="top-left"===this.pickerPosition||"top-right"===this.pickerPosition?e.top-this.picker.outerHeight():e.top+this.height,r-=n.top,i-=n.left,this.picker.css({top:r,left:i,zIndex:this.zIndex}))},hour_minute:"^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]",update:function(){var e,t=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(e=arguments[0],t=!0):"string"==typeof(e=(this.isInput?this.element:this.element.find("input")).val()||this.element.data("date")||this.initialDate)&&(e=e.replace(/^\s+|\s+$/g,"")),e||(e=new Date,t=!1),"string"==typeof e&&(new RegExp(this.hour_minute).test(e)||new RegExp(this.hour_minute+":[0-5][0-9]").test(e))&&(e=this.getDate()),this.date=D.parseDate(e,this.format,this.language,this.formatType,this.timezone),t&&this.setValue(),this.date<this.startDate?this.viewDate=new Date(this.startDate):this.date>this.endDate?this.viewDate=new Date(this.endDate):this.viewDate=new Date(this.date),this.fill()},fillDow:function(){for(var e=this.weekStart,t="<tr>";e<this.weekStart+7;)t+='<th class="dow">'+T[this.language].daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datetimepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=new Date(this.viewDate),i=0;i<12;i++)t.setUTCMonth(i),e+='<span class="'+this.onRenderMonth(t).join(" ")+'">'+T[this.language].monthsShort[i]+"</span>";this.picker.find(".datetimepicker-months td").html(e)},fill:function(){if(this.date&&this.viewDate){for(var e,t=(b=new Date(this.viewDate)).getUTCFullYear(),i=b.getUTCMonth(),n=b.getUTCDate(),r=b.getUTCHours(),o=this.startDate.getUTCFullYear(),s=this.startDate.getUTCMonth(),a=this.endDate.getUTCFullYear(),l=this.endDate.getUTCMonth()+1,u=new E(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),c=new Date,d=(this.setTitle(".datetimepicker-days",T[this.language].months[i]+" "+t),"time"===this.formatViewType?(h=this.getFormattedDate(),this.setTitle(".datetimepicker-hours",h),this.setTitle(".datetimepicker-minutes",h)):(this.setTitle(".datetimepicker-hours",n+" "+T[this.language].months[i]+" "+t),this.setTitle(".datetimepicker-minutes",n+" "+T[this.language].months[i]+" "+t)),this.picker.find("tfoot th.today").text(T[this.language].today||T.en.today).toggle(!1!==this.todayBtn),this.picker.find("tfoot th.clear").text(T[this.language].clear||T.en.clear).toggle(!1!==this.clearBtn),this.updateNavArrows(),this.fillMonths(),E(t,i-1,28,0,0,0,0)),h=D.getDaysInMonth(d.getUTCFullYear(),d.getUTCMonth()),p=(d.setUTCDate(h),d.setUTCDate(h-(d.getUTCDay()-this.weekStart+7)%7),new Date(d)),f=(p.setUTCDate(p.getUTCDate()+42),p=p.valueOf(),[]);d.valueOf()<p;)d.getUTCDay()===this.weekStart&&f.push("<tr>"),e=this.onRenderDay(d),d.getUTCFullYear()<t||d.getUTCFullYear()===t&&d.getUTCMonth()<i?e.push("old"):(d.getUTCFullYear()>t||d.getUTCFullYear()===t&&d.getUTCMonth()>i)&&e.push("new"),this.todayHighlight&&d.getUTCFullYear()===c.getFullYear()&&d.getUTCMonth()===c.getMonth()&&d.getUTCDate()===c.getDate()&&e.push("today"),d.valueOf()===u&&e.push("active"),(d.valueOf()+864e5<=this.startDate||d.valueOf()>this.endDate||-1!==C.inArray(d.getUTCDay(),this.daysOfWeekDisabled)||-1!==C.inArray(d.toDateString(),this.datesDisabled))&&e.push("disabled"),f.push('<td class="'+e.join(" ")+'">'+d.getUTCDate()+"</td>"),d.getUTCDay()===this.weekEnd&&f.push("</tr>"),d.setUTCDate(d.getUTCDate()+1);this.picker.find(".datetimepicker-days tbody").empty().append(f.join(""));for(var f=[],g="",m="",v="",y=this.hoursDisabled||[],b=new Date(this.viewDate),w=0;w<24;w++){b.setUTCHours(w),e=this.onRenderHour(b),-1!==y.indexOf(w)&&e.push("disabled");var x=E(t,i,n,w);x.valueOf()+36e5<=this.startDate||x.valueOf()>this.endDate?e.push("disabled"):r===w&&e.push("active"),this.showMeridian&&2===T[this.language].meridiem.length?((m=w<12?T[this.language].meridiem[0]:T[this.language].meridiem[1])!==v&&(""!==v&&f.push("</fieldset>"),f.push('<fieldset class="hour"><legend>'+m.toUpperCase()+"</legend>")),v=m,g=w%12||12,w<12?e.push("hour_am"):e.push("hour_pm"),f.push('<span class="'+e.join(" ")+'">'+g+"</span>"),23===w&&f.push("</fieldset>")):(g=w+":00",f.push('<span class="'+e.join(" ")+'">'+g+"</span>"))}this.picker.find(".datetimepicker-hours td").html(f.join("")),f=[];var g="",m="",v="",_=this.minutesDisabled||[];b=new Date(this.viewDate);for(w=0;w<60;w+=this.minuteStep)-1===_.indexOf(w)&&(b.setUTCMinutes(w),b.setUTCSeconds(0),e=this.onRenderMinute(b),this.showMeridian&&2===T[this.language].meridiem.length?((m=r<12?T[this.language].meridiem[0]:T[this.language].meridiem[1])!==v&&(""!==v&&f.push("</fieldset>"),f.push('<fieldset class="minute"><legend>'+m.toUpperCase()+"</legend>")),v=m,g=r%12||12,f.push('<span class="'+e.join(" ")+'">'+g+":"+(w<10?"0"+w:w)+"</span>"),59===w&&f.push("</fieldset>")):(g=w+":00",f.push('<span class="'+e.join(" ")+'">'+r+":"+(w<10?"0"+w:w)+"</span>")));this.picker.find(".datetimepicker-minutes td").html(f.join(""));var h=this.date.getUTCFullYear(),k=this.setTitle(".datetimepicker-months",t).end().find(".month").removeClass("active"),h=(h===t&&k.eq(this.date.getUTCMonth()).addClass("active"),(t<o||a<t)&&k.addClass("disabled"),t===o&&k.slice(0,s).addClass("disabled"),t===a&&k.slice(l).addClass("disabled"),f="",t=10*parseInt(t/10,10),this.setTitle(".datetimepicker-years",t+"-"+(t+9)).end().find("td"));--t,b=new Date(this.viewDate);for(w=-1;w<11;w++)b.setUTCFullYear(t),e=this.onRenderYear(b),-1!==w&&10!==w||e.push(F),f+='<span class="'+e.join(" ")+'">'+t+"</span>",t+=1;h.html(f),this.place()}},updateNavArrows:function(){var e=new Date(this.viewDate),t=e.getUTCFullYear(),i=e.getUTCMonth(),n=e.getUTCDate(),r=e.getUTCHours();switch(this.viewMode){case 0:t<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()&&r<=this.startDate.getUTCHours()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),t>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()&&r>=this.endDate.getUTCHours()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:t<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),t>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 2:t<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),t>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 3:case 4:t<=this.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),t>=this.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},mousewheel:function(e){e.preventDefault(),e.stopPropagation(),this.wheelPause||(this.wheelPause=!0,e=0<(e=e.originalEvent.wheelDelta)?1:0===e?0:-1,this.wheelViewModeNavigationInverseDirection&&(e=-e),this.showMode(e),setTimeout(C.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay))},click:function(e){e.stopPropagation(),e.preventDefault();var t=C(e.target).closest("span, td, th, legend");if(1===(t=t.is("."+this.icontype)?C(t).parent().closest("span, td, th, legend"):t).length)if(t.is(".disabled"))this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});else switch(t[0].nodeName.toLowerCase()){case"th":switch(t[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var i=D.modes[this.viewMode].navStep*("prev"===t[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,i);break;case 1:this.viewDate=this.moveDate(this.viewDate,i);break;case 2:this.viewDate=this.moveMonth(this.viewDate,i);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,i)}this.fill(),this.element.trigger({type:t[0].className+":"+this.convertViewModeText(this.viewMode),date:this.viewDate,startDate:this.startDate,endDate:this.endDate});break;case"clear":this.reset(),this.autoclose&&this.hide();break;case"today":var n=new Date;(n=E(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),0))<this.startDate?n=this.startDate:n>this.endDate&&(n=this.endDate),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(n),this.fill(),this.autoclose&&this.hide()}break;case"span":t.is(".disabled")||(o=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),r=this.viewDate.getUTCDate(),a=this.viewDate.getUTCHours(),l=this.viewDate.getUTCMinutes(),u=this.viewDate.getUTCSeconds(),t.is(".month")?(this.viewDate.setUTCDate(1),s=t.parent().find("span").index(t),r=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(s),this.element.trigger({type:"changeMonth",date:this.viewDate}),3<=this.viewSelect&&this._setDate(E(o,s,r,a,l,u,0))):t.is(".year")?(this.viewDate.setUTCDate(1),o=parseInt(t.text(),10)||0,this.viewDate.setUTCFullYear(o),this.element.trigger({type:"changeYear",date:this.viewDate}),4<=this.viewSelect&&this._setDate(E(o,s,r,a,l,u,0))):t.is(".hour")?(a=parseInt(t.text(),10)||0,(t.hasClass("hour_am")||t.hasClass("hour_pm"))&&(12===a&&t.hasClass("hour_am")?a=0:12!==a&&t.hasClass("hour_pm")&&(a+=12)),this.viewDate.setUTCHours(a),this.element.trigger({type:"changeHour",date:this.viewDate}),1<=this.viewSelect&&this._setDate(E(o,s,r,a,l,u,0))):t.is(".minute")&&(l=parseInt(t.text().substr(t.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(l),this.element.trigger({type:"changeMinute",date:this.viewDate}),0<=this.viewSelect)&&this._setDate(E(o,s,r,a,l,u,0)),0!==this.viewMode?(c=this.viewMode,this.showMode(-1),this.fill(),c===this.viewMode&&this.autoclose&&this.hide()):(this.fill(),this.autoclose&&this.hide()));break;case"td":t.is(".day")&&!t.is(".disabled")&&(r=parseInt(t.text(),10)||1,o=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),a=this.viewDate.getUTCHours(),l=this.viewDate.getUTCMinutes(),u=this.viewDate.getUTCSeconds(),t.is(".old")?0===s?(s=11,--o):--s:t.is(".new")&&(11===s?(s=0,o+=1):s+=1),this.viewDate.setUTCFullYear(o),this.viewDate.setUTCMonth(s,r),this.element.trigger({type:"changeDay",date:this.viewDate}),2<=this.viewSelect)&&this._setDate(E(o,s,r,a,l,u,0));var r,o,s,a,l,u,c=this.viewMode;this.showMode(-1),this.fill(),c===this.viewMode&&this.autoclose&&this.hide()}},_setDate:function(e,t){var i;t&&"date"!==t||(this.date=e),t&&"view"!==t||(this.viewDate=e),this.fill(),this.setValue(),this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&i.change(),this.element.trigger({type:"changeDate",date:this.getDate()}),null===e&&(this.date=this.viewDate)},moveMinute:function(e,t){var i;return t?((i=new Date(e.valueOf())).setUTCMinutes(i.getUTCMinutes()+t*this.minuteStep),i):e},moveHour:function(e,t){var i;return t?((i=new Date(e.valueOf())).setUTCHours(i.getUTCHours()+t),i):e},moveDate:function(e,t){var i;return t?((i=new Date(e.valueOf())).setUTCDate(i.getUTCDate()+t),i):e},moveMonth:function(e,t){if(!t)return e;var i,n,r=new Date(e.valueOf()),o=r.getUTCDate(),s=r.getUTCMonth(),a=Math.abs(t);if(t=0<t?1:-1,1===a)n=-1===t?function(){return r.getUTCMonth()===s}:function(){return r.getUTCMonth()!==i},i=s+t,r.setUTCMonth(i),(i<0||11<i)&&(i=(i+12)%12);else{for(var l=0;l<a;l++)r=this.moveMonth(r,t);i=r.getUTCMonth(),r.setUTCDate(o),n=function(){return i!==r.getUTCMonth()}}for(;n();)r.setUTCDate(--o),r.setUTCMonth(i);return r},moveYear:function(e,t){return this.moveMonth(e,12*t)},dateWithinRange:function(e){return e>=this.startDate&&e<=this.endDate},keydown:function(e){if(this.picker.is(":not(:visible)"))27===e.keyCode&&this.show();else{var t,i,n,r,o,s=!1;switch(e.keyCode){case 27:this.hide(),e.preventDefault();break;case 37:case 39:this.keyboardNavigation&&(n=37===e.keyCode?-1:1,r=this.viewMode,e.ctrlKey?r+=2:e.shiftKey&&(r+=1),4===r?(t=this.moveYear(this.date,n),i=this.moveYear(this.viewDate,n)):3===r?(t=this.moveMonth(this.date,n),i=this.moveMonth(this.viewDate,n)):2===r?(t=this.moveDate(this.date,n),i=this.moveDate(this.viewDate,n)):1===r?(t=this.moveHour(this.date,n),i=this.moveHour(this.viewDate,n)):0===r&&(t=this.moveMinute(this.date,n),i=this.moveMinute(this.viewDate,n)),this.dateWithinRange(t))&&(this.date=t,this.viewDate=i,this.setValue(),this.update(),e.preventDefault(),s=!0);break;case 38:case 40:this.keyboardNavigation&&(n=38===e.keyCode?-1:1,r=this.viewMode,e.ctrlKey?r+=2:e.shiftKey&&(r+=1),4===r?(t=this.moveYear(this.date,n),i=this.moveYear(this.viewDate,n)):3===r?(t=this.moveMonth(this.date,n),i=this.moveMonth(this.viewDate,n)):2===r?(t=this.moveDate(this.date,7*n),i=this.moveDate(this.viewDate,7*n)):1===r?i=this.showMeridian?(t=this.moveHour(this.date,6*n),this.moveHour(this.viewDate,6*n)):(t=this.moveHour(this.date,4*n),this.moveHour(this.viewDate,4*n)):0===r&&(t=this.moveMinute(this.date,4*n),i=this.moveMinute(this.viewDate,4*n)),this.dateWithinRange(t))&&(this.date=t,this.viewDate=i,this.setValue(),this.update(),e.preventDefault(),s=!0);break;case 13:0!==this.viewMode?(r=this.viewMode,this.showMode(-1),this.fill(),r===this.viewMode&&this.autoclose&&this.hide()):(this.fill(),this.autoclose&&this.hide()),e.preventDefault();break;case 9:this.hide()}s&&(this.isInput?o=this.element:this.component&&(o=this.element.find("input")),o&&o.change(),this.element.trigger({type:"changeDate",date:this.getDate()}))}},showMode:function(e){e&&(e=Math.max(0,Math.min(D.modes.length-1,this.viewMode+e)))>=this.minView&&e<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:e}),this.viewMode=e),this.picker.find(">div").hide().filter(".datetimepicker-"+D.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(){this._setDate(null,"date")},convertViewModeText:function(e){switch(e){case 4:return"decade";case 3:return"year";case 2:return"month";case 1:return"day";case 0:return"hour"}}};var F=C.fn.datetimepicker,T=(C.fn.datetimepicker=function(n){var r,o=Array.apply(null,arguments);return o.shift(),this.each(function(){var e=C(this),t=e.data("datetimepicker"),i="object"==typeof n&&n;if(t||e.data("datetimepicker",t=new y(this,C.extend({},C.fn.datetimepicker.defaults,i))),"string"==typeof n&&"function"==typeof t[n]&&(r=t[n].apply(t,o))!==s)return!1}),r!==s?r:this},C.fn.datetimepicker.defaults={},C.fn.datetimepicker.Constructor=y,C.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],suffix:["st","nd","rd","th"],today:"Today",clear:"Clear"}}),D={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},getDaysInMonth:function(e,t){return[31,D.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},getDefaultFormat:function(e,t){if("standard"===e)return"input"===t?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"===e)return"input"===t?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(e){if("standard"===e)return/t|hh?|HH?|p|P|z|Z|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"===e)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(e,t){var i=e.replace(this.validParts(t),"\0").split("\0"),e=e.match(this.validParts(t));if(i&&i.length&&e&&0!==e.length)return{separators:i,parts:e};throw new Error("Invalid date format.")},parseDate:function(e,t,i,n,r){var o;if(e instanceof Date)return(o=new Date(e.valueOf()-6e4*e.getTimezoneOffset())).setMilliseconds(0),o;if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(e)&&(t=this.parseFormat("yyyy-mm-dd",n)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(e)&&(t=this.parseFormat("yyyy-mm-dd hh:ii",n)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(e)&&(t=this.parseFormat("yyyy-mm-dd hh:ii:ss",n)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(e)){var s,a=/([-+]\d+)([dmwy])/,l=e.match(/([-+]\d+)([dmwy])/g);e=new Date;for(var u=0;u<l.length;u++)switch(h=a.exec(l[u]),s=parseInt(h[1]),h[2]){case"d":e.setUTCDate(e.getUTCDate()+s);break;case"m":e=y.prototype.moveMonth.call(y.prototype,e,s);break;case"w":e.setUTCDate(e.getUTCDate()+7*s);break;case"y":e=y.prototype.moveYear.call(y.prototype,e,s)}return E(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0)}var c,d,h,l=e&&e.toString().match(this.nonpunctuation)||[],e=new Date(0,0,0,0,0,0,0),p={},f=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P","z","Z"],g={hh:function(e,t){return e.setUTCHours(t)},h:function(e,t){return e.setUTCHours(t)},HH:function(e,t){return e.setUTCHours(12===t?0:t)},H:function(e,t){return e.setUTCHours(12===t?0:t)},ii:function(e,t){return e.setUTCMinutes(t)},i:function(e,t){return e.setUTCMinutes(t)},ss:function(e,t){return e.setUTCSeconds(t)},s:function(e,t){return e.setUTCSeconds(t)},yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){for(--t;t<0;)t+=12;for(e.setUTCMonth(t%=12);e.getUTCMonth()!==t;){if(isNaN(e.getUTCMonth()))return e;e.setUTCDate(e.getUTCDate()-1)}return e},d:function(e,t){return e.setUTCDate(t)},p:function(e,t){return e.setUTCHours(1===t?e.getUTCHours()+12:e.getUTCHours())},z:function(){return r}};if(g.M=g.MM=g.mm=g.m,g.dd=g.d,g.P=g.p,g.Z=g.z,e=E(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()),l.length===t.parts.length){for(var u=0,m=t.parts.length;u<m;u++){if(c=parseInt(l[u],10),h=t.parts[u],isNaN(c))switch(h){case"MM":d=C(T[i].months).filter(function(){var e=this.slice(0,l[u].length);return e===l[u].slice(0,e.length)}),c=C.inArray(d[0],T[i].months)+1;break;case"M":d=C(T[i].monthsShort).filter(function(){var e=this.slice(0,l[u].length),t=l[u].slice(0,e.length);return e.toLowerCase()===t.toLowerCase()}),c=C.inArray(d[0],T[i].monthsShort)+1;break;case"p":case"P":c=C.inArray(l[u].toLowerCase(),T[i].meridiem)}p[h]=c}for(var v,u=0;u<f.length;u++)(v=f[u])in p&&!isNaN(p[v])&&g[v](e,p[v])}return e},formatDate:function(e,t,i,n,r){if(null===e)return"";var o;if("standard"===n)o={t:e.getTime(),yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear(),m:e.getUTCMonth()+1,M:T[i].monthsShort[e.getUTCMonth()],MM:T[i].months[e.getUTCMonth()],d:e.getUTCDate(),D:T[i].daysShort[e.getUTCDay()],DD:T[i].days[e.getUTCDay()],p:2===T[i].meridiem.length?T[i].meridiem[e.getUTCHours()<12?0:1]:"",h:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds(),z:r},2===T[i].meridiem.length?o.H=o.h%12==0?12:o.h%12:o.H=o.h,o.HH=(o.H<10?"0":"")+o.H,o.P=o.p.toUpperCase(),o.Z=o.z,o.hh=(o.h<10?"0":"")+o.h,o.ii=(o.i<10?"0":"")+o.i,o.ss=(o.s<10?"0":"")+o.s,o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m;else{if("php"!==n)throw new Error("Invalid format type.");(o={y:e.getUTCFullYear().toString().substring(2),Y:e.getUTCFullYear(),F:T[i].months[e.getUTCMonth()],M:T[i].monthsShort[e.getUTCMonth()],n:e.getUTCMonth()+1,t:D.getDaysInMonth(e.getUTCFullYear(),e.getUTCMonth()),j:e.getUTCDate(),l:T[i].days[e.getUTCDay()],D:T[i].daysShort[e.getUTCDay()],w:e.getUTCDay(),N:0===e.getUTCDay()?7:e.getUTCDay(),S:e.getUTCDate()%10<=T[i].suffix.length?T[i].suffix[e.getUTCDate()%10-1]:"",a:2===T[i].meridiem.length?T[i].meridiem[e.getUTCHours()<12?0:1]:"",g:e.getUTCHours()%12==0?12:e.getUTCHours()%12,G:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()}).m=(o.n<10?"0":"")+o.n,o.d=(o.j<10?"0":"")+o.j,o.A=o.a.toString().toUpperCase(),o.h=(o.g<10?"0":"")+o.g,o.H=(o.G<10?"0":"")+o.G,o.i=(o.i<10?"0":"")+o.i,o.s=(o.s<10?"0":"")+o.s}for(var e=[],s=C.extend([],t.separators),a=0,l=t.parts.length;a<l;a++)s.length&&e.push(s.shift()),e.push(o[t.parts[a]]);return s.length&&e.push(s.shift()),e.join("")},convertViewMode:function(e){switch(e){case 4:case"decade":e=4;break;case 3:case"year":e=3;break;case 2:case"month":e=2;break;case 1:case"day":e=1;break;case 0:case"hour":e=0}return e},headTemplate:'<thead><tr><th class="prev"><i class="{iconType} {leftArrow}"/></th><th colspan="5" class="switch"></th><th class="next"><i class="{iconType} {rightArrow}"/></th></tr></thead>',headTemplateV3:'<thead><tr><th class="prev"><span class="{iconType} {leftArrow}"></span> </th><th colspan="5" class="switch"></th><th class="next"><span class="{iconType} {rightArrow}"></span> </th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};D.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+D.headTemplate+D.contTemplate+D.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+D.headTemplate+D.contTemplate+D.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+D.headTemplate+"<tbody></tbody>"+D.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+D.headTemplate+D.contTemplate+D.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+D.headTemplate+D.contTemplate+D.footTemplate+"</table></div></div>",D.templateV3='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+D.headTemplateV3+D.contTemplate+D.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+D.headTemplateV3+D.contTemplate+D.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+D.headTemplateV3+"<tbody></tbody>"+D.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+D.headTemplateV3+D.contTemplate+D.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+D.headTemplateV3+D.contTemplate+D.footTemplate+"</table></div></div>",C.fn.datetimepicker.DPGlobal=D,C.fn.datetimepicker.noConflict=function(){return C.fn.datetimepicker=F,this},C(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(e){var t=C(this);t.data("datetimepicker")||(e.preventDefault(),t.datetimepicker("show"))}),C(function(){C('[data-provide="datetimepicker-inline"]').datetimepicker()})}),!function(o){"use strict";function n(e,t){this.$element=o(e),this.options=o.extend({},this.defaults(),t),this.render()}n.VERSION="2.2.0",n.DEFAULTS={on:"On",off:"Off",onstyle:"primary",offstyle:"default",size:"normal",style:"",width:null,height:null},n.prototype.defaults=function(){return{on:this.$element.attr("data-on")||n.DEFAULTS.on,off:this.$element.attr("data-off")||n.DEFAULTS.off,onstyle:this.$element.attr("data-onstyle")||n.DEFAULTS.onstyle,offstyle:this.$element.attr("data-offstyle")||n.DEFAULTS.offstyle,size:this.$element.attr("data-size")||n.DEFAULTS.size,style:this.$element.attr("data-style")||n.DEFAULTS.style,width:this.$element.attr("data-width")||n.DEFAULTS.width,height:this.$element.attr("data-height")||n.DEFAULTS.height}},n.prototype.render=function(){this._onstyle="btn-"+this.options.onstyle,this._offstyle="btn-"+this.options.offstyle;var e="large"===this.options.size?"btn-lg":"small"===this.options.size?"btn-sm":"mini"===this.options.size?"btn-xs":"",t=o('<label class="btn">').html(this.options.on).addClass(this._onstyle+" "+e),i=o('<label class="btn">').html(this.options.off).addClass(this._offstyle+" "+e+" active"),n=o('<span class="toggle-handle btn btn-default">').addClass(e),r=o('<div class="toggle-group">').append(t,i,n),e=o('<div class="toggle btn" data-toggle="toggle">').addClass(this.$element.prop("checked")?this._onstyle:this._offstyle+" off").addClass(e).addClass(this.options.style),e=(this.$element.wrap(e),o.extend(this,{$toggle:this.$element.parent(),$toggleOn:t,$toggleOff:i,$toggleGroup:r}),this.$toggle.append(r),this.options.width||Math.max(t.outerWidth(),i.outerWidth())+n.outerWidth()/2),r=this.options.height||Math.max(t.outerHeight(),i.outerHeight());t.addClass("toggle-on"),i.addClass("toggle-off"),this.$toggle.css({width:e,height:r}),this.options.height&&(t.css("line-height",t.height()+"px"),i.css("line-height",i.height()+"px")),this.update(!0),this.trigger(!0)},n.prototype.toggle=function(){this.$element.prop("checked")?this.off():this.on()},n.prototype.on=function(e){return!this.$element.prop("disabled")&&(this.$toggle.removeClass(this._offstyle+" off").addClass(this._onstyle),this.$element.prop("checked",!0),void(e||this.trigger()))},n.prototype.off=function(e){return!this.$element.prop("disabled")&&(this.$toggle.removeClass(this._onstyle).addClass(this._offstyle+" off"),this.$element.prop("checked",!1),void(e||this.trigger()))},n.prototype.enable=function(){this.$toggle.removeAttr("disabled"),this.$element.prop("disabled",!1)},n.prototype.disable=function(){this.$toggle.attr("disabled","disabled"),this.$element.prop("disabled",!0)},n.prototype.update=function(e){this.$element.prop("disabled")?this.disable():this.enable(),this.$element.prop("checked")?this.on(e):this.off(e)},n.prototype.trigger=function(e){this.$element.off("change.bs.toggle"),e||this.$element.change(),this.$element.on("change.bs.toggle",o.proxy(function(){this.update()},this))},n.prototype.destroy=function(){this.$element.off("change.bs.toggle"),this.$toggleGroup.remove(),this.$element.removeData("bs.toggle"),this.$element.unwrap()};var e=o.fn.bootstrapToggle;o.fn.bootstrapToggle=function(i){return this.each(function(){var e=o(this),t=e.data("bs.toggle");t||e.data("bs.toggle",t=new n(this,"object"==typeof i&&i)),"string"==typeof i&&t[i]&&t[i]()})},o.fn.bootstrapToggle.Constructor=n,o.fn.toggle.noConflict=function(){return o.fn.bootstrapToggle=e,this},o(function(){o("input[type=checkbox][data-toggle^=toggle]").bootstrapToggle()}),o(document).on("click.bs.toggle","div[data-toggle^=toggle]",function(e){o(this).find("input[type=checkbox]").bootstrapToggle("toggle"),e.preventDefault()})}(jQuery),!function(s){s.editors.List=s.editors.Base.extend({events:{'click [data-action="add"]:last':function(e){e.preventDefault(),this.addItem(null,!0)}},initialize:function(e){var t=s.editors,i=(t.Base.prototype.initialize.call(this,e=e||{}),this.schema);if(!i)throw new Error("Missing required option 'schema'");this.template=e.template||this.constructor.template,this.Editor=(e=i.itemType)?t.List[e]||t[e]:t.Text,this.items=[]},render:function(){var t=this,e=this.value||[],i=Backbone.$,i=i(i.trim(this.template()));return this.$list=i.is("[data-items]")?i:i.find("[data-items]"),e.length?_.each(e,function(e){t.addItem(e)}):this.Editor.isAsync||this.addItem(),t.schema.maxCardinality&&t.items.length>=t.schema.maxCardinality&&i.find('button[data-action="add"]:last').hide(),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},addItem:function(e,t){function i(){n.items.push(o),n.$list.append(o.el),n.schema.maxCardinality&&n.items.length>=n.schema.maxCardinality&&n.$el.find('button[data-action="add"]:last').hide(),o.editor.on("all",function(e){var t;"change"!==e&&((t=_.toArray(arguments))[0]="item:"+e,t.splice(1,0,n),r.List.prototype.trigger.apply(this,t))},n),o.editor.on("change",function(){o.addEventTriggered||(o.addEventTriggered=!0,this.trigger("add",this,o.editor)),this.trigger("item:change",this,o.editor),this.trigger("change",this)},n),o.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},n),o.editor.on("blur",function(){var e;this.hasFocus&&(e=this,setTimeout(function(){_.find(e.items,function(e){return e.editor.hasFocus})||e.trigger("blur",e)},0))},n),(t||e)&&(o.addEventTriggered=!0),t&&(n.trigger("add",n,o.editor),n.trigger("change",n))}var n=this,r=s.editors,o=new r.List.Item({list:this,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key}).render();return this.Editor.isAsync?o.editor.on("readyToAdd",i,this):(i(),o.editor.focus()),o},removeItem:function(e){var t=this.schema.confirmDelete;t&&!confirm(t)||(t=_.indexOf(this.items,e),this.items[t].remove(),this.items.splice(t,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem(),this.schema.maxCardinality&&this.items.length<this.schema.maxCardinality&&this.$el.find('button[data-action="add"]:last').show())},getValue:function(){var e=_.map(this.items,function(e){return e.getValue()});return _.without(e,void 0,"")},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){var e;this.hasFocus&&(e=_.find(this.items,function(e){return e.editor.hasFocus}))&&e.editor.blur()},remove:function(){_.invoke(this.items,"remove"),s.editors.Base.prototype.remove.call(this)},validate:function(){var e;return this.validators&&(e=_.map(this.items,function(e){return e.validate()}),!!_.compact(e).length)?{type:"list",message:"Some of the items in the list failed validation",errors:e}:null}},{template:_.template('      <div>        <div data-items></div>        <button type="button" data-action="add">Add</button>      </div>    ',null,s.templateSettings)}),s.editors.List.Item=s.editors.Base.extend({events:{'click [data-action="remove"]:last':function(e){e.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(e){13===e.keyCode&&e.preventDefault()}},initialize:function(e){this.list=e.list,this.schema=e.schema||this.list.schema,this.value=e.value,this.Editor=e.Editor||s.editors.Text,this.key=e.key,this.template=e.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName,this.form=e.form},render:function(){var e=Backbone.$,e=(this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form}).render(),e(e.trim(this.template())));return e.find("[data-editor]").append(this.editor.el),this.setElement(e),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var t,i=this.getValue(),n=this.list.form?this.list.form.getValue():{},e=this.schema.validators,r=this.getValidator;return e&&(t=null,_.every(e,function(e){return!(t=r(e)(i,n))}),t?this.setError(t):this.clearError(),t)||null},setError:function(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{template:_.template('      <div>        <span data-editor></span>        <button type="button" data-action="remove">&times;</button>      </div>    ',null,s.templateSettings),errorClassName:"error"}),s.editors.List.Modal=s.editors.Base.extend({events:{click:"openEditor"},initialize:function(e){if(s.editors.Base.prototype.initialize.call(this,e=e||{}),!s.editors.List.Modal.ModalAdapter)throw new Error("A ModalAdapter is required");if(this.form=e.form,!e.form)throw new Error('Missing required option: "form"');this.template=e.template||this.constructor.template},render:function(){var e=this;return _.isEmpty(this.value)?this.openEditor():(this.renderSummary(),setTimeout(function(){e.trigger("readyToAdd")},0)),this.hasFocus&&this.trigger("blur",this),this},renderSummary:function(){this.$el.html($.trim(this.template({summary:this.getStringValue()})))},itemToString:function(i){i=i||{};var n=[];return _.each(this.nestedSchema,function(e,t){e=e.title||s.Field.prototype.createTitle.call({key:t}),t=i[t];(_.isUndefined(t)||_.isNull(t))&&(t=""),n.push(e+": "+t)}),n.join("<br />")},getStringValue:function(){var e=this.schema,t=this.getValue();return _.isEmpty(t)?"[Empty]":(e.itemToString?e:this).itemToString(t)},openEditor:function(){var e=this.form.constructor,e=this.modalForm=new e({schema:this.nestedSchema,data:this.value}),e=this.modal=new s.editors.List.Modal.ModalAdapter({content:e,animate:!0});e.open(),this.trigger("open",this),this.trigger("focus",this),e.on("cancel",this.onModalClosed,this),e.on("ok",_.bind(this.onModalSubmitted,this))},onModalSubmitted:function(){var e=this.modal,t=this.modalForm,i=!this.value;if(t.validate())return e.preventClose();this.value=t.getValue(),this.renderSummary(),i&&this.trigger("readyToAdd"),this.trigger("change",this),this.onModalClosed()},onModalClosed:function(){this.modal=null,this.modalForm=null,this.trigger("close",this),this.trigger("blur",this)},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){this.hasFocus||this.openEditor()},blur:function(){this.hasFocus&&this.modal&&this.modal.trigger("cancel")}},{template:_.template("      <div><%= summary %></div>    ",null,s.templateSettings),ModalAdapter:Backbone.BootstrapModal,isAsync:!0}),s.editors.List.Object=s.editors.List.Modal.extend({initialize:function(){s.editors.List.Modal.prototype.initialize.apply(this,arguments);var e=this.schema;if(!e.subSchema)throw new Error('Missing required option "schema.subSchema"');this.nestedSchema=e.subSchema}}),s.editors.List.NestedModel=s.editors.List.Modal.extend({initialize:function(){s.editors.List.Modal.prototype.initialize.apply(this,arguments);var e=this.schema;if(!e.model)throw new Error('Missing required option "schema.model"');e=e.model.prototype.schema;this.nestedSchema=_.isFunction(e)?e():e},getStringValue:function(){var e=this.schema,t=this.getValue();return _.isEmpty(t)?null:e.itemToString?e.itemToString(t):new e.model(t).toString()}})}(Backbone.Form),!function(e){e.template=_.template('    <form class="form-horizontal" role="form">      <div data-fieldsets></div>      <% if (submitButton) { %>        <button type="submit" class="btn"><%= submitButton %></button>      <% } %>    </form>  '),e.Fieldset.template=_.template("    <fieldset data-fields>      <% if (legend) { %>        <legend><%= legend %></legend>      <% } %>    </fieldset>  "),e.Field.template=_.template('    <div class="form-group field-<%= key %>">      <label class="col-sm-2 control-label" for="<%= editorId %>">        <% if (titleHTML){ %><%= titleHTML %>        <% } else { %><%- title %><% } %>      </label>      <div class="col-sm-10">        <span data-editor></span>        <p class="help-block" data-error></p>        <p class="help-block"><%= help %></p>      </div>    </div>  '),e.NestedField.template=_.template('    <div class="field-<%= key %>">      <div title="<% if (titleHTML){ %><%= titleHTML %><% } else { %><%- title %><% } %>" class="input-xlarge">        <span data-editor></span>        <div class="help-inline" data-error></div>      </div>      <div class="help-block"><%= help %></div>    </div>  '),e.editors.Base.prototype.className="form-control",e.Field.errorClassName="has-error",e.editors.List&&(e.editors.List.template=_.template('      <div class="bbf-list">        <div class="bbf-list-contents">          <ul class="list-unstyled clearfix" data-items></ul>        </div>        <div class="bbf-list-buttons">          <button type="button" class="btn btn-default bbf-add" data-action="add"><span class="glyphicon glyphicon-plus"></span> add value</button>        </div>      </div>    '),e.editors.List.Item.template=_.template('      <li class="clearfix">        <div class="input-group">          <div data-editor></div>          <span class="input-group-btn">            <button type="button" class="btn btn-default bbf-del" data-action="remove">&times;</button>          </span>        </div>      </li>    '),e.editors.List.Object.template=e.editors.List.NestedModel.template=_.template('      <div class="bbf-list-modal"><%= summary %></div>    '))}(Backbone.Form),!function(e,t){"function"==typeof define&&define.amd?define([],t):"undefined"!=typeof exports?t():(t(),e.bootstrapTable={})}(this,function(){"use strict";var e=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var M=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!i||n.length!==i);r=!0);}catch(e){t=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(t)throw o}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};function d(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U=jQuery,t=3;try{var i=U.fn.dropdown.Constructor.VERSION;void 0!==i&&(t=parseInt(i,10))}catch(e){}var x={3:{iconsPrefix:"glyphicon",icons:{paginationSwitchDown:"glyphicon-collapse-down icon-chevron-down",paginationSwitchUp:"glyphicon-collapse-up icon-chevron-up",refresh:"glyphicon-refresh icon-refresh",toggleOff:"glyphicon-list-alt icon-list-alt",toggleOn:"glyphicon-list-alt icon-list-alt",columns:"glyphicon-th icon-th",detailOpen:"glyphicon-plus icon-plus",detailClose:"glyphicon-minus icon-minus",fullscreen:"glyphicon-fullscreen"},classes:{buttons:"default",pull:"pull"},html:{toobarDropdow:['<ul class="dropdown-menu" role="menu">',"</ul>"],toobarDropdowItem:'<li role="menuitem"><label>%s</label></li>',pageDropdown:['<ul class="dropdown-menu" role="menu">',"</ul>"],pageDropdownItem:'<li role="menuitem" class="%s"><a href="#">%s</a></li>'}},4:{iconsPrefix:"fa",icons:{paginationSwitchDown:"fa-caret-square-down",paginationSwitchUp:"fa-caret-square-up",refresh:"fa-sync",toggleOff:"fa-toggle-off",toggleOn:"fa-toggle-on",columns:"fa-th-list",detailOpen:"fa-plus",detailClose:"fa-minus",fullscreen:"fa-arrows-alt"},classes:{buttons:"secondary",pull:"float"},html:{toobarDropdow:['<div class="dropdown-menu dropdown-menu-right">',"</div>"],toobarDropdowItem:'<label class="dropdown-item">%s</label>',pageDropdown:['<div class="dropdown-menu">',"</div>"],pageDropdownItem:'<a class="dropdown-item %s" href="#">%s</a>'}}}[t],$={bootstrapVersion:t,sprintf:function(e){for(var t=arguments.length,i=Array(1<t?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var r=!0,o=0,e=e.replace(/%s/g,function(){var e=i[o++];return void 0===e?(r=!1,""):e});return r?e:""},getFieldTitle:function(e,t){var i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;if(a.field===t)return a.title}}catch(e){n=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}return""},setFieldIndex:function(e){var t=0,i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[0][Symbol.iterator]();!(n=(s=a.next()).done);n=!0)t+=s.value.colspan||1}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}for(var l=0;l<e.length;l++){i[l]=[];for(var u=0;u<t;u++)i[l][u]=!1}for(var c=0;c<e.length;c++){var d=!0,h=!1,p=void 0;try{for(var f,g=e[c][Symbol.iterator]();!(d=(f=g.next()).done);d=!0){var m=f.value,v=m.rowspan||1,y=m.colspan||1,b=i[c].indexOf(!1);1===y&&(m.fieldIndex=b,void 0===m.field)&&(m.field=b);for(var w=0;w<v;w++)i[c+w][b]=!0;for(var x=0;x<y;x++)i[c][b+x]=!0}}catch(e){h=!0,p=e}finally{try{!d&&g.return&&g.return()}finally{if(h)throw p}}}},getScrollBarWidth:function(){var e,t,i;return void 0===this.cachedWidth&&(i=U("<div/>").addClass("fixed-table-scroll-inner"),(e=U("<div/>").addClass("fixed-table-scroll-outer")).append(i),U("body").append(e),t=i[0].offsetWidth,e.css("overflow","scroll"),t===(i=i[0].offsetWidth)&&(i=e[0].clientWidth),e.remove(),this.cachedWidth=t-i),this.cachedWidth},calculateObjectValue:function(e,t,i,n){var r=t;if("string"==typeof t){var o=t.split(".");if(1<o.length){r=window;var s=!0,a=!1,l=void 0;try{for(var u,c=o[Symbol.iterator]();!(s=(u=c.next()).done);s=!0)r=r[u.value]}catch(e){a=!0,l=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw l}}}else r=window[t]}return null!==r&&"object"===(void 0===r?"undefined":h(r))?r:"function"==typeof r?r.apply(e,i||[]):!r&&"string"==typeof t&&this.sprintf.apply(this,[t].concat(d(i)))?this.sprintf.apply(this,[t].concat(d(i))):n},compareObjects:function(e,t,i){var n=Object.keys(e),r=Object.keys(t);if(i&&n.length!==r.length)return!1;var o=!0,i=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(r.includes(u)&&e[u]!==t[u])return!1}}catch(e){i=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(i)throw s}}return!0},escapeHTML:function(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/`/g,"&#x60;"):e},getRealDataAttr:function(e){var t=!0,i=!1,n=void 0;try{for(var r,o=Object.entries(e)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,a=M(s,2),l=a[0],u=a[1],c=l.split(/(?=[A-Z])/).join("-").toLowerCase();c!==l&&(e[c]=u,delete e[l])}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}return e},getItemField:function(e,t,i){var n=e;if("string"!=typeof t||e.hasOwnProperty(t))return i?this.escapeHTML(e[t]):e[t];var e=t.split("."),r=!0,t=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)var l=s.value,n=n&&n[l]}catch(e){t=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(t)throw o}}return i?this.escapeHTML(n):n},isIEBrowser:function(){return navigator.userAgent.includes("MSIE ")||/Trident.*rv:11\./.test(navigator.userAgent)},findIndex:function(e,t){var i=!0,n=!1,r=void 0;try{for(var o,s=e.entries()[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=M(a,2),u=l[0],c=l[1];if(JSON.stringify(c)===JSON.stringify(t))return u}}catch(e){n=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}return-1}},i={height:void 0,classes:"table table-bordered table-hover",theadClasses:"",rowStyle:function(e,t){return{}},rowAttributes:function(e,t){return{}},undefinedText:"-",locale:void 0,sortable:!0,sortClass:void 0,silentSort:!0,sortName:void 0,sortOrder:"asc",sortStable:!1,rememberOrder:!1,customSort:void 0,columns:[[]],data:[],url:void 0,method:"get",cache:!0,contentType:"application/json",dataType:"json",ajax:void 0,ajaxOptions:{},queryParams:function(e){return e},queryParamsType:"limit",responseHandler:function(e){return e},totalField:"total",dataField:"rows",pagination:!1,onlyInfoPagination:!1,paginationLoop:!0,sidePagination:"client",totalRows:0,pageNumber:1,pageSize:10,pageList:[10,25,50,100],paginationHAlign:"right",paginationVAlign:"bottom",paginationDetailHAlign:"left",paginationPreText:"&lsaquo;",paginationNextText:"&rsaquo;",paginationSuccessivelySize:5,paginationPagesBySide:1,paginationUseIntermediate:!1,search:!1,searchOnEnterKey:!1,strictSearch:!1,trimOnSearch:!0,searchAlign:"right",searchTimeOut:500,searchText:"",customSearch:void 0,showHeader:!0,showFooter:!1,footerStyle:function(e,t){return{}},showColumns:!1,minimumCountColumns:1,showPaginationSwitch:!1,showRefresh:!1,showToggle:!1,showFullscreen:!1,smartDisplay:!0,escape:!1,idField:void 0,uniqueId:void 0,cardView:!1,detailView:!1,detailFormatter:function(e,t){return""},detailFilter:function(e,t){return!0},selectItemName:"btSelectItem",clickToSelect:!1,ignoreClickToSelectOn:function(e){e=e.tagName;return["A","BUTTON"].includes(e)},singleSelect:!1,checkboxHeader:!0,maintainSelected:!1,toolbar:void 0,toolbarAlign:"left",buttonsToolbar:void 0,buttonsAlign:"right",buttonsClass:x.classes.buttons,icons:x.icons,iconSize:void 0,iconsPrefix:x.iconsPrefix,onAll:function(e,t){return!1},onClickCell:function(e,t,i,n){return!1},onDblClickCell:function(e,t,i,n){return!1},onClickRow:function(e,t){return!1},onDblClickRow:function(e,t){return!1},onSort:function(e,t){return!1},onCheck:function(e){return!1},onUncheck:function(e){return!1},onCheckAll:function(e){return!1},onUncheckAll:function(e){return!1},onCheckSome:function(e){return!1},onUncheckSome:function(e){return!1},onLoadSuccess:function(e){return!1},onLoadError:function(e){return!1},onColumnSwitch:function(e,t){return!1},onPageChange:function(e,t){return!1},onSearch:function(e){return!1},onToggle:function(e){return!1},onPreBody:function(e){return!1},onPostBody:function(){return!1},onPostHeader:function(){return!1},onExpandRow:function(e,t,i){return!1},onCollapseRow:function(e,t){return!1},onRefreshOptions:function(e){return!1},onRefresh:function(e){return!1},onResetView:function(){return!1},onScrollBody:function(){return!1}},r=((t={})["en-US"]=t.en={formatLoadingMessage:function(){return"Loading, please wait..."},formatRecordsPerPage:function(e){return $.sprintf("%s rows per page",e)},formatShowingRows:function(e,t,i){return $.sprintf("Showing %s to %s of %s rows",e,t,i)},formatDetailPagination:function(e){return $.sprintf("Showing %s rows",e)},formatSearch:function(){return"Search"},formatNoMatches:function(){return"No matching records found"},formatPaginationSwitch:function(){return"Hide/Show pagination"},formatRefresh:function(){return"Refresh"},formatToggle:function(){return"Toggle"},formatFullscreen:function(){return"Fullscreen"},formatColumns:function(){return"Columns"},formatAllRows:function(){return"All"}},U.extend(i,t["en-US"]),{radio:!1,checkbox:!1,checkboxEnabled:!0,field:void 0,title:void 0,titleTooltip:void 0,class:void 0,align:void 0,halign:void 0,falign:void 0,valign:void 0,width:void 0,sortable:!1,order:"asc",visible:!0,switchable:!0,clickToSelect:!0,formatter:void 0,footerFormatter:void 0,events:void 0,sorter:void 0,sortName:void 0,cellStyle:void 0,searchable:!0,searchFormatter:!0,cardVisible:!0,escape:!1,showSelectTitle:!1}),a=(e(o,[{key:"init",value:function(){this.initLocale(),this.initContainer(),this.initTable(),this.initHeader(),this.initData(),this.initHiddenRows(),this.initFooter(),this.initToolbar(),this.initPagination(),this.initBody(),this.initSearchText(),this.initServer()}},{key:"initLocale",value:function(){var e,t;this.options.locale&&(e=U.fn.bootstrapTable.locales,(t=this.options.locale.split(/-|_/))[0]=t[0].toLowerCase(),t[1]&&(t[1]=t[1].toUpperCase()),e[this.options.locale]?U.extend(this.options,e[this.options.locale]):e[t.join("-")]?U.extend(this.options,e[t.join("-")]):e[t[0]]&&U.extend(this.options,e[t[0]]))}},{key:"initContainer",value:function(){var e=["top","both"].includes(this.options.paginationVAlign)?'<div class="fixed-table-pagination clearfix"></div>':"",t=["bottom","both"].includes(this.options.paginationVAlign)?'<div class="fixed-table-pagination"></div>':"";this.$container=U('\n        <div class="bootstrap-table">\n        <div class="fixed-table-toolbar"></div>\n        '+e+'\n        <div class="fixed-table-container">\n        <div class="fixed-table-header"><table></table></div>\n        <div class="fixed-table-body">\n        <div class="fixed-table-loading">\n        '+this.options.formatLoadingMessage()+'\n        </div>\n        </div>\n        <div class="fixed-table-footer"><table><tr></tr></table></div>\n        </div>\n        '+t+"\n        </div>\n      "),this.$container.insertAfter(this.$el),this.$tableContainer=this.$container.find(".fixed-table-container"),this.$tableHeader=this.$container.find(".fixed-table-header"),this.$tableBody=this.$container.find(".fixed-table-body"),this.$tableLoading=this.$container.find(".fixed-table-loading"),this.$tableFooter=this.$container.find(".fixed-table-footer"),this.options.buttonsToolbar?this.$toolbar=U("body").find(this.options.buttonsToolbar):this.$toolbar=this.$container.find(".fixed-table-toolbar"),this.$pagination=this.$container.find(".fixed-table-pagination"),this.$tableBody.append(this.$el),this.$container.after('<div class="clearfix"></div>'),this.$el.addClass(this.options.classes),this.options.height&&(this.$tableContainer.addClass("fixed-height"),this.options.classes.split(" ").includes("table-bordered"))&&(this.$tableBody.append('<div class="fixed-table-border"></div>'),this.$tableBorder=this.$tableBody.find(".fixed-table-border"),this.$tableLoading.addClass("fixed-table-border"))}},{key:"initTable",value:function(){var u,c=this,n=[],t=[];this.$header=this.$el.find(">thead"),this.$header.length||(this.$header=U('<thead class="'+this.options.theadClasses+'"></thead>').appendTo(this.$el)),this.$header.find("tr").each(function(e,t){var i=[];U(t).find("th").each(function(e,t){void 0!==U(t).data("field")&&U(t).data("field",""+U(t).data("field")),i.push(U.extend({},{title:U(t).html(),class:U(t).attr("class"),titleTooltip:U(t).attr("title"),rowspan:U(t).attr("rowspan")?+U(t).attr("rowspan"):void 0,colspan:U(t).attr("colspan")?+U(t).attr("colspan"):void 0},U(t).data()))}),n.push(i)}),Array.isArray(this.options.columns[0])||(this.options.columns=[this.options.columns]),this.options.columns=U.extend(!0,[],n,this.options.columns),this.columns=[],this.fieldsColumnsIndex=[],$.setFieldIndex(this.options.columns),this.options.columns.forEach(function(e,i){e.forEach(function(e,t){e=U.extend({},o.COLUMN_DEFAULTS,e);void 0!==e.fieldIndex&&(c.columns[e.fieldIndex]=e,c.fieldsColumnsIndex[e.field]=e.fieldIndex),c.options.columns[i][t]=e})}),this.options.data.length||(u=[],this.$el.find(">tbody>tr").each(function(a,e){var l={};l._id=U(e).attr("id"),l._class=U(e).attr("class"),l._data=$.getRealDataAttr(U(e).data()),U(e).find(">td").each(function(e,t){for(var i=+U(t).attr("colspan")||1,n=+U(t).attr("rowspan")||1,r=e;u[a]&&u[a][r];r++);for(var o=r;o<r+i;o++)for(var s=a;s<a+n;s++)u[s]||(u[s]=[]),u[s][o]=!0;e=c.columns[r].field;l[e]=U(t).html(),l["_"+e+"_id"]=U(t).attr("id"),l["_"+e+"_class"]=U(t).attr("class"),l["_"+e+"_rowspan"]=U(t).attr("rowspan"),l["_"+e+"_colspan"]=U(t).attr("colspan"),l["_"+e+"_title"]=U(t).attr("title"),l["_"+e+"_data"]=$.getRealDataAttr(U(t).data())}),t.push(l)}),(this.options.data=t).length&&(this.fromHtml=!0))}},{key:"initHeader",value:function(){var c=this,d={},h=[];this.header={fields:[],styles:[],classes:[],formatters:[],events:[],sorters:[],sortNames:[],cellStyles:[],searchables:[]},this.options.columns.forEach(function(e,u){h.push("<tr>"),0===u&&!c.options.cardView&&c.options.detailView&&h.push('<th class="detail" rowspan="'+c.options.columns.length+'">\n            <div class="fht-cell"></div>\n            </th>\n          '),e.forEach(function(e,t){var i,n,r,o="",s=$.sprintf(' class="%s"',e.class),a="px",l=e.width;if(void 0===e.width||c.options.cardView||"string"==typeof e.width&&e.width.includes("%")&&(a="%"),e.width&&"string"==typeof e.width&&(l=e.width.replace("%","").replace("px","")),i=$.sprintf("text-align: %s; ",e.halign||e.align),n=$.sprintf("text-align: %s; ",e.align),r=$.sprintf("vertical-align: %s; ",e.valign),r+=$.sprintf("width: %s; ",!e.checkbox&&!e.radio||l?l?l+a:void 0:e.showSelectTitle?void 0:"36px"),void 0!==e.fieldIndex){if(c.header.fields[e.fieldIndex]=e.field,c.header.styles[e.fieldIndex]=n+r,c.header.classes[e.fieldIndex]=s,c.header.formatters[e.fieldIndex]=e.formatter,c.header.events[e.fieldIndex]=e.events,c.header.sorters[e.fieldIndex]=e.sorter,c.header.sortNames[e.fieldIndex]=e.sortName,c.header.cellStyles[e.fieldIndex]=e.cellStyle,c.header.searchables[e.fieldIndex]=e.searchable,!e.visible)return;if(c.options.cardView&&!e.cardVisible)return;d[e.field]=e}h.push("<th"+$.sprintf(' title="%s"',e.titleTooltip),e.checkbox||e.radio?$.sprintf(' class="bs-checkbox %s"',e.class||""):s,$.sprintf(' style="%s"',i+r),$.sprintf(' rowspan="%s"',e.rowspan),$.sprintf(' colspan="%s"',e.colspan),$.sprintf(' data-field="%s"',e.field),0===t&&0<u?" data-not-first-th":"",">"),h.push($.sprintf('<div class="th-inner %s">',c.options.sortable&&e.sortable?"sortable both":""));l=o=c.options.escape?$.escapeHTML(e.title):e.title;e.checkbox&&(o="",!c.options.singleSelect&&c.options.checkboxHeader&&(o='<input name="btSelectAll" type="checkbox" />'),c.header.stateField=e.field),e.radio&&(o="",c.header.stateField=e.field,c.options.singleSelect=!0),!o&&e.showSelectTitle&&(o+=l),h.push(o),h.push("</div>"),h.push('<div class="fht-cell"></div>'),h.push("</div>"),h.push("</th>")}),h.push("</tr>")}),this.$header.html(h.join("")),this.$header.find("th[data-field]").each(function(e,t){U(t).data(d[U(t).data("field")])}),this.$container.off("click",".th-inner").on("click",".th-inner",function(e){var t=U(e.currentTarget);if(c.options.detailView&&!t.parent().hasClass("bs-checkbox")&&t.closest(".bootstrap-table")[0]!==c.$container[0])return!1;c.options.sortable&&t.parent().data().sortable&&c.onSort(e)}),this.$header.children().children().off("keypress").on("keypress",function(e){c.options.sortable&&U(e.currentTarget).data().sortable&&13===(e.keyCode||e.which)&&c.onSort(e)}),U(window).off("resize.bootstrap-table"),!this.options.showHeader||this.options.cardView?(this.$header.hide(),this.$tableHeader.hide(),this.$tableLoading.css("top",0)):(this.$header.show(),this.$tableHeader.show(),this.$tableLoading.css("top",this.$header.outerHeight()+1),this.getCaret(),U(window).on("resize.bootstrap-table",U.proxy(this.resetWidth,this))),this.$selectAll=this.$header.find('[name="btSelectAll"]'),this.$selectAll.off("click").on("click",function(e){e=e.currentTarget,e=U(e).prop("checked");c[e?"checkAll":"uncheckAll"](),c.updateSelected()})}},{key:"initFooter",value:function(){!this.options.showFooter||this.options.cardView?this.$tableFooter.hide():this.$tableFooter.show()}},{key:"initData",value:function(e,t){this.options.data="append"===t?this.options.data.concat(e):"prepend"===t?[].concat(e).concat(this.options.data):e||this.options.data,this.data=this.options.data,"server"!==this.options.sidePagination&&this.initSort()}},{key:"initSort",value:function(){var o=this,s=this.options.sortName,a="desc"===this.options.sortOrder?-1:1,l=this.header.fields.indexOf(this.options.sortName);-1!==l&&(this.options.sortStable&&this.data.forEach(function(e,t){e.hasOwnProperty("_position")||(e._position=t)}),this.options.customSort?$.calculateObjectValue(this.options,this.options.customSort,[this.options.sortName,this.options.sortOrder,this.data]):this.data.sort(function(e,t){o.header.sortNames[l]&&(s=o.header.sortNames[l]);var i=$.getItemField(e,s,o.options.escape),n=$.getItemField(t,s,o.options.escape),r=$.calculateObjectValue(o.header,o.header.sorters[l],[i,n,e,t]);return void 0!==r?o.options.sortStable&&0===r?a*(e._position-t._position):a*r:(null==i&&(i=""),null==n&&(n=""),o.options.sortStable&&i===n&&(i=e._position,n=t._position),U.isNumeric(i)&&U.isNumeric(n)?(i=parseFloat(i))<(n=parseFloat(n))?-1*a:n<i?a:0:i===n?0:-1===(i="string"!=typeof i?i.toString():i).localeCompare(n)?-1*a:a)}),void 0!==this.options.sortClass)&&(clearTimeout(0),setTimeout(function(){o.$el.removeClass(o.options.sortClass);var e=o.$header.find('[data-field="'+o.options.sortName+'"]').index();o.$el.find("tr td:nth-child("+(e+1)+")").addClass(o.options.sortClass)},250))}},{key:"onSort",value:function(e){var t=e.type,e=e.currentTarget,t="keypress"===t?U(e):U(e).parent(),e=this.$header.find("th").eq(t.index());this.$header.add(this.$header_).find("span.order").remove(),this.options.sortName===t.data("field")?this.options.sortOrder="asc"===this.options.sortOrder?"desc":"asc":(this.options.sortName=t.data("field"),this.options.rememberOrder?this.options.sortOrder="asc"===t.data("order")?"desc":"asc":this.options.sortOrder=this.columns[this.fieldsColumnsIndex[t.data("field")]].order),this.trigger("sort",this.options.sortName,this.options.sortOrder),t.add(e).data("order",this.options.sortOrder),this.getCaret(),"server"===this.options.sidePagination?this.initServer(this.options.silentSort):(this.initSort(),this.initBody())}},{key:"initToolbar",value:function(){var n=this,r=[],t=0,e=void 0,i=void 0,o=0;this.$toolbar.find(".bs-bars").children().length&&U("body").append(U(this.options.toolbar)),this.$toolbar.html(""),"string"!=typeof this.options.toolbar&&"object"!==h(this.options.toolbar)||U($.sprintf('<div class="bs-bars %s-%s"></div>',x.classes.pull,this.options.toolbarAlign)).appendTo(this.$toolbar).append(U(this.options.toolbar)),r=[$.sprintf('<div class="columns columns-%s btn-group %s-%s">',this.options.buttonsAlign,x.classes.pull,this.options.buttonsAlign)],"string"==typeof this.options.icons&&(this.options.icons=$.calculateObjectValue(null,this.options.icons)),this.options.showPaginationSwitch&&r.push($.sprintf('<button class="btn'+$.sprintf(" btn-%s",this.options.buttonsClass)+$.sprintf(" btn-%s",this.options.iconSize)+'" type="button" name="paginationSwitch" aria-label="pagination Switch" title="%s">',this.options.formatPaginationSwitch()),$.sprintf('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.paginationSwitchDown),"</button>"),this.options.showFullscreen&&this.$toolbar.find('button[name="fullscreen"]').off("click").on("click",U.proxy(this.toggleFullscreen,this)),this.options.showRefresh&&r.push($.sprintf('<button class="btn'+$.sprintf(" btn-%s",this.options.buttonsClass)+$.sprintf(" btn-%s",this.options.iconSize)+'" type="button" name="refresh" aria-label="refresh" title="%s">',this.options.formatRefresh()),$.sprintf('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.refresh),"</button>"),this.options.showToggle&&r.push($.sprintf('<button class="btn'+$.sprintf(" btn-%s",this.options.buttonsClass)+$.sprintf(" btn-%s",this.options.iconSize)+'" type="button" name="toggle" aria-label="toggle" title="%s">',this.options.formatToggle()),$.sprintf('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.toggleOff),"</button>"),this.options.showFullscreen&&r.push($.sprintf('<button class="btn'+$.sprintf(" btn-%s",this.options.buttonsClass)+$.sprintf(" btn-%s",this.options.iconSize)+'" type="button" name="fullscreen" aria-label="fullscreen" title="%s">',this.options.formatFullscreen()),$.sprintf('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.fullscreen),"</button>"),this.options.showColumns&&(r.push($.sprintf('<div class="keep-open btn-group" title="%s">',this.options.formatColumns()),'<button type="button" aria-label="columns" class="btn'+$.sprintf(" btn-%s",this.options.buttonsClass)+$.sprintf(" btn-%s",this.options.iconSize)+' dropdown-toggle" data-toggle="dropdown">',$.sprintf('<i class="%s %s"></i>',this.options.iconsPrefix,this.options.icons.columns),' <span class="caret"></span>',"</button>",x.html.toobarDropdow[0]),this.columns.forEach(function(e,t){var i;e.radio||e.checkbox||n.options.cardView&&!e.cardVisible||(i=e.visible?' checked="checked"':"",e.switchable&&(r.push($.sprintf(x.html.toobarDropdowItem,$.sprintf('<input type="checkbox" data-field="%s" value="%s"%s> %s',e.field,t,i,e.title))),o++))}),r.push(x.html.toobarDropdow[1],"</div>")),r.push("</div>"),(this.showToolbar||2<r.length)&&this.$toolbar.append(r.join("")),this.options.showPaginationSwitch&&this.$toolbar.find('button[name="paginationSwitch"]').off("click").on("click",U.proxy(this.togglePagination,this)),this.options.showRefresh&&this.$toolbar.find('button[name="refresh"]').off("click").on("click",U.proxy(this.refresh,this)),this.options.showToggle&&this.$toolbar.find('button[name="toggle"]').off("click").on("click",function(){n.toggleView()}),this.options.showColumns&&(e=this.$toolbar.find(".keep-open"),o<=this.options.minimumCountColumns&&e.find("input").prop("disabled",!0),e.find("li").off("click").on("click",function(e){e.stopImmediatePropagation()}),e.find("input").off("click").on("click",function(e){e=e.currentTarget,e=U(e);n.toggleColumn(e.val(),e.prop("checked"),!1),n.trigger("column-switch",e.data("field"),e.prop("checked"))})),this.options.search&&((r=[]).push($.sprintf('<div class="%s-%s search">',x.classes.pull,this.options.searchAlign),$.sprintf('<input class="form-control'+$.sprintf(" input-%s",this.options.iconSize)+'" type="text" placeholder="%s">',this.options.formatSearch()),"</div>"),this.$toolbar.append(r.join("")),(i=this.$toolbar.find(".search input")).off("keyup drop blur").on("keyup drop blur",function(e){n.options.searchOnEnterKey&&13!==e.keyCode||[37,38,39,40].includes(e.keyCode)||(clearTimeout(t),t=setTimeout(function(){n.onSearch(e)},n.options.searchTimeOut))}),$.isIEBrowser())&&i.off("mouseup").on("mouseup",function(e){clearTimeout(t),t=setTimeout(function(){n.onSearch(e)},n.options.searchTimeOut)})}},{key:"onSearch",value:function(e){var t=e.currentTarget,e=e.firedByInitSearchText,i=U.trim(U(t).val());this.options.trimOnSearch&&U(t).val()!==i&&U(t).val(i),i!==this.searchText&&(this.searchText=i,this.options.searchText=i,e||(this.options.pageNumber=1),this.initSearch(),e&&"client"!==this.options.sidePagination||this.updatePagination(),this.trigger("search",i))}},{key:"initSearch",value:function(){var l,n,u=this;"server"!==this.options.sidePagination&&(this.options.customSearch?$.calculateObjectValue(this.options,this.options.customSearch,[this.searchText]):(l=this.searchText&&(this.options.escape?$.escapeHTML(this.searchText):this.searchText).toLowerCase(),n=U.isEmptyObject(this.filterColumns)?null:this.filterColumns,this.data=n?this.options.data.filter(function(e,t){for(var i in n)if(Array.isArray(n[i])&&!n[i].includes(e[i])||!Array.isArray(n[i])&&e[i]!==n[i])return!1;return!0}):this.options.data,this.data=l?this.data.filter(function(e,t){for(var i=0;i<u.header.fields.length;i++)if(u.header.searchables[i]){var n=U.isNumeric(u.header.fields[i])?parseInt(u.header.fields[i],10):u.header.fields[i],r=u.columns[u.fieldsColumnsIndex[n]],o=void 0;if("string"==typeof n)for(var o=e,s=n.split("."),a=0;a<s.length;a++)null!==o[s[a]]&&(o=o[s[a]]);else o=e[n];if("string"==typeof(o=r&&r.searchFormatter?$.calculateObjectValue(r,u.header.formatters[i],[o,e,t],o):o)||"number"==typeof o)if(u.options.strictSearch){if((""+o).toLowerCase()===l)return!0}else if((""+o).toLowerCase().includes(l))return!0}return!1}):this.data))}},{key:"initPagination",value:function(){var i=this;if(this.options.pagination){this.$pagination.show();var e=[],n=!1,t=void 0,r=void 0,o=void 0,s=void 0,a=void 0,l=void 0,u=void 0,c=this.getData(),d=this.options.pageList;if("server"!==this.options.sidePagination&&(this.options.totalRows=c.length),this.totalPages=0,this.options.totalRows&&(this.options.pageSize===this.options.formatAllRows()?(this.options.pageSize=this.options.totalRows,n=!0):this.options.pageSize===this.options.totalRows&&("string"==typeof this.options.pageList?this.options.pageList.replace("[","").replace("]","").replace(/ /g,"").toLowerCase().split(","):this.options.pageList).includes(this.options.formatAllRows().toLowerCase())&&(n=!0),this.totalPages=1+~~((this.options.totalRows-1)/this.options.pageSize),this.options.totalPages=this.totalPages),0<this.totalPages&&this.options.pageNumber>this.totalPages&&(this.options.pageNumber=this.totalPages),this.pageFrom=(this.options.pageNumber-1)*this.options.pageSize+1,this.pageTo=this.options.pageNumber*this.options.pageSize,this.pageTo>this.options.totalRows&&(this.pageTo=this.options.totalRows),e.push($.sprintf('<div class="%s-%s pagination-detail">',x.classes.pull,this.options.paginationDetailHAlign),'<span class="pagination-info">',this.options.onlyInfoPagination?this.options.formatDetailPagination(this.options.totalRows):this.options.formatShowingRows(this.pageFrom,this.pageTo,this.options.totalRows),"</span>"),!this.options.onlyInfoPagination){e.push('<span class="page-list">');var h=[$.sprintf('<span class="btn-group %s">',"top"===this.options.paginationVAlign||"both"===this.options.paginationVAlign?"dropdown":"dropup"),'<button type="button" class="btn'+$.sprintf(" btn-%s",this.options.buttonsClass)+$.sprintf(" btn-%s",this.options.iconSize)+' dropdown-toggle" data-toggle="dropdown">','<span class="page-size">',n?this.options.formatAllRows():this.options.pageSize,"</span>",' <span class="caret"></span>',"</button>",x.html.pageDropdown[0]];if("string"==typeof this.options.pageList){var c=this.options.pageList.replace("[","").replace("]","").replace(/ /g,"").split(","),d=[],p=!0,f=!1,g=void 0;try{for(var m,v=c[Symbol.iterator]();!(p=(m=v.next()).done);p=!0){var y=m.value;d.push(y.toUpperCase()===this.options.formatAllRows().toUpperCase()||"UNLIMITED"===y.toUpperCase()?this.options.formatAllRows():+y)}}catch(e){f=!0,g=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw g}}}d.forEach(function(e,t){(!i.options.smartDisplay||0===t||d[t-1]<i.options.totalRows)&&(t=void 0,t=n?e===i.options.formatAllRows()?"active":"":e===i.options.pageSize?"active":"",h.push($.sprintf(x.html.pageDropdownItem,t,e)))}),h.push(x.html.pageDropdown[1]+"</span>"),e.push(this.options.formatRecordsPerPage(h.join(""))),e.push("</span>"),e.push("</div>",$.sprintf('<div class="%s-%s pagination">',x.classes.pull,this.options.paginationHAlign),'<ul class="pagination'+$.sprintf(" pagination-%s",this.options.iconSize)+'">',$.sprintf('<li class="page-item page-pre"><a class="page-link" href="#">%s</a></li>',this.options.paginationPreText)),o=this.totalPages<this.options.paginationSuccessivelySize?(r=1,this.totalPages):(r=this.options.pageNumber-this.options.paginationPagesBySide)+2*this.options.paginationPagesBySide,(o=this.options.pageNumber<this.options.paginationSuccessivelySize-1?this.options.paginationSuccessivelySize:o)>this.totalPages&&(o=this.totalPages),(r=this.options.paginationSuccessivelySize>this.totalPages-r?r-(this.options.paginationSuccessivelySize-(this.totalPages-r))+1:r)<1&&(r=1),o>this.totalPages&&(o=this.totalPages);var c=Math.round(this.options.paginationPagesBySide/2),b=function(e){return'\n          <li class="page-item'+(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"")+(e===i.options.pageNumber?" active":"")+'">\n            <a class="page-link" href="#">'+e+"</a>\n          </li>\n        "};if(1<r){var w=this.options.paginationPagesBySide;for(r<=w&&(w=r-1),t=1;t<=w;t++)e.push(b(t));r-1===w+1?e.push(b(t=r-1)):w<r-1&&(r-2*this.options.paginationPagesBySide>this.options.paginationPagesBySide&&this.options.paginationUseIntermediate?(t=Math.round((r-c)/2+c),e.push(b(t," page-intermediate"))):e.push('\n                  <li class="page-item page-first-separator disabled">\n                    <a class="page-link" href="#">...</a>\n                  </li>'))}for(t=r;t<=o;t++)e.push(b(t));if(this.totalPages>o){f=this.totalPages-(this.options.paginationPagesBySide-1);for(o+1===(f=f<=o?o+1:f)-1?e.push(b(t=o+1)):o+1<f&&(this.totalPages-o>2*this.options.paginationPagesBySide&&this.options.paginationUseIntermediate?(t=Math.round((this.totalPages-c-o)/2+o),e.push(b(t," page-intermediate"))):e.push('\n                  <li class="page-item page-last-separator disabled">\n                    <a class="page-link" href="#">...</a>\n                  </li>')),t=f;t<=this.totalPages;t++)e.push(b(t))}e.push('\n          <li class="page-item page-next">\n          <a class="page-link" href="#">'+this.options.paginationNextText+"</a>\n          </li>\n          </ul>\n          </div>\n        ")}this.$pagination.html(e.join("")),this.options.onlyInfoPagination||(s=this.$pagination.find(".page-list a"),a=this.$pagination.find(".page-pre"),l=this.$pagination.find(".page-next"),u=this.$pagination.find(".page-item").not(".page-next, .page-pre"),this.options.smartDisplay&&(this.totalPages<=1&&this.$pagination.find("div.pagination").hide(),(d.length<2||this.options.totalRows<=d[0])&&this.$pagination.find("span.page-list").hide(),this.$pagination[this.getData().length?"show":"hide"]()),this.options.paginationLoop||(1===this.options.pageNumber&&a.addClass("disabled"),this.options.pageNumber===this.totalPages&&l.addClass("disabled")),n&&(this.options.pageSize=this.options.formatAllRows()),s.off("click").on("click",U.proxy(this.onPageListChange,this)),a.off("click").on("click",U.proxy(this.onPagePre,this)),l.off("click").on("click",U.proxy(this.onPageNext,this)),u.off("click").on("click",U.proxy(this.onPageNumber,this)))}else this.$pagination.hide()}},{key:"updatePagination",value:function(e){e&&U(e.currentTarget).hasClass("disabled")||(this.options.maintainSelected||this.resetRows(),this.initPagination(),"server"===this.options.sidePagination?this.initServer():this.initBody(),this.trigger("page-change",this.options.pageNumber,this.options.pageSize))}},{key:"onPageListChange",value:function(e){e.preventDefault();var t=U(e.currentTarget);return t.parent().addClass("active").siblings().removeClass("active"),this.options.pageSize=t.text().toUpperCase()===this.options.formatAllRows().toUpperCase()?this.options.formatAllRows():+t.text(),this.$toolbar.find(".page-size").text(this.options.pageSize),this.updatePagination(e),!1}},{key:"onPagePre",value:function(e){return e.preventDefault(),this.options.pageNumber-1==0?this.options.pageNumber=this.options.totalPages:this.options.pageNumber--,this.updatePagination(e),!1}},{key:"onPageNext",value:function(e){return e.preventDefault(),this.options.pageNumber+1>this.options.totalPages?this.options.pageNumber=1:this.options.pageNumber++,this.updatePagination(e),!1}},{key:"onPageNumber",value:function(e){if(e.preventDefault(),this.options.pageNumber!==+U(e.currentTarget).text())return this.options.pageNumber=+U(e.currentTarget).text(),this.updatePagination(e),!1}},{key:"initRow",value:function(I,A,e,t){var O=this,N=[],L={},P=[],i="",n={},r=[];if(!(-1<$.findIndex(this.hiddenRows,I))){if((L=$.calculateObjectValue(this.options,this.options.rowStyle,[I,A],L))&&L.css){var o=!0,s=!1,a=void 0;try{for(var l,u=Object.entries(L.css)[Symbol.iterator]();!(o=(l=u.next()).done);o=!0){var c=l.value,d=M(c,2),h=d[0],p=d[1];P.push(h+": "+p)}}catch(e){s=!0,a=e}finally{try{!o&&u.return&&u.return()}finally{if(s)throw a}}}if(n=$.calculateObjectValue(this.options,this.options.rowAttributes,[I,A],n)){var f=!0,s=!1,a=void 0;try{for(var g,m=Object.entries(n)[Symbol.iterator]();!(f=(g=m.next()).done);f=!0){var v=g.value,y=M(v,2),b=y[0],w=y[1];r.push(b+'="'+$.escapeHTML(w)+'"')}}catch(e){s=!0,a=e}finally{try{!f&&m.return&&m.return()}finally{if(s)throw a}}}if(I._data&&!U.isEmptyObject(I._data)){var x=!0,n=!1,s=void 0;try{for(var _,k=Object.entries(I._data)[Symbol.iterator]();!(x=(_=k.next()).done);x=!0){var C=_.value,E=M(C,2),F=E[0],T=E[1];if("index"===F)return;i+=" data-"+F+'="'+T+'"'}}catch(e){n=!0,s=e}finally{try{!x&&k.return&&k.return()}finally{if(n)throw s}}}return N.push("<tr",$.sprintf(" %s",r.length?r.join(" "):void 0),$.sprintf(' id="%s"',Array.isArray(I)?void 0:I._id),$.sprintf(' class="%s"',L.classes||(Array.isArray(I)?void 0:I._class)),' data-index="'+A+'"',$.sprintf(' data-uniqueid="%s"',I[this.options.uniqueId]),$.sprintf("%s",i),">"),this.options.cardView&&N.push('<td colspan="'+this.header.fields.length+'"><div class="card-views">'),!this.options.cardView&&this.options.detailView&&(N.push("<td>"),$.calculateObjectValue(null,this.options.detailFilter,[A,I])&&N.push('\n            <a class="detail-icon" href="#">\n            <i class="'+this.options.iconsPrefix+" "+this.options.icons.detailOpen+'"></i>\n            </a>\n          '),N.push("</td>")),this.header.fields.forEach(function(e,t){var i="",n=$.getItemField(I,e,O.options.escape),r="",o="",s={},a="",l=O.header.classes[t],u="",c="",d="",h="",p="",f=O.columns[t];if((!O.fromHtml||void 0!==n||f.checkbox||f.radio)&&f.visible&&(!O.options.cardView||f.cardVisible)){if(f.escape&&(n=$.escapeHTML(n)),P.concat([O.header.styles[t]]).length&&(u=' style="'+P.concat([O.header.styles[t]]).join("; ")+'"'),I["_"+e+"_id"]&&(a=$.sprintf(' id="%s"',I["_"+e+"_id"])),I["_"+e+"_class"]&&(l=$.sprintf(' class="%s"',I["_"+e+"_class"])),I["_"+e+"_rowspan"]&&(d=$.sprintf(' rowspan="%s"',I["_"+e+"_rowspan"])),I["_"+e+"_colspan"]&&(h=$.sprintf(' colspan="%s"',I["_"+e+"_colspan"])),I["_"+e+"_title"]&&(p=$.sprintf(' title="%s"',I["_"+e+"_title"])),(s=$.calculateObjectValue(O.header,O.header.cellStyles[t],[n,I,A,e],s)).classes&&(l=' class="'+s.classes+'"'),s.css){var g=[],m=!0,v=!1,y=void 0;try{for(var b,w=Object.entries(s.css)[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var x=b.value,_=M(x,2),k=_[0],C=_[1];g.push(k+": "+C)}}catch(e){v=!0,y=e}finally{try{!m&&w.return&&w.return()}finally{if(v)throw y}}u=' style="'+g.concat(O.header.styles[t]).join("; ")+'"'}if(r=$.calculateObjectValue(f,O.header.formatters[t],[n,I,A,e],n),I["_"+e+"_data"]&&!U.isEmptyObject(I["_"+e+"_data"])){var E=!0,s=!1,v=void 0;try{for(var F,T=Object.entries(I["_"+e+"_data"])[Symbol.iterator]();!(E=(F=T.next()).done);E=!0){var D=F.value,S=M(D,2),R=S[0],j=S[1];if("index"===R)return;c+=" data-"+R+'="'+j+'"'}}catch(e){s=!0,v=e}finally{try{!E&&T.return&&T.return()}finally{if(s)throw v}}}f.checkbox||f.radio?(o=f.checkbox?"checkbox":"",o=f.radio?"radio":o,y=f.class||"",s=!0===r||n||r&&r.checked,v=!f.checkboxEnabled||r&&r.disabled,i=[O.options.cardView?'<div class="card-view '+y+'">':'<td class="bs-checkbox '+y+'">','<input\n              data-index="'+A+'"\n              name="'+O.options.selectItemName+'"\n              type="'+o+'"\n              '+$.sprintf('value="%s"',I[O.options.idField])+"\n              "+$.sprintf('checked="%s"',s?"checked":void 0)+"\n              "+$.sprintf('disabled="%s"',v?"disabled":void 0)+" />",O.header.formatters[t]&&"string"==typeof r?r:"",O.options.cardView?"</div>":"</td>"].join(""),I[O.header.stateField]=!0===r||!!n||r&&r.checked):(r=null==r?O.options.undefinedText:r,O.options.cardView?(i='<div class="card-view">'+(O.options.showHeader?'<span class="title"'+L+">"+$.getFieldTitle(O.columns,e)+"</span>":"")+'<span class="value">'+r+"</span></div>",O.options.smartDisplay&&""===r&&(i='<div class="card-view"></div>')):i="<td"+a+l+u+c+d+h+p+">"+r+"</td>"),N.push(i)}}),this.options.cardView&&N.push("</div></td>"),N.push("</tr>"),N.join("")}}},{key:"initBody",value:function(e){for(var c=this,r=this.getData(),t=(this.trigger("pre-body",r),this.$body=this.$el.find(">tbody"),this.$body.length||(this.$body=U("<tbody></tbody>").appendTo(this.$el)),this.options.pagination&&"server"!==this.options.sidePagination||(this.pageFrom=1,this.pageTo=r.length),U(document.createDocumentFragment())),i=!1,n=this.pageFrom-1;n<this.pageTo;n++){var o=r[n],o=this.initRow(o,n,r,t),i=i||!!o;o&&"string"==typeof o&&t.append(o)}i?this.$body.html(t):this.$body.html('<tr class="no-records-found">'+$.sprintf('<td colspan="%s">%s</td>',this.$header.find("th").length,this.options.formatNoMatches())+"</tr>"),e||this.scrollTo(0),this.$body.find("> tr[data-index] > td").off("click dblclick").on("click dblclick",function(e){var t=e.currentTarget,i=e.type,e=e.target,t=U(t),n=t.parent(),r=c.data[n.data("index")],o=t[0].cellIndex,o=c.getVisibleFields()[c.options.detailView&&!c.options.cardView?o-1:o],s=c.columns[c.fieldsColumnsIndex[o]],a=$.getItemField(r,o,c.options.escape);t.find(".detail-icon").length||(c.trigger("click"===i?"click-cell":"dbl-click-cell",o,a,r,t),c.trigger("click"===i?"click-row":"dbl-click-row",r,n,o),"click"===i&&c.options.clickToSelect&&s.clickToSelect&&!c.options.ignoreClickToSelectOn(e)&&(a=n.find($.sprintf('[name="%s"]',c.options.selectItemName))).length&&a[0].click())}),this.$body.find("> tr[data-index] > td > .detail-icon").off("click").on("click",function(e){e.preventDefault();var e=U(e.currentTarget),t=e.parent().parent(),i=t.data("index"),n=r[i];return t.next().is("tr.detail-view")?(e.find("i").attr("class",$.sprintf("%s %s",c.options.iconsPrefix,c.options.icons.detailOpen)),c.trigger("collapse-row",i,n,t.next()),t.next().remove()):(e.find("i").attr("class",$.sprintf("%s %s",c.options.iconsPrefix,c.options.icons.detailClose)),t.after($.sprintf('<tr class="detail-view"><td colspan="%s"></td></tr>',t.find("td").length)),e=t.next().find("td"),t=$.calculateObjectValue(c.options,c.options.detailFormatter,[i,n,e],""),1===e.length&&e.append(t),c.trigger("expand-row",i,n,e)),c.resetView(),!1}),this.$selectItem=this.$body.find($.sprintf('[name="%s"]',this.options.selectItemName)),this.$selectItem.off("click").on("click",function(e){e.stopImmediatePropagation();e=U(e.currentTarget);c.check_(e.prop("checked"),e.data("index"))}),this.header.events.forEach(function(e,t){if(e){"string"==typeof e&&(e=$.calculateObjectValue(null,e));var a=c.header.fields[t],l=c.getVisibleFields().indexOf(a);if(-1!==l){c.options.detailView&&!c.options.cardView&&(l+=1);var i=!0,t=!1,n=void 0;try{for(var r,o=Object.entries(e)[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value,u=M(s,2);!function(o,s){c.$body.find(">tr:not(.no-records-found)").each(function(e,t){var r=U(t),t=r.find(c.options.cardView?".card-view":"td").eq(l),i=o.indexOf(" "),n=o.substring(0,i),i=o.substring(i+1);t.find(i).off(n).on(n,function(e){var t=r.data("index"),i=c.data[t],n=i[a];s.apply(c,[e,n,i,t])})})}(u[0],u[1])}}catch(e){t=!0,n=e}finally{try{!i&&o.return&&o.return()}finally{if(t)throw n}}}}}),this.updateSelected(),this.resetView(),this.trigger("post-body",r)}},{key:"initServer",value:function(i,e,t){var n=this,r={},o=this.header.fields.indexOf(this.options.sortName),s={searchText:this.searchText,sortName:this.options.sortName,sortOrder:this.options.sortOrder};this.header.sortNames[o]&&(s.sortName=this.header.sortNames[o]),this.options.pagination&&"server"===this.options.sidePagination&&(s.pageSize=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,s.pageNumber=this.options.pageNumber),(t||this.options.url||this.options.ajax)&&("limit"===this.options.queryParamsType&&(s={search:s.searchText,sort:s.sortName,order:s.sortOrder},this.options.pagination)&&"server"===this.options.sidePagination&&(s.offset=this.options.pageSize===this.options.formatAllRows()?0:this.options.pageSize*(this.options.pageNumber-1),s.limit=this.options.pageSize===this.options.formatAllRows()?this.options.totalRows:this.options.pageSize,0===s.limit)&&delete s.limit,U.isEmptyObject(this.filterColumnsPartial)||(s.filter=JSON.stringify(this.filterColumnsPartial,null)),r=$.calculateObjectValue(this.options,this.options.queryParams,[s],r),U.extend(r,e||{}),!1!==r)&&(i||this.$tableLoading.show(),o=U.extend({},$.calculateObjectValue(null,this.options.ajaxOptions),{type:this.options.method,url:t||this.options.url,data:"application/json"===this.options.contentType&&"post"===this.options.method?JSON.stringify(r):r,cache:this.options.cache,contentType:this.options.contentType,dataType:this.options.dataType,success:function(e){e=$.calculateObjectValue(n.options,n.options.responseHandler,[e],e);n.load(e),n.trigger("load-success",e),i||n.$tableLoading.hide()},error:function(e){var t=[];"server"===n.options.sidePagination&&((t={})[n.options.totalField]=0,t[n.options.dataField]=[]),n.load(t),n.trigger("load-error",e.status,e),i||n.$tableLoading.hide()}}),this.options.ajax?$.calculateObjectValue(this,this.options.ajax,[o],null):(this._xhr&&4!==this._xhr.readyState&&this._xhr.abort(),this._xhr=U.ajax(o)))}},{key:"initSearchText",value:function(){var e;this.options.search&&(this.searchText="")!==this.options.searchText&&((e=this.$toolbar.find(".search input")).val(this.options.searchText),this.onSearch({currentTarget:e,firedByInitSearchText:!0}))}},{key:"getCaret",value:function(){var i=this;this.$header.find("th").each(function(e,t){U(t).find(".sortable").removeClass("desc asc").addClass(U(t).data("field")===i.options.sortName?i.options.sortOrder:"both")})}},{key:"updateSelected",value:function(){var e=this.$selectItem.filter(":enabled").length&&this.$selectItem.filter(":enabled").length===this.$selectItem.filter(":enabled").filter(":checked").length;this.$selectAll.add(this.$selectAll_).prop("checked",e),this.$selectItem.each(function(e,t){U(t).closest("tr")[U(t).prop("checked")?"addClass":"removeClass"]("selected")})}},{key:"updateRows",value:function(){var i=this;this.$selectItem.each(function(e,t){i.data[U(t).data("index")][i.header.stateField]=U(t).prop("checked")})}},{key:"resetRows",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.data[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value;this.$selectAll.prop("checked",!1),this.$selectItem.prop("checked",!1),this.header.stateField&&(o[this.header.stateField]=!1)}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}this.initHiddenRows()}},{key:"trigger",value:function(e){for(var t,e=e+".bs.table",i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(t=this.options)[o.EVENTS[e]].apply(t,n),this.$el.trigger(U.Event(e),n),this.options.onAll(e,n),this.$el.trigger(U.Event("all.bs.table"),[e,n])}},{key:"resetHeader",value:function(){clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(U.proxy(this.fitHeader,this),this.$el.is(":hidden")?100:0)}},{key:"fitHeader",value:function(){var e,t,o,s,a=this;this.$el.is(":hidden")?this.timeoutId_=setTimeout(U.proxy(this.fitHeader,this),100):(e=(e=this.$tableBody.get(0)).scrollWidth>e.clientWidth&&e.scrollHeight>e.clientHeight+this.$header.outerHeight()?$.getScrollBarWidth():0,this.$el.css("margin-top",-this.$header.outerHeight()),0<(t=U(":focus")).length&&0<(t=t.parents("th")).length&&void 0!==(t=t.attr("data-field"))&&0<(t=this.$header.find("[data-field='"+t+"']")).length&&t.find(":input").addClass("focus-temp"),this.$header_=this.$header.clone(!0,!0),this.$selectAll_=this.$header_.find('[name="btSelectAll"]'),this.$tableHeader.css({"margin-right":e}).find("table").css("width",this.$el.outerWidth()).html("").attr("class",this.$el.attr("class")).append(this.$header_),t=U(".focus-temp:visible:eq(0)"),0<t.length&&(t.focus(),this.$header.find(".focus-temp").removeClass("focus-temp")),this.$header.find("th[data-field]").each(function(e,t){a.$header_.find($.sprintf('th[data-field="%s"]',U(t).data("field"))).data(U(t).data())}),o=this.getVisibleFields(),s=this.$header_.find("th"),this.$body.find(">tr:first-child:not(.no-records-found) > *").each(function(e,t){var i,n,t=U(t),r=e;a.options.detailView&&!a.options.cardView&&(0===e&&(n=(i=s.filter(".detail")).width()-i.find(".fht-cell").width(),i.find(".fht-cell").width(t.innerWidth()-n)),r=e-1),-1!==r&&(n=(i=1<(i=a.$header_.find($.sprintf('th[data-field="%s"]',o[r]))).length?U(s[t[0].cellIndex]):i).width()-i.find(".fht-cell").width(),i.find(".fht-cell").width(t.innerWidth()-n))}),this.horizontalScroll(),this.trigger("post-header"))}},{key:"resetFooter",value:function(){var e=this.getData(),t=[];if(this.options.showFooter&&!this.options.cardView){!this.options.cardView&&this.options.detailView&&t.push('<td><div class="th-inner">&nbsp;</div><div class="fht-cell"></div></td>');var i=!0,n=!1,r=void 0;try{for(var o,s=this.columns[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a,l,u,c=o.value,d=[],h=$.sprintf(' class="%s"',c.class);if(!c.visible)return;if(this.options.cardView&&!c.cardVisible)return;if(a=$.sprintf("text-align: %s; ",c.falign||c.align),l=$.sprintf("vertical-align: %s; ",c.valign),(u=$.calculateObjectValue(null,this.options.footerStyle))&&u.css){var p=!0,f=!1,g=void 0;try{for(var m,v=Object.keys(u.css)[Symbol.iterator]();!(p=(m=v.next()).done);p=!0){var y=m.value,b=M(y,2),w=b[0],x=b[1];d.push(w+": "+x)}}catch(e){f=!0,g=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw g}}}t.push("<td",h,$.sprintf(' style="%s"',a+l+d.concat().join("; ")),">"),t.push('<div class="th-inner">'),t.push($.calculateObjectValue(c,c.footerFormatter,[e],"&nbsp;")||"&nbsp;"),t.push("</div>"),t.push('<div class="fht-cell"></div>'),t.push("</div>"),t.push("</td>")}}catch(e){n=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}this.$tableFooter.find("tr").html(t.join("")),this.$tableFooter.show(),clearTimeout(this.timeoutFooter_),this.timeoutFooter_=setTimeout(U.proxy(this.fitFooter,this),this.$el.is(":hidden")?100:0)}}},{key:"fitFooter",value:function(){var e,t,i;clearTimeout(this.timeoutFooter_),this.$el.is(":hidden")?this.timeoutFooter_=setTimeout(U.proxy(this.fitFooter,this),100):(t=(e=this.$el.css("width"))>this.$tableBody.width()?$.getScrollBarWidth():0,this.$tableFooter.css({"margin-right":t}).find("table").css("width",e).attr("class",this.$el.attr("class")),i=this.$tableFooter.find("td"),this.$body.find(">tr:first-child:not(.no-records-found) > *").each(function(e,t){t=U(t);i.eq(e).find(".fht-cell").width(t.innerWidth())}),this.horizontalScroll())}},{key:"horizontalScroll",value:function(){var t=this;this.trigger("scroll-body"),this.$tableBody.off("scroll").on("scroll",function(e){e=e.currentTarget;t.options.showHeader&&t.options.height&&t.$tableHeader.scrollLeft(U(e).scrollLeft()),t.options.showFooter&&!t.options.cardView&&t.$tableFooter.scrollLeft(U(e).scrollLeft())})}},{key:"toggleColumn",value:function(e,t,i){var n;-1!==e&&(this.columns[e].visible=t,this.initHeader(),this.initSearch(),this.initPagination(),this.initBody(),this.options.showColumns)&&(n=this.$toolbar.find(".keep-open input").prop("disabled",!1),i&&n.filter($.sprintf('[value="%s"]',e)).prop("checked",t),n.filter(":checked").length<=this.options.minimumCountColumns)&&n.filter(":checked").prop("disabled",!0)}},{key:"getVisibleFields",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var r,o=this.header.fields[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;this.columns[this.fieldsColumnsIndex[s]].visible&&e.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}return e}},{key:"resetView",value:function(e){var t,i=0;e&&e.height&&(this.options.height=e.height),this.$selectAll.prop("checked",0<this.$selectItem.length&&this.$selectItem.length===this.$selectItem.filter(":checked").length),this.options.cardView?(this.$el.css("margin-top","0"),this.$tableContainer.css("padding-bottom","0"),this.$tableFooter.hide()):(this.options.showHeader&&this.options.height?(this.$tableHeader.show(),this.resetHeader(),i+=this.$header.outerHeight()):(this.$tableHeader.hide(),this.trigger("post-header")),this.options.showFooter&&(this.resetFooter(),this.options.height)&&(i+=this.$tableFooter.outerHeight()+1),this.options.height&&(e=this.$toolbar.outerHeight(!0),t=this.$pagination.outerHeight(!0),e=this.options.height-e-t,t=this.$tableBody.find("table").outerHeight(!0),this.$tableContainer.css("height",e+"px"),this.$tableBorder)&&this.$tableBorder.css("height",e-t-i-1+"px"),this.getCaret(),this.$tableContainer.css("padding-bottom",i+"px"),this.trigger("reset-view"))}},{key:"getData",value:function(e){var t=this.options.data;return!this.searchText&&!this.options.sortName&&U.isEmptyObject(this.filterColumns)&&U.isEmptyObject(this.filterColumnsPartial)||(t=this.data),e?t.slice(this.pageFrom-1,this.pageTo):t}},{key:"load",value:function(e){var t;this.options.pagination&&"server"===this.options.sidePagination&&(this.options.totalRows=e[this.options.totalField]),t=e.fixedScroll,e=Array.isArray(e)?e:e[this.options.dataField],this.initData(e),this.initSearch(),this.initPagination(),this.initBody(t)}},{key:"append",value:function(e){this.initData(e,"append"),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}},{key:"prepend",value:function(e){this.initData(e,"prepend"),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}},{key:"remove",value:function(e){var t=this.options.data.length,i=void 0,n=void 0;if(e.hasOwnProperty("field")&&e.hasOwnProperty("values")){for(i=t-1;0<=i;i--)(n=this.options.data[i]).hasOwnProperty(e.field)&&e.values.includes(n[e.field])&&(this.options.data.splice(i,1),"server"===this.options.sidePagination)&&--this.options.totalRows;t!==this.options.data.length&&(this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0))}}},{key:"removeAll",value:function(){0<this.options.data.length&&(this.options.data.splice(0,this.options.data.length),this.initSearch(),this.initPagination(),this.initBody(!0))}},{key:"getRowByUniqueId",value:function(e){for(var t=this.options.uniqueId,i=e,n=null,r=void 0,o=void 0,s=void 0,r=this.options.data.length-1;0<=r;r--){if((o=this.options.data[r]).hasOwnProperty(t))s=o[t];else{if(!o._data||!o._data.hasOwnProperty(t))continue;s=o._data[t]}if("string"==typeof s?i=i.toString():"number"==typeof s&&(Number(s)===s&&s%1==0?i=parseInt(i):s===Number(s)&&0!==s&&(i=parseFloat(i))),s===i){n=o;break}}return n}},{key:"removeByUniqueId",value:function(e){var t=this.options.data.length,e=this.getRowByUniqueId(e);e&&this.options.data.splice(this.options.data.indexOf(e),1),t!==this.options.data.length&&(this.initSearch(),this.initPagination(),this.initBody(!0))}},{key:"updateByUniqueId",value:function(e){var e=Array.isArray(e)?e:[e],t=!0,i=!1,n=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s,a=r.value;a.hasOwnProperty("id")&&a.hasOwnProperty("row")&&-1!==(s=this.options.data.indexOf(this.getRowByUniqueId(a.id)))&&U.extend(this.options.data[s],a.row)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}},{key:"refreshColumnTitle",value:function(i){i.hasOwnProperty("field")&&i.hasOwnProperty("title")&&(this.columns[this.fieldsColumnsIndex[i.field]].title=this.options.escape?$.escapeHTML(i.title):i.title,this.columns[this.fieldsColumnsIndex[i.field]].visible)&&(void 0!==this.options.height?this.$tableHeader:this.$header).find("th[data-field]").each(function(e,t){if(U(t).data("field")===i.field)return U(U(t).find(".th-inner")[0]).text(i.title),!1})}},{key:"insertRow",value:function(e){e.hasOwnProperty("index")&&e.hasOwnProperty("row")&&(this.options.data.splice(e.index,0,e.row),this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0))}},{key:"updateRow",value:function(e){var e=Array.isArray(e)?e:[e],t=!0,i=!1,n=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;s.hasOwnProperty("index")&&s.hasOwnProperty("row")&&U.extend(this.options.data[s.index],s.row)}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}this.initSearch(),this.initPagination(),this.initSort(),this.initBody(!0)}},{key:"initHiddenRows",value:function(){this.hiddenRows=[]}},{key:"showRow",value:function(e){this.toggleRow(e,!0)}},{key:"hideRow",value:function(e){this.toggleRow(e,!1)}},{key:"toggleRow",value:function(e,t){var i=void 0;e.hasOwnProperty("index")?i=this.getData()[e.index]:e.hasOwnProperty("uniqueId")&&(i=this.getRowByUniqueId(e.uniqueId)),i&&(e=$.findIndex(this.hiddenRows,i),t||-1!==e?t&&-1<e&&this.hiddenRows.splice(e,1):this.hiddenRows.push(i),this.initBody(!0))}},{key:"getHiddenRows",value:function(e){if(!e){var e=this.getData(),t=[],i=!0,n=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;this.hiddenRows.includes(a)&&t.push(a)}}catch(e){n=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw r}}return this.hiddenRows=t}this.initHiddenRows(),this.initBody(!0)}},{key:"mergeCells",value:function(e){var t=e.index,i=this.getVisibleFields().indexOf(e.field),n=e.rowspan||1,r=e.colspan||1,o=void 0,s=void 0,a=this.$body.find(">tr"),e=(this.options.detailView&&!this.options.cardView&&(i+=1),a.eq(t).find(">td").eq(i));if(!(t<0||i<0||t>=this.data.length)){for(o=t;o<t+n;o++)for(s=i;s<i+r;s++)a.eq(o).find(">td").eq(s).hide();e.attr("rowspan",n).attr("colspan",r).show()}}},{key:"updateCell",value:function(e){e.hasOwnProperty("index")&&e.hasOwnProperty("field")&&e.hasOwnProperty("value")&&(this.data[e.index][e.field]=e.value,!1!==e.reinit)&&(this.initSort(),this.initBody(!0))}},{key:"updateCellById",value:function(e){var n=this;e.hasOwnProperty("id")&&e.hasOwnProperty("field")&&e.hasOwnProperty("value")&&((Array.isArray(e)?e:[e]).forEach(function(e){var t=e.id,i=e.field,e=e.value,t=n.options.data.indexOf(n.getRowByUniqueId(t));-1!==t&&(n.data[t][i]=e)}),!1!==e.reinit)&&(this.initSort(),this.initBody(!0))}},{key:"getOptions",value:function(){var e=U.extend({},this.options);return delete e.data,U.extend(!0,{},e)}},{key:"getSelections",value:function(){var t=this;return this.options.data.filter(function(e){return!0===e[t.header.stateField]})}},{key:"getAllSelections",value:function(){var t=this;return this.options.data.filter(function(e){return e[t.header.stateField]})}},{key:"checkAll",value:function(){this.checkAll_(!0)}},{key:"uncheckAll",value:function(){this.checkAll_(!1)}},{key:"checkInvert",value:function(){var e=this.$selectItem.filter(":enabled"),t=e.filter(":checked");e.each(function(e,t){U(t).prop("checked",!U(t).prop("checked"))}),this.updateRows(),this.updateSelected(),this.trigger("uncheck-some",t),t=this.getSelections(),this.trigger("check-some",t)}},{key:"checkAll_",value:function(e){var t=void 0;e||(t=this.getSelections()),this.$selectAll.add(this.$selectAll_).prop("checked",e),this.$selectItem.filter(":enabled").prop("checked",e),this.updateRows(),e&&(t=this.getSelections()),this.trigger(e?"check-all":"uncheck-all",t)}},{key:"check",value:function(e){this.check_(!0,e)}},{key:"uncheck",value:function(e){this.check_(!1,e)}},{key:"check_",value:function(e,t){var i=this.$selectItem.filter('[data-index="'+t+'"]'),n=this.data[t];if(i.is(":radio")||this.options.singleSelect){var r=!0,o=!1,s=void 0;try{for(var a,l=this.options.data[Symbol.iterator]();!(r=(a=l.next()).done);r=!0)a.value[this.header.stateField]=!1}catch(e){o=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(o)throw s}}this.$selectItem.filter(":checked").not(i).prop("checked",!1)}n[this.header.stateField]=e,i.prop("checked",e),this.updateSelected(),this.trigger(e?"check":"uncheck",this.data[t],i)}},{key:"checkBy",value:function(e){this.checkBy_(!0,e)}},{key:"uncheckBy",value:function(e){this.checkBy_(!1,e)}},{key:"checkBy_",value:function(i,n){var r,o=this;n.hasOwnProperty("field")&&n.hasOwnProperty("values")&&(r=[],this.options.data.forEach(function(e,t){if(!e.hasOwnProperty(n.field))return!1;n.values.includes(e[n.field])&&(t=o.$selectItem.filter(":enabled").filter($.sprintf('[data-index="%s"]',t)).prop("checked",i),e[o.header.stateField]=i,r.push(e),o.trigger(i?"check":"uncheck",e,t))}),this.updateSelected(),this.trigger(i?"check-some":"uncheck-some",r))}},{key:"destroy",value:function(){this.$el.insertBefore(this.$container),U(this.options.toolbar).insertBefore(this.$el),this.$container.next().remove(),this.$container.remove(),this.$el.html(this.$el_.html()).css("margin-top","0").attr("class",this.$el_.attr("class")||"")}},{key:"showLoading",value:function(){this.$tableLoading.show()}},{key:"hideLoading",value:function(){this.$tableLoading.hide()}},{key:"togglePagination",value:function(){this.options.pagination=!this.options.pagination;var e=this.$toolbar.find('button[name="paginationSwitch"] i');this.options.pagination?e.attr("class",this.options.iconsPrefix+" "+this.options.icons.paginationSwitchDown):e.attr("class",this.options.iconsPrefix+" "+this.options.icons.paginationSwitchUp),this.updatePagination()}},{key:"toggleFullscreen",value:function(){this.$el.closest(".bootstrap-table").toggleClass("fullscreen")}},{key:"refresh",value:function(e){e&&e.url&&(this.options.url=e.url),e&&e.pageNumber&&(this.options.pageNumber=e.pageNumber),e&&e.pageSize&&(this.options.pageSize=e.pageSize),this.initServer(e&&e.silent,e&&e.query,e&&e.url),this.trigger("refresh",e)}},{key:"resetWidth",value:function(){this.options.showHeader&&this.options.height&&this.fitHeader(),this.options.showFooter&&!this.options.cardView&&this.fitFooter()}},{key:"showColumn",value:function(e){this.toggleColumn(this.fieldsColumnsIndex[e],!0,!0)}},{key:"hideColumn",value:function(e){this.toggleColumn(this.fieldsColumnsIndex[e],!1,!0)}},{key:"getHiddenColumns",value:function(){return this.columns.filter(function(e){return!e.visible})}},{key:"getVisibleColumns",value:function(){return this.columns.filter(function(e){return e.visible})}},{key:"toggleAllColumns",value:function(e){var t=!0,i=!1,n=void 0;try{for(var r,o=this.columns[Symbol.iterator]();!(t=(r=o.next()).done);t=!0)r.value.visible=e}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}this.initHeader(),this.initSearch(),this.initPagination(),this.initBody(),this.options.showColumns&&(i=this.$toolbar.find(".keep-open input").prop("disabled",!1)).filter(":checked").length<=this.options.minimumCountColumns&&i.filter(":checked").prop("disabled",!0)}},{key:"showAllColumns",value:function(){this.toggleAllColumns(!0)}},{key:"hideAllColumns",value:function(){this.toggleAllColumns(!1)}},{key:"filterBy",value:function(e){this.filterColumns=U.isEmptyObject(e)?{}:e,this.options.pageNumber=1,this.initSearch(),this.updatePagination()}},{key:"scrollTo",value:function(e){if(void 0===e)return this.$tableBody.scrollTop();var t=e;"string"==typeof e&&"bottom"===e&&(t=this.$tableBody[0].scrollHeight),this.$tableBody.scrollTop(t)}},{key:"getScrollPosition",value:function(){return this.scrollTo()}},{key:"selectPage",value:function(e){0<e&&e<=this.options.totalPages&&(this.options.pageNumber=e,this.updatePagination())}},{key:"prevPage",value:function(){1<this.options.pageNumber&&(this.options.pageNumber--,this.updatePagination())}},{key:"nextPage",value:function(){this.options.pageNumber<this.options.totalPages&&(this.options.pageNumber++,this.updatePagination())}},{key:"toggleView",value:function(){this.options.cardView=!this.options.cardView,this.initHeader();var e=this.$toolbar.find('button[name="toggle"] i');this.options.cardView?(e.removeClass(this.options.icons.toggleOff),e.addClass(this.options.icons.toggleOn)):(e.removeClass(this.options.icons.toggleOn),e.addClass(this.options.icons.toggleOff)),this.initBody(),this.trigger("toggle",this.options.cardView)}},{key:"refreshOptions",value:function(e){$.compareObjects(this.options,e,!0)||(this.options=U.extend(this.options,e),this.trigger("refresh-options",this.options),this.destroy(),this.init())}},{key:"resetSearch",value:function(e){var t=this.$toolbar.find(".search input");t.val(e||""),this.onSearch({currentTarget:t})}},{key:"expandRow_",value:function(e,t){t=this.$body.find($.sprintf('> tr[data-index="%s"]',t));t.next().is("tr.detail-view")===!e&&t.find("> td > .detail-icon").click()}},{key:"expandRow",value:function(e){this.expandRow_(!0,e)}},{key:"collapseRow",value:function(e){this.expandRow_(!1,e)}},{key:"expandAllRows",value:function(e){var t=this;if(e){var e=this.$body.find($.sprintf('> tr[data-index="%s"]',0)),i=null,n=!1,r=-1;if(e.next().is("tr.detail-view")?e.next().next().is("tr.detail-view")||(e.next().find(".detail-icon").click(),n=!0):(e.find("> td > .detail-icon").click(),n=!0),n)try{r=setInterval(function(){0<(i=t.$body.find("tr.detail-view").last().find(".detail-icon")).length?i.click():clearInterval(r)},1)}catch(e){clearInterval(r)}}else for(var o=this.$body.children(),s=0;s<o.length;s++)this.expandRow_(!0,U(o[s]).data("index"))}},{key:"collapseAllRows",value:function(e){if(e)this.expandRow_(!1,0);else for(var t=this.$body.children(),i=0;i<t.length;i++)this.expandRow_(!1,U(t[i]).data("index"))}},{key:"updateFormatText",value:function(e,t){this.options[$.sprintf("format%s",e)]&&("string"==typeof t?this.options[$.sprintf("format%s",e)]=function(){return t}:"function"==typeof t&&(this.options[$.sprintf("format%s",e)]=t)),this.initToolbar(),this.initPagination(),this.initBody()}}]),o);function o(e,t){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.options=t,this.$el=U(e),this.$el_=this.$el.clone(),this.timeoutId_=0,this.timeoutFooter_=0,this.init()}a.DEFAULTS=i,a.LOCALES=t,a.COLUMN_DEFAULTS=r,a.EVENTS={"all.bs.table":"onAll","click-cell.bs.table":"onClickCell","dbl-click-cell.bs.table":"onDblClickCell","click-row.bs.table":"onClickRow","dbl-click-row.bs.table":"onDblClickRow","sort.bs.table":"onSort","check.bs.table":"onCheck","uncheck.bs.table":"onUncheck","check-all.bs.table":"onCheckAll","uncheck-all.bs.table":"onUncheckAll","check-some.bs.table":"onCheckSome","uncheck-some.bs.table":"onUncheckSome","load-success.bs.table":"onLoadSuccess","load-error.bs.table":"onLoadError","column-switch.bs.table":"onColumnSwitch","page-change.bs.table":"onPageChange","search.bs.table":"onSearch","toggle.bs.table":"onToggle","pre-body.bs.table":"onPreBody","post-body.bs.table":"onPostBody","post-header.bs.table":"onPostHeader","expand-row.bs.table":"onExpandRow","collapse-row.bs.table":"onCollapseRow","refresh-options.bs.table":"onRefreshOptions","reset-view.bs.table":"onResetView","refresh.bs.table":"onRefresh","scroll-body.bs.table":"onScrollBody"};var l=["getOptions","getSelections","getAllSelections","getData","load","append","prepend","remove","removeAll","insertRow","updateRow","updateCell","updateByUniqueId","removeByUniqueId","getRowByUniqueId","showRow","hideRow","getHiddenRows","mergeCells","refreshColumnTitle","checkAll","uncheckAll","checkInvert","check","uncheck","checkBy","uncheckBy","refresh","resetView","resetWidth","destroy","showLoading","hideLoading","showColumn","hideColumn","getHiddenColumns","getVisibleColumns","showAllColumns","hideAllColumns","filterBy","scrollTo","getScrollPosition","selectPage","prevPage","nextPage","togglePagination","toggleView","refreshOptions","resetSearch","expandRow","collapseRow","expandAllRows","collapseAllRows","updateFormatText","updateCellById"];U.BootstrapTable=a,U.fn.bootstrapTable=function(r){for(var e=arguments.length,o=Array(1<e?e-1:0),t=1;t<e;t++)o[t-1]=arguments[t];var s=void 0;return this.each(function(e,t){var i=U(t).data("bootstrap.table"),n=U.extend({},a.DEFAULTS,U(t).data(),"object"===(void 0===r?"undefined":h(r))&&r);if("string"==typeof r){if(!l.includes(r))throw new Error("Unknown method: "+r);if(!i)return;s=i[r].apply(i,o),"destroy"===r&&U(t).removeData("bootstrap.table")}i||U(t).data("bootstrap.table",i=new U.BootstrapTable(t,n))}),void 0===s?this:s},U.fn.bootstrapTable.Constructor=a,U.fn.bootstrapTable.defaults=a.DEFAULTS,U.fn.bootstrapTable.columnDefaults=a.COLUMN_DEFAULTS,U.fn.bootstrapTable.locales=a.LOCALES,U.fn.bootstrapTable.methods=l,U.fn.bootstrapTable.utils=$,U(function(){U('[data-toggle="table"]').bootstrapTable()})}),!function(p){"use strict";p.extend(p.fn.bootstrapTable.defaults,{editable:!0,onEditableInit:function(){return!1},onEditableSave:function(e,t,i,n){return!1},onEditableShown:function(e,t,i,n){return i.parent("td").find('button[data-name="dereference-'+e+'"]').hide(),!1},onEditableHidden:function(e,t,i,n){return i.parent("td").find('button[data-name="dereference-'+e+'"]').show(),!1},dereference:!0,onDereferenceInit:function(){return!1}}),p.extend(p.fn.bootstrapTable.Constructor.EVENTS,{"editable-init.bs.table":"onEditableInit","editable-save.bs.table":"onEditableSave","editable-shown.bs.table":"onEditableShown","editable-hidden.bs.table":"onEditableHidden","dereference-init.bs.table":"onDereferenceInit"});var e=p.fn.bootstrapTable.Constructor,t=e.prototype.initTable,i=e.prototype.initBody;e.prototype.initTable=function(){var h=this;t.apply(this,Array.prototype.slice.apply(arguments)),(this.options.editable||this.options.dereference)&&p.each(this.columns,function(e,n){var r,o,i,s,a,l,u,c,d;(n.editable||n.dereference)&&(r={},o=[],i="editable-",p.each(h.options,s=function(e,t){var e=e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()});e.slice(0,i.length)==i&&(e=e.replace(i,"data-"),r[e]=t)}),a={},l=[],u="dereference-",p.each(h.options,c=function(e,t){var e=e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()});e.slice(0,u.length)==u&&(e=e.replace(u,"data-"),a[e]=t)}),d=n.formatter,n.formatter=function(e,t,i){i=d?d(e,t,i):e,e="";return n.editable&&(p.each(n,s),p.each(r,function(e,t){o.push(" "+e+'="'+t+'"')}),e+=['<a href="javascript:void(0)"',' data-name="'+n.field+'"',' data-pk="'+t[h.options.idField]+'"',' data-value="'+i+'"',o.join(""),"></a>"].join("")),n.dereference&&(p.each(n,c),p.each(a,function(e,t){l.push(" "+e+'="'+t+'"')}),e+=[' <a href="javascript:void(0)"',' data-name="dereference-'+n.field+'"',' data-value="'+i+'"',l.join(""),"> ",'<i class="glyphicon glyphicon-link"></i>',"</button>"].join("")),e})})},e.prototype.initBody=function(){var s=this;i.apply(this,Array.prototype.slice.apply(arguments)),this.options.editable&&(p.each(this.columns,function(e,r){var o,t;r.editable&&(o=s.getData(),(t=s.$body.find('a[data-name="'+r.field+'"]')).each(function(){var e;"function"==typeof r.editable?(e=o[p(this).parents("tr[data-index]").data("index")],p(this).editable(r.editable(e,r.field))):p(this).editable(r.editable)}).off("save").on("save",function(e,t){var i=o[p(this).parents("tr[data-index]").data("index")],n=i[r.field];p(this).data("value",t.submitValue),i[r.field]=t.submitValue,s.trigger("editable-save",r.field,i,n,p(this))}),t.each(function(){var e;"function"==typeof r.editable?(e=o[p(this).parents("tr[data-index]").data("index")],p(this).editable(r.editable(e,r.field))):p(this).editable(r.editable)}).off("shown").on("shown",function(e,t){var i=o[p(this).parents("tr[data-index]").data("index")];s.trigger("editable-shown",r.field,i,p(this),t)}),t.each(function(){var e;"function"==typeof r.editable?(e=o[p(this).parents("tr[data-index]").data("index")],p(this).editable(r.editable(e,r.field))):p(this).editable(r.editable)}).off("hidden").on("hidden",function(e,t){var i=o[p(this).parents("tr[data-index]").data("index")];s.trigger("editable-hidden",r.field,i,p(this),t)}))}),this.trigger("editable-init")),this.options.dereference&&(p.each(this.columns,function(e,t){var i;t.dereference&&(s.getData(),s.$body.find('a[data-name="dereference-'+t.field+'"]').off("click").on("click",(i=t.dereference,function(e,t){"function"==typeof i?i(p(this).attr("data-value")):console.log("Bad dereference definition")})))}),this.trigger("dereference-init"))}}(jQuery),!function(o,n){function t(e,t,i,n,r,o){return e=parseInt(e,10),!isNaN(e)&&!(!t&&0==e||!i&&e<0||!n&&0<e||null!=r&&r<e||null!=o&&e<o)}function e(e){return o.isNumeric(e)}function i(e,t){var i,n=this;for(i in n.mainElement=e,n.options=o.extend({},s,t),n.currentType=n.options.type||"http://www.w3.org/2000/01/rdf-schema#Literal",n.mainElement.on("input",function(){n.checkHashSign(),n.verifyInput(),n.change()}),n.container=o(document.createElement("div")).addClass("rdfNodeEditor"),n.inputContainer=o(document.createElement("div")).addClass("rdfNodeInputContainer"),(t=o(e).addClass("form-control")).after(n.container),n.inputContainer.append(t),n.container.append(n.inputContainer),n.options.choices&&("object"==typeof n.options.choices?n.selectizeSetup(n.options.choices):"function"==typeof n.options.choices&&n.options.choices(function(e){n.selectizeSetup(e)}),n.updateView(!1)),n.typeContainer=o(document.createElement("div")).addClass("rdfNodeTypeContainer"),n.typeContainer.css("vertical-align","top"),n.typeElement=o(document.createElement("select")).addClass("form-control"),a)n.typeElement.append(o(document.createElement("option")).attr("value",i).text(a[i].label));function r(){n.lastType=n.currentType,n.currentType=n.options.selectize?n.typeElement[0].selectize.getValue():n.typeElement.val(),n.verifyFct=a[n.currentType].verify,n.updateEditor(),n.verifyInput(),n.change()}n.typeContainer.append(n.typeElement),n.container.append(n.typeContainer),n.options.selectize?(n.typeElement.selectize({onChange:r}),n.typeElement[0].selectize.setValue(this.currentType)):n.typeElement.change(r),n.options.type&&(n.typeElement.val(n.options.type),n.typeContainer.hide()),n.languageElement=o(document.createElement("input")).addClass("form-control").attr("placeholder","Language"),n.languageContainer=o(document.createElement("div")).addClass("rdfNodelanguageContainer"),n.languageContainer.css("vertical-align","top"),n.languageContainer.append(n.languageElement),n.container.append(n.languageContainer),"http://www.w3.org/2000/01/rdf-schema#Literal"===n.currentType&&n.options.showLangSelect||n.languageContainer.hide(),n.languageElement.on("input",function(){n.lang=n.languageElement.val(),n.verifyInput(),n.change()}),n.options.dereferenceLink&&(n.dereferenceLink=o(document.createElement("button")),n.dereferenceLink.attr("type","button").addClass("btn btn-default btn-sm"),n.dereferenceLink.html('<i class="glyphicon glyphicon-link"></i>'),(e=o(document.createElement("div")).addClass("rdfe-reference-link")).append(n.dereferenceLink),(n.mainElement.closest(".editable-input").length?n.container.parent():n.container).after(e),n.dereferenceLink.on("click",function(){var e=n.getValue();e&&n.options.dereferenceLink(e.value)})),n.updateEditor(!0)}var r,s={type:null,showLangSelect:!0,selectize:!1,create:!0},a={"http://www.w3.org/2000/01/rdf-schema#Literal":{label:"Plain Literal"},"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource":{label:"Reference"},"http://www.w3.org/2001/XMLSchema#integer":{label:"Integer",verify:function(e){return t(e,!0,!0,!0)}},"http://www.w3.org/2001/XMLSchema#decimal":{label:"Decimal",verify:e},"http://www.w3.org/2001/XMLSchema#double":{label:"Double",verify:e},"http://www.w3.org/2001/XMLSchema#float":{label:"Float",verify:e},"http://www.w3.org/2001/XMLSchema#nonPositiveInteger":{label:"Non-Positive Integer",verify:function(e){return t(e,!0,!0,!1)}},"http://www.w3.org/2001/XMLSchema#negativeInteger":{label:"Negative Integer",verify:function(e){return t(e,!1,!0,!1)}},"http://www.w3.org/2001/XMLSchema#long":{label:"Long",verify:function(e){return t(e,!0,!0,!0)}},"http://www.w3.org/2001/XMLSchema#int":{label:"Int",verify:function(e){return t(e,!0,!0,!0,2147483647,-2147483648)}},"http://www.w3.org/2001/XMLSchema#short":{label:"Short",verify:function(e){return t(e,!0,!0,!0,32767,-32768)}},"http://www.w3.org/2001/XMLSchema#byte":{label:"Byte",verify:function(e){return t(e,!0,!0,!0,127,-128)}},"http://www.w3.org/2001/XMLSchema#nonNegativeInteger":{label:"Non-Negative Integer",verify:function(e){return t(e,!0,!1,!0)}},"http://www.w3.org/2001/XMLSchema#unsignedLong":{label:"Unsigned Long",verify:function(e){return t(e,!0,!1,!0)}},"http://www.w3.org/2001/XMLSchema#unsignedInt":{label:"Unsigned Int",verify:function(e){return t(e,!0,!1,!0,4294967295)}},"http://www.w3.org/2001/XMLSchema#unsignedShort":{label:"Unsigned Short",verify:function(e){return t(e,!0,!1,!0,65535)}},"http://www.w3.org/2001/XMLSchema#unsignedByte":{label:"Unsigned Byte",verify:function(e){return t(e,!0,!0,!0,255)}},"http://www.w3.org/2001/XMLSchema#positiveInteger":{label:"Positive Integer",verify:function(e){return t(e,!1,!1,!0)}},"http://www.w3.org/2001/XMLSchema#boolean":{label:"Boolean",setup:function(e,t){t?(e.bootstrapToggle&&e.bootstrapToggle("destroy"),e.attr("type","text")):(e.attr("type","checkbox"),e.bootstrapToggle({on:"True",off:"False"}))},getValue:function(e){return e.is(":checked")?"true":"false"},setValue:function(e,t){this.setup(e),"1"===(t=t&&t.toString().toLowerCase())||"true"===t?e.bootstrapToggle("on"):e.bootstrapToggle("off")}},"http://www.w3.org/2001/XMLSchema#string":{label:"String"},"http://www.w3.org/2001/XMLSchema#hexBinary":{label:"Hex Binary"},"http://www.w3.org/2001/XMLSchema#dateTime":{label:"Datetime",setup:function(e,t){t?e.datetimepicker("remove"):e.datetimepicker({format:"yyyy-mm-ddThh:ii:ssZ",weekStart:1,timezone:"Z"})}},"http://www.w3.org/2001/XMLSchema#date":{label:"Date",setup:function(e,t){t?e.datetimepicker("remove"):e.datetimepicker({format:"yyyy-mm-dd",weekStart:1})}}},l=(i.prototype.change=function(){o(this).trigger("changed",this)},i.prototype.selectizeSetup=function(e){var t=this;t.resourceContainer||(t.resourceSelect=o(document.createElement("select")),t.resourceSelect.attr("placeholder","Select/Enter resource"),t.resourceContainer=o(document.createElement("div")).addClass("rdfResourceContainer"),t.resourceContainer.append(t.resourceSelect),t.resourceContainer.css("min-width","200px"),t.inputContainer.append(t.resourceContainer)),t.resourceSelectize||(t.resourceSelect.selectize({delimiter:null,valueField:"value",searchField:["label"],sortField:["label"],lockOptgroupOrder:!0,create:function(e,t){var i=new n.RdfNode("uri",e);i.label=e,i.optgroup="local",t(this.options[e]=i)},createOnBlur:!0,onChange:function(e){t.mainElement.val(e),t.change()},render:{item:function(e,t){return"<div>"+t(e.label||e.value)+"</div>"},option:function(e,t){return e.label?"<div>"+t(e.label)+" <small>("+t(e.value)+")</small></div>":"<div>"+t(e.value)+"</div>"},option_create:function(e,t){var i=e.input;return(i=n.Utils.trim(n.Utils.trim(i,"<"),">"))!=e.input?'<div class="create">Add <strong>'+t(e.input)+"</strong> <small>("+t(i)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+t(i)+"</strong>&hellip;</div>"}}}),t.resourceSelectize=o(t.resourceSelect)[0].selectize),t.resourceSelectize.clearOptions(),t.resourceSelectize.clearOptionGroups(),t.resourceSelectize.addOptionGroup("local",{label:"Local Store"});for(var i=0;i<e.length;i++)e[i].optgroup="local";t.resourceSelectize.addOption(e)},i.prototype.updateSelection=function(e,t){var i=this.resourceSelectize;if(i){i.addOptionGroup(e,{label:e});for(var n=0;n<t.length;n++)t[n].optgroup=e;i.addOption(t),i.refreshOptions(!0)}},r=["http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#string"],function(e,t){return e===t||0<=o.inArray(e,r)&&0<=o.inArray(t,r)});i.prototype.updateEditor=function(e){var t=this;l(t.options.type,t.currentType)?t.typeContainer.hide():t.typeContainer.css("display","table-cell"),t.options.showLangSelect&&"http://www.w3.org/2000/01/rdf-schema#Literal"===t.currentType?t.languageContainer.css("display","table-cell"):t.languageContainer.hide(),!e&&t.lastType===t.currentType||(t.lastType&&a[t.lastType].setup&&a[t.lastType].setup(t.mainElement,!0),a[t.currentType].setup&&a[t.currentType].setup(t.mainElement),t.updateView("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!==t.currentType))},i.prototype.getField=function(){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"===this.currentType?this.resourceSelectize:this.mainElement},i.prototype.getValue=function(){return"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"===this.currentType?new n.RdfNode("uri",n.Utils.trim(n.Utils.trim(this.mainElement.val(),"<"),">")):new n.RdfNode("literal",a[this.currentType].getValue?a[this.currentType].getValue(this.mainElement):this.mainElement.val(),this.currentType,this.lang||void 0)},i.prototype.setValue=function(e,t){var i;e&&(i=this,e=n.RdfNode.fromStoreNode(e),i.lastType=i.currentType,"uri"===e.type||i.startsWithHashSign()?(i.currentType="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",t?(i.selectizeSetup(t),i.updateView(!1)):i.updateView(!0)):(i.updateView(!0),i.currentType=e.datatype||"http://www.w3.org/2000/01/rdf-schema#Literal","http://www.w3.org/2001/XMLSchema#boolean"!==i.options.type||"0"!==(t=e.value.toString())&&"1"!==t&&"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(i.currentType="http://www.w3.org/2001/XMLSchema#boolean")),i.lang=e.language,e.value&&e.value.indexOf&&-1!==e.value.indexOf("\n")&&i.transformToTextarea(),i.mainElement.val(e.value),i.resourceSelectize&&n.Utils.trim(e.value,"")&&(e.optgroup||(e.optgroup="local"),i.resourceSelectize.addOption(e),i.resourceSelectize.setValue(e.value)),a[i.currentType]&&a[i.currentType].setValue&&a[i.currentType].setValue(i.mainElement,i.mainElement.val()),i.languageElement.val(i.lang),i.typeElement.val(i.currentType),i.options.selectize&&i.typeElement[0].selectize.setValue(i.currentType),i.updateEditor(i.lastType!==i.currentType),i.lastType=i.currentType)},i.prototype.updateView=function(e){var t=this;t.dereferenceLink&&("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"===t.currentType?t.dereferenceLink.show():t.dereferenceLink.hide()),t.inputContainer.css("width","auto"),e?(t.mainElement.show(),t.resourceContainer&&t.resourceContainer.hide()):t.resourceContainer?(t.inputContainer.css("width","50%"),t.resourceContainer.show(),t.mainElement.hide()):t.mainElement.show()},i.prototype.isValid=function(e){return!this.verifyFct||this.verifyFct(this.mainElement.val())},i.prototype.startsWithHashSign=function(){var e;return!0===this.options.startHashSignAsResource&&1<=(e=n.Utils.trim(o(this.mainElement).val())).length&&"#"===e.charAt(0)},i.prototype.checkHashSign=function(){this.startsWithHashSign()&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!==(this.options.selectize?this.typeElement[0].selectize.getValue():this.typeElement.val())&&(this.options.selectize?(this.typeElement[0].selectize.setValue("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"),this.typeElement[0].selectize.onChange()):(this.typeElement.val("http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"),this.typeElement.change()))},i.prototype.verifyInput=function(){var e=o(this.mainElement).val(),t=!0;(t=0<e.length?!this.verifyFct||this.verifyFct(e):t)?this.mainElement.removeClass("has-error"):this.mainElement.addClass("has-error")},i.prototype.isLiteralType=function(e){return a.hasOwnProperty(e)&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!=e},i.prototype.setEditFocus=function(){this.getField()&&this.getField().focus()},i.prototype.blur=function(){this.getField().blur()},i.prototype.getElement=function(){return this.container},i.prototype.transformToTextarea=function(){var e;"INPUT"===this.mainElement.prop("tagName")&&"text"===this.mainElement.prop("type")&&((e=document.createElement("textarea")).id=this.mainElement.prop("id"),e.name=this.mainElement.prop("name"),e.value=this.mainElement.val(),o(e).addClass(this.mainElement.prop("class")),this.mainElement.replaceWith(e),this.mainElement=o(e))},o.fn.rdfNodeEditor=function(e){var t=this.data("rdfNodeEditor");return t||(t=new i(this,e),this.data("rdfNodeEditor",t)),t}}(window.jQuery,RDFE),!function(i,u){function t(e){this.init("rdfnode",e,t.defaults)}i.fn.editableutils.inherit(t,i.fn.editabletypes.abstractinput),i.extend(t.prototype,{render:function(){this.$input=this.$tpl.filter("input"),this.setClass(),this.$input.rdfNodeEditor(this.options.rdfnode)},activate:function(){this.$input.rdfNodeEditor().setEditFocus()},value2html:function(e,t){e||!1===e?i(t).text(e.toString()):i(t).empty()},html2value:function(e){return null},input2value:function(){return this.$input.rdfNodeEditor().getValue()},value2input:function(e){function t(){return e instanceof u.RdfNode?e.value:e}var i,n,r=this.$input.rdfNodeEditor();if(!(i=e instanceof u.RdfNode?e:i)||"uri"===i.type){if(this.options&&this.options.rdfnode){var o=this.options.rdfnode,s=o.ontologyManager;if(s){s=s.ontologyPropertyByURI(o.predicate);if(s){var a=s.getRange();if(a&&a.length){for(var l=0;l<a.length;l++)if(r.isLiteralType(a[l])){i=new u.RdfNode("literal",t(),a[l]);break}if(!i||"uri"===i.type)if(n=o.document.itemsByRange(a))i=new u.RdfNode("uri",t());else for(l=0;l<a.length;l++)if(r.isLiteralType(a[l])){i=new u.RdfNode("literal",t(),a[l]);break}}}}}i=i||(this.options&&this.options.rdfnode&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"===this.options.rdfnode.type?new u.RdfNode("uri",t(),"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"):new u.RdfNode("literal",t(),this.options.rdfnode.type))}r.setValue(i,n)}}),t.defaults=i.extend({},i.fn.editabletypes.abstractinput.defaults,{rdfnode:{},tpl:'<input type="text">'}),i.fn.editabletypes.rdfnode=t}(window.jQuery,RDFE),!function(o){function i(e,t){var r=this;r.options=o.extend({},t),r.options.ontologyManager=r.options.ontologyManager||new RDFE.OntologyManager,r.mainElem=e,o(r.options.ontologyManager).on("changed",function(e,t){r.sel.addOption(t.allOntologies())}),o(r.mainElem).selectize({valueField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:r.options.ontologyManager.ontologiesAsArray(),onChange:function(e){o(r).trigger("changed",r.options.ontologyManager.ontologyByURI(e))},createOntology:function(e,t){return r.options.ontologyManager.ontologyByURI(r.options.ontologyManager.ontologyDetermine(e),t)},create:function(t,i){var n=this,e=(e=r.options.ontologyManager.ontologyDetermine(t))||r.options.ontologyManager.prefixes[t]||t;r.options.ontologyManager.parseOntologyFile(e,{success:function(){i(n.settings.createOntology(t,!0))},error:function(e){e&&e.message&&o.notify({message:e.message},{type:"danger"}),i(n.settings.createOntology(t,!0))}})},render:{item:function(e,t){return"<div>"+t(e.title||e.label||e.prefix||e.URI)+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||e.prefix||e.URI)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,t){var i=r.options.ontologyManager.prefixes[e.input]||e.input;return i!=e.input?'<div class="create">Load <strong>'+t(e.input)+"</strong> <small>("+t(i)+")</small>&hellip;</div>":'<div class="create">Load <strong>'+t(i)+"</strong>&hellip;</div>"}}}),r.sel=o(r.mainElem)[0].selectize}i.prototype.selectedOntologyURI=function(){return this.sel.getValue()},i.prototype.selectedOntology=function(){return this.sel.options[this.selectedOntologyURI()]},i.prototype.on=function(e,t){o(this).on(e,t)},o.fn.ontoBox=function(e){var t=this.data("ontoBox");return t||(t=new i(this,e),this.data("ontoBox",t)),t}}(window.jQuery),!function(i,s){function n(e,t){var o=this;o.options=i.extend({},n.defaults,t),o.options.ontologyManager=o.options.ontologyManager||new s.OntologyManager,o.mainElement=e,i(o.options.ontologyManager).on("changed",function(e,t,i){o.updateOptions()}),i(o.mainElement).selectize({delimiter:null,valueField:"URI",searchField:["title","label","prefix","curi","URI"],sortField:["prefix","URI"],options:o.propertyList(),onChange:function(e){i(o).trigger("changed",o.sel.options[e])},createProperty:function(e,t){return o.options.ontologyManager.ontologyPropertyByURI(o.options.ontologyManager.uriDenormalize(e),t)},create:function(t,i){var n=this,e=!1,r=("a"===(t=s.Utils.trim(s.Utils.trim(t,"<"),">"))?(t="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",e=!0):t.startsWith("#")&&(e=!0),o.options.ontologyManager.ontologyDetermine(t)),e=this.settings.createProperty(t,e=r?e:!0);if(e)return i(e);o.options.ontologyManager.parseOntologyFile(r,{success:function(){i(n.settings.createProperty(t,!0))},error:function(e){e=e&&e.message?e.message:"Error loading ontology";console.log(e),bootbox.confirm(e+". Do you want to create new property?",function(e){e?o.options.ontologyManager.ontologyByURI(r)||(o.options.ontologyManager.ontologyByURI(r)||new s.Ontology(o.options.ontologyManager,r),i(n.settings.createProperty(t,!0))):n.unlock()})}})},render:{item:function(e,t){var i=e.title||e.label||e.curi||e.name;return"<div>"+(i=e.curi&&e.curi!=i?t(i)+" <small>("+t(e.curi)+")</small>":t(i))+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||e.curi||e.name)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,t){var i=e.input,i=s.Utils.trim(s.Utils.trim(i,"<"),">");return(i=o.options.ontologyManager.uriDenormalize(i))!=e.input?'<div class="create">Add <strong>'+t(e.input)+"</strong> <small>("+t(i)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+t(i)+"</strong>&hellip;</div>"}}}),o.options.dereferenceLink&&(o.dereferenceLink=i(document.createElement("button")),o.dereferenceLink.attr("type","button").addClass("btn btn-default btn-sm"),o.dereferenceLink.html('<i class="glyphicon glyphicon-link"></i>'),(t=i(document.createElement("div")).addClass("rdfe-reference-link")).append(o.dereferenceLink),o.mainElement.closest(".editable-input").length?o.mainElement.parent().after(t):o.mainElement.parent().append(t),o.dereferenceLink.on("click",function(){o.options.dereferenceLink(o.selectedURI())})),o.sel=i(o.mainElement)[0].selectize}n.defaults={ontologyManager:null,ontology:null},n.prototype.setOntology=function(e){this.options.ontology=e,this.updateOptions()},n.prototype.propertyList=function(){var e=(this.options.ontology||this.options.ontologyManager).allProperties();return e},n.prototype.updateOptions=function(){var e=this.selectedURI(),t=this.propertyList();this.sel.clearOptions(),this.sel.addOption(t),this.setPropertyURI(e)},n.prototype.setPropertyURI=function(e){e?(e=this.options.ontologyManager.uriDenormalize(e),e=s.Utils.trim(s.Utils.trim(e,"<"),">"),this.sel.options[e]||this.sel.addOption(this.options.ontologyManager.ontologyPropertyByURI(e,!0)),this.sel.setValue(e)):this.sel.setValue(null)},n.prototype.selectedURI=function(){return this.sel.getValue()},n.prototype.selectedProperty=function(){return this.sel.options[this.selectedURI()]},n.prototype.on=function(e,t){return i(this).on(e,t),this},i.fn.propertyBox=function(e){var t=this.data("propertyBox");return t||(t=new n(this,e),this.data("propertyBox",t)),t}}(window.jQuery,RDFE),!function(i){function t(e){this.init("rdfnode",e,t.defaults)}i.fn.editableutils.inherit(t,i.fn.editabletypes.abstractinput),i.extend(t.prototype,{render:function(){this.$input=this.$tpl.filter("select"),this.setClass(),this.$input.propertyBox(this.options.propertyBox),this.$input.propertyBox().sel.$control.css("min-width","250px")},activate:function(){},value2html:function(e,t){e?i(t).text(e.toString()):i(t).empty()},html2value:function(e){return null},input2value:function(){return this.$input.propertyBox().selectedURI()},value2input:function(e){this.$input.propertyBox().setPropertyURI(e)}}),t.defaults=i.extend({},i.fn.editabletypes.abstractinput.defaults,{propertyBox:{},tpl:"<select></select>"}),i.fn.editabletypes.propertyBox=t}(window.jQuery),!function(h){function e(e){this.editor=e}window.RDFE||(window.RDFE={}),RDFE.TripleView=(e.prototype.render=function(l,u){var c,d=this;d.editor.doc.listProperties(function(e){d.editor.doc.store.graph(d.editor.doc.graph,function(e,t){if(e)h(d.editor).trigger("rdf-editor-error",{type:"triple-list-error",message:e});else{l.empty();for(var r=h(document.createElement("table")).addClass("table"),i=(l.append(r),t.toArray()),n=0;n<i.length;n+=1)i[n].id=n;r.data("maxindex",n);var e=1,t=10,o="subject",s="asc",a=d.editor.config.options.pageSettings;a.pageNo&&(e=a.pageNo),a.pageSize&&(t=a.pageSize),a.sortName&&(o=a.sortName),a.sortOrder&&(s=a.sortOrder),r.bootstrapTable({striped:!0,pagination:!0,paginationVAlign:"top",pageNumber:e,pageSize:t,search:!0,sortName:o,sortOrder:s,searchAlign:"left",showHeader:!0,data:i,editable:!0,dereference:!0,columns:[{field:"subject",title:RDFE.Utils.namingSchemaLabel("s",d.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("s",d.editor.namingSchema()),sortable:!0,editable:d.editor.editableSubject(d.editor),formatter:d.editor.nodeFormatter},{field:"predicate",title:RDFE.Utils.namingSchemaLabel("p",d.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("p",d.editor.namingSchema()),sortable:!0,editable:d.editor.editablePredicate(d.editor),formatter:d.editor.nodeFormatter},{field:"object",title:RDFE.Utils.namingSchemaLabel("o",d.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("o",d.editor.namingSchema()),sortable:!0,editable:d.editor.editableObject(d.editor,function(e){return e.predicate.toString()}),formatter:d.editor.nodeFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Add a new statement to the document"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,editable:!1,formatter:function(e,t,i){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(e,t,i,n){d.editor.doc.deleteTriple(i,function(){r.bootstrapTable("remove",{field:"id",values:[i.id]}),h(d.editor).trigger("rdf-editor-success",{type:"triple-delete-success",message:"Successfully deleted triple."})},function(){h(d.editor).trigger("rdf-editor-error",{type:"triple-delete-error",message:"Failed to delete triple."})})}}}]}),r.on("editable-shown.bs.table",function(e,t,i){c=_.clone(i)}),r.on("editable-save.bs.table",function(e,t,i){d.editor.dataSetter(t,c,i)}),r.on("page-change.bs.table",function(e,t,i){h(d.editor).trigger("rdf-editor-page",{pageNo:t,pageSize:i})}),r.on("sort.bs.table",function(e,t,i){h(d.editor).trigger("rdf-editor-page",{sortName:t,sortOrder:i})}),h(r).find(".add").on("click",function(e){d.editor.editTriple()}),d.tripleTable=r,u&&u()}})})},e.prototype.addTriple=function(e){var t=this.tripleTable.data("maxindex");this.tripleTable.bootstrapTable("append",h.extend(e,{id:t})),this.tripleTable.data("maxindex",t+1)},e)}(jQuery),Backbone.Form.editors.Rdfnode=Backbone.Form.editors.Base.extend({tagName:"input",events:{change:function(){this.trigger("change",this)},focus:function(){this.trigger("focus",this)},blur:function(){this.trigger("blur",this)},keyup:function(e,t){13==e.keyCode&&e.shiftKey&&(console.log("shift+enter"),this.editor&&this.editor.transformToTextarea(),e.stopPropagation()),this.trigger("keyup",this)}},initialize:function(e){Backbone.Form.editors.Base.prototype.initialize.call(this,e)},render:function(){var e=this;return this.$el.attr("type","text"),this.$el.rdfNodeEditor(this.schema.rdfnode),e.editor=this.$el.rdfNodeEditor(),e.setElement(e.editor.getElement()),$(this.editor).on("change",function(){e.trigger("change",this)}),this.setValue(this.value),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.hasFocus||this.editor.setEditFocus()},blur:function(){this.hasFocus&&this.editor.blur()}}),Backbone.Form.editors.NestedRdf=Backbone.Form.editors.Object.extend({initialize:function(e){if(Backbone.Form.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedRdf editor')},render:function(){var e=this.form.constructor,t=this.value,i=(this.key,this.schema.model),t=t||new i;return this.nestedForm=new e({model:t,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){var e=this.nestedForm.getValue();if(this.nestedForm.model.defaults){var t,i=!1;for(t in e)if(e[t])for(var n=0;n<e[t].length;n++)if(e[t][n].value){i=!0;break}i&&(e=_.extend({},this.nestedForm.model.defaults,e))}return{uri:this.nestedForm.model.uri,values:e}}}),window.RDFE||(window.RDFE={}),RDFE.EntityModel=Backbone.Model.extend({setEntity:function(e,t){this.doc=e,this.uri=t,this.individualsCache={}},addValue:function(e,t){var i=this.get(e)||[];i.push(t),this.set(e,i)},getIndividuals:function(e,t){if(this.individualsCache[e])t(this.individualsCache[e]);else{var i=[],n=this.doc.ontologyManager.ontologyClassByURI(e);if(e&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource"!==e?"http://www.w3.org/2000/01/rdf-schema#Class"===e?i=this.doc.ontologyManager.ontologyClasses:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"===e?i=this.doc.ontologyManager.ontologyProperties:n&&(i=n.getIndividuals(!0)):i=this.doc.ontologyManager.individuals,i=_.map(_.values(i),function(e){var t=new RDFE.RdfNode("uri",e.URI);return t.label=e.label||e.name,t}),this.doc.listEntities(e,function(e){$.merge(i,e)}),n)for(var r=n.getSubClasses(!0),o=0,s=r.length;o<s;o++)this.doc.listEntities(r[o].URI,function(e){$.merge(i,e)});t(this.individualsCache[e]=i)}},maxCardinalityForProperty:function(e){for(var t=0;t<this.types.length;t++){var i=this.types[t].maxCardinalityForProperty(e);if(i)return i}return null},restrictionsForProperty:function(e){for(var t=0;t<this.types.length;t++){var i=this.types[t].restrictions[e];if(i)return i}return null},isAggregateProperty:function(e){for(var t=0;t<this.types.length;t++)if(this.types[t].isAggregateProperty(e))return!0;return!1},addSchemaEntryForProperty:function(e){var t,i,n,r=this,o=e.URI?e:r.doc.ontologyManager.ontologyProperties[e]||{URI:e},e=this.restrictionsForProperty(e),e=(e&&(s=e.hasCustomLabel,t=e.hasCustomComment),RDFE.Utils.createTitle(s||o.label||o.title||RDFE.Utils.uri2name(o.URI))),s={titleHTML:'<span title="{0}">{1}</span>'.format(RDFE.Utils.escapeXml(o.URI),e),title:e,maxCardinality:r.maxCardinalityForProperty(o.URI),editorAttrs:{title:RDFE.coalesce(t,o.comment,o.description)}};r.isAggregateProperty(o.URI)?(i=o.getRange?r.doc.ontologyManager.ontologyClassByURI(o.getRange()):null)?(s.type="List",s.itemType="NestedRdf",s.model=RDFE.EntityModel.extend({defaults:{"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":[new RDFE.RdfNode("uri",o.getRange())]},initialize:function(e){RDFE.EntityModel.prototype.initialize.call(this,e),this.doc=r.doc,this.buildSchemaFromTypes([i])},individualsCache:r.individualsCache}),s.editorAttrs.style="height:auto;"):(console.log("Caution: invalid range on aggregate: ",o),s.type="List",s.itemType="Rdfnode",s.rdfnode={type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",create:!0}):(s.type="List",s.itemType="Rdfnode",s.rdfnode={},n=_.result(o,"getRange"),o.class==r.doc.ontologyManager.uriDenormalize("owl:DatatypeProperty")?s.rdfnode.type=n:o.class==r.doc.ontologyManager.uriDenormalize("owl:ObjectProperty")?(s.rdfnode.type="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",s.rdfnode.choices=function(e){r.getIndividuals(n,e)},s.rdfnode.create=!0):n&&("http://www.w3.org/2000/01/rdf-schema#Literal"==n||n.startsWith("http://www.w3.org/2001/XMLSchema#")?s.rdfnode.type=n:(s.rdfnode.type="http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",s.rdfnode.choices=function(e){r.getIndividuals(n,e)},s.rdfnode.create=!0))),r.schema[o.URI]=s},buildSchemaFromTypes:function(e){var t=this;t.schema={},t.fields=[],t.lens=null;for(var i=0,n=(t.types=e).length;i<n;i++){var r=e[i].getFresnelLens();if(r&&r.showProperties.length){t.lens=r;break}}t.fields=r?_.without(r.showProperties,t.doc.ontologyManager.uriDenormalize("fresnel:allProperties")):[t.doc.ontologyManager.uriDenormalize("rdf:type")];for(i=0;i<t.fields.length;i++)t.addSchemaEntryForProperty(t.fields[i])},docToModel:function(d,e){var h=this;h.schema={},h.fields=[],this.doc.getEntity(h.uri,function(e){h.types=_.compact(_.map(e.types,h.doc.ontologyManager.ontologyClassByURI,h.doc.ontologyManager)),h.fields=[],h.lens=null;if(0===h.types.length)for(var t in e.properties){var i=h.doc.ontologyManager.ontologyPropertyByURI(t);i&&i.domain&&(h.types=_.union(h.types,i.domain))}for(var n=0,r=h.types.length;n<r;n++){var o=h.types[n].getFresnelLens();if(o&&0<o.showProperties.length){h.lens=o;break}}if(o&&(h.fields=_.clone(o.showProperties)),o){var s=h.fields.indexOf(h.doc.ontologyManager.uriDenormalize("fresnel:allProperties"));if(0<=s){h.allowAddProperty=!0;var a=[];for(t in e.properties)_.contains(h.fields,t)||_.contains(o.hideProperties,t)||a.push(t);h.fields.splice.apply(h.fields,[s,1].concat(a))}}else for(var t in h.allowAddProperty=!0,e.properties)_.contains(h.fields,t)||("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"===t?h.fields.unshift(t):h.fields.push(t));for(n=0;n<h.fields.length;n++)h.addSchemaEntryForProperty(h.fields[n]);for(t in e.properties)for(var l,u=h.isAggregateProperty(t),c=e.properties[t],n=0;n<c.length;n++)u?((l=new RDFE.EntityModel).setEntity(h.doc,c[n].value),l.individualsCache=h.individualsCache,l.docToModel(function(){h.addValue(t,l)})):h.addValue(t,c[n]);d&&d()})},modelToDoc:function(){var p=1;return function(t,i){for(var n=this,r=(p=1,function e(t,i,n){var r=[];if(!t||0===t.length){for(var o="",s=0,a=n.config.options.labelProps.length;s<a;s++)if(i[n.config.options.labelProps[s]]){o=i[n.config.options.labelProps[s]];break}o=(o||"subres")+"_"+p,t=n.buildEntityUri(o),p++}var l=n.store.rdf.createNamedNode(t);for(prop in i){var u=n.store.rdf.createNamedNode(prop),c=i[prop];c.constructor!==Array&&(c=[c]);for(var d=0;d<c.length;d++){var h=c[d];h.values?0<(h=e(h.uri,h.values,n)).length&&(r.push(n.store.rdf.createTriple(l,u,h[0].subject)),Array.prototype.push.apply(r,h)):(h=c[d].toStoreNode(n.store))&&0<h.nominalValue.length&&r.push(n.store.rdf.createTriple(l,u,h))}}return r}(this.uri,n.attributes,n.doc)),o=[],e=0;e<r.length;e++)_.indexOf(o,r[e].subject.nominalValue)<0&&o.push(r[e].subject.nominalValue);var s=function(e){e>=o.length?n.doc.addTriples(r,t,i):n.doc.deleteBySubject(o[e],function(){s(e+1)},i)};s(0)}}()}),!function(c){function e(e,t){this.doc=e,this.namingSchema=e.config.options[e.config.options.namingSchema],this.ontologyManager=t}var d;window.RDFE||(window.RDFE={}),RDFE.EntityEditor=(d=Backbone.Form.extend({template:_.template('<form class="form-horizontal clearfix" role="form">  <a href="#" class="btn btn-default btn-xs pull-right addProp">Add <%= RDFE.Utils.namingSchemaLabel("p", this.namingSchema) %></a>  <div data-fieldsets></div>  <% if (submitButton) { %>    <button type="submit" class="btn"><%= submitButton %></button>  <% } %></form>'),render:function(){var r=this;return r.namingSchema=r.model.doc.config.options[r.model.doc.config.options.namingSchema],Backbone.Form.prototype.render.call(this),r.model.allowAddProperty||this.$el.find(".addProp").hide(),this.$el.find("> a.addProp").click(function(e){e.preventDefault();var t=c(document.createElement("select")),e=c(document.createElement("button")).addClass("btn").addClass("btn-default").text("Add"),i=c(document.createElement("button")).addClass("btn").addClass("btn-default").text("Cancel"),n=c(document.createElement("div")).append(c(document.createElement("span")).text("New "+RDFE.Utils.namingSchemaLabel("p",r.namingSchema)+":")).append(t).append(e).append(i),t=t.propertyBox({ontologyManager:r.model.doc.ontologyManager});i.click(function(e){e.preventDefault(),n.remove()}),e.click(function(e){e.preventDefault(),t.selectedURI()?(console.log("Adding new property",t.selectedURI(),"to form",r),r.commit(),r.model.addSchemaEntryForProperty(t.selectedProperty()),r.model.fields.push(t.selectedURI()),r.fieldsets=void 0,r.initialize(r.options),n.remove(),e=r.$el.parent(),r.$el.remove(),r.render(),console.log(e,r.$el),e.append(r.$el)):console.log("No prop selected")}),r.$el.prepend(n)}),this}}),e.prototype.template=_.template('<div class="panel panel-default">        <div class="panel-heading clearfix">          <h3 class="panel-title pull-left">Editing <a href="<%= entityUri %>"><span class="rdfe-entity-label"><%= entityLabel %><span></a> <span class="rdfe-entity-types"></span></h3>          <div class="btn-group pull-right" role="group">            <button type="button" class="btn btn-primary btn-sm" id="okBtn">Apply</button>            <button type="button" class="btn btn-default btn-sm" id="cnclBtn">Cancel</button>          </div>        </div>        <div class="panel-body" id="entityFormContainer">        </div>      </div>'),e.prototype.render=function(o,s,a){var l=this,u=new RDFE.EntityModel;u.setEntity(this.doc,s),u.docToModel(function(){function e(e){t.commit(),u.modelToDoc(function(){c(l).trigger("rdf-editor-success",{type:"editor-form-save-done",message:"Locally saved details of "+s}),e&&e()},function(e){c(l).trigger("rdf-editor-error",{type:"editor-form-save-failed",message:e})})}var t=new d({model:u}),i=(t.render(),o.empty(),o.append(l.template({entityUri:s,entityLabel:RDFE.Utils.uri2name(s)})),l.doc.getEntity(s,function(e){o.find(".rdfe-entity-types").html(l.ontologyManager.typesToLabel(e.types,!0)),o.find(".rdfe-entity-label").html(e.label)}),o.find("#entityFormContainer").append(t.el),o.find(".toggle.btn").css("width","100%"),o.find("button#cnclBtn")),n=o.find("button#saveBtn"),r=o.find("button#okBtn");i.click(function(){a()});n.click(function(){e()}),r.click(function(){e(a)})},function(e){c(l).trigger("rdf-editor-error",{type:"editor-form-creation-failed",message:e})})},e)}(jQuery),!function(l){function e(e,t,i,n){this.doc=e,this.namingSchema=e.config.options[e.config.options.namingSchema],this.ontologyManager=t,this.editor=i,this.editFct=n.editFct}function u(e,t,i){return'<span title="'+t.uri+'">'+t.label+"</span>"}function c(e,t,i){return t.types&&t.types.length?t.types:"<em>none</em>"}function d(e,t){return{label:e.label,types:t.typesToLabel(e.types),uri:e.uri||e.value}}window.RDFE||(window.RDFE={}),RDFE.EntityView=(e.prototype.render=function(n,r){function s(e,t,i){return['<a class="edit ml10" href="javascript:void(0)" title="Edit this '+RDFE.Utils.namingSchemaLabel("spo",a.namingSchema,!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove this '+RDFE.Utils.namingSchemaLabel("spo",a.namingSchema,!1,!0)+' from the document">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")}var a=this;a.doc.listEntities(a.editor.config.options.entityTypesFiler,function(e){a.entityTable=null,n.empty();for(var o=l(document.createElement("table")).addClass("table"),t=(n.append(o),[]),i=0;i<e.length;i++)t.push(d(e[i],a.ontologyManager));o.bootstrapTable({striped:!0,sortName:"label",pagination:!0,search:!0,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:t,idField:"uri",columns:[{field:"label",title:RDFE.Utils.namingSchemaLabel("s",a.namingSchema)+" Name",titleTooltip:RDFE.Utils.namingSchemaLabel("s",a.namingSchema)+" Name",aligh:"left",sortable:!0,formatter:u},{field:"types",title:"Entity Types",titleTooltip:"Entity Types",aligh:"left",class:"rdfe-small-column",sortable:!0,formatter:c},{field:"actions",title:'<button class="add btn btn-default" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("spo",a.namingSchema,!1,!0)+' to the document"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,formatter:s,events:{"click .edit":function(e,t,i,n){a.editFct(i.uri)},"click .remove":function(e,t,i,n){var r;r=i.uri,a.doc.deleteEntity(r,function(){o.bootstrapTable("remove",{field:"uri",values:[r]}),l(a).trigger("rdf-editor-success",{type:"entity-delete-done",uri:r,message:"Successfully deleted entity "+r+"."})},function(e){l(a).trigger("rdf-editor-error",{type:"entity-delete-failed",message:e})})}}}]}),l(o).find(".add").on("click",function(e){a.editor.createNewEntityEditor()}),a.entityTable=o,r&&r()},function(e){l(a).trigger("rdf-editor-error",{type:"entity-list-failed",message:e})})},e.prototype.addEntity=function(e){this.entityTable.bootstrapTable("append",e)},e.prototype.updateEntity=function(e){var t=this;t.doc.getEntity(e,function(e){t.entityTable.bootstrapTable("update",{field:"uri",data:d(e,t.ontologyManager)})})},e)}(jQuery),!function(d){function e(e,t){this.editor=e,this.subject=t}window.RDFE||(window.RDFE={}),RDFE.SubjectEditor=(e.prototype.template=_.template('       <div class="panel panel-default">         <div class="panel-heading clearfix">           <form class="form-inline">             <div class="form-group" style="width: 80%;">               <label>Selected <%= RDFE.Utils.namingSchemaLabel("s", this.editor.namingSchema()) %> </label>               <input name="subject" class="form-control" style="width: 85%;" disabled="disabled" />             </div>             <div class="btn-group pull-right" role="group">               <button type="button" class="btn btn-default btn-sm rdfe-font-bold" id="backButton" title="Back">Back</button>             </div>           </form>         </div>         <div class="panel-body" id="subjectTable">         </div>         <div class="panel-body" id="subjectForm" style="display: none;">       </div>'),e.prototype.render=function(o,e,s,t){function i(n,r){function t(){var e=n.find('input[name="subject"]').val(),t=null,i=n.find("#class")[0].selectize.getValue();l.editor.doc.config.options.entityUriTmpl&&(t=e,e=null),l.editor.doc.addEntity(e,t,i,function(e){d(l.editor).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully created new triple."}),l.editor.doc.getSubject(e.uri,function(e){o.subjectView.addSubject(e),l.subject=e,l.render(o,n,s,r)})},function(){d(l.editor).trigger("rdf-editor-error",{type:"triple-insert-error",message:"Failed to add new triple."})})}var e,i;n.html('<div class="panel panel-default">  <div class="panel-heading">    <h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("s",l.editor.namingSchema())+'</h3>  </div>  <div class="panel-body">    <div class="form-horizontal">       <div class="form-group">         <label for="ontology" class="col-sm-2 control-label">Vocabulary</label>         <div class="col-sm-10">           <select name="ontology" id="ontology" class="form-control" />         </div>       </div>       <div class="form-group">         <label for="class" class="col-sm-2 control-label">Type</label>         <div class="col-sm-10">           <select name="class" id="class" class="form-control" />         </div>       </div>       <div class="form-group">          <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",l.editor.namingSchema())+(l.editor.doc.config.options.entityUriTmpl?" Name":" URI")+'</label>          <div class="col-sm-10">            <input name="subject" id="subject" class="form-control" />          </div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <a href="#" class="btn btn-default triple-action triple-action-new-cancel">Cancel</a>           <a href="#" class="btn btn-primary triple-action triple-action-new-save">OK</a>         </div>       </div>     </div>  </div></div>\n'),(e=d("#ontology").ontoBox({ontologyManager:l.editor.ontologyManager})).on("changed",function(e){e=l.editor.ontologyManager.ontologyByURI(e.currentTarget.selectedOntologyURI());i.clearOptions(),i.addOption(e?e.classesAsArray():l.editor.ontologyManager.allClasses())}),e.sel.focus(),e=d("#class").selectize({valueField:"URI",labelField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:l.editor.ontologyManager.allClasses(),create:function(e,t){t(l.editor.ontologyManager.ontologyClassByURI(l.editor.ontologyManager.uriDenormalize(e),!0))},render:{item:function(e,t){var i=e.title||e.label||name.curi||e.name;return"<div>"+(i=e.curi&&e.curi!=i?t(i)+" <small>("+t(e.curi)+")</small>":t(i))+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||name.curi||e.name)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,t){var i=l.editor.ontologyManager.uriDenormalize(e.input);return i!==e.input?'<div class="create">Add <strong>'+t(e.input)+"</strong> <small>("+t(i)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+t(i)+"</strong>&hellip;</div>"}}}),i=e[0].selectize,n.find("a.triple-action-new-cancel").click(function(e){e.preventDefault(),r()}),n.find("a.triple-action-new-save").click(function(e){e.preventDefault(),t()}),n.find("input#subject").keypress(function(e){13===e.which&&t()})}var n,r,a,l=this;e.empty(),l.subject?(e.append(l.template(l.subject)),r=d(document.createElement("table")).addClass("table"),e.find("#subjectTable").append(r),e.find("button#backButton").click(function(){t()}),a=e.find('input[name="subject"]'),""!==l.subject.uri?a.val(l.subject.uri):(a.css("color","red"),a.css("font-style","italic"),a.val("Empty")),a=e,r.bootstrapTable({striped:!0,sortName:"subject",pagination:!0,paginationVAlign:"top",search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:[],dereference:!0,columns:[{field:"predicate",title:RDFE.Utils.namingSchemaLabel("p",l.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("p",l.editor.namingSchema()),sortable:!0,editable:l.editor.editablePredicate(l.editor),formatter:l.editor.nodeFormatter},{field:"object",title:RDFE.Utils.namingSchemaLabel("o",l.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("o",l.editor.namingSchema()),sortable:!0,editable:l.editor.editableObject(l.editor,function(e){return e.predicate.toString()}),formatter:l.editor.nodeFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Add Relation" style="display: none;"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,editable:!1,formatter:function(e,t,i){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(e,t,i,n){l.editor.doc.deleteTriple(i,function(){r.bootstrapTable("remove",{field:"id",values:[i.id]}),d(l.editor).trigger("rdf-editor-success",{type:"triple-delete-success",message:"Successfully deleted triple."})},function(e){d(l.editor).trigger("rdf-editor-error",{type:"triple-delete-error",message:"Failed to delete triple."})})}}}]}),r.on("editable-shown.bs.table",function(e,t,i){n=_.clone(i)}),r.on("editable-save.bs.table",function(e,t,i){l.editor.dataSetter(t,n,i)}),l.subjectTable=r,l.subjectTableContainer=a.find("#subjectTable"),l.subjectFormContainer=a.find("#subjectForm"),l.addButton=d(r).find(".add"),l.addButton.click(function(){l.createNewRelationEditor()}),l.renderData(),s&&l.createNewRelationEditor()):i(e,t)},e.prototype.renderData=function(){for(var e=this.subject?this.subject.items:[],t=0;t<e.length;t++)e[t].id=t;this.subjectTable.data("maxindex",t),this.subjectTable.bootstrapTable("load",e),this.subject?this.addButton.show():this.addButton.hide()},e.prototype.addTriple=function(e){var t=this.subjectTable.data("maxindex");this.subjectTable.bootstrapTable("append",d.extend(e,{id:t})),this.subjectTable.data("maxindex",++t)},e.prototype.createNewRelationEditor=function(){var l=this,a=(l.subjectTableContainer.hide(),l.subjectFormContainer.html('<div class="panel panel-default">   <div class="panel-heading"><h3 class="panel-title">Add Relation</h3></div>   <div class="panel-body">     <form class="form-horizontal">       <div class="form-group">         <label for="predicate" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("p",l.editor.namingSchema())+'</label>         <div class="col-sm-10"><select name="predicate" class="form-control"></select></div>       </div>       <div class="form-group object-list">         <div class="col-sm-12 object-item_0" style="padding: 0;">           <label for="object_0" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("o",l.editor.namingSchema())+'</label>           <div class="col-sm-9"><input name="object_0" class="form-control" /></div>           <div class="col-sm-1 btn_0"><button type="button" class="btn btn-default object-add" title="Add Object"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></button></div>         </div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default subject-action subject-action-new-cancel">Cancel</button>           <button type="submt" class="btn btn-primary subject-action subject-action-new-save">OK</button>         </div>       </div>     </form>   </div> </div>').show(),1),u=[],e=l.subjectFormContainer.find('input[name="object_0"]').rdfNodeEditor(l.editor.doc.config.options),c=(e.setValue(new RDFE.RdfNode("literal","",null,"")),u.push(e),l.subjectFormContainer.find('select[name="predicate"]').propertyBox({ontologyManager:l.editor.ontologyManager}).on("changed",function(e,t){for(var i=0;i<u.length;i++){var n=u[i];n&&l.editor.changeObjectType(t,n)}}));c.sel.focus(),l.subjectFormContainer.find("button.object-add").click(function(e){for(var t=0,i=u.length-1;0<=i;i--)if(u[i]){t=i;break}function n(e){l.subjectFormContainer.find("div.object-item_<N>".replace(/<N>/g,r)).remove(),u[r]=null}var r,o=l.editor.ontologyManager.ontologyPropertyByURI(c.selectedURI()),s=l.subjectFormContainer.find("div.object-list"),s=(s.append(' <div class="col-sm-12 object-item_<N>" style="padding: 0;">    <label for="object_<N>" class="col-sm-2 control-label"></label>    <div class="col-sm-9"><input name="object_<N>" class="form-control" /></div>    <div class="col-sm-1 btn_<N>"></div>  </div> '.replace(/<N>/g,a)),s.find("button.object-add").detach().appendTo(s.find("div.btn_<N>".replace(/<N>/g,a))),s.find("div.btn_<N>".replace(/<N>/g,t)).append(' <button type="button" class="btn btn-default object-remove_<N>" title="Remove Object"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>'.replace(/<N>/g,t)),l.subjectFormContainer.find('input[name="object_<N>"]'.replace(/<N>/g,a)).rdfNodeEditor(l.editor.doc.config.options));s.setValue(new RDFE.RdfNode("literal","",null,"")),o&&l.editor.changeObjectType(o,s),r=t;l.subjectFormContainer.find("button.object-remove_<N>".replace(/<N>/g,t)).click(n),u.push(s),a++}),l.subjectFormContainer.find("button.subject-action-new-cancel").click(function(e){l.subjectFormContainer.hide(),l.subjectTableContainer.show()}),l.subjectFormContainer.find("button.subject-action-new-save").click(function(e){e.preventDefault();var t=!0,i=l.subject.uri,n=c.selectedURI();if(RDFE.Validate.check(c.sel,n)){for(var r=0;r<u.length;r++){var o,s,a=u[r];a&&(o=a.getValue(),RDFE.Validate.check(a.getField(),o.value)?(s=l.editor.doc.store.rdf.createTriple(l.editor.doc.store.rdf.createNamedNode(i),l.editor.doc.store.rdf.createNamedNode(n),o.toStoreNode(l.editor.doc.store)),l.editor.doc.addTriples([s],function(){l.subjectView||l.addTriple(s),d(l.editor).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new triple."}),l.subjectFormContainer.find("div.object-item_<N>".replace(/<N>/g,r)).remove(),u[r]=null},function(e){d(l.editor).trigger("rdf-editor-error",{type:"triple-insert-error",message:"Failed to add new triple."}),t=!1})):t=!1)}t&&(l.subjectFormContainer.hide(),l.subjectTableContainer.show())}})},e)}(jQuery),!function(c){function e(e,t){this.editor=e,this.editFct=t.editFct}window.RDFE||(window.RDFE={}),RDFE.SubjectView=(e.prototype.render=function(a,l){var u=this;u.editor.doc.listSubjects(function(e){u.subjects=e,u.subjectTable=null,a.empty();var r=c(document.createElement("table")).addClass("table"),t=(a.append(r),1),i=10,n="uri",o="asc",s=u.editor.config.options.pageSettings;s.pageNo&&(t=s.pageNo),s.pageSize&&(i=s.pageSize),s.sortName&&(n=s.sortName),s.sortOrder&&(o=s.sortOrder),r.bootstrapTable({striped:!0,pagination:!0,paginationVAlign:"top",pageNumber:t,pageSize:i,search:!0,sortName:n,sortOrder:o,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:e,idField:"uri",columns:[{field:"uri",title:RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema()),sortable:!0,formatter:function(e,t,i){var n=u.editor.ontologyManager.ontologyClassByURI(t.label)?"":'class="rdfe-green-link"';return""!==RDFE.Utils.uri2name(t.uri)?'<a href="{0}" target="_blank" {1}>{0}</a>'.format(t.uri,n):'<em style="color: red;">Empty</em>'}},{field:"items",title:"Count",titleTooltip:"Count",sortable:!0,sorter:u.editor.countSorter,align:"right",class:"rdfe-small-column",formatter:u.editor.countFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema(),!1,!0)+'"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,formatter:function(e,t,i){return['<a class="edit ml10" href="javascript:void(0)" title="Edit or add a new '+RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema(),!1,!0)+" name and "+RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema(),!1,!0)+" pairs associated with this "+RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema(),!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="dereference ml10" href="javascript:void(0)" title="Dereference this '+RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema(),!0,!0)+'">','  <i class="glyphicon glyphicon-link"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove all '+RDFE.Utils.namingSchemaLabel("spo",u.editor.namingSchema(),!0,!0)+" associated with this "+RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema(),!1,!0)+'">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .edit":function(e,t,i,n){u.editFct(i)},"click .dereference":function(e,t,i,n){u.editor.dereference()(i.uri)},"click .remove":function(e,t,i,n){u.editor.doc.deleteBySubject(i.uri,function(){r.bootstrapTable("remove",{field:"uri",values:[i.uri]}),c(u.editor).trigger("rdf-editor-success",{type:"subject-delete-success",message:"Successfully deleted triples with subject "+i.uri+"."})},function(e){c(u.editor).trigger("rdf-editor-error",{type:"subject-delete-error",message:e})})}}}]}),r.on("page-change.bs.table",function(e,t,i){c(u.editor).trigger("rdf-editor-page",{pageNo:t,pageSize:i})}),r.on("sort.bs.table",function(e,t,i){c(u.editor).trigger("rdf-editor-page",{sortName:t,sortOrder:i})}),c(r).find(".add").on("click",function(e){u.editor.editSubject()}),u.subjectTable=r,l&&l()},function(e){c(u.editor).trigger("rdf-editor-error",{type:"subject-list-error",message:e})})},e.prototype.addSubject=function(t){_.find(this.subjects,function(e){return e.uri===t.uri})||this.subjectTable.bootstrapTable("append",t)},e.prototype.updateSubject=function(n){var i=this;i.editor.doc.getSubject(n,function(e){var t=i.subjects.findIndex(function(e,t,i){return e.uri===n});i.subjectTable.bootstrapTable("updateRow",{index:t,row:e})})},e)}(jQuery),!function(l){function e(e,t){this.editor=e,this.predicate=t}window.RDFE||(window.RDFE={}),RDFE.PredicateEditor=(e.prototype.template=_.template('       <div class="panel panel-default">         <div class="panel-heading clearfix">           <form class="form-inline">             <div class="form-group" style="width: 80%;">               <label><%= RDFE.Utils.namingSchemaLabel("p", this.editor.namingSchema()) %> </label>               <select name="predicate" class="form-control" style="width: 85%;"></select>             </div>             <div class="btn-group pull-right" role="group">               <button type="button" class="btn btn-default btn-sm rdfe-font-bold" id="backButton" title="Back">Back</button>             </div>           </form>         </div>         <div class="panel-body" id="predicateTable">         </div>         <div class="panel-body" id="predicateForm" style="display: none;">       </div>'),e.prototype.render=function(e,t,i,n){var r,o=this,s=(t.empty(),t.append(o.template(o.predicate)),l(document.createElement("table")).addClass("table"));t.find("#predicateTable").append(s);t.find("button#backButton").click(function(){n()});var a=t.find('select[name="predicate"]').propertyBox({ontologyManager:o.editor.ontologyManager});o.predicate&&a.setPropertyURI(o.predicate.uri),o.predicate||a.sel.focus(),a.sel.on("change",function(e){e&&o.editor.doc.getPredicate(e,function(e){o.predicateView.addPredicate(e),o.predicate=e,o.renderData()})}),a=t,s.bootstrapTable({striped:!0,sortName:"subject",pagination:!0,paginationVAlign:"top",search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:[],dereference:!0,columns:[{field:"subject",title:RDFE.Utils.namingSchemaLabel("s",o.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("s",o.editor.namingSchema()),sortable:!0,editable:o.editor.editableSubject(o.editor),formatter:o.editor.nodeFormatter},{field:"object",title:RDFE.Utils.namingSchemaLabel("o",o.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("o",o.editor.namingSchema()),sortable:!0,editable:o.editor.editableObject(o.editor,function(e){return e.predicate.toString()}),formatter:o.editor.nodeFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Add Relation" style="display: none;"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,editable:!1,formatter:function(e,t,i){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(e,t,i,n){o.editor.doc.deleteTriple(i,function(){s.bootstrapTable("remove",{field:"id",values:[i.id]}),l(o.editor).trigger("rdf-editor-success",{type:"predicate-delete-success",message:"Successfully deleted triple."})},function(e){l(o.editor).trigger("rdf-editor-error",{type:"predicate-delete-error",message:"Failed to delete triple."})})}}}]}),s.on("editable-shown.bs.table",function(e,t,i){r=_.clone(i)}),s.on("editable-save.bs.table",function(e,t,i){o.editor.dataSetter(t,r,i)}),o.predicateView=e.predicateView,o.predicateTable=s,o.predicateTableContainer=a.find("#predicateTable"),o.predicateFormContainer=a.find("#predicateForm"),o.addButton=l(s).find(".add"),o.addButton.click(function(){o.createNewRelationEditor()}),o.renderData(),i&&o.createNewRelationEditor()},e.prototype.renderData=function(){for(var e=this.predicate?this.predicate.items:[],t=0;t<e.length;t++)e[t].id=t;this.predicateTable.data("maxindex",t),this.predicateTable.bootstrapTable("load",e),this.predicate?this.addButton.show():this.addButton.hide()},e.prototype.addTriple=function(e){var t=this.predicateTable.data("maxindex");this.predicateTable.bootstrapTable("append",l.extend(e,{id:t})),this.predicateTable.data("maxindex",++t),this.predicateView.updatePredicate(this.predicate.uri)},e.prototype.createNewRelationEditor=function(){var r=this,o=(r.predicateTableContainer.hide(),r.predicateFormContainer.html('<div class="panel panel-default">   <div class="panel-heading"><h3 class="panel-title">Add Relation</h3></div>   <div class="panel-body">     <form class="form-horizontal">       <div class="form-group">         <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",r.editor.namingSchema())+'</label>         <div class="col-sm-10"><input name="subject" class="form-control" /></div>       </div>       <div class="form-group">         <label for="object" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("o",r.editor.namingSchema())+'</label>         <div class="col-sm-10"><input name="object" class="form-control" /></div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default predicate-action predicate-action-new-cancel">Cancel</button>           <button type="submit" class="btn btn-primary predicate-action predicate-action-new-save">OK</button>         </div>       </div>     </form>   </div> </div>').show(),r.predicateFormContainer.find('input[name="subject"]')),e=(o.focus(),r.editor.ontologyManager.ontologyProperties[r.predicate.uri]),s=r.predicateFormContainer.find('input[name="object"]').rdfNodeEditor(r.editor.doc.config.options);r.editor.changeObjectType(e,s),r.predicateFormContainer.find("button.predicate-action-new-cancel").click(function(e){r.predicateFormContainer.hide(),r.predicateTableContainer.show()}),r.predicateFormContainer.find("button.predicate-action-new-save").click(function(e){e.preventDefault();var t,i,n,e=o.val(),e=RDFE.Utils.trim(RDFE.Utils.trim(e,"<"),">");RDFE.Validate.check(o,e)&&(t=r.predicate.uri,i=s.getValue(),RDFE.Validate.check(s.getField(),i.value))&&(n=r.editor.doc.store.rdf.createTriple(r.editor.doc.store.rdf.createNamedNode(e),r.editor.doc.store.rdf.createNamedNode(t),i.toStoreNode(r.editor.doc.store)),r.editor.doc.addTriples([n],function(){r.addTriple(n),l(r.editor).trigger("rdf-editor-success",{type:"predicate-insert-success",message:"Successfully added new triple."}),r.predicateFormContainer.hide(),r.predicateTableContainer.show()},function(){l(r.editor).trigger("rdf-editor-error",{type:"predicate-insert-error",message:"Failed to add new triple."})}))})},e)}(jQuery),!function(c){function e(e,t){this.editor=e,this.editFct=t.editFct}function d(e,t,i){return'<a href="{0}" target="_blank">{0}</a>'.format(t.uri)}function h(e,t){function i(e){return'<a href="{0}">{0}</a>'.format(e)}return e=i(e),(t=i(t))<e?1:e<t?-1:0}window.RDFE||(window.RDFE={}),RDFE.PredicateView=(e.prototype.render=function(a,l){var u=this;u.editor.doc.listPredicates(function(e){u.predicates=e,u.predicateTable=null,a.empty();var r=c(document.createElement("table")).addClass("table"),t=(a.append(r),1),i=10,n="uri",o="asc",s=u.editor.config.options.pageSettings;s.pageNo&&(t=s.pageNo),s.pageSize&&(i=s.pageSize),s.sortName&&(n=s.sortName),s.sortOrder&&(o=s.sortOrder),r.bootstrapTable({striped:!0,pagination:!0,paginationVAlign:"top",pageNumber:t,pageSize:i,search:!0,sortName:n,sortOrder:o,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:e,idField:"uri",columns:[{field:"uri",title:RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema()),sortable:!0,sorter:h,formatter:d},{field:"items",title:"Count",titleTooltip:"Count",sortable:!0,align:"right",sorter:u.editor.countSorter,class:"rdfe-small-column",formatter:u.editor.countFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema(),!1,!0)+'"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,formatter:function(e,t,i){return['<a class="edit ml10" href="javascript:void(0)" title="Edit or add a new '+RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema(),!1,!0)+" and "+RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema(),!1,!0)+" pairs associated with this "+RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema(),!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="dereference ml10" href="javascript:void(0)" title="Dereference this '+RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema(),!0,!0)+'">','  <i class="glyphicon glyphicon-link"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove all '+RDFE.Utils.namingSchemaLabel("spo",u.editor.namingSchema(),!0,!0)+" associated with this "+RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema(),!1,!0)+'">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .edit":function(e,t,i,n){u.editFct(i)},"click .dereference":function(e,t,i,n){u.editor.dereference()(i.uri)},"click .remove":function(e,t,i,n){u.editor.doc.deletePredicate(i.uri,function(){r.bootstrapTable("remove",{field:"uri",values:[i.uri]}),c(u.editor).trigger("rdf-editor-success",{type:"predicate-delete-success",message:"Successfully deleted triples with predicate "+i.uri+"."})},function(e){c(u.editor).trigger("rdf-editor-error",{type:"predicate-delete-error",message:e})})}}}]}),r.on("page-change.bs.table",function(e,t,i){c(u.editor).trigger("rdf-editor-page",{pageNo:t,pageSize:i})}),r.on("sort.bs.table",function(e,t,i){c(u.editor).trigger("rdf-editor-page",{sortName:t,sortOrder:i})}),c(r).find(".add").on("click",function(e){u.editor.editPredicate()}),u.predicateTable=r,l&&l()},function(e){c(u.editor).trigger("rdf-editor-error",{type:"predicate-list-error",message:e})})},e.prototype.addPredicate=function(t){_.find(this.predicates,function(e){return e.uri===t.uri})||(this.predicateTable.bootstrapTable("append",t),this.predicates.push(t))},e.prototype.updatePredicate=function(n){var i=this;i.editor.doc.getPredicate(n,function(e){var t=i.predicates.findIndex(function(e,t,i){return e.uri===n});i.predicateTable.bootstrapTable("updateRow",{index:t,row:e})})},e)}(jQuery),!function(l){function e(e,t){this.editor=e,this.object=t}window.RDFE||(window.RDFE={}),RDFE.ObjectEditor=(e.prototype.template=_.template('       <div class="panel panel-default">         <div class="panel-heading clearfix">           <div class="form-group">             <div class="col-sm-1">               <label for="object" class="control-label pull-right" style="padding-top: 5px"><%= RDFE.Utils.namingSchemaLabel("o", this.editor.namingSchema()) %> </label>             </div>             <div class="col-sm-10">               <input name="object" class="form-control" />             </div>             <div class="col-sm-1">               <button type="button" class="btn btn-default btn-sm pull-right rdfe-font-bold" id="backButton" title="Back">Back</button>             </div>           </div>         </div>         <div class="panel-body" id="objectTable">         </div>         <div class="panel-body" id="objectForm" style="display: none;">       </div>'),e.prototype.render=function(e,t,i,n){var r,o=this,s=(t.empty(),t.append(o.template(o.object)),l(document.createElement("table")).addClass("table"));t.find("#objectTable").append(s);t.find("button#backButton").click(function(){o.objectView.removeObject(o.object),n()});var a=t.find('input[name="object"]').rdfNodeEditor(o.editor.doc.config.options);o.object&&a.setValue(o.object.object),l(a).on("changed",function(e,t){var t=t.getValue();t.value&&("uri"==t.type&&(t.value=o.editor.ontologyManager.uriDenormalize(t.value)),t=t.toStoreNode(o.editor.doc.store),o.editor.doc.getObject(t,function(e){o.objectView.removeObject(o.object),o.objectView.addObject(e),o.object=e,o.renderData()}))}),a.mainElement.focus(),a=t,s.bootstrapTable({striped:!0,sortName:"subject",pagination:!0,paginationVAlign:"top",search:!0,searchAlign:"left",showHeader:!0,editable:!0,data:[],dereference:!0,columns:[{field:"subject",title:RDFE.Utils.namingSchemaLabel("s",o.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("s",o.editor.namingSchema()),sortable:!0,editable:o.editor.editableSubject(o.editor),formatter:o.editor.nodeFormatter},{field:"predicate",title:RDFE.Utils.namingSchemaLabel("p",o.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("p",o.editor.namingSchema()),sortable:!0,editable:o.editor.editablePredicate(o.editor),formatter:o.editor.nodeFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Add Relation" style="display: none;"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,editable:!1,formatter:function(e,t,i){return['<a class="remove ml10" href="javascript:void(0)" title="Remove">','<i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .remove":function(e,t,i,n){o.editor.doc.deleteTriple(i,function(){s.bootstrapTable("remove",{field:"id",values:[i.id]}),l(o.editor).trigger("rdf-editor-success",{type:"object-delete-success",message:"Successfully deleted triple."})},function(e){l(o.editor).trigger("rdf-editor-error",{type:"triple-delete-error",message:"Failed to delete triple."})})}}}]}),s.on("editable-shown.bs.table",function(e,t,i){r=_.clone(i)}),s.on("editable-save.bs.table",function(e,t,i){o.editor.dataSetter(t,r,i)}),o.objectView=e.objectView,o.objectTable=s,o.objectTableContainer=a.find("#objectTable"),o.objectFormContainer=a.find("#objectForm"),o.addButton=l(s).find(".add"),o.addButton.click(function(){o.createNewRelationEditor()}),o.renderData(),i&&o.createNewRelationEditor()},e.prototype.renderData=function(){for(var e=this.object?this.object.items:[],t=0;t<e.length;t++)e[t].id=t;this.objectTable.data("maxindex",t),this.objectTable.bootstrapTable("load",e),this.object?this.addButton.show():this.addButton.hide()},e.prototype.addTriple=function(e){var t=this.objectTable.data("maxindex");this.objectTable.bootstrapTable("append",l.extend(e,{id:t})),this.objectTable.data("maxindex",++t),this.objectView.updateObject(this.object.object)},e.prototype.createNewRelationEditor=function(){var n=this,r=(n.objectTableContainer.hide(),n.objectFormContainer.html('<div class="panel panel-default">   <div class="panel-heading"><h3 class="panel-title">Add Relation</h3></div>   <div class="panel-body">     <form class="form-horizontal">       <div class="form-group">         <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",n.editor.namingSchema())+'</label>         <div class="col-sm-10"><input name="subject" class="form-control" /></div>       </div>       <div class="form-group">         <label for="predicate" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("p",n.editor.namingSchema())+'</label>         <div class="col-sm-10"><select name="predicate" class="form-control"></select></div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default object-action object-action-new-cancel">Cancel</button>           <button type="submit" class="btn btn-primary object-action object-action-new-save">OK</button>         </div>       </div>     </form>   </div> </div>').show(),n.objectFormContainer.find('select[name="predicate"]').propertyBox({ontologyManager:n.editor.ontologyManager})),o=n.objectFormContainer.find('input[name="subject"]');o.focus(),n.objectFormContainer.find("button.object-action-new-cancel").click(function(e){n.objectFormContainer.hide(),n.objectTableContainer.show()}),n.objectFormContainer.find("button.object-action-new-save").click(function(e){e.preventDefault();var t,i,e=o.val(),e=RDFE.Utils.trim(RDFE.Utils.trim(e,"<"),">");RDFE.Validate.check(o,e)&&(i=r.selectedURI(),i=RDFE.Utils.trim(RDFE.Utils.trim(i,"<"),">"),RDFE.Validate.check(r.sel,i))&&(t=n.editor.doc.store.rdf.createTriple(n.editor.doc.store.rdf.createNamedNode(e),n.editor.doc.store.rdf.createNamedNode(i),n.object.object),n.editor.doc.addTriples([t],function(){n.addTriple(t),l(n.editor).trigger("rdf-editor-success",{type:"object-insert-success",message:"Successfully added new triple."}),n.objectFormContainer.hide(),n.objectTableContainer.show()},function(){l(n.editor).trigger("rdf-editor-error",{type:"object-insert-error",message:"Failed to add new triple."})}))})},e)}(jQuery),!function(c){function e(e,t){this.editor=e,this.editFct=t.editFct}window.RDFE||(window.RDFE={}),RDFE.ObjectView=(e.prototype.render=function(a,l){var u=this;u.editor.doc.listObjects(function(e){u.objects=e,u.objectsTable=null,a.empty();var r=c(document.createElement("table")).addClass("table"),t=(a.append(r),1),i=10,n="label",o="asc",s=u.editor.config.options.pageSettings;s.pageNo&&(t=s.pageNo),s.pageSize&&(i=s.pageSize),s.sortName&&(n=s.sortName),s.sortOrder&&(o=s.sortOrder),r.bootstrapTable({striped:!0,pagination:!0,paginationVAlign:"top",pageNumber:t,pageSize:i,search:!0,sortName:n,sortOrder:o,searchAlign:"left",trimOnSearch:!1,showHeader:!0,data:e,idField:"id",columns:[{field:"label",title:RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema()),titleTooltip:RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema()),sortable:!0,formatter:function(e,t,i){var n;return"IRI"===t.type?(n='class="rdfe-green-link"',u.editor.ontologyManager.ontologyClassByURI(t.label)&&(n=""),'<a href="{0}" target="_blank" {1}>{0}</a>'.format(t.label,n)):t.label}},{field:"type",title:"Type",titleTooltip:"Type",sortable:!0,class:"rdfe-small-column",formatter:function(e,t,i){return"IRI"===t.type?t.type:'<a href="{1}" target="_blank">{0}</a>'.format(u.editor.ontologyManager.uriNormalize(t.type),t.type)}},{field:"items",title:"Count",titleTooltip:"Count",sortable:!0,sorter:u.editor.countSorter,align:"right",class:"rdfe-small-column",formatter:u.editor.countFormatter},{field:"actions",title:'<button class="add btn btn-default btn-sm" title="Click to create a new '+RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema(),!1,!0)+'"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New</button>',align:"center",valign:"middle",class:"rdfe-small-column",clickToSelect:!1,formatter:function(e,t,i){return['<a class="edit ml10" href="javascript:void(0)" title="Edit or add a new '+RDFE.Utils.namingSchemaLabel("s",u.editor.namingSchema(),!1,!0)+" and "+RDFE.Utils.namingSchemaLabel("p",u.editor.namingSchema(),!1,!0)+" pairs associated with this "+RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema(),!1,!0)+'">','  <i class="glyphicon glyphicon-edit"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove all '+RDFE.Utils.namingSchemaLabel("spo",u.editor.namingSchema(),!0,!0)+" associated with this "+RDFE.Utils.namingSchemaLabel("o",u.editor.namingSchema(),!1,!0)+'">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .edit":function(e,t,i,n){u.editFct(i)},"click .remove":function(e,t,i,n){u.editor.doc.deleteObject(i.object,function(){r.bootstrapTable("remove",{field:"id",values:[i.id]}),c(u.editor).trigger("rdf-editor-success",{type:"object-delete-success",message:"Successfully deleted triples with object "+i.object+"."})},function(e){c(u.editor).trigger("rdf-editor-error",{type:"object-delete-error",message:e})})}}}]}),r.on("page-change.bs.table",function(e,t,i){c(u.editor).trigger("rdf-editor-page",{pageNo:t,pageSize:i})}),r.on("sort.bs.table",function(e,t,i){c(u.editor).trigger("rdf-editor-page",{sortName:t,sortOrder:i})}),c(r).find(".add").on("click",function(e){u.editor.editObject()}),u.objectsTable=r,l&&l()},function(e){c(u.editor).trigger("rdf-editor-error",{type:"object-list-error",message:e})})},e.prototype.addObject=function(t){_.find(this.objects,function(e){return e.id===t.id})||(this.objectsTable.bootstrapTable("append",t),this.objects.push(t))},e.prototype.updateObject=function(e){var t=this;t.editor.doc.getObject(e,function(n){var e=t.objects.findIndex(function(e,t,i){return e.id===n.id});t.objectsTable.bootstrapTable("updateRow",{index:e,row:n})})},e.prototype.removeObject=function(e){e&&0===e.items.length&&this.objectsTable.bootstrapTable("remove",{field:"id",values:[e.id]})},e)}(jQuery),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0==this.indexOf(e)}),window.RDFE||(window.RDFE={}),RDFE.Editor=function(t,i){function e(){var e={config:t.config,documentTree:t.documentTree,ontologyManager:n.ontologyManager};new RDFE.Document(e,function(e){n.doc=e,$(n.doc).on("docChanged",function(e,t){n.docChanged()}),i&&i(n)})}var n=this,r=$.extend({initOntologyManager:!0},t.options);n.config=t.config,n.maxLength=n.config.options.maxLabelLength,n.spinner=0,n.ontologyManager=new RDFE.OntologyManager(t.config.options);!0===r.initOntologyManager?n.ontologyManager.init({success:e}):e()},RDFE.Editor.prototype.namingSchema=function(){return this.config.options[this.config.options.namingSchema]},RDFE.Editor.prototype.nodeFormatter=function(e){return"Literal"==e.interfaceName?"http://www.w3.org/2001/XMLSchema#dateTime"==e.datatype?new Date(e.nominalValue).toString():RDFE.Utils.escapeXml(RDFE.Utils.strAbbreviate(e.nominalValue,this.maxLength)):RDFE.Utils.uriAbbreviate(e.toString(),this.maxLength)},RDFE.Editor.prototype.countFormatter=function(e,t,i){return t.items.length},RDFE.Editor.prototype.countSorter=function(e,t){return e=e.length,(t=t.length)<e?1:e<t?-1:0},RDFE.Editor.prototype.editableSubject=function(t){return function(e){return{mode:"inline",type:"rdfnode",rdfnode:{mode:"subject",config:$.extend({},t.config.options,{dereferenceLink:t.dereference()}),type:"http://www.w3.org/1999/02/22-rdf-syntax-ns#Resource",dereferenceLink:t.dereference()},value:e.subject}}},RDFE.Editor.prototype.editablePredicate=function(t){return function(e){return{mode:"inline",type:"propertyBox",propertyBox:{ontologyManager:t.ontologyManager,dereferenceLink:t.dereference()},value:e.predicate.nominalValue}}},RDFE.Editor.prototype.editableObject=function(t,i){return function(e){return{mode:"inline",type:"rdfnode",rdfnode:{mode:"object",type:e.object.datatype,config:$.extend({},t.config.options,{dereferenceLink:t.dereference()}),predicate:i?i(e):null,document:t.doc,ontologyManager:t.ontologyManager,dereferenceLink:t.dereference()},value:e.object}}},RDFE.Editor.prototype.render=function(e){this.container=e,this.container.empty(),this.listContainer=$(document.createElement("div")).appendTo(this.container),this.formContainer=$(document.createElement("div")).appendTo(this.container)},RDFE.Editor.prototype.docChanged=function(){this.doc.store.graph(this.doc.graph,function(e,t){t="<![CDATA["+t.toNT()+"]]>";$("body").find('script[type="text/turtle"][id="document"]').text(t)})},RDFE.Editor.prototype.toggleSpinner=function(e){e?$(this).trigger("rdf-editor-spinner-start","editor-spinner"):$(this).trigger("rdf-editor-spinner-done","editor-spinner")},RDFE.Editor.prototype.toggleView=function(e,t){var i=this;e!==i.view&&("subjects"===e||"entities"===e?(!0===i.config.options.useEntityEditor?i.createEntityList():i.createSubjectList(),i.view=e):"predicates"===e||"attributes"===e?(i.createPredicateList(),i.view=e):"objects"===e||"values"===e?(i.createObjectList(),i.view=e):(i.createTripleList(),i.view="triples"===e||"statements"===e?e:"EAV"===t?"statements":"triples"),$(i).trigger("rdf-editor-page",{view:i.view}))},RDFE.Editor.prototype.updateView=function(){var e=this;"subjects"===e.view||"entities"===e.view?!0===e.config.options.useEntityEditor?e.createEntityList():e.createSubjectList():"predicates"===e.view||"attributes"===e.view?e.createPredicateList():"objects"===e.view||"values"===e.view?e.createObjectList():e.createTripleList()},RDFE.Editor.prototype.settingsForm=function(){var r=this,o=$("#settingsModal"),e=$.jStorage.get("rdfe:settings",{});o.find("#userID").val(e.userID),o.find('input[name="namingSchema"][value="'+e.namingSchema+'"]').attr("checked","checked"),o.modal({keyboard:!0}),o.keypress(function(e){13==e.which&&o.find('button[type="submit"]').click()}),o.find(".ok").off(),o.find(".ok").on("click",function(e){e.preventDefault();var e=$.jStorage.get("rdfe:settings",{}),t=o.find("#userID").val(),e=e.namingSchema,i="",n=o.find('input[name="namingSchema"]:checked'),n=(0<n.length&&(i=n.val()),$.jStorage.set("rdfe:settings",{userID:t,namingSchema:i}),o.modal("hide"),-1!==["entities","attributes","values","statements"].indexOf(r.view)?"EAV":"SPO");e===i&&n===i||(r.tripleView=null,r.subjectView=null,r.predicateView=null,r.objectView=null,r.config.options.namingSchema=i,$(r).trigger("rdf-editor-namingSchema",{uiMode:i,viewMode:r.view}))})},RDFE.Editor.prototype.localForm=function(){var i=this,n=$("#localModal");n.find("#content").val(""),n.find("#contentType").val("text/turtle"),n.modal({keyboard:!0}),n.find(".ok").off(),n.find(".ok").on("click",function(e){var t;e.preventDefault(),window.File&&window.FileReader&&window.FileList&&window.Blob?(e=n.find("#localFile").prop("files"))?e.length&&e[0]?(e=e[0],(t=new FileReader).onload=function(){var e=t.result;i.doc.import(e,function(e){n.modal("hide"),i.updateView(),i.docChanged(),$(i).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully imported RDF data."})},function(e){$(i).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to import RDF data. <br /> "+e.message})})},t.readAsText(e)):$(i).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Please select a file!"}):$(i).trigger("rdf-editor-error",{type:"rdf-editor-error",message:'This browser doesn\'t seem to support the "files" property of file inputs.'}):$(i).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"The File APIs are not fully supported by your browser."})})},RDFE.Editor.prototype.remoteForm=function(){var i=this,n=$("#remoteModal");n.find("#remoteURL").val(""),n.modal({keyboard:!0}),n.find(".ok").off(),n.find(".ok").on("click",function(e){e.preventDefault();var t=n.find("#remoteURL").val();$.ajax(t).done(function(e){i.doc.import(e,function(e){n.modal("hide"),i.updateView(),i.docChanged(),$(i).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully imported RDF data."})},function(e){n.modal("hide"),$(i).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to import RDF data. <br /> "+e.message})})}).fail(function(e){n.modal("hide");e=RDFE.IO.ajaxFailMessage(e,'Failed to load remote document "{0}"',t);$(i).trigger("rdf-editor-error",{type:"rdf-editor-error",message:e})})})},RDFE.Editor.prototype.importForm=function(){var t=this,i=$("#importModal");i.find("#content").val(""),i.find("#contentType").val("text/turtle"),i.modal({keyboard:!0}),i.find(".ok").off(),i.find(".ok").on("click",function(e){e.preventDefault();e=i.find("#content").val();i.find("#contentType").val();t.doc.import(e,function(e){i.modal("hide"),t.updateView(),t.docChanged(),$(t).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully imported RDF data."})},function(e){$(t).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to import RDF data. <br /> "+e.message})})})},RDFE.Editor.prototype.exportForm=function(){var i=this,n=$("#exportModal");n.find("#content").val(""),n.keypress(function(e){13==e.which&&n.find('button[type="submit"]').click()}),n.modal({keyboard:!0}),$(i).trigger("rdf-editor-spinner-start","export-spinner"),i.doc.store.graph(i.doc.graph,function(e,t){t=t.toNT();n.find("#content").val(t),$(i).trigger("rdf-editor-spinner-done","export-spinner")})},RDFE.Editor.prototype.undo=function(){var t=this;t.doc.undoLog(function(e){t.updateView(),t.docChanged(),$(t).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully undo RDF data."})},function(e){$(t).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to undo RDF data. <br /> "+e.message})})},RDFE.Editor.prototype.redo=function(){var t=this;t.doc.redoLog(function(e){t.updateView(),t.docChanged(),$(t).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully redo RDF data."})},function(e){$(t).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to redo RDF data. <br /> "+e.message})})},RDFE.Editor.prototype.signDocumentForm=function(){var s,a=this,e=$("#signModal"),t=e.find(".modal-body");t.empty(),a.doc.checkForSignature(),angular.element("[ng-controller=AuthHeaderCtrl]").scope().profile?(t.html('      <div class="form-group">         <label class="col-sm-2 control-label">Signature</label>         <div class="col-sm-10">           <input type="text" class="form-control" name="signatureDocURI" id="signatureDocURI" value="{0}">        </div>       </div>    '.format(a.doc.signature||a.doc.url+",signature")),e.find(".ok").show(),e.find(".ok").off(),e.find(".ok").on("click",(s=e,function(e){e.preventDefault();function t(e,t){a.doc.store.graph(a.doc.graph,function(e,t){function n(e,t,i){var n;"error"===t?r():(t={contentType:"text/plain",success:function(){s.modal("hide"),a.updateView(),$(a).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully signed document."})},error:r},(n=RDFE.IO.createIO("webdav")).type="webdav",n.insert(o,e,t))}t=t.toNT();$.get("/ods/api/signature?content="+t).done(function(e,t,i){n(e,t)}).fail(function(e,t,i){n(e,t)})})}function r(e,t){i||a.doc.deleteTriples(n),$(a).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to sign document."})}var i,e=a.doc.store.rdf,o=s.find("#signatureDocURI").val(),n=e.createTriple(e.createNamedNode(a.doc.url),e.createNamedNode("http://www.openlinksw.com/schemas/cert#hasSignature"),e.createNamedNode(o));a.doc.checkTriple(n,function(e){i=e},function(e){i=e});i?t():a.doc.addTriples(n,t,r)}))):(t.html('      <div class="form-group">         <label class="col-sm-2 control-label">Signature</label>         <div class="col-sm-10">           <p class="form-control-static">The user is not logged. Please, login and try again.</p>         </div>       </div>    '),e.find(".ok").hide()),e.modal()},RDFE.Editor.prototype.unsignDocumentForm=function(){var r,o=this,e=$("#unsignModal"),t=e.find(".modal-body");t.empty(),o.doc.checkForSignature(),o.doc.signature?(t.html('      <div class="form-group">         <label class="col-sm-2 control-label">Signature</label>         <div class="col-sm-10">           <p class="form-control-static">{0}</p>         </div>       </div>      <div class="form-group">         <label class="col-sm-2"></label>         <div class="col-sm-10 checkbox">           <label><input type="checkbox" name="deleteSignature" id="deleteSignature" value="on"><strong>Delete Signature File</strong></label>        </div>       </div>    '.format(o.doc.signature)),e.find(".ok").show(),e.find(".ok").off(),e.find(".ok").on("click",(r=e,function(e){e.preventDefault();function t(){r.modal("hide"),o.updateView(),$(o).trigger("rdf-editor-success",{type:"rdf-editor-success",message:"Successfully unsigned document."})}function i(){$(o).trigger("rdf-editor-error",{type:"rdf-editor-error",message:"Failed to unsign document."})}function n(){var e=(e=o.doc.store.rdf).createTriple(e.createNamedNode(o.doc.url),e.createNamedNode("http://www.openlinksw.com/schemas/cert#hasSignature"),e.createNamedNode(o.doc.signature));o.doc.deleteTriples(e,t,i)}r.find("#deleteSignature").checked?((e=RDFE.IO.createIO("webdav")).type="webdav",e.delete(o.doc.signature)):n()}))):(t.html('      <div class="form-group">         <label class="col-sm-2 control-label">Signature</label>         <div class="col-sm-10">           <p class="form-control-static">Document has not signature</p>         </div>       </div>    '),e.find(".ok").hide()),e.modal()},RDFE.Editor.prototype.dereference=function(){var t;return t=this,function(e){if(e){if(e.startsWith("#")){if(!t.doc.url)return;e=t.doc.url+e}e.startsWith("http")&&window.open(e,"_blank").focus()}}},RDFE.Editor.prototype.createTripleList=function(){var e=this;e.toggleSpinner(!0),e.tripleView||(e.tripleView=new RDFE.TripleView(e)),e.formContainer.hide(),e.listContainer.empty().show(),setTimeout(function(){e.tripleView.render(e.listContainer,function(){e.toggleSpinner(!1)})},0)},RDFE.Editor.prototype.editTriple=function(e,t,i){var r=this;if(!r.doc)return!1;r.listContainer.hide(),r.formContainer.html('<div class="panel panel-default">  <div class="panel-heading"><h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("spo",r.namingSchema())+'</h3></div>  <div class="panel-body">    <form class="form-horizontal">      <div class="form-group"><label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",r.namingSchema())+'</label>        <div class="col-sm-10"><input name="subject" class="form-control" /></div>      </div>      <div class="form-group"><label for="predicate" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("p",r.namingSchema())+'</label>        <div class="col-sm-10"><select name="predicate" class="form-control"></select></div>      </div>      <div class="form-group"><label for="object" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("o",r.namingSchema())+'</label>        <div class="col-sm-10"><input name="object" class="form-control" /></div>      </div>      <div class="form-group">        <div class="col-sm-10 col-sm-offset-2">          <button type="button" class="btn btn-default triple-action triple-action-new-cancel">Cancel</button>           <button type="submit" class="btn btn-primary triple-action triple-action-new-save">OK</button>         </div>      </div>    </form>  </div></div>').show();var o=r.formContainer.find('input[name="subject"]'),s=(o.focus(),(e||r.saveSubject)&&r.formContainer.find('input[name="subject"]').val(e||r.saveSubject),r.formContainer.find('input[name="object"]').rdfNodeEditor(r.config.options)),a=(i&&s.setValue(new RDFE.RdfNode("literal",i,null,"")),r.formContainer.find('select[name="predicate"]').propertyBox({ontologyManager:r.ontologyManager}).on("changed",function(e,t){r.changeObjectType(t,s)}));t&&a.setPropertyURI(t),r.formContainer.find("button.triple-action-new-cancel").click(function(e){e.preventDefault(),r.createTripleList()}),r.formContainer.find("button.triple-action-new-save").click(function(e){e.preventDefault();var t,i,n=o.val(),n=RDFE.Utils.trim(RDFE.Utils.trim(n,"<"),">");RDFE.Validate.check(o,n)&&(e=a.selectedURI(),e=RDFE.Utils.trim(RDFE.Utils.trim(e,"<"),">"),RDFE.Validate.check(a.sel,e))&&("uri"==(t=s.getValue()).type&&(t.value=r.ontologyManager.uriDenormalize(t.value)),RDFE.Validate.check(s.getField(),t.value))&&(i=r.doc.store.rdf.createTriple(r.doc.store.rdf.createNamedNode(n),r.doc.store.rdf.createNamedNode(e),t.toStoreNode(r.doc.store)),r.doc.addTriples([i],function(){r.tripleView&&r.tripleView.addTriple(i),$(r).trigger("rdf-editor-success",{type:"triple-insert-success",message:"Successfully added new triple."}),r.saveSubject=n,r.createTripleList()},function(){$(r).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})}))})},RDFE.Editor.prototype.createNewEntityEditor=function(n){var t,e,r=this;if(!r.doc)return!1;r.listContainer.hide(),r.formContainer.show(),n?(e=(e=r.ontologyManager.ontologyClassByURI(n))?e.label:RDFE.Utils.uri2name(n),r.formContainer.html('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("s",r.namingSchema())+'</h3></div><div class="panel-body"><div class="form-horizontal">   <div class="form-group">     <label for="class" class="col-sm-2 control-label">Type</label>     <div class="col-sm-10">       <p class="form-control-static" title="'+n+'">'+e+'</p>    </div>   </div>   <div class="form-group">      <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",r.namingSchema())+' URI</label>      <div class="col-sm-10">        <input name="subject" id="subject" class="form-control" />      </div>   </div>   <div class="form-group">     <div class="col-sm-10 col-sm-offset-2">       <button type="button" class="btn btn-default triple-action triple-action-new-cancel">Cancel</button>       <button type="submit" class="btn btn-primary triple-action triple-action-new-save">OK</button>     </div>   </div> </div></div></div>\n'),r.formContainer.find("input#subject").focus()):(r.formContainer.html('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Add new '+RDFE.Utils.namingSchemaLabel("s",r.namingSchema())+'</h3></div><div class="panel-body"><div class="form-horizontal">   <div class="form-group">     <label for="ontology" class="col-sm-2 control-label">Vocabulary</label>     <div class="col-sm-10">       <select name="ontology" id="ontology" class="form-control" />     </div>   </div>   <div class="form-group">     <label for="class" class="col-sm-2 control-label">Type</label>     <div class="col-sm-10">       <select name="class" id="class" class="form-control" />     </div>   </div>   <div class="form-group">      <label for="subject" class="col-sm-2 control-label">'+RDFE.Utils.namingSchemaLabel("s",r.namingSchema())+' URI</label>      <div class="col-sm-10">        <input name="subject" id="subject" class="form-control" />      </div>   </div>   <div class="form-group">     <div class="col-sm-10 col-sm-offset-2">       <button type="button" class="btn btn-default triple-action triple-action-new-cancel">Cancel</button>       <button type="submit" class="btn btn-primary triple-action triple-action-new-save">OK</button>     </div>   </div> </div></div></div>\n'),(e=$("#ontology").ontoBox({ontologyManager:r.ontologyManager})).on("changed",function(e){e=r.ontologyManager.ontologyByURI(e.currentTarget.selectedOntologyURI());t.clearOptions(),t.addOption(e?e.classesAsArray():r.ontologyManager.allClasses())}),e.sel.focus(),e=$("#class").selectize({valueField:"URI",labelField:"URI",searchField:["title","label","prefix","URI"],sortField:["prefix","URI"],options:r.ontologyManager.allClasses(),create:function(e,t){t(r.ontologyManager.ontologyClassByURI(r.ontologyManager.uriDenormalize(e),!0))},render:{item:function(e,t){var i=e.title||e.label||name.curi||e.name;return"<div>"+(i=e.curi&&e.curi!=i?t(i)+" <small>("+t(e.curi)+")</small>":t(i))+"</div>"},option:function(e,t){return"<div>"+t(e.title||e.label||name.curi||e.name)+"<br/><small>("+t(e.URI)+")</small></div>"},option_create:function(e,t){var i=r.ontologyManager.uriDenormalize(e.input);return i!=e.input?'<div class="create">Add <strong>'+t(e.input)+"</strong> <small>("+t(i)+")</small>&hellip;</div>":'<div class="create">Add <strong>'+t(i)+"</strong>&hellip;</div>"}}}),t=e[0].selectize),r.config.options.entityUriTmpl&&r.formContainer.find('label[for="subject"]').text(RDFE.Utils.namingSchemaLabel("s",r.namingSchema())+" Name"),r.formContainer.find("button.triple-action-new-cancel").click(function(e){e.preventDefault(),r.listContainer.show(),r.formContainer.hide()});function i(){var e=r.formContainer.find('input[name="subject"]').val(),t=null,i=n||r.formContainer.find("#class")[0].selectize.getValue(),e=RDFE.Utils.trim(RDFE.Utils.trim(e,"<"),">");r.config.options.entityUriTmpl&&(t=e,e=null),r.doc.addEntity(e,t,i,function(e){r.entityView&&r.entityView.addEntity(e),$(r).trigger("rdf-editor-success",{type:"entity-insert-success",message:"Successfully created new entity."}),r.editEntity(e.uri)},function(){$(r).trigger("rdf-editor-error",{type:"triple-insert-failed",message:"Failed to add new triple to store."})})}r.formContainer.find("button.triple-action-new-save").click(function(e){e.preventDefault(),i()}),r.formContainer.find("input#subject").keypress(function(e){13===e.which&&i()})},RDFE.Editor.prototype.createEntityList=function(){var i=this;i.toggleSpinner(!0),i.entityView||(i.entityView=new RDFE.EntityView(i.doc,i.ontologyManager,i,{editFct:function(e){i.editEntity.call(i,e)}}),$(i.entityView).on("rdf-editor-error",function(e,t){$(i).trigger("rdf-editor-error",t)}).on("rdf-editor-success",function(e,t){$(i).trigger("rdf-editor-success",t)})),i.formContainer.hide(),i.listContainer.empty().show(),setTimeout(function(){i.entityView.render(i.listContainer,function(){i.toggleSpinner(!1)})},0)},RDFE.Editor.prototype.editEntity=function(e){var i=this;i.entityEditor||(i.entityEditor=new RDFE.EntityEditor(i.doc,i.ontologyManager),$(i.entityEditor).on("rdf-editor-error",function(e,t){$(i).trigger("rdf-editor-error",t)}).on("rdf-editor-success",function(e,t){$(i).trigger("rdf-editor-success",t)})),i.listContainer.hide(),i.formContainer.show(),i.entityEditor.render(i.formContainer,e,function(){i.formContainer.hide(),i.listContainer.show(),i.entityView.updateEntity(e)})},RDFE.Editor.prototype.createSubjectList=function(){var t=this;t.toggleSpinner(!0),t.subjectView||(t.subjectView=new RDFE.SubjectView(t,{editFct:function(e){t.editSubject.call(t,e)}})),t.formContainer.hide(),t.listContainer.empty().show(),setTimeout(function(){t.subjectView.render(t.listContainer,function(){t.toggleSpinner(!1)})},0)},RDFE.Editor.prototype.editSubject=function(e,t){var i=this;i.subjectEditor||(i.subjectEditor=new RDFE.SubjectEditor(i)),"string"==typeof e&&(e=i.doc.newSubject(e)),i.listContainer.hide(),i.formContainer.show(),i.subjectEditor.subject=e,i.subjectEditor.render(i,i.formContainer,t,function(){i.formContainer.hide(),i.listContainer.show(),e&&e.uri&&i.subjectView.updateSubject(e.uri)})},RDFE.Editor.prototype.createPredicateList=function(){var t=this;t.toggleSpinner(!0),t.predicateView||(t.predicateView=new RDFE.PredicateView(t,{editFct:function(e){t.editPredicate.call(t,e)}})),t.formContainer.hide(),t.listContainer.empty().show(),setTimeout(function(){t.predicateView.render(t.listContainer,function(){t.toggleSpinner(!1)})},0)},RDFE.Editor.prototype.editPredicate=function(e,t){var i=this;i.predicateEditor||(i.predicateEditor=new RDFE.PredicateEditor(i)),i.listContainer.hide(),i.formContainer.show(),(e="string"==typeof e?i.doc.newPredicate(e):e)&&i.ontologyManager.ontologyPropertyByURI(e.uri,!0),i.predicateEditor.predicate=e,i.predicateEditor.render(i,i.formContainer,t,function(){i.formContainer.hide(),i.listContainer.show(),e&&e.uri&&i.predicateView.updatePredicate(e.uri)})},RDFE.Editor.prototype.createObjectList=function(){var t=this;t.toggleSpinner(!0),t.objectView||(t.objectView=new RDFE.ObjectView(t,{editFct:function(e){t.editObject.call(t,e)}})),t.formContainer.hide(),t.listContainer.empty().show(),setTimeout(function(){t.objectView.render(t.listContainer,function(){t.toggleSpinner(!1)})},0)},RDFE.Editor.prototype.editObject=function(e,t){var i=this;i.objectEditor||(i.objectEditor=new RDFE.ObjectEditor(i)),"string"==typeof e&&(e=i.doc.newObject(e)),i.listContainer.hide(),i.formContainer.show(),i.objectEditor.object=e,i.objectEditor.render(i,i.formContainer,t,function(){i.formContainer.hide(),i.listContainer.show(),e&&i.objectView.updateObject(e)})},RDFE.Editor.prototype.changeObjectType=function(e,t){var i,n,r=t.getValue();if(e){var o=e.getRange();if(o&&o.length){for(var s=0;s<o.length;s++)if(t.isLiteralType(o[s])){i=new RDFE.RdfNode("literal",r.value,o[s],r.language);break}if(!i)if(n=this.doc.itemsByRange(o))i=new RDFE.RdfNode("uri",r.value),"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"!==e.URI&&this.objectsLookup(t,o);else for(s=0;s<o.length;s++)t.isLiteralType(o[s])&&(i=new RDFE.RdfNode("literal",r.value,o[s],r.language))}}i=i||new RDFE.RdfNode("literal",r.value,null,""),t.setValue(i,n)},RDFE.Editor.prototype.objectsLookup=function(s,e){var t=this.config.options.objectLookups;if(t&&t.enabled){var i=t.sources;if(i)for(var n=RDFE.IO.createIO("http"),a=this.doc.store,r=0;r<i.length;r++)for(var o=0;o<e.length;o++){var l=e[o],u="urn:__GRAPH__"+r+"_"+o,c=i[r].url.format(encodeURIComponent(l)),l=function(n,r,o){return function(e,t,i){a.loadTurtle(e,n,n,null,function(e,t){e||(e="select ?s from <{0}> where {?s a <{1}>}".format(n,r),a.execute(e,function(e,t){for(var i=[],n=0;n<t.length;n++)i.push(new RDFE.RdfNode("uri",t[n].s.value));s.updateSelection(o,i)}))}),a.clear(n,function(){})}}(u,l,i[r].label);n.retrieveToStore(c,a,u,{success:l})}}},RDFE.Editor.prototype.dataSetter=function(e,t,i){var n,r=this,o=i[e];"subject"===e?o=r.doc.store.rdf.createNamedNode(o.value):"predicate"===e?o=r.doc.store.rdf.createNamedNode(o):"object"===e&&(o="uri"===o.type?r.doc.store.rdf.createNamedNode(o.value):"http://www.w3.org/2001/XMLSchema#dateTime"===o.datatype?(n=new Date(o.value),r.doc.store.rdf.createLiteral(n.toISOString(),o.language,o.datatype)):r.doc.store.rdf.createLiteral(o.value,o.language,o.datatype)),i[e]=o,r.doc.updateTriple(t,i,function(e){$(r).trigger("rdf-editor-success",{type:"triple-update-success",message:"Successfully updated triple."})},function(e){$(r).trigger("rdf-editor-error",{type:"triple-update-error",message:"Failed to update triple."})})},!function(c){function e(e,t){t=c.extend({},t),this.editor=e,this.ontologyManager=e.ontologyManager,this.ontologies=this.ontologyManager.allOntologies()}window.RDFE||(window.RDFE={}),RDFE.OntologyView=(e.prototype.render=function(e){var u=this,t=(c(u.ontologyManager).on("changed",function(e,t){u.addOntologies(t.allOntologies())}),u.table=null,u.tableContainer=null,u.formContainer=null,e.empty(),c(document.createElement("div"))),i=(e.append(t),c(document.createElement("table")).addClass("table")),n=(t.append(i),c(document.createElement("div"))),e=(e.append(n),u.ontologyManager.allOntologies());i.bootstrapTable({striped:!0,sortName:"prefix",showHeader:!1,classes:"table-hover table-condensed",height:157,data:e,idField:"URI",dataSetter:function(e,t,i){i=c.trim(i),e.prefix!==i&&(delete u.ontologyManager.prefixes[e.prefix],delete RDFE.prefixes[e.prefix],e.prefix=i,u.ontologyManager.prefixes[e.prefix]=e.URI,RDFE.prefixes[e.prefix]=e.URI)},columns:[{field:"prefix",title:"Prefix",titleTooltip:"Prefix",editable:function(e){return{mode:"inline",type:"text",value:e.prefix,emptytext:"empty",validate:function(e){e=c.trim(e);return""==e?"This field is required":u.ontologyManager.ontologyByPrefix(e)?"This prefix is used":void 0}}},formatter:function(e,t,i){return t.prefix||""}},{field:"URI",title:"URI",titleTooltip:"URI",formatter:function(e,t,i){return['<span title="Vocabulary {0} - {1} classes, {2} properties">'.format(t.URI,t.classesLength(),t.propertiesLength()),"{0} - {1}/{2}".format(t.URI,t.classesLength(),t.propertiesLength()),"</span>"].join("")}},{field:"actions",title:"",align:"center",valign:"middle",clickToSelect:!1,formatter:function(e,t,i){return['<a class="refresh ml10" href="javascript:void(0)" title="Refresh vocabulary">','  <i class="glyphicon glyphicon-refresh"></i>',"</a>",'<a class="dereference ml10" href="javascript:void(0)" title="Dereference this vocabulary">','  <i class="glyphicon glyphicon-link"></i>',"</a>",'<a class="remove ml10" href="javascript:void(0)" title="Remove vocabulary">','  <i class="glyphicon glyphicon-remove"></i>',"</a>"].join("")},events:{"click .refresh":function(e,t,i,n){var r=c("#ontology-loading");r.is(":visible")||(r.show(),u.ontologyManager.parseOntologyFile(i.URI,{success:function(){c(u.ontologyManager).trigger("loadingFinished",[u.ontologyManager]),r.hide()},error:function(e){c(u.ontologyManager).trigger("loadingFailed",[u.ontologyManager]),c.notify({message:e.message},{type:"danger"}),r.hide()},ioType:"http"}))},"click .dereference":function(e,t,i,n){u.editor.dereference()(i.URI)},"click .remove":function(e,t,i,n){u.ontologyManager.ontologyRemove(i.URI),u.table.bootstrapTable("remove",{field:"URI",values:[i.URI]})}}}]}),u.table=i,u.tableContainer=t,(u.formContainer=n).html('<div class="panel panel-default" style="border: 0; padding: 0; margin-bottom: 0;">   <div class="panel-body" style="padding-top: 10px; padding-bottom: 0;"><div class="form-horizontal">     <form class="form-horizontal">       <div class="form-group">         <label for="ontology" class="col-sm-2 control-label">Prefix</label>         <div class="col-sm-10">           <input name="prefix" id="prefix" class="form-control" />         </div>       </div>       <div class="form-group">         <label for="class" class="col-sm-2 control-label">URI</label>         <div class="col-sm-10">           <input name="uri" id="uri" class="form-control" />         </div>       </div>       <div class="form-group">         <div class="col-sm-10 col-sm-offset-2">           <button type="button" class="btn btn-default cancel">Cancel</button>           <button type="submit" class="btn btn-primary save">OK</button>         </div>       </div>     </form>   </div> </div>\n'),n.find(".cancel").click(function(e){e.preventDefault(),c("#ontology-loading").is(":visible")||(u.formContainer.hide(),u.tableContainer.show())}),n.find(".save").click(function(e){e.preventDefault();var i,n,t,r,o,s,a,l=c("#ontology-loading");l.is(":visible")||(i=u.formContainer.find("#uri"),n=u.formContainer.find("#prefix"),t=function(){u.formContainer.hide(),u.tableContainer.show(),l.hide()},e={success:function(){var e=u.ontologyManager.ontologyByURI(r);e&&(e.prefix=o),c(u.ontologyManager).trigger("loadingFinished",[u.ontologyManager]),u.ontologyManager.prefixes[o]=r,t()},error:function(e){c(u.ontologyManager).trigger("loadingFailed",[u.ontologyManager]);e=e&&e.message?e.message:"Error loading ontology";bootbox.confirm(e+". <br /><br />Do you want an empty ontology to be added?",function(e){var t;e&&(e=i.val(),t=n.val(),!u.ontologyManager.ontologyByURI(e))&&(new RDFE.Ontology(u.ontologyManager,e,t),u.addOntologies(u.ontologyManager.allOntologies()))}),t()}},r=i.val(),RDFE.Validate.check(i,r)&&("http:"!==(a=RDFE.Utils.splitUrl(r)).protocol&&"https:"!==a.protocol?bootbox.alert("Only HTTP and HTTPS protocols are supported"):(o=n.val())&&u.ontologyManager.prefixes[o]&&u.ontologyManager.prefixes[o]!==r?bootbox.alert("The prefix is already used for another URI"):u.ontologyManager.ontologyByURI(r)?(s="",(a=u.ontologyManager.prefixByOntology(r))!==o&&(s=" with prefix "+o),bootbox.alert("This ontology is loaded{0}. Please, use 'Refresh' action!".format(s))):(l.show(),u.ontologyManager.parseOntologyFile(r,e))))}),n.find("#prefix").blur(function(e){var t;u.formContainer.find("#uri").val()||(t=u.formContainer.find("#prefix").val())&&(t=RDFE.ontologyByPrefix(t))&&u.formContainer.find("#uri").val(t)}),n.hide()},e.prototype.addOntologies=function(t){for(var i=0;i<t.length;i++)_.find(this.ontologies,function(e){return e.URI===t[i].URI})&&this.table.bootstrapTable("updateByUniqueId",t[i].URI,t[i]);for(i=0;i<t.length;i++)_.find(this.ontologies,function(e){return e.URI===t[i].URI})||this.table.bootstrapTable("append",t[i]);this.ontologies=t},e.prototype.add=function(e){this.formContainer.find("#prefix").val(""),this.formContainer.find("#uri").val(""),this.tableContainer.hide(),this.formContainer.show(),this.formContainer.find("#prefix").focus()},e)}(jQuery),!function(){"use strict";var e=window.jQuery||window.$||(window.$={}),l={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||(String.prototype.evalJSON?function(e){return String(e).evalJSON()}:e.parseJSON)||e.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||e.toJSON};if("function"!=typeof l.parse||"function"!=typeof l.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");var a,u={__jstorage_meta:{CRC32:{}}},s={jStorage:"{}"},c=null,n=0,d=!1,h={},t=!1,p=0,f={},g=+new Date,r={isXML:function(e){e=(e?e.ownerDocument||e:0).documentElement;return!!e&&"HTML"!==e.nodeName},encode:function(t){if(this.isXML(t))try{return(new XMLSerializer).serializeToString(t)}catch(e){try{return t.xml}catch(e){}}return!1},decode:function(e){var t="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t};return!!t&&(t=t.call("DOMParser"in window&&new DOMParser||window,e,"text/xml"),!!this.isXML(t))&&t}};function m(){var e="{}";if("userDataBehavior"==d){c.load("jStorage");try{e=c.getAttribute("jStorage")}catch(e){}try{p=c.getAttribute("jStorage_update")}catch(e){}s.jStorage=e}o(),x(),_()}function i(){var o;clearTimeout(t),t=setTimeout(function(){if("localStorage"==d||"globalStorage"==d)o=s.jStorage_update;else if("userDataBehavior"==d){c.load("jStorage");try{o=c.getAttribute("jStorage_update")}catch(e){}}if(o&&o!=p){p=o;var e,t=l.parse(l.stringify(u.__jstorage_meta.CRC32));m(),e=l.parse(l.stringify(u.__jstorage_meta.CRC32));var i,n=[],r=[];for(i in t)t.hasOwnProperty(i)&&(e[i]?t[i]!=e[i]&&"2."==String(t[i]).substr(0,2)&&n.push(i):r.push(i));for(i in e)!e.hasOwnProperty(i)||t[i]||n.push(i);v(n,"updated"),v(r,"deleted")}},25)}function v(e,t){var i,n,r,o;if(e=[].concat(e||[]),"flushed"==t){for(var s in e=[],h)h.hasOwnProperty(s)&&e.push(s);t="deleted"}for(i=0,r=e.length;i<r;i++){if(h[e[i]])for(n=0,o=h[e[i]].length;n<o;n++)h[e[i]][n](e[i],t);if(h["*"])for(n=0,o=h["*"].length;n<o;n++)h["*"][n](e[i],t)}}function y(){var e=(+new Date).toString();if("localStorage"==d||"globalStorage"==d)try{s.jStorage_update=e}catch(e){d=!1}else"userDataBehavior"==d&&(c.setAttribute("jStorage_update",e),c.save("jStorage"));i()}function o(){if(s.jStorage)try{u=l.parse(String(s.jStorage))}catch(e){s.jStorage="{}"}else s.jStorage="{}";n=s.jStorage?String(s.jStorage).length:0,u.__jstorage_meta||(u.__jstorage_meta={}),u.__jstorage_meta.CRC32||(u.__jstorage_meta.CRC32={})}function b(){if(u.__jstorage_meta.PubSub){for(var e=+new Date-2e3,t=0,i=u.__jstorage_meta.PubSub.length;t<i;t++)if(u.__jstorage_meta.PubSub[t][0]<=e){u.__jstorage_meta.PubSub.splice(t,u.__jstorage_meta.PubSub.length-t);break}u.__jstorage_meta.PubSub.length||delete u.__jstorage_meta.PubSub}try{s.jStorage=l.stringify(u),c&&(c.setAttribute("jStorage",s.jStorage),c.save("jStorage")),n=s.jStorage?String(s.jStorage).length:0}catch(e){}}function w(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==e)throw new TypeError("Reserved key name")}function x(){var e,t,i,n,r=1/0,o=!1,s=[];if(clearTimeout(a),u.__jstorage_meta&&"object"==typeof u.__jstorage_meta.TTL){for(t in e=+new Date,i=u.__jstorage_meta.TTL,n=u.__jstorage_meta.CRC32,i)i.hasOwnProperty(t)&&(i[t]<=e?(delete i[t],delete n[t],delete u[t],o=!0,s.push(t)):i[t]<r&&(r=i[t]));r!=1/0&&(a=setTimeout(x,Math.min(r-e,2147483647))),o&&(b(),y(),v(s,"deleted"))}}function _(){if(u.__jstorage_meta.PubSub){for(var e,t=g,i=[],n=u.__jstorage_meta.PubSub.length-1;0<=n;n--)(e=u.__jstorage_meta.PubSub[n])[0]>g&&(t=e[0],i.unshift(e));for(n=i.length-1;0<=n;n--){a=s=o=r=void 0;var r=i[n][1],o=i[n][2];if(f[r])for(var s=0,a=f[r].length;s<a;s++)try{f[r][s](r,l.parse(l.stringify(o)))}catch(e){}}g=t}}e=!(e.jStorage={version:"0.4.12",set:function(e,t,i){if(w(e),i=i||{},void 0===t)this.deleteKey(e);else{if(r.isXML(t))t={_is_xml:!0,xml:r.encode(t)};else{if("function"==typeof t)return;t&&"object"==typeof t&&(t=l.parse(l.stringify(t)))}u[e]=t,u.__jstorage_meta.CRC32[e]="2."+function(e,t){for(var i,n=e.length,r=t^n,o=0;4<=n;)i=1540483477*(65535&(i=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(i>>>16)&65535)<<16),r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16)^1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16),n-=4,++o;switch(n){case 3:r^=(255&e.charCodeAt(o+2))<<16;case 2:r^=(255&e.charCodeAt(o+1))<<8;case 1:r=1540483477*(65535&(r^=255&e.charCodeAt(o)))+((1540483477*(r>>>16)&65535)<<16)}return r=1540483477*(65535&(r^=r>>>13))+((1540483477*(r>>>16)&65535)<<16),(r^=r>>>15)>>>0}(l.stringify(t),2538058380),this.setTTL(e,i.TTL||0),v(e,"updated")}return t},get:function(e,t){return w(e),e in u?u[e]&&"object"==typeof u[e]&&u[e]._is_xml?r.decode(u[e].xml):u[e]:void 0===t?null:t},deleteKey:function(e){return w(e),e in u&&(delete u[e],"object"==typeof u.__jstorage_meta.TTL&&e in u.__jstorage_meta.TTL&&delete u.__jstorage_meta.TTL[e],delete u.__jstorage_meta.CRC32[e],b(),y(),v(e,"deleted"),!0)},setTTL:function(e,t){var i=+new Date;return w(e),t=Number(t)||0,e in u&&(u.__jstorage_meta.TTL||(u.__jstorage_meta.TTL={}),0<t?u.__jstorage_meta.TTL[e]=i+t:delete u.__jstorage_meta.TTL[e],b(),x(),y(),!0)},getTTL:function(e){var t=+new Date;return w(e),e in u&&u.__jstorage_meta.TTL&&u.__jstorage_meta.TTL[e]&&u.__jstorage_meta.TTL[e]-t||0},flush:function(){return u={__jstorage_meta:{CRC32:{}}},b(),y(),v(null,"flushed"),!0},storageObj:function(){function e(){}return e.prototype=u,new e},index:function(){var e,t=[];for(e in u)u.hasOwnProperty(e)&&"__jstorage_meta"!=e&&t.push(e);return t},storageSize:function(){return n},currentBackend:function(){return d},storageAvailable:function(){return!!d},listenKeyChange:function(e,t){w(e),h[e]||(h[e]=[]),h[e].push(t)},stopListening:function(e,t){if(w(e),h[e])if(t)for(var i=h[e].length-1;0<=i;i--)h[e][i]==t&&h[e].splice(i,1);else delete h[e]},subscribe:function(e,t){if(!(e=(e||"").toString()))throw new TypeError("Channel not defined");f[e]||(f[e]=[]),f[e].push(t)},publish:function(e,t){if(!(e=(e||"").toString()))throw new TypeError("Channel not defined");e=e,t=t,u.__jstorage_meta||(u.__jstorage_meta={}),u.__jstorage_meta.PubSub||(u.__jstorage_meta.PubSub=[]),u.__jstorage_meta.PubSub.unshift([+new Date,e,t]),b(),y()},reInit:function(){m()},noConflict:function(e){return delete window.$.jStorage,e&&(window.jStorage=this),this}});if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),e=!0,window.localStorage.removeItem("_tmptest")}catch(e){}if(e)try{window.localStorage&&(s=window.localStorage,d="localStorage",p=s.jStorage_update)}catch(e){}else if("globalStorage"in window)try{window.globalStorage&&(s="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],d="globalStorage",p=s.jStorage_update)}catch(e){}else{if(!(c=document.createElement("link")).addBehavior)return c=null;c.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(c);try{c.load("jStorage")}catch(e){c.setAttribute("jStorage","{}"),c.save("jStorage"),c.load("jStorage")}e="{}";try{e=c.getAttribute("jStorage")}catch(e){}try{p=c.getAttribute("jStorage_update")}catch(e){}s.jStorage=e,d="userDataBehavior"}o(),x(),"localStorage"==d||"globalStorage"==d?"addEventListener"in window?window.addEventListener("storage",i,!1):document.attachEvent("onstorage",i):"userDataBehavior"==d&&setInterval(i,1e3),_(),"addEventListener"in window&&window.addEventListener("pageshow",function(e){e.persisted&&i()},!1)}(),!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.bootbox=t(e.jQuery)}(this,function t(l,u){"use strict";function a(e,t,i){e.stopPropagation(),e.preventDefault(),l.isFunction(i)&&!1===i(e)||t.modal("hide")}function c(e,i){var n=0;l.each(e,function(e,t){i(e,t,n++)})}function d(e){var n,r;if("object"!=typeof e)throw new Error("Please supply an object of options");if(e.message)return(e=l.extend({},o,e)).buttons||(e.buttons={}),e.backdrop=!!e.backdrop&&"static",n=e.buttons,r=function(e){var t,i=0;for(t in e)i++;return i}(n),c(n,function(e,t,i){if(l.isFunction(t)&&(t=n[e]={callback:t}),"object"!==l.type(t))throw new Error("button with key "+e+" must be an object");t.label||(t.label=e),t.className||(t.className=r<=2&&i===r-1?"btn-primary":"btn-default")}),e;throw new Error("Please specify a message")}function h(e,t,i){return l.extend(!0,{},e,function(e,t){var i=e.length,n={};if(i<1||2<i)throw new Error("Invalid argument length");return 2===i||"string"==typeof e[0]?(n[t[0]]=e[0],n[t[1]]=e[1]):n=e[0],n}(t,i))}function i(e,t,i,n){return f(h({className:"bootbox-"+e,buttons:p.apply(null,t)},n,i),t)}function p(){for(var e={},t=0,i=arguments.length;t<i;t++){var n=arguments[t],r=n.toLowerCase(),n=n.toUpperCase();e[r]={label:(r=n,(s[o.locale]||s.en)[r])}}return e}function f(e,t){var i={};return c(t,function(e,t){i[t]=!0}),c(e.buttons,function(e){if(i[e]===u)throw new Error("button key "+e+" is not allowed (options are "+t.join("\n")+")")}),e}var g={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},o={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0,container:"body"},m={alert:function(){var e=i("alert",["ok"],["message","callback"],arguments);if(e.callback&&!l.isFunction(e.callback))throw new Error("alert requires callback property to be a function when provided");return e.buttons.ok.callback=e.onEscape=function(){return!l.isFunction(e.callback)||e.callback()},m.dialog(e)},confirm:function(){var e=i("confirm",["cancel","confirm"],["message","callback"],arguments);if(e.buttons.cancel.callback=e.onEscape=function(){return e.callback(!1)},e.buttons.confirm.callback=function(){return e.callback(!0)},l.isFunction(e.callback))return m.dialog(e);throw new Error("confirm requires a callback")},prompt:function(){var t,r,e=l(g.form),o=f(h({className:"bootbox-prompt",buttons:p("cancel","confirm"),value:"",inputType:"text"},arguments,["title","callback"]),["cancel","confirm"]),i=o.show===u||o.show;if(o.message=e,o.buttons.cancel.callback=o.onEscape=function(){return o.callback(null)},o.buttons.confirm.callback=function(){switch(o.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":i=r.val();break;case"checkbox":var e=r.find("input:checked"),i=[];c(e,function(e,t){i.push(l(t).val())})}return o.callback(i)},o.show=!1,!o.title)throw new Error("prompt requires a title");if(!l.isFunction(o.callback))throw new Error("prompt requires a callback");if(!g.inputs[o.inputType])throw new Error("invalid prompt type");switch(r=l(g.inputs[o.inputType]),o.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":r.val(o.value);break;case"select":var n,s={};if(!(n=o.inputOptions||[]).length)throw new Error("prompt with select requires options");c(n,function(e,t){var i=r;if(t.value===u||t.text===u)throw new Error("given options in wrong format");t.group&&(s[t.group]||(s[t.group]=l("<optgroup/>").attr("label",t.group)),i=s[t.group]),i.append("<option value='"+t.value+"'>"+t.text+"</option>")}),c(s,function(e,t){r.append(t)}),r.val(o.value);break;case"checkbox":var a=l.isArray(o.value)?o.value:[o.value];if(!(n=o.inputOptions||[]).length)throw new Error("prompt with checkbox requires options");if(!n[0].value||!n[0].text)throw new Error("given options in wrong format");r=l("<div/>"),c(n,function(e,i){var n=l(g.inputs[o.inputType]);n.find("input").attr("value",i.value),n.find("label").append(i.text),c(a,function(e,t){t===i.value&&n.find("input").prop("checked",!0)}),r.append(n)})}return o.placeholder&&r.attr("placeholder",o.placeholder),o.pattern&&r.attr("pattern",o.pattern),e.append(r),e.on("submit",function(e){e.preventDefault(),e.stopPropagation(),t.find(".btn-primary").click()}),(t=m.dialog(o)).off("shown.bs.modal"),t.on("shown.bs.modal",function(){r.focus()}),!0===i&&t.modal("show"),t},dialog:function(e){e=d(e);var i=l(g.dialog),t=i.find(".modal-dialog"),n=i.find(".modal-body"),r=e.buttons,o="",s={onEscape:e.onEscape};return c(r,function(e,t){o+="<button data-bb-handler='"+e+"' type='button' class='btn "+t.className+"'>"+t.label+"</button>",s[e]=t.callback}),n.find(".bootbox-body").html(e.message),!0===e.animate&&i.addClass("fade"),e.className&&i.addClass(e.className),"large"===e.size&&t.addClass("modal-lg"),"small"===e.size&&t.addClass("modal-sm"),e.title&&n.before(g.header),e.closeButton&&(r=l(g.closeButton),e.title?i.find(".modal-header").prepend(r):r.css("margin-top","-10px").prependTo(n)),e.title&&i.find(".modal-title").html(e.title),o.length&&(n.after(g.footer),i.find(".modal-footer").html(o)),i.on("hidden.bs.modal",function(e){e.target===this&&i.remove()}),i.on("shown.bs.modal",function(){i.find(".btn-primary:first").focus()}),i.on("escape.close.bb",function(e){s.onEscape&&a(e,i,s.onEscape)}),i.on("click",".modal-footer button",function(e){var t=l(this).data("bb-handler");a(e,i,s[t])}),i.on("click",".bootbox-close-button",function(e){a(e,i,s.onEscape)}),i.on("keyup",function(e){27===e.which&&i.trigger("escape.close.bb")}),l(e.container).append(i),i.modal({backdrop:e.backdrop,keyboard:!1,show:!1}),e.show&&i.modal("show"),i},setDefaults:function(){var e={};2===arguments.length?e[arguments[0]]=arguments[1]:e=arguments[0],l.extend(o,e)},hideAll:function(){return l(".bootbox").modal("hide"),m}},s={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zrušit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"Εντάξει",CANCEL:"Ακύρωση",CONFIRM:"Επιβεβαίωση"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"キャンセル",CONFIRM:"確認"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return m.init=function(e){return t(e||l)},m}),!function(d){d.deparam=function(e,l){var u={},c={true:!0,false:!1,null:null};return d.each(e.replace(/\+/g," ").split("&"),function(e,t){var i=t.split("="),n=decodeURIComponent(i[0]),r=u,o=0,s=n.split("]["),a=s.length-1,a=/\[/.test(s[0])&&/\]$/.test(s[a])?(s[a]=s[a].replace(/\]$/,""),(s=s.shift().split("[").concat(s)).length-1):0;if(2===i.length)if(i=decodeURIComponent(i[1]),l&&(i=i&&!isNaN(i)?+i:"undefined"===i?void 0:void 0!==c[i]?c[i]:i),a)for(;o<=a;o++)r=r[n=""===s[o]?r.length:s[o]]=o<a?r[n]||(s[o+1]&&isNaN(s[o+1])?{}:[]):i;else d.isArray(u[n])?u[n].push(i):u[n]=void 0!==u[n]?[u[n],i]:i;else n&&(u[n]=l?void 0:"")}),u}}(jQuery),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?e(require("jquery")):e(jQuery)}(function(d){var i=/\+/g;function h(e){return f.raw?e:encodeURIComponent(e)}function p(e,t){e=f.raw?e:function(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(i," ")),f.json?JSON.parse(e):e}catch(e){}}(e);return d.isFunction(t)?t(e):e}var f=d.cookie=function(e,t,i){var n,r;if(void 0!==t&&!d.isFunction(t))return"number"==typeof(i=d.extend({},f.defaults,i)).expires&&(n=i.expires,(r=i.expires=new Date).setTime(+r+864e5*n)),document.cookie=[h(e),"=",(r=t,h(f.json?JSON.stringify(r):String(r))),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("");for(var o=e?void 0:{},s=document.cookie?document.cookie.split("; "):[],a=0,l=s.length;a<l;a++){var u=s[a].split("="),c=(c=u.shift(),f.raw?c:decodeURIComponent(c)),u=u.join("=");if(e&&e===c){o=p(u,t);break}e||void 0===(u=p(u))||(o[c]=u)}return o};f.defaults={},d.removeCookie=function(e,t){return void 0!==d.cookie(e)&&(d.cookie(e,"",d.extend({},t,{expires:-1})),!d.cookie(e))}}),!function(e){if("object"==typeof exports)e(require("jquery"),require("spin"));else if("function"==typeof define&&define.amd)define(["jquery","spin"],e);else{if(!window.Spinner)throw new Error("Spin.js not present");e(window.jQuery,window.Spinner)}}(function(r,o){r.fn.spin=function(i,n){return this.each(function(){var e=r(this),t=e.data();t.spinner&&(t.spinner.stop(),delete t.spinner),!1!==i&&(i=r.extend({color:n||e.css("color")},r.fn.spin.presets[i]||i),t.spinner=new o(i).spin(this))})},r.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}}),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(s){function i(e,t,i){var r,o,t={content:{message:"object"==typeof t?t.message:t,title:t.title||"",icon:t.icon||"",url:t.url||"#",target:t.target||"-"}};i=s.extend(!0,{},t,i),this.settings=s.extend(!0,{},n,i),this._defaults=n,"-"===this.settings.content.target&&(this.settings.content.target=this.settings.url_target),this.animations={start:"webkitAnimationStart oanimationstart MSAnimationStart animationstart",end:"webkitAnimationEnd oanimationend MSAnimationEnd animationend"},"number"==typeof this.settings.offset&&(this.settings.offset={x:this.settings.offset,y:this.settings.offset}),!this.settings.allow_duplicates&&(this.settings.allow_duplicates||(r=this,o=!1,s('[data-notify="container"]').each(function(e,t){var t=s(t),i=t.find('[data-notify="title"]').text().trim(),n=t.find('[data-notify="message"]').html().trim(),i=i===s("<div>"+r.settings.content.title+"</div>").html().trim(),n=n===s("<div>"+r.settings.content.message+"</div>").html().trim(),t=t.hasClass("alert-"+r.settings.type);return!(o=i&&n&&t?!0:o)}),o))||this.init()}var n={element:"body",position:null,type:"info",allow_dismiss:!0,allow_duplicates:!0,newest_on_top:!1,showProgressbar:!1,placement:{from:"top",align:"right"},offset:20,spacing:10,z_index:1031,delay:5e3,timer:1e3,url_target:"_blank",mouse_over:null,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class",template:'<div data-notify="container" class="col-xs-11 col-sm-4 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">&times;</button><span data-notify="icon"></span> <span data-notify="title">{1}</span> <span data-notify="message">{2}</span><div class="progress" data-notify="progressbar"><div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div></div><a href="{3}" target="{4}" data-notify="url"></a></div>'};String.format=function(){for(var e=arguments[0],t=1;t<arguments.length;t++)e=e.replace(RegExp("\\{"+(t-1)+"\\}","gm"),arguments[t]);return e},s.extend(i.prototype,{init:function(){var o=this;this.buildNotify(),this.settings.content.icon&&this.setIcon(),"#"!=this.settings.content.url&&this.styleURL(),this.styleDismiss(),this.placement(),this.bind(),this.notify={$ele:this.$ele,update:function(e,t){var i,n={};for(i in"string"==typeof e?n[e]=t:n=e,n)switch(i){case"type":this.$ele.removeClass("alert-"+o.settings.type),this.$ele.find('[data-notify="progressbar"] > .progress-bar').removeClass("progress-bar-"+o.settings.type),o.settings.type=n[i],this.$ele.addClass("alert-"+n[i]).find('[data-notify="progressbar"] > .progress-bar').addClass("progress-bar-"+n[i]);break;case"icon":var r=this.$ele.find('[data-notify="icon"]');"class"===o.settings.icon_type.toLowerCase()?r.removeClass(o.settings.content.icon).addClass(n[i]):(r.is("img")||r.find("img"),r.attr("src",n[i]));break;case"progress":r=o.settings.delay-o.settings.delay*(n[i]/100);this.$ele.data("notify-delay",r),this.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",n[i]).css("width",n[i]+"%");break;case"url":this.$ele.find('[data-notify="url"]').attr("href",n[i]);break;case"target":this.$ele.find('[data-notify="url"]').attr("target",n[i]);break;default:this.$ele.find('[data-notify="'+i+'"]').html(n[i])}t=this.$ele.outerHeight()+parseInt(o.settings.spacing)+parseInt(o.settings.offset.y);o.reposition(t)},close:function(){o.close()}}},buildNotify:function(){var e=this.settings.content;this.$ele=s(String.format(this.settings.template,this.settings.type,e.title,e.message,e.url,e.target)),this.$ele.attr("data-notify-position",this.settings.placement.from+"-"+this.settings.placement.align),this.settings.allow_dismiss||this.$ele.find('[data-notify="dismiss"]').css("display","none"),(this.settings.delay<=0&&!this.settings.showProgressbar||!this.settings.showProgressbar)&&this.$ele.find('[data-notify="progressbar"]').remove()},setIcon:function(){"class"===this.settings.icon_type.toLowerCase()?this.$ele.find('[data-notify="icon"]').addClass(this.settings.content.icon):this.$ele.find('[data-notify="icon"]').is("img")?this.$ele.find('[data-notify="icon"]').attr("src",this.settings.content.icon):this.$ele.find('[data-notify="icon"]').append('<img src="'+this.settings.content.icon+'" alt="Notify Icon" />')},styleDismiss:function(){this.$ele.find('[data-notify="dismiss"]').css({position:"absolute",right:"10px",top:"5px",zIndex:this.settings.z_index+2})},styleURL:function(){this.$ele.find('[data-notify="url"]').css({backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)",height:"100%",left:0,position:"absolute",top:0,width:"100%",zIndex:this.settings.z_index+1})},placement:function(){var i=this,e=this.settings.offset.y,t={display:"inline-block",margin:"0px auto",position:this.settings.position||("body"===this.settings.element?"fixed":"absolute"),transition:"all .5s ease-in-out",zIndex:this.settings.z_index},n=!1,r=this.settings;switch(s('[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])').each(function(){e=Math.max(e,parseInt(s(this).css(r.placement.from))+parseInt(s(this).outerHeight())+parseInt(r.spacing))}),!0===this.settings.newest_on_top&&(e=this.settings.offset.y),t[this.settings.placement.from]=e+"px",this.settings.placement.align){case"left":case"right":t[this.settings.placement.align]=this.settings.offset.x+"px";break;case"center":t.left=0,t.right=0}this.$ele.css(t).addClass(this.settings.animate.enter),s.each(Array("webkit-","moz-","o-","ms-",""),function(e,t){i.$ele[0].style[t+"AnimationIterationCount"]=1}),s(this.settings.element).append(this.$ele),!0===this.settings.newest_on_top&&(e=parseInt(e)+parseInt(this.settings.spacing)+this.$ele.outerHeight(),this.reposition(e)),s.isFunction(i.settings.onShow)&&i.settings.onShow.call(this.$ele),this.$ele.one(this.animations.start,function(){n=!0}).one(this.animations.end,function(){i.$ele.removeClass(i.settings.animate.enter),s.isFunction(i.settings.onShown)&&i.settings.onShown.call(this)}),setTimeout(function(){n||s.isFunction(i.settings.onShown)&&i.settings.onShown.call(this)},600)},bind:function(){var i,n=this;this.$ele.find('[data-notify="dismiss"]').on("click",function(){n.close()}),this.$ele.mouseover(function(){s(this).data("data-hover","true")}).mouseout(function(){s(this).data("data-hover","false")}),this.$ele.data("data-hover","false"),0<this.settings.delay&&(n.$ele.data("notify-delay",n.settings.delay),i=setInterval(function(){var e,t=parseInt(n.$ele.data("notify-delay"))-n.settings.timer;("false"===n.$ele.data("data-hover")&&"pause"===n.settings.mouse_over||"pause"!=n.settings.mouse_over)&&(e=(n.settings.delay-t)/n.settings.delay*100,n.$ele.data("notify-delay",t),n.$ele.find('[data-notify="progressbar"] > div').attr("aria-valuenow",e).css("width",e+"%")),t<=-n.settings.timer&&(clearInterval(i),n.close())},n.settings.timer))},close:function(){var e=this,t=parseInt(this.$ele.css(this.settings.placement.from)),i=!1;this.$ele.attr("data-closing","true").addClass(this.settings.animate.exit),e.reposition(t),s.isFunction(e.settings.onClose)&&e.settings.onClose.call(this.$ele),this.$ele.one(this.animations.start,function(){i=!0}).one(this.animations.end,function(){s(this).remove(),s.isFunction(e.settings.onClosed)&&e.settings.onClosed.call(this)}),setTimeout(function(){i||(e.$ele.remove(),e.settings.onClosed&&e.settings.onClosed(e.$ele))},600)},reposition:function(e){var t=this,i='[data-notify-position="'+this.settings.placement.from+"-"+this.settings.placement.align+'"]:not([data-closing="true"])',n=this.$ele.nextAll(i);(n=!0===this.settings.newest_on_top?this.$ele.prevAll(i):n).each(function(){s(this).css(t.settings.placement.from,e),e=parseInt(e)+parseInt(t.settings.spacing)+s(this).outerHeight()})}}),s.notify=function(e,t){return new i(0,e,t).notify},s.notifyDefaults=function(e){return n=s.extend(!0,{},n,e)},s.notifyClose=function(e){s(void 0===(e="warning"===e?"danger":e)||"all"===e?"[data-notify]":"success"===e||"info"===e||"warning"===e||"danger"===e?".alert-"+e+"[data-notify]":e?e+"[data-notify]":'[data-notify-position="'+e+'"]').find('[data-notify="dismiss"]').trigger("click")},s.notifyCloseExcept=function(e){("success"===(e="warning"===e?"danger":e)||"info"===e||"warning"===e||"danger"===e?s("[data-notify]").not(".alert-"+e):s("[data-notify]").not(e)).find('[data-notify="dismiss"]').trigger("click")}});